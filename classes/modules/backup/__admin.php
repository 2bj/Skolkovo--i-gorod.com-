<?php
 abstract class __backup extends baseModuleAdmin {public function backup_panel($vf33a4e939ffe21234596860b7249c246 = "") {if(!$vf33a4e939ffe21234596860b7249c246) {return "";}return backupModel::getInstance()->getChanges($vf33a4e939ffe21234596860b7249c246);}public function rollback() {$v3d477c1c43140638c8738b94181f5b18 = (int) getRequest('param0');backupModel::getInstance()->rollback($v3d477c1c43140638c8738b94181f5b18);}public function backup_save($vad0c3358f1a712601256bfc6e9ee9830 = "", $v05dd82e678780573a4af462d35d7f06d = "", $vf33a4e939ffe21234596860b7249c246 = "") {return backupModel::getInstance()->save($vad0c3358f1a712601256bfc6e9ee9830, $v05dd82e678780573a4af462d35d7f06d, $vf33a4e939ffe21234596860b7249c246);}public function config(){$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$v21ffce5b8a6cc8cc6a41448dd69623c9 = Array(    "backup" => Array(     "boolean:enabled" => NULL,     "int:max_timelimit" => NULL,     "int:max_save_actions" => NULL    ),        "snapshots" => Array(     "status:backup-directory" => SYS_MANIFEST_PATH . 'backup/'    )   );$v15d61712450a686a7f365adf4fef581f = getRequest("param0");if($v15d61712450a686a7f365adf4fef581f == "do") {$v21ffce5b8a6cc8cc6a41448dd69623c9 = $this->expectParams($v21ffce5b8a6cc8cc6a41448dd69623c9);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/backup/enabled", $v21ffce5b8a6cc8cc6a41448dd69623c9['backup']['boolean:enabled']);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/backup/max_timelimit", $v21ffce5b8a6cc8cc6a41448dd69623c9['backup']['int:max_timelimit']);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/backup/max_save_actions", $v21ffce5b8a6cc8cc6a41448dd69623c9['backup']['int:max_save_actions']);$this->chooseRedirect();}else {$v645ec79f22bec5efe970061d395cf7c4 = getRequest('ent');if(!$v645ec79f22bec5efe970061d395cf7c4) {$v645ec79f22bec5efe970061d395cf7c4 = time();$this->redirect($this->pre_lang . '/admin/backup/config/?ent=' . $v645ec79f22bec5efe970061d395cf7c4);}}$this->setDataType("settings");$this->setActionType("modify");$v21ffce5b8a6cc8cc6a41448dd69623c9['backup']['boolean:enabled'] = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/backup/enabled");$v21ffce5b8a6cc8cc6a41448dd69623c9['backup']['int:max_timelimit'] = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/backup/max_timelimit");$v21ffce5b8a6cc8cc6a41448dd69623c9['backup']['int:max_save_actions'] = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/backup/max_save_actions");$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($v21ffce5b8a6cc8cc6a41448dd69623c9, "settings");$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}public function createSnapshot() {$v7f2db423a49b305459147332fb01cf87 = outputBuffer::current();$v7f2db423a49b305459147332fb01cf87->contentType('text/javascript');$v7f2db423a49b305459147332fb01cf87->charset('utf-8');$v7f2db423a49b305459147332fb01cf87->clear();$v7f2db423a49b305459147332fb01cf87->option('comression', false);$vd5189de027922f81005951e6efe0efd5 = $this->pre_lang . '/admin/backup/config/';if(defined("CURRENT_VERSION_LINE") && false) {if(CURRENT_VERSION_LINE == "demo") {$v56bd7107802ebe56c6918992f0608ec6 = getLabel('error-disabled-in-demo');$v7f2db423a49b305459147332fb01cf87->push("alert('{$v56bd7107802ebe56c6918992f0608ec6}');window.location = '{$vd5189de027922f81005951e6efe0efd5}';");$v7f2db423a49b305459147332fb01cf87->end();}}$v1081232f9f4c5953506a75107dd45f6f = new baseXmlConfig(SYS_KERNEL_PATH . "subsystems/manifest/manifests/MakeSystemBackup.xml");$v7f5cb74af5d7f4b82200738fdbdc5a45 = new manifest($v1081232f9f4c5953506a75107dd45f6f);$v7f5cb74af5d7f4b82200738fdbdc5a45->hibernationsCountLeft = -1;$v7f5cb74af5d7f4b82200738fdbdc5a45->setCallback(new jsonManifestCallback());$v7f5cb74af5d7f4b82200738fdbdc5a45->execute();unset($v7f5cb74af5d7f4b82200738fdbdc5a45);$v7f2db423a49b305459147332fb01cf87->push("\nwindow.location = '{$vd5189de027922f81005951e6efe0efd5}';\n");$v7f2db423a49b305459147332fb01cf87->end();}public function deleteSnapshot() {$v5b063e275d506f65ebf1b02d926f19a4 = getRequest('filename');$v736007832d2167baaae763fd3a3f3cf1 = new umiDirectory(SYS_MANIFEST_PATH . 'backup/');foreach($v736007832d2167baaae763fd3a3f3cf1 as $v447b7147e84be512208dcc0995d67ebc) {if($v447b7147e84be512208dcc0995d67ebc instanceof umiFile) {if($v447b7147e84be512208dcc0995d67ebc->getFileName() == $v5b063e275d506f65ebf1b02d926f19a4) {$v447b7147e84be512208dcc0995d67ebc->delete();break;}}}$this->chooseRedirect($this->pre_lang . '/admin/backup/');}public function restoreSnapshot() {header("Content-type: text/javascript; charset=utf-8");if(defined("CURRENT_VERSION_LINE")) {if(CURRENT_VERSION_LINE == "demo") {$v56bd7107802ebe56c6918992f0608ec6 = getLabel('error-disabled-in-demo');echo "alert('{$v56bd7107802ebe56c6918992f0608ec6}');window.location.reload();";exit();}}disableOutputCompression();header("Content-type: text/javascript; charset=utf-8");if($v9b207167e5381c47682c6b4f58a623fb = manifest::unhibernate('RestoreSystemBackup')) {echo $v9b207167e5381c47682c6b4f58a623fb;}else {$v1081232f9f4c5953506a75107dd45f6f = new baseXmlConfig("classes/manifest/manifests/RestoreSystemBackup.xml");$v7f5cb74af5d7f4b82200738fdbdc5a45 = new manifest($v1081232f9f4c5953506a75107dd45f6f);$v7f5cb74af5d7f4b82200738fdbdc5a45->hibernationsCountLeft = 19;$v7f5cb74af5d7f4b82200738fdbdc5a45->addParam('external-archive-filepath', getRequest('filename'));$v7f5cb74af5d7f4b82200738fdbdc5a45->setCallback(new jsonManifestCallback());$v7f5cb74af5d7f4b82200738fdbdc5a45->execute();}echo <<<JS

window.location.reload();

JS;   exit();}public function downloadSnapshot() {$v5b063e275d506f65ebf1b02d926f19a4 = getRequest('filename');$v736007832d2167baaae763fd3a3f3cf1 = new umiDirectory(SYS_MANIFEST_PATH . 'backup/');foreach($v736007832d2167baaae763fd3a3f3cf1 as $v447b7147e84be512208dcc0995d67ebc) {if($v447b7147e84be512208dcc0995d67ebc instanceof umiFile) {if($v447b7147e84be512208dcc0995d67ebc->getFileName() == $v5b063e275d506f65ebf1b02d926f19a4) {$v447b7147e84be512208dcc0995d67ebc->download();break;}}}$this->chooseRedirect($this->pre_lang . '/admin/backup/');}};?>