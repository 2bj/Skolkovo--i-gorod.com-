<?php
 class umiBasket extends singleton implements iSingleton, iUmiBasket {private $arrBasket = array();private $oAuthUser = null;private $oUserBasket = null;private $arrUserOrders = array();public $iBasketOrderId = null;public static function getInstance() {return parent::getInstance(__CLASS__);}protected function addDefaultCurrency() {$v7f5cbfbf72c13c3428b35837dff582f8 = umiObjectTypesCollection::getInstance()->getBaseType("eshop", "currency");if (!$this->getCurrencyIdBySId("RUB")) {if ($v9017fb3bf59312f4fd0f9b05ca2d6b2a = umiObjectsCollection::getInstance()->addObject(" Российский рубль", $v7f5cbfbf72c13c3428b35837dff582f8)) {$vbd3adc4abcd2cd0e0ed0ef2ebc9babba = umiObjectsCollection::getInstance()->getObject($v9017fb3bf59312f4fd0f9b05ca2d6b2a);$v1f7b4f1dbe8fa53089854e0ffa829523 = 1;$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->setName("Российский рубль");$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->setValue("eshop_currency_letter_code", "RUB");$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->setValue("eshop_currency_symbol", "Руб.");$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->setValue("eshop_currency_exchange_rate", 1);$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->setValue("eshop_currency_nominal", 1);$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->setValue("use_in_eshop", true);$vbd3adc4abcd2cd0e0ed0ef2ebc9babba->commit();}}}protected function __construct() {$v186ba0d5990f6e43e7ad46f0dbaa47fb = cmsController::getInstance()->getModule("users");$this->pre_lang = $v186ba0d5990f6e43e7ad46f0dbaa47fb->pre_lang;self::addDefaultCurrency();if (!regedit::getInstance()->getVal("//modules/eshop/default_currency_code")) {regedit::getInstance()->setVal("//modules/eshop/default_currency_code", "RUB");}if (!$vac22dc37185bfb86c70c01e405ee3a41 = getSession("eshop_currency")) {if ($v989f7db4a0aff0e98d7613c6237994c3 = regedit::getInstance()->getVal("//modules/eshop/default_currency_code")) {if ($v0873fd1803b4616bc91d2a07edc36f83 = $this->getCurrencyIdBySId($v989f7db4a0aff0e98d7613c6237994c3)) {if ($vc67900acfb42046331b80ee12f9092ca = $this->getCurrencyFullInfo($v0873fd1803b4616bc91d2a07edc36f83)) {$_SESSION['eshop_currency'] = $vc67900acfb42046331b80ee12f9092ca;$this->currencyInfo = $vc67900acfb42046331b80ee12f9092ca;}else {$this->currencyInfo = $this->getCurrencyFullInfo(false);}}}}else {$this->currencyInfo = getSession("eshop_currency");}if ($v186ba0d5990f6e43e7ad46f0dbaa47fb && $v186ba0d5990f6e43e7ad46f0dbaa47fb->is_auth()) {$v7ad6e70c936a7223ff2f1663258f4a0a = cmsController::getInstance()->getModule("users")->user_id;$vbcf86f29ac4d9422a46f1df6a5835bc7 = umiObjectsCollection::getInstance()->getObject($v7ad6e70c936a7223ff2f1663258f4a0a);if ($vbcf86f29ac4d9422a46f1df6a5835bc7 instanceof umiObject) {$this->oAuthUser = $vbcf86f29ac4d9422a46f1df6a5835bc7;$v99c77b7f5f1c13a61a2bb6714cc6148c = $vbcf86f29ac4d9422a46f1df6a5835bc7->getValue("orders_refs");sort($v99c77b7f5f1c13a61a2bb6714cc6148c, SORT_NUMERIC);$this->arrUserOrders = array_reverse($v99c77b7f5f1c13a61a2bb6714cc6148c);$this->oUserBasket = null;$this->oUserBasket = $this->getUserBasket();$this->iBasketOrderId = $this->oUserBasket->getId();}if ($v52da19fcb82fee397e92cdedeaaf552b = $vbcf86f29ac4d9422a46f1df6a5835bc7->getValue("preffered_currency")) {if ($v447a171b335c14c5ec83464ae32394c2 = $this->getCurrencyFullInfo($v52da19fcb82fee397e92cdedeaaf552b)) {$vac22dc37185bfb86c70c01e405ee3a41 = getSession("eshop_currency");if ($vac22dc37185bfb86c70c01e405ee3a41) {$v1af0389838508d7016a9841eb6273962 = umiObjectsCollection::getInstance()->getObject($vac22dc37185bfb86c70c01e405ee3a41['ID']);if ($v1af0389838508d7016a9841eb6273962 instanceof umiObject) {$v367e854225a0810977297b3bedb2f309 = $v1af0389838508d7016a9841eb6273962->getValue("use_in_eshop");if (!$v367e854225a0810977297b3bedb2f309) {$v9b192b46554d909d1b98ef3b1348bb4a = regedit::getInstance()->getVal("//modules/eshop/default_currency_code");$vf82265ccceac13b2f40ccd9e81cbd263 = $this->getCurrencyIdBySId($v9b192b46554d909d1b98ef3b1348bb4a);if ($vf82265ccceac13b2f40ccd9e81cbd263) {if ($vda95ba8c7ad526c3f0083da1179de11c = $this->getCurrencyFullInfo($vf82265ccceac13b2f40ccd9e81cbd263)) {$_SESSION["eshop_currency"] = $vda95ba8c7ad526c3f0083da1179de11c;}}}}}else {$_SESSION['eshop_currency'] = $v447a171b335c14c5ec83464ae32394c2;$this->currencyInfo = $v447a171b335c14c5ec83464ae32394c2;}}}if (isset($_SESSION['umi_basket']) && is_array($_SESSION['umi_basket'])) {foreach ($_SESSION['umi_basket'] as $vdada7698e90003048a305e981875250f => $v6ad9da766f68c8a186c7128f54dc2fe7) {$v4001fcc4579ade3073c3d6b350f1cb1d = isset($v6ad9da766f68c8a186c7128f54dc2fe7['count'])? (int) $v6ad9da766f68c8a186c7128f54dc2fe7['count'] : 1;$this->addToBasket($vdada7698e90003048a305e981875250f, $v4001fcc4579ade3073c3d6b350f1cb1d, false);usleep(100);}$this->recalcBasket();unset($_SESSION['umi_basket']);session_commit();$this->oUserBasket->update();}}else {if (isset($_SESSION['umi_basket']) && is_array($_SESSION['umi_basket'])) {$this->arrBasket = $_SESSION['umi_basket'];}}if (!isset($this->currencyInfo)) {$this->currencyInfo = Array(     'ID' => "",     'name' => "",     'char_code' => "",     'num_code' => "",     'exchange' => 1,     'symbol' => ""    );}}public function getUserBasket() {if ($this->oUserBasket instanceof umiObject) return $this->oUserBasket;$vdcb9afbd8280826e367d80729a873796 = null;for ($v168965c34d6a1fd6ad3d68aa5e76ae56 = 0;$v168965c34d6a1fd6ad3d68aa5e76ae56 < count($this->arrUserOrders);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$v015d7d5955a6c24c16819c190e17119c = umiObjectsCollection::getInstance()->getObject($this->arrUserOrders[$v168965c34d6a1fd6ad3d68aa5e76ae56]);if ($v015d7d5955a6c24c16819c190e17119c instanceof umiObject) {$v8fe28c0d2566be75ba389f80bde58dbe = $v015d7d5955a6c24c16819c190e17119c->getValue("status");$vb373676bb979e6765e65bf71b71f0e59 = umiObjectsCollection::getInstance()->getObject($v8fe28c0d2566be75ba389f80bde58dbe);if ($vb373676bb979e6765e65bf71b71f0e59 instanceof umiObject) {$vc2c71c9cea7d8612c574c7bf4208a850 = $vb373676bb979e6765e65bf71b71f0e59->getValue("id_name");if ($vc2c71c9cea7d8612c574c7bf4208a850 == "cart") {$vdcb9afbd8280826e367d80729a873796 = $v015d7d5955a6c24c16819c190e17119c;break;}}}}if (!$vdcb9afbd8280826e367d80729a873796 instanceof umiObject) {$v963cecbdfa91757f2c7a4a9e794f3da7 = umiObjectTypesCollection::getInstance()->getBaseType("eshop", "order");$v99d66bded2c34a2de292eb583294cfd8 = umiObjectsCollection::getInstance()->addObject("tmp", $v963cecbdfa91757f2c7a4a9e794f3da7);$vc36891666d27ef9f0ad1c906807a25b7 = umiObjectsCollection::getInstance()->getObject($v99d66bded2c34a2de292eb583294cfd8);if ($vc36891666d27ef9f0ad1c906807a25b7 instanceof umiObject) {$v8fe28c0d2566be75ba389f80bde58dbe = $this->getStatusBySId("cart");if ($v8fe28c0d2566be75ba389f80bde58dbe !== false) {$vc36891666d27ef9f0ad1c906807a25b7->setValue("status", $v8fe28c0d2566be75ba389f80bde58dbe);$vc36891666d27ef9f0ad1c906807a25b7->setValue("order_time", new umiDate());$this->arrUserOrders[] = $v99d66bded2c34a2de292eb583294cfd8;$this->oAuthUser->setValue("orders_refs", $this->arrUserOrders);$this->oAuthUser->commit();}$vc36891666d27ef9f0ad1c906807a25b7->setName("#" . $v99d66bded2c34a2de292eb583294cfd8);$vb0ab4f7791b60b1e8ea01057b77873b0 = $vc36891666d27ef9f0ad1c906807a25b7->getOwnerId();if($vb0ab4f7791b60b1e8ea01057b77873b0) {$vc36891666d27ef9f0ad1c906807a25b7->setValue("user_id", $vc36891666d27ef9f0ad1c906807a25b7->getOwnerId());}$vc36891666d27ef9f0ad1c906807a25b7->commit();}$vdcb9afbd8280826e367d80729a873796 = $vc36891666d27ef9f0ad1c906807a25b7;}return $vdcb9afbd8280826e367d80729a873796;}public static function getStatusBySId($vc2c71c9cea7d8612c574c7bf4208a850) {$v963cecbdfa91757f2c7a4a9e794f3da7 = umiObjectTypesCollection::getInstance()->getBaseType("eshop", "order_status");$v770c309c1aed0fbfabad24a3d5933129 = new umiSelection;$v770c309c1aed0fbfabad24a3d5933129->setObjectTypeFilter();$v770c309c1aed0fbfabad24a3d5933129->addObjectType($v963cecbdfa91757f2c7a4a9e794f3da7);$v76e5bebbd31002d9f9bdc30cf3f9e80e = umiSelectionsParser::runSelection($v770c309c1aed0fbfabad24a3d5933129);foreach($v76e5bebbd31002d9f9bdc30cf3f9e80e as $v8fe28c0d2566be75ba389f80bde58dbe) {$v6437d643343493ea14e85b62c6d469a7 = umiObjectsCollection::getInstance()->getObject($v8fe28c0d2566be75ba389f80bde58dbe);if ($v6437d643343493ea14e85b62c6d469a7 instanceof umiObject && $v6437d643343493ea14e85b62c6d469a7->getValue("id_name") == $vc2c71c9cea7d8612c574c7bf4208a850) {return $v8fe28c0d2566be75ba389f80bde58dbe;}else {umiObjectsCollection::getInstance()->unloadObject($v8fe28c0d2566be75ba389f80bde58dbe);}}return false;}public function getCurrencyFullInfo($vf82265ccceac13b2f40ccd9e81cbd263) {if ($v1af0389838508d7016a9841eb6273962 = umiObjectsCollection::getInstance()->getObject($vf82265ccceac13b2f40ccd9e81cbd263)) {$v9b207167e5381c47682c6b4f58a623fb = Array(     'ID' => $v1af0389838508d7016a9841eb6273962->getId(),     'name' => $v1af0389838508d7016a9841eb6273962->getName(),     'char_code' => $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_letter_code"),     'num_code' => $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_digit_code"),     'exchange' => $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_exchange_rate"),     'symbol' => $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_symbol"),     'used'  => $v1af0389838508d7016a9841eb6273962->getValue("use_in_eshop")    );return $v9b207167e5381c47682c6b4f58a623fb;}else {return $this->currencyInfo;}}public function recalcBasket() {$v4cead3d6ab5da0edf249f6a9f60d67e1 = 0;if ($this->oUserBasket instanceof umiObject) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue('items');foreach ($vdc7a98f1b58b3830d6bad4f2d3d7f80c as $v4871f4bb9cbe707fa1e58df3ca89e64c) {$v6a183de20981accc6e2669cd7c8e9f37 = umiObjectsCollection::getInstance()->getObject($v4871f4bb9cbe707fa1e58df3ca89e64c);if ($v6a183de20981accc6e2669cd7c8e9f37 instanceof umiObject) {$v4001fcc4579ade3073c3d6b350f1cb1d = (int) $v6a183de20981accc6e2669cd7c8e9f37->getValue("count");$vdada7698e90003048a305e981875250f = $v6a183de20981accc6e2669cd7c8e9f37->getValue("catalog_relation");$v266dfb6190a3ce57973bce176a01701e = umiHierarchy::getInstance()->getElement($vdada7698e90003048a305e981875250f, true, true);$v2f00ba1902e84d6f712f04a6bd702d20 = 0;if ($v266dfb6190a3ce57973bce176a01701e instanceof umiHierarchyElement) {$vb2594a9ab5a8904453deabc3eb7ea896 = (float) $v266dfb6190a3ce57973bce176a01701e->getValue("price");$v15d61712450a686a7f365adf4fef581f = cmsController::getInstance()->getCurrentMode();if(!$v266dfb6190a3ce57973bce176a01701e->getValue("ignore_discounts") && $v15d61712450a686a7f365adf4fef581f != "admin") {$v2f00ba1902e84d6f712f04a6bd702d20 = cmsController::getInstance()->getModule("eshop")->getElementDiscountSize($vdada7698e90003048a305e981875250f);}umiHierarchy::getInstance()->unloadElement($vdada7698e90003048a305e981875250f);}else {$vb2594a9ab5a8904453deabc3eb7ea896 = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_item");}$vfc84f2e61c76eef0a7d2756a556e18af = $vb2594a9ab5a8904453deabc3eb7ea896 * $v4001fcc4579ade3073c3d6b350f1cb1d;$v4cead3d6ab5da0edf249f6a9f60d67e1 += $vfc84f2e61c76eef0a7d2756a556e18af;$v6a183de20981accc6e2669cd7c8e9f37->setValue("price_item", $vb2594a9ab5a8904453deabc3eb7ea896);$v6a183de20981accc6e2669cd7c8e9f37->setValue("price_total",  $vfc84f2e61c76eef0a7d2756a556e18af);$v6a183de20981accc6e2669cd7c8e9f37->setValue("discount_size", $v2f00ba1902e84d6f712f04a6bd702d20);if ($v39ef6876beef6b0bd0447481a49e0a8b = $this->getCurrencyIdBySId($this->currencyInfo['char_code'])) {$vbbb3865b6d792bb5bac8c25fc7d9d5cc = $this->recalcCurrency($vb2594a9ab5a8904453deabc3eb7ea896, $this->currencyInfo['char_code']);$v5c7b6ba08be4932fb910da451dac565e = $this->recalcCurrency($vfc84f2e61c76eef0a7d2756a556e18af, $this->currencyInfo['char_code']);$v6a183de20981accc6e2669cd7c8e9f37->setValue("eshop_order_item_currency_price", $vbbb3865b6d792bb5bac8c25fc7d9d5cc);$v6a183de20981accc6e2669cd7c8e9f37->setValue("eshop_order_item_currency_price-total", $v5c7b6ba08be4932fb910da451dac565e);}$v6a183de20981accc6e2669cd7c8e9f37->commit();umiObjectsCollection::getInstance()->unloadObject($v4871f4bb9cbe707fa1e58df3ca89e64c);}}if ($v39ef6876beef6b0bd0447481a49e0a8b = $this->getCurrencyIdBySId($this->currencyInfo['char_code'])) {$v00a2509a3077aeb1c684495b8997ff2d = $this->recalcCurrency($v4cead3d6ab5da0edf249f6a9f60d67e1,$this->currencyInfo['char_code']);$this->oUserBasket->setValue("eshop_order_currency", $v39ef6876beef6b0bd0447481a49e0a8b);$this->oUserBasket->setValue("currency_exchange_rate", umiObjectsCollection::getInstance()->getObject($v39ef6876beef6b0bd0447481a49e0a8b)->getValue("eshop_currency_exchange_rate"));$this->oUserBasket->setValue("eshop_order_currency_total", $v00a2509a3077aeb1c684495b8997ff2d);$this->oUserBasket->commit();}$this->oUserBasket->setValue("order_price", $v4cead3d6ab5da0edf249f6a9f60d67e1);if (isset($this->currencyInfo['ID'])) {if ($vee11cbb19052e40b07aac0ca060c23ee = umiObjectsCollection::getInstance()->getObject($this->oUserBasket->getOwnerId())) {$vee11cbb19052e40b07aac0ca060c23ee->setValue("preffered_currency", $this->currencyInfo['ID']);$vee11cbb19052e40b07aac0ca060c23ee->commit();}}}else {foreach ($this->arrBasket as $vdada7698e90003048a305e981875250f => $v4ee5b6978eaf93554afdf93554daca3f) {$this->arrBasket[$vdada7698e90003048a305e981875250f]['price_total'] = $v4ee5b6978eaf93554afdf93554daca3f['count'] * (float) $v4ee5b6978eaf93554afdf93554daca3f['price_item'];$v4cead3d6ab5da0edf249f6a9f60d67e1 += $this->arrBasket[$vdada7698e90003048a305e981875250f]['price_total'];$v1f6c5af354dac8f09cb094dd4a41a111 = cmsController::getInstance()->getModule("eshop")->getGlobalDiscount($v4cead3d6ab5da0edf249f6a9f60d67e1);}}$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$v1f6c5af354dac8f09cb094dd4a41a111 = 0;if ($vb1444fb0c07653567ad325aa25d4e37a) {if (!$vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/eshop/disable_global_discount")) {$v1f6c5af354dac8f09cb094dd4a41a111 = cmsController::getInstance()->getModule("eshop")->getGlobalDiscount($v4cead3d6ab5da0edf249f6a9f60d67e1);}}if ($this->oUserBasket instanceof umiObject){$this->oUserBasket->setValue("global-discount-size", $v4cead3d6ab5da0edf249f6a9f60d67e1*$v1f6c5af354dac8f09cb094dd4a41a111/100);$this->oUserBasket->setValue("eshop_global_discount_proc", $v1f6c5af354dac8f09cb094dd4a41a111);$this->oUserBasket->commit();$this->globalDiscount = $v4cead3d6ab5da0edf249f6a9f60d67e1*$v1f6c5af354dac8f09cb094dd4a41a111/100;$v4cead3d6ab5da0edf249f6a9f60d67e1 = $v4cead3d6ab5da0edf249f6a9f60d67e1-($v4cead3d6ab5da0edf249f6a9f60d67e1*$v1f6c5af354dac8f09cb094dd4a41a111)/100;}else{$this->globalDiscount = $v4cead3d6ab5da0edf249f6a9f60d67e1*$v1f6c5af354dac8f09cb094dd4a41a111/100;$v4cead3d6ab5da0edf249f6a9f60d67e1 = $v4cead3d6ab5da0edf249f6a9f60d67e1-($v4cead3d6ab5da0edf249f6a9f60d67e1*$v1f6c5af354dac8f09cb094dd4a41a111)/100;}return $v4cead3d6ab5da0edf249f6a9f60d67e1;}public function getCurrencyIdBySId($v63fc25dd3b0d13e7b94b8bec99336150) {$v7f5cbfbf72c13c3428b35837dff582f8 = umiObjectTypesCollection::getInstance()->getBaseType("eshop", "currency");$v4101a5fdf0ed40cbaf9bea2e125182cb = umiObjectTypesCollection::getInstance()->getType($v7f5cbfbf72c13c3428b35837dff582f8);if ($v4101a5fdf0ed40cbaf9bea2e125182cb) {$v22a2d946c9fc6d6834069558722d8417 = $v4101a5fdf0ed40cbaf9bea2e125182cb->getFieldId('eshop_currency_letter_code');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v7f5cbfbf72c13c3428b35837dff582f8);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($v22a2d946c9fc6d6834069558722d8417, $v63fc25dd3b0d13e7b94b8bec99336150);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);if (!$result) {return false;}return $result[0];}}public function changeBasketItem($vdada7698e90003048a305e981875250f, $vb9f40d29448a72e2cfda3af6243709ed) {$vdada7698e90003048a305e981875250f = (int) $vdada7698e90003048a305e981875250f;$v4001fcc4579ade3073c3d6b350f1cb1d = isset($vb9f40d29448a72e2cfda3af6243709ed['count'])? (int) $vb9f40d29448a72e2cfda3af6243709ed['count'] : 1;if ($this->oUserBasket instanceof umiObject) {$v40911d343e3e3311186847c58f567c0f = $this->getBasketItem($vdada7698e90003048a305e981875250f);if ($v40911d343e3e3311186847c58f567c0f instanceof umiObject) {$v40911d343e3e3311186847c58f567c0f->setValue("count", $v4001fcc4579ade3073c3d6b350f1cb1d);$v40911d343e3e3311186847c58f567c0f->commit();}}elseif (isset($this->arrBasket[$vdada7698e90003048a305e981875250f])) {$this->arrBasket[$vdada7698e90003048a305e981875250f]['count'] = $v4001fcc4579ade3073c3d6b350f1cb1d;}$this->recalcBasket();}public function getBasketItemCount($vdada7698e90003048a305e981875250f) {$va5a928b6b6b19de8a18398c7b29f47d7 = 1;$vdada7698e90003048a305e981875250f = (int) $vdada7698e90003048a305e981875250f;if ($this->oUserBasket instanceof umiObject) {$v40911d343e3e3311186847c58f567c0f = $this->getBasketItem($vdada7698e90003048a305e981875250f);if ($v40911d343e3e3311186847c58f567c0f instanceof umiObject) {$va5a928b6b6b19de8a18398c7b29f47d7 = $v40911d343e3e3311186847c58f567c0f->getValue("count");}}elseif (isset($this->arrBasket[$vdada7698e90003048a305e981875250f])) {$va5a928b6b6b19de8a18398c7b29f47d7 = $this->arrBasket[$vdada7698e90003048a305e981875250f]['count'];}return $va5a928b6b6b19de8a18398c7b29f47d7;}public function getBasketItem($vd4307f7aed9d7eec636d292770b14e3a) {if ($this->oUserBasket instanceof umiObject) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue('items');foreach ($vdc7a98f1b58b3830d6bad4f2d3d7f80c as $v4871f4bb9cbe707fa1e58df3ca89e64c) {$v6a183de20981accc6e2669cd7c8e9f37 = umiObjectsCollection::getInstance()->getObject($v4871f4bb9cbe707fa1e58df3ca89e64c);if ($v4871f4bb9cbe707fa1e58df3ca89e64c == $vd4307f7aed9d7eec636d292770b14e3a && !$v6a183de20981accc6e2669cd7c8e9f37->getValue("catalog_relation")) {return $v6a183de20981accc6e2669cd7c8e9f37;}if ($v6a183de20981accc6e2669cd7c8e9f37 instanceof umiObject) {if ($v6a183de20981accc6e2669cd7c8e9f37->getValue("catalog_relation") == $vd4307f7aed9d7eec636d292770b14e3a) {return $v6a183de20981accc6e2669cd7c8e9f37;}}umiObjectsCollection::getInstance()->unloadObject($v4871f4bb9cbe707fa1e58df3ca89e64c);}}elseif (isset($this->arrBasket[$vd4307f7aed9d7eec636d292770b14e3a])) {return $this->arrBasket[$vd4307f7aed9d7eec636d292770b14e3a];}return null;}public function setItemPropertyValue($v7057e8409c7c531a1a6e9ac3df4ed549, $v73f329f154a663bfda020aadcdd0b775, $v2063c1608d6e0baf80249c42e2be5804) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getBasketItem($v7057e8409c7c531a1a6e9ac3df4ed549);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement) {$v9b207167e5381c47682c6b4f58a623fb = $v8e2dcfd7e7e24b1ca76c1193f645902b->setValue($v73f329f154a663bfda020aadcdd0b775, $v2063c1608d6e0baf80249c42e2be5804);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();return $v9b207167e5381c47682c6b4f58a623fb;}else {return false;}}public function addItemToUserBasket($v40911d343e3e3311186847c58f567c0f) {if ($this->oUserBasket instanceof umiObject && $v40911d343e3e3311186847c58f567c0f instanceof umiObject) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue('items');$vdc7a98f1b58b3830d6bad4f2d3d7f80c[] = $v40911d343e3e3311186847c58f567c0f->getId();$this->oUserBasket->setValue("items", $vdc7a98f1b58b3830d6bad4f2d3d7f80c);$this->oUserBasket->commit();}}public function addToBasket($vdada7698e90003048a305e981875250f, $v4001fcc4579ade3073c3d6b350f1cb1d = 1, $v3432271a37da0a83c769a938df03fd10 =true) {$v4001fcc4579ade3073c3d6b350f1cb1d = (int) $v4001fcc4579ade3073c3d6b350f1cb1d;$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("eshop_add_tobasket");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("before");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("element_id", $vdada7698e90003048a305e981875250f);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("count", $v4001fcc4579ade3073c3d6b350f1cb1d);def_module::setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$v266dfb6190a3ce57973bce176a01701e = umiHierarchy::getInstance()->getElement($vdada7698e90003048a305e981875250f, true, true);if ($v266dfb6190a3ce57973bce176a01701e instanceof umiHierarchyElement) {$vce123cab8b9ebbeeb4a8d88dd02ab599 = $v266dfb6190a3ce57973bce176a01701e->getName();$v51133816ce05f130a4de0cb29a56aa64 = (float) $v266dfb6190a3ce57973bce176a01701e->getValue("price");$v3c0f26d95118d32410046fe6d77e5f8f = null;if ($this->oUserBasket instanceof umiObject) {$v40911d343e3e3311186847c58f567c0f = $this->getBasketItem($vdada7698e90003048a305e981875250f);if ($v40911d343e3e3311186847c58f567c0f instanceof umiObject) {$v3c0f26d95118d32410046fe6d77e5f8f = $v40911d343e3e3311186847c58f567c0f->getId();$v40911d343e3e3311186847c58f567c0f->setValue("count", $v40911d343e3e3311186847c58f567c0f->getValue("count") + $v4001fcc4579ade3073c3d6b350f1cb1d);$v40911d343e3e3311186847c58f567c0f->commit();}else {$v963cecbdfa91757f2c7a4a9e794f3da7 = umiObjectTypesCollection::getInstance()->getBaseType("eshop", "order_item");$vab7cb92f603a66be8b596ca7caca6549 = umiObjectsCollection::getInstance()->addObject($vce123cab8b9ebbeeb4a8d88dd02ab599, $v963cecbdfa91757f2c7a4a9e794f3da7);$v3c0f26d95118d32410046fe6d77e5f8f = $vab7cb92f603a66be8b596ca7caca6549;$v40911d343e3e3311186847c58f567c0f = umiObjectsCollection::getInstance()->getObject($vab7cb92f603a66be8b596ca7caca6549);if ($v40911d343e3e3311186847c58f567c0f instanceof umiObject) {$v40911d343e3e3311186847c58f567c0f->setValue("price_item", $v51133816ce05f130a4de0cb29a56aa64);$v40911d343e3e3311186847c58f567c0f->setValue("count", $v4001fcc4579ade3073c3d6b350f1cb1d);$v40911d343e3e3311186847c58f567c0f->setValue("catalog_relation", array($vdada7698e90003048a305e981875250f));$v40911d343e3e3311186847c58f567c0f->commit();$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue('items');$vdc7a98f1b58b3830d6bad4f2d3d7f80c[] = $v40911d343e3e3311186847c58f567c0f->getId();$this->oUserBasket->setValue("items", $vdc7a98f1b58b3830d6bad4f2d3d7f80c);$this->oUserBasket->commit();}}}else {if (isset($this->arrBasket[$vdada7698e90003048a305e981875250f])) {$this->arrBasket[$vdada7698e90003048a305e981875250f]['count'] += $v4001fcc4579ade3073c3d6b350f1cb1d;}else {$this->arrBasket[$vdada7698e90003048a305e981875250f] = array('price_item' => $v51133816ce05f130a4de0cb29a56aa64, 'count' => $v4001fcc4579ade3073c3d6b350f1cb1d);}$_SESSION['umi_basket'] = $this->arrBasket;}if ($v3432271a37da0a83c769a938df03fd10) {$this->recalcBasket();}$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("eshop_add_tobasket");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("after");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("element_id", $vdada7698e90003048a305e981875250f);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("price_item", $v51133816ce05f130a4de0cb29a56aa64);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("count", $v4001fcc4579ade3073c3d6b350f1cb1d);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("new_basket_item_id", $v3c0f26d95118d32410046fe6d77e5f8f);def_module::setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);umiHierarchy::getInstance()->unloadElement($vdada7698e90003048a305e981875250f);}}public function removeFromBasket($vdada7698e90003048a305e981875250f) {$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("eshop_remove_frombasket");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("before");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("element_id", $vdada7698e90003048a305e981875250f);def_module::setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);if ($this->oUserBasket instanceof umiObject) {$v6a183de20981accc6e2669cd7c8e9f37 = $this->getBasketItem($vdada7698e90003048a305e981875250f);if ($v6a183de20981accc6e2669cd7c8e9f37 instanceof umiObject) {umiObjectsCollection::getInstance()->delObject($v6a183de20981accc6e2669cd7c8e9f37->getId());$v6f6b8983aa8e35763123f65ae38eb0b2 = $this->oUserBasket->getValue('items');if (is_array($v6f6b8983aa8e35763123f65ae38eb0b2)) {$v6f6b8983aa8e35763123f65ae38eb0b2 = array_diff($v6f6b8983aa8e35763123f65ae38eb0b2, array($v6a183de20981accc6e2669cd7c8e9f37->getId()));$this->oUserBasket->setValue('items', $v6f6b8983aa8e35763123f65ae38eb0b2);}$this->oUserBasket->commit();$this->recalcBasket();}}elseif (isset($this->arrBasket[$vdada7698e90003048a305e981875250f])) {unset($this->arrBasket[$vdada7698e90003048a305e981875250f]);$this->recalcBasket();}}public function clear() {if ($this->oUserBasket instanceof umiObject) {$v6f6b8983aa8e35763123f65ae38eb0b2 = $this->oUserBasket->getValue('items');if (is_array($v6f6b8983aa8e35763123f65ae38eb0b2)) {foreach($v6f6b8983aa8e35763123f65ae38eb0b2 as $vb80bb7740288fda1f201890375a60c8f) {$v447b7147e84be512208dcc0995d67ebc = umiObjectsCollection::getInstance()->getObject($vb80bb7740288fda1f201890375a60c8f);if (!$v447b7147e84be512208dcc0995d67ebc) continue;$ve4f211a5065ef1d955274b37906bc026 = $v447b7147e84be512208dcc0995d67ebc->getValue("catalog_relation");$this->removeFromBasket($ve4f211a5065ef1d955274b37906bc026);}}}elseif (count($this->arrBasket)) {foreach ($this->arrBasket as $ve4f211a5065ef1d955274b37906bc026 => $vfa816edb83e95bf0c8da580bdfd491ef) {$this->removeFromBasket($ve4f211a5065ef1d955274b37906bc026);}}}private function renderBasketItem($vd08a5699e22c853234b8c680e8fed98c, $v2db03d3a62131293122e5d8fdb26c7e5, &$ve2942a04780e223b215eb8b663cf5353 = NULL, &$v78a5eb43deef9a7b5b9ce157b9d52ac4 = NULL) {$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$vfca1bff8ad8b3a8585abfb0ad523ba42['node:name'] = "";$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:count'] = 0;$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price'] = 0;$vfca1bff8ad8b3a8585abfb0ad523ba42['void:price_total'] = 0;if ($vd08a5699e22c853234b8c680e8fed98c instanceof umiObject) {$v6a183de20981accc6e2669cd7c8e9f37 = $vd08a5699e22c853234b8c680e8fed98c;$vdada7698e90003048a305e981875250f = $vd08a5699e22c853234b8c680e8fed98c->getValue("catalog_relation");$v266dfb6190a3ce57973bce176a01701e = umiHierarchy::getInstance()->getElement($vdada7698e90003048a305e981875250f, true, true);}elseif ($vd08a5699e22c853234b8c680e8fed98c instanceof umiHierarchyElement) {$v266dfb6190a3ce57973bce176a01701e = $vd08a5699e22c853234b8c680e8fed98c;$vdada7698e90003048a305e981875250f = $v266dfb6190a3ce57973bce176a01701e->getId();}else {return false;}if ($v266dfb6190a3ce57973bce176a01701e instanceof umiHierarchyElement) {$vfca1bff8ad8b3a8585abfb0ad523ba42['node:name'] = $v266dfb6190a3ce57973bce176a01701e->getName();if ($this->oUserBasket instanceof umiObject) {$v6a183de20981accc6e2669cd7c8e9f37 = $this->getBasketItem($vdada7698e90003048a305e981875250f);if ($v6a183de20981accc6e2669cd7c8e9f37 instanceof umiObject) {$vb2594a9ab5a8904453deabc3eb7ea896      = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_item");$vfc84f2e61c76eef0a7d2756a556e18af = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_total");$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:count'] = (int) $v6a183de20981accc6e2669cd7c8e9f37->getValue("count");$vb2594a9ab5a8904453deabc3eb7ea896 = $this->recalcCurrency($vb2594a9ab5a8904453deabc3eb7ea896, $this->currencyInfo['exchange']);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price'] = number_format($vb2594a9ab5a8904453deabc3eb7ea896, $vb2594a9ab5a8904453deabc3eb7ea896-floor($vb2594a9ab5a8904453deabc3eb7ea896)>0.005 ? 2 : 0, '.', '');$vfc84f2e61c76eef0a7d2756a556e18af = $this->recalcCurrency($vfc84f2e61c76eef0a7d2756a556e18af, $this->currencyInfo['exchange']);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price-total'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:price_total'] = number_format($vfc84f2e61c76eef0a7d2756a556e18af, $vfc84f2e61c76eef0a7d2756a556e18af-floor($vfc84f2e61c76eef0a7d2756a556e18af)>0.005 ? 2 : 0, '.', '');$ve2942a04780e223b215eb8b663cf5353 += (int) $v6a183de20981accc6e2669cd7c8e9f37->getValue("count");$v78a5eb43deef9a7b5b9ce157b9d52ac4 += (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_total");}}elseif (isset($this->arrBasket[$vdada7698e90003048a305e981875250f])) {$vb2594a9ab5a8904453deabc3eb7ea896      = (float) $this->arrBasket[$vdada7698e90003048a305e981875250f]['price_item'];$vfc84f2e61c76eef0a7d2756a556e18af = (float) $this->arrBasket[$vdada7698e90003048a305e981875250f]['price_total'];$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:count'] = (int) $this->arrBasket[$vdada7698e90003048a305e981875250f]['count'];$vb2594a9ab5a8904453deabc3eb7ea896 = $this->recalcCurrency($vb2594a9ab5a8904453deabc3eb7ea896, $this->currencyInfo['exchange']);$vfc84f2e61c76eef0a7d2756a556e18af = $this->recalcCurrency($vfc84f2e61c76eef0a7d2756a556e18af, $this->currencyInfo['exchange']);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price'] = number_format($vb2594a9ab5a8904453deabc3eb7ea896, $vb2594a9ab5a8904453deabc3eb7ea896-floor($vb2594a9ab5a8904453deabc3eb7ea896)>0.005 ? 2 : 0, '.', '');$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price-total'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:price_total'] = number_format($vfc84f2e61c76eef0a7d2756a556e18af, $vfc84f2e61c76eef0a7d2756a556e18af-floor($vfc84f2e61c76eef0a7d2756a556e18af)>0.005 ? 2 : 0, '.', '');$ve2942a04780e223b215eb8b663cf5353 += (int) $this->arrBasket[$vdada7698e90003048a305e981875250f]['count'];$v78a5eb43deef9a7b5b9ce157b9d52ac4 = $this->recalcCurrency($v78a5eb43deef9a7b5b9ce157b9d52ac4, $this->currencyInfo['char_code']);$v78a5eb43deef9a7b5b9ce157b9d52ac4 += (float) $this->arrBasket[$vdada7698e90003048a305e981875250f]['price_total'];}$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:element-id'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:element_id'] = $vdada7698e90003048a305e981875250f;$vfca1bff8ad8b3a8585abfb0ad523ba42['xlink:href'] = "upage://" . $vdada7698e90003048a305e981875250f;return def_module::parseTemplate($v2db03d3a62131293122e5d8fdb26c7e5, $vfca1bff8ad8b3a8585abfb0ad523ba42, $vdada7698e90003048a305e981875250f);}elseif ($this->oUserBasket instanceof umiObject) {$vfca1bff8ad8b3a8585abfb0ad523ba42['node:name'] = $v6a183de20981accc6e2669cd7c8e9f37->getName();$vb2594a9ab5a8904453deabc3eb7ea896      = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_item");$vfc84f2e61c76eef0a7d2756a556e18af = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_total");$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:count'] = (int) $v6a183de20981accc6e2669cd7c8e9f37->getValue("count");$vb2594a9ab5a8904453deabc3eb7ea896 = $this->recalcCurrency($vb2594a9ab5a8904453deabc3eb7ea896, $this->currencyInfo['exchange']);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price'] = number_format($vb2594a9ab5a8904453deabc3eb7ea896, $vb2594a9ab5a8904453deabc3eb7ea896-floor($vb2594a9ab5a8904453deabc3eb7ea896)>0.005 ? 2 : 0, '.', '');$vfc84f2e61c76eef0a7d2756a556e18af = $this->recalcCurrency($vfc84f2e61c76eef0a7d2756a556e18af, $this->currencyInfo['exchange']);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:price-total'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:price_total'] = number_format($vfc84f2e61c76eef0a7d2756a556e18af, $vfc84f2e61c76eef0a7d2756a556e18af-floor($vfc84f2e61c76eef0a7d2756a556e18af)>0.005 ? 2 : 0, '.', '');$ve2942a04780e223b215eb8b663cf5353 += (int) $v6a183de20981accc6e2669cd7c8e9f37->getValue("count");$v78a5eb43deef9a7b5b9ce157b9d52ac4 += (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_total");$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:element-id'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:element_id'] = $v6a183de20981accc6e2669cd7c8e9f37->getId();$vfca1bff8ad8b3a8585abfb0ad523ba42['xlink:href'] = "uobject://" . $v6a183de20981accc6e2669cd7c8e9f37->getId();return def_module::parseTemplate($v2db03d3a62131293122e5d8fdb26c7e5, $vfca1bff8ad8b3a8585abfb0ad523ba42, $vdada7698e90003048a305e981875250f);}return "";}public function renderBasket($v39f17319be96f2b5889115ba057e5c2a = "default") {if(!$v39f17319be96f2b5889115ba057e5c2a) $v39f17319be96f2b5889115ba057e5c2a = "default";list($vf58ad3dd007a99ae7d915c495d9cad32, $v1939afb0d115f6754194039ec5cbec79, $v935e03f6c23aeace729a03e1fc6f3265, $v5eb14216753d182c5586aa87b9163a28) = def_module::loadTemplates("tpls/eshop/basket/{$v39f17319be96f2b5889115ba057e5c2a}.tpl", "basket", "basket_empty", "basket_item", "basket_new_item");$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$v906e631fd3cab146a7f686acb519cf5a = $this->recalcBasket();$v906e631fd3cab146a7f686acb519cf5a = $this->recalcCurrency($v906e631fd3cab146a7f686acb519cf5a, $this->currencyInfo['exchange']);if (isset($this->globalDiscount)) {$v3bacb6f274aeafcc61c1e858b65914a5 = $this->recalcCurrency($this->globalDiscount, $this->currencyInfo['exchange']);}$vfca1bff8ad8b3a8585abfb0ad523ba42['void:order_price'] = number_format($v906e631fd3cab146a7f686acb519cf5a, $v906e631fd3cab146a7f686acb519cf5a-floor($v906e631fd3cab146a7f686acb519cf5a)>0.005 ? 2 : 0, '.', '');$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = array();$vfca1bff8ad8b3a8585abfb0ad523ba42['void:currency_symbol'] = $this->currencyInfo['symbol'];$vfca1bff8ad8b3a8585abfb0ad523ba42['void:currency_choose'] = $this->renderCurrencyChooser();if (isset($v3bacb6f274aeafcc61c1e858b65914a5)) {$vfca1bff8ad8b3a8585abfb0ad523ba42['void:global_discount'] = number_format($v3bacb6f274aeafcc61c1e858b65914a5, $v3bacb6f274aeafcc61c1e858b65914a5-floor($v3bacb6f274aeafcc61c1e858b65914a5)>0.005 ? 2 : 0, '.', '');}else {$vfca1bff8ad8b3a8585abfb0ad523ba42['void:global_discount'] = 0;}$ve2942a04780e223b215eb8b663cf5353 = 0;$v78a5eb43deef9a7b5b9ce157b9d52ac4 = 0;if ($this->oUserBasket instanceof umiObject) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue('items');$vd2bb979f7fab52c3ef9df04a5c695a42 = array();foreach ($vdc7a98f1b58b3830d6bad4f2d3d7f80c as $v4871f4bb9cbe707fa1e58df3ca89e64c) {$v937104c02a5902ba5850d12f4d9c3459 = umiObjectsCollection::getInstance()->getObject($v4871f4bb9cbe707fa1e58df3ca89e64c);if ($v937104c02a5902ba5850d12f4d9c3459 instanceof umiObject) {$v8e9156e0217af72801862c5f519b575a = $this->renderBasketItem($v937104c02a5902ba5850d12f4d9c3459, $v935e03f6c23aeace729a03e1fc6f3265, $ve2942a04780e223b215eb8b663cf5353, $v78a5eb43deef9a7b5b9ce157b9d52ac4);if ($v8e9156e0217af72801862c5f519b575a !== false) {$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'][] = $v8e9156e0217af72801862c5f519b575a;$vd2bb979f7fab52c3ef9df04a5c695a42[] = $v4871f4bb9cbe707fa1e58df3ca89e64c;}umiObjectsCollection::getInstance()->unloadObject($v4871f4bb9cbe707fa1e58df3ca89e64c);}}$this->oUserBasket->setValue("items", $vd2bb979f7fab52c3ef9df04a5c695a42);$this->oUserBasket->commit();}else {foreach ($this->arrBasket as $vc39bd8d80533e4c1195e806feddc6e33 => $v6ad9da766f68c8a186c7128f54dc2fe7) {$v266dfb6190a3ce57973bce176a01701e = umiHierarchy::getInstance()->getElement($vc39bd8d80533e4c1195e806feddc6e33);$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'][] = $this->renderBasketItem($v266dfb6190a3ce57973bce176a01701e, $v935e03f6c23aeace729a03e1fc6f3265, $ve2942a04780e223b215eb8b663cf5353, $v78a5eb43deef9a7b5b9ce157b9d52ac4);umiHierarchy::getInstance()->unloadElement($vc39bd8d80533e4c1195e806feddc6e33);}}$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:order-id'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:order_id'] = $this->iBasketOrderId;$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:total-count'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:total_count'] = $ve2942a04780e223b215eb8b663cf5353;$v78a5eb43deef9a7b5b9ce157b9d52ac4 = $this->recalcCurrency($v78a5eb43deef9a7b5b9ce157b9d52ac4, $this->currencyInfo['exchange']);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:total-price'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:total_price'] = number_format($v78a5eb43deef9a7b5b9ce157b9d52ac4, $v78a5eb43deef9a7b5b9ce157b9d52ac4-floor($v78a5eb43deef9a7b5b9ce157b9d52ac4)>0.005 ? 2 : 0, '.', '');if (count($vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'])) {if (!xslTemplater::getInstance()->getIsInited()) {$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'][] = $v5eb14216753d182c5586aa87b9163a28;}return def_module::parseTemplate($vf58ad3dd007a99ae7d915c495d9cad32, $vfca1bff8ad8b3a8585abfb0ad523ba42);}else {if (!xslTemplater::getInstance()->getIsInited()) {$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'][] = $v5eb14216753d182c5586aa87b9163a28;}return def_module::parseTemplate($v1939afb0d115f6754194039ec5cbec79, $vfca1bff8ad8b3a8585abfb0ad523ba42);}}public function renderCurrencyChooser($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list ($v33049bc9918b68289df6a5ec64f07f47) = def_module::loadTemplates("tpls/eshop/basket/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "currency_choose");$v7f5cbfbf72c13c3428b35837dff582f8 = umiObjectTypesCollection::getInstance()->getBaseType("eshop", "currency");$v4101a5fdf0ed40cbaf9bea2e125182cb = umiObjectTypesCollection::getInstance()->getType($v7f5cbfbf72c13c3428b35837dff582f8);$v01155f9f4e569970e4eef4e39fdbf559 = $v4101a5fdf0ed40cbaf9bea2e125182cb->getFieldId("use_in_eshop");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v7f5cbfbf72c13c3428b35837dff582f8);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($v01155f9f4e569970e4eef4e39fdbf559, true);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vea963809ed3a54d0c863508f546b2bae = Array ("subnodes:currency_items" => "");if (count($result) < 2) {return false;}foreach ($result as $vf82265ccceac13b2f40ccd9e81cbd263) {$vea963809ed3a54d0c863508f546b2bae['subnodes:currency_items'].= $this->renderCurrencyItem($vf82265ccceac13b2f40ccd9e81cbd263);}return def_module::parseTemplate($v33049bc9918b68289df6a5ec64f07f47, $vea963809ed3a54d0c863508f546b2bae);}public function renderCurrencyItem($v59a814aa020a1b32c4674a5887a35022, $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {$v1af0389838508d7016a9841eb6273962 = umiObjectsCollection::getInstance()->getObject($v59a814aa020a1b32c4674a5887a35022);list($va5a4a431bc2a84787a8fb088497d4d61) = def_module::loadTemplates("tpls/eshop/basket/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "currency_item");$vea963809ed3a54d0c863508f546b2bae['void:currency_id'] = $v1af0389838508d7016a9841eb6273962->getId();$vea963809ed3a54d0c863508f546b2bae['void:currency_name'] = $v1af0389838508d7016a9841eb6273962->getName();$vea963809ed3a54d0c863508f546b2bae['void:currency_s_code'] = $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_letter_code");$vea963809ed3a54d0c863508f546b2bae['void:currency_d_code'] = $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_digit_code");if ($vea963809ed3a54d0c863508f546b2bae['void:currency_s_code'] == $this->currencyInfo['char_code']) {$vea963809ed3a54d0c863508f546b2bae['void:selected'] = "selected";}else {$vea963809ed3a54d0c863508f546b2bae['void:selected'] = "";}return def_module::parseTemplate($va5a4a431bc2a84787a8fb088497d4d61, $vea963809ed3a54d0c863508f546b2bae);}public function render4JSON($v665971ef909f183bc1d95cf716bd8a51, $v67fa22c715c9478d4a0d3133095e0e76 = false) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = array();$v8b64d76fba6e1cbdd00bafd2d3c99bff = 0;if ($this->oUserBasket instanceof umiObject) {$v752c689ce80a36650e28a520b3221f73 = $this->oUserBasket->getValue('items');foreach ($v752c689ce80a36650e28a520b3221f73 as $v4871f4bb9cbe707fa1e58df3ca89e64c) {$v937104c02a5902ba5850d12f4d9c3459 = umiObjectsCollection::getInstance()->getObject($v4871f4bb9cbe707fa1e58df3ca89e64c);if ($v937104c02a5902ba5850d12f4d9c3459 instanceof umiObject) {$vc39bd8d80533e4c1195e806feddc6e33 = $v937104c02a5902ba5850d12f4d9c3459->getValue("catalog_relation");if (!$vc39bd8d80533e4c1195e806feddc6e33) $vc39bd8d80533e4c1195e806feddc6e33 = $v4871f4bb9cbe707fa1e58df3ca89e64c;$vdc7a98f1b58b3830d6bad4f2d3d7f80c[$vc39bd8d80533e4c1195e806feddc6e33] = array();$vdc7a98f1b58b3830d6bad4f2d3d7f80c[$vc39bd8d80533e4c1195e806feddc6e33]["count"] = $v937104c02a5902ba5850d12f4d9c3459->getValue("count");$vdc7a98f1b58b3830d6bad4f2d3d7f80c[$vc39bd8d80533e4c1195e806feddc6e33]["price_item"] = (float) $v937104c02a5902ba5850d12f4d9c3459->getValue("price_item");$vdc7a98f1b58b3830d6bad4f2d3d7f80c[$vc39bd8d80533e4c1195e806feddc6e33]["price_total"] = (float) $v937104c02a5902ba5850d12f4d9c3459->getValue("price_total");$v8b64d76fba6e1cbdd00bafd2d3c99bff += $vdc7a98f1b58b3830d6bad4f2d3d7f80c[$vc39bd8d80533e4c1195e806feddc6e33]["count"];umiObjectsCollection::getInstance()->unloadObject($v4871f4bb9cbe707fa1e58df3ca89e64c);}}}else {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->arrBasket;}$v8b64d76fba6e1cbdd00bafd2d3c99bff = 0;$v5c3de9eb5ec5ec83938f67f225f6ceff = "var basket_items = new Array();\r\n";foreach ($vdc7a98f1b58b3830d6bad4f2d3d7f80c as $vdada7698e90003048a305e981875250f => $vb9f40d29448a72e2cfda3af6243709ed) {if ($v67fa22c715c9478d4a0d3133095e0e76) {$v8b64d76fba6e1cbdd00bafd2d3c99bff += $vb9f40d29448a72e2cfda3af6243709ed['count'];}else {$v266dfb6190a3ce57973bce176a01701e = umiHierarchy::getInstance()->getElement($vdada7698e90003048a305e981875250f, true, true);if ($v266dfb6190a3ce57973bce176a01701e instanceof umiHierarchyElement) {$v4001fcc4579ade3073c3d6b350f1cb1d = isset($vb9f40d29448a72e2cfda3af6243709ed['count']) ? (int) $vb9f40d29448a72e2cfda3af6243709ed['count'] : 1;$v42e712f9dc973f0a265bdc8a8f66d9ee = isset($vb9f40d29448a72e2cfda3af6243709ed['count']) ? (float) $vb9f40d29448a72e2cfda3af6243709ed['price_total'] : 0;$v42e712f9dc973f0a265bdc8a8f66d9ee = (float) $this->recalcCurrency($v42e712f9dc973f0a265bdc8a8f66d9ee, $this->currencyInfo['exchange']);$v42e712f9dc973f0a265bdc8a8f66d9ee = number_format($v42e712f9dc973f0a265bdc8a8f66d9ee, $v42e712f9dc973f0a265bdc8a8f66d9ee-floor($v42e712f9dc973f0a265bdc8a8f66d9ee)>0.005 ? 2 : 0, '.', '');$ve87b15e3177e9b011839289c31dbd666 = (float) $this->recalcCurrency($vb9f40d29448a72e2cfda3af6243709ed["price_item"], $this->currencyInfo['exchange']);$v7479e7685a8e80cd48baf8679a2aa21f = number_format($ve87b15e3177e9b011839289c31dbd666, $ve87b15e3177e9b011839289c31dbd666-floor($ve87b15e3177e9b011839289c31dbd666)>0.005 ? 2 : 0, '.', '');$vabf111989a07096e6008314e95793a24 = umiHierarchy::getInstance()->getPathById($vdada7698e90003048a305e981875250f);$v5c3de9eb5ec5ec83938f67f225f6ceff .= <<<END
							basket_items[basket_items.length] = {
								'id'			: '{$vdada7698e90003048a305e981875250f}',
								'name'			: '{$v266dfb6190a3ce57973bce176a01701e->getName()}',
								'count'			: '{$v4001fcc4579ade3073c3d6b350f1cb1d}',
								'price'			: '{$v7479e7685a8e80cd48baf8679a2aa21f}',
								'price_total'	: '{$v42e712f9dc973f0a265bdc8a8f66d9ee}',
								'element_path'	: '{$vabf111989a07096e6008314e95793a24}'
							};
END;      $v8b64d76fba6e1cbdd00bafd2d3c99bff += $vb9f40d29448a72e2cfda3af6243709ed['count'];umiHierarchy::getInstance()->unloadElement($vdada7698e90003048a305e981875250f);}elseif ($this->oUserBasket instanceof umiObject) {$v6a183de20981accc6e2669cd7c8e9f37 = umiObjectsCollection::getInstance()->getObject($vdada7698e90003048a305e981875250f);$v4001fcc4579ade3073c3d6b350f1cb1d = isset($vb9f40d29448a72e2cfda3af6243709ed['count']) ? (int) $vb9f40d29448a72e2cfda3af6243709ed['count'] : 1;$v42e712f9dc973f0a265bdc8a8f66d9ee = isset($vb9f40d29448a72e2cfda3af6243709ed['count']) ? (float) $vb9f40d29448a72e2cfda3af6243709ed['price_total'] : 0;$v42e712f9dc973f0a265bdc8a8f66d9ee = (float) $this->recalcCurrency($v42e712f9dc973f0a265bdc8a8f66d9ee, $this->currencyInfo['exchange']);$v42e712f9dc973f0a265bdc8a8f66d9ee = number_format($v42e712f9dc973f0a265bdc8a8f66d9ee, $v42e712f9dc973f0a265bdc8a8f66d9ee-floor($v42e712f9dc973f0a265bdc8a8f66d9ee)>0.005 ? 2 : 0, '.', '');$ve87b15e3177e9b011839289c31dbd666 = (float) $this->recalcCurrency($vb9f40d29448a72e2cfda3af6243709ed["price_item"], $this->currencyInfo['exchange']);$ve87b15e3177e9b011839289c31dbd666 = $vb9f40d29448a72e2cfda3af6243709ed["price_item"];$v7479e7685a8e80cd48baf8679a2aa21f = number_format($ve87b15e3177e9b011839289c31dbd666, $ve87b15e3177e9b011839289c31dbd666-floor($ve87b15e3177e9b011839289c31dbd666)>0.005 ? 2 : 0, '.', '');$vabf111989a07096e6008314e95793a24 = umiHierarchy::getInstance()->getPathById($vdada7698e90003048a305e981875250f);$v5c3de9eb5ec5ec83938f67f225f6ceff .= <<<END
							basket_items[basket_items.length] = {
								'id'			: '{$vdada7698e90003048a305e981875250f}',
								'name'			: '{$v6a183de20981accc6e2669cd7c8e9f37->getName()}',
								'count'			: '{$v4001fcc4579ade3073c3d6b350f1cb1d}',
								'price'			: '{$v7479e7685a8e80cd48baf8679a2aa21f}',
								'price_total'	: '{$v42e712f9dc973f0a265bdc8a8f66d9ee}',
								'element_path'	: '#'
							};
END;      $v8b64d76fba6e1cbdd00bafd2d3c99bff += $vb9f40d29448a72e2cfda3af6243709ed['count'];umiObjectsCollection::getInstance()->unloadObject($vdada7698e90003048a305e981875250f);}}}$v2272f1c5f220df456f160c62dccd4d48 = $this->recalcCurrency($this->recalcBasket(), $this->currencyInfo['exchange']);$v2272f1c5f220df456f160c62dccd4d48 = number_format($v2272f1c5f220df456f160c62dccd4d48, $v2272f1c5f220df456f160c62dccd4d48-floor($v2272f1c5f220df456f160c62dccd4d48)>0.005 ? 2 : 0, '.', '');if (isset($this->globalDiscount)) {$v3bacb6f274aeafcc61c1e858b65914a5 = $this->recalcCurrency($this->globalDiscount, $this->currencyInfo['exchange']);if (isset($v3bacb6f274aeafcc61c1e858b65914a5)) {$v3bacb6f274aeafcc61c1e858b65914a5 = number_format($v3bacb6f274aeafcc61c1e858b65914a5, $v3bacb6f274aeafcc61c1e858b65914a5-floor($v3bacb6f274aeafcc61c1e858b65914a5)>0.005 ? 2 : 0, '.', '');}else {$v3bacb6f274aeafcc61c1e858b65914a5 = 0;}}else {$v3bacb6f274aeafcc61c1e858b65914a5 = 0;}$vdccc8c8d061984a56d899361b4934477 = <<<END
				var response = new lLibResponse({$v665971ef909f183bc1d95cf716bd8a51});
				{$v5c3de9eb5ec5ec83938f67f225f6ceff}
				response.basket_items = basket_items;
				response.order_total = '{$v2272f1c5f220df456f160c62dccd4d48}';
				response.total_count = '{$v8b64d76fba6e1cbdd00bafd2d3c99bff}';
				response.global_discount = '{$v3bacb6f274aeafcc61c1e858b65914a5}';
				lLib.getInstance().makeResponse(response);
END;   return $vdccc8c8d061984a56d899361b4934477;}public function render4Mail($v39f17319be96f2b5889115ba057e5c2a = "default") {if(!$v39f17319be96f2b5889115ba057e5c2a) $v39f17319be96f2b5889115ba057e5c2a = "default";list($ve6b738259b7946364373607cd1a0719c, $vb7b252949d022668e77ecca74c0522c1) = def_module::loadTemplates("tpls/eshop/{$v39f17319be96f2b5889115ba057e5c2a}.tpl", "order_items", "order_item");$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$vfca1bff8ad8b3a8585abfb0ad523ba42['order_price'] = $this->recalcBasket();$vfca1bff8ad8b3a8585abfb0ad523ba42['items'] = "";$vfca1bff8ad8b3a8585abfb0ad523ba42['order_id'] = $this->oUserBasket->getId();if ($this->oUserBasket instanceof umiObject) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue('items');foreach ($vdc7a98f1b58b3830d6bad4f2d3d7f80c as $v4871f4bb9cbe707fa1e58df3ca89e64c) {$v937104c02a5902ba5850d12f4d9c3459 = umiObjectsCollection::getInstance()->getObject($v4871f4bb9cbe707fa1e58df3ca89e64c);if ($v937104c02a5902ba5850d12f4d9c3459 instanceof umiObject) {$vfca1bff8ad8b3a8585abfb0ad523ba42['items'] .= $this->renderBasketItem($v937104c02a5902ba5850d12f4d9c3459, $vb7b252949d022668e77ecca74c0522c1);umiObjectsCollection::getInstance()->unloadObject($v4871f4bb9cbe707fa1e58df3ca89e64c);}}}return def_module::parseTemplate($ve6b738259b7946364373607cd1a0719c, $vfca1bff8ad8b3a8585abfb0ad523ba42, false, $vfca1bff8ad8b3a8585abfb0ad523ba42['order_id']);}public function renderUserOrders($v39f17319be96f2b5889115ba057e5c2a = "default") {if(!$v39f17319be96f2b5889115ba057e5c2a) $v39f17319be96f2b5889115ba057e5c2a = "default";if (!$this->oAuthUser) return "";list($va4f7054523aa6ad190bab52e704de1ca, $v4a865feb0ecdde1dc4ff9b58738c0e43, $v0e8e0acfc36f60cb162a346a5b39a3d0, $v95fdc830fb6fdbea13988d7ade619c98, $v28540ca4db4fa0ef449d0d785a34726a) = def_module::loadTemplates("tpls/eshop/orders/{$v39f17319be96f2b5889115ba057e5c2a}.tpl", "orders_block", "order_line", "orders_empty", "cancel_button", "cancel_locked");$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$vfca1bff8ad8b3a8585abfb0ad523ba42['void:lines'] = array();$v0dc8a7853e0ac5b79403091c0c5876ea = 0;for ($v168965c34d6a1fd6ad3d68aa5e76ae56 = 0;$v168965c34d6a1fd6ad3d68aa5e76ae56 < count($this->arrUserOrders);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$vacd050ad8e72b0334557da0382c28f46 = $this->arrUserOrders[$v168965c34d6a1fd6ad3d68aa5e76ae56];$v015d7d5955a6c24c16819c190e17119c = umiObjectsCollection::getInstance()->getObject($vacd050ad8e72b0334557da0382c28f46);if ($v015d7d5955a6c24c16819c190e17119c instanceof umiObject) {$v8fe28c0d2566be75ba389f80bde58dbe = $v015d7d5955a6c24c16819c190e17119c->getValue("status");$vb373676bb979e6765e65bf71b71f0e59 = umiObjectscollection::getInstance()->getObject($v8fe28c0d2566be75ba389f80bde58dbe);if ($vb373676bb979e6765e65bf71b71f0e59 instanceof umiObject) {$v3cd9675997efe228bcce9ab9b8f62ccb = $vb373676bb979e6765e65bf71b71f0e59->getValue("id_name");if ($v3cd9675997efe228bcce9ab9b8f62ccb === "cart" || $v3cd9675997efe228bcce9ab9b8f62ccb === "canceled") continue;$v0e7bdcacca9012e2ed3543f64cb5647b = $v015d7d5955a6c24c16819c190e17119c->getValue("order_time");$v1821a344c08754f72d971a6191b14fe6 = "";if ($v0e7bdcacca9012e2ed3543f64cb5647b instanceof umiDate) {$v1821a344c08754f72d971a6191b14fe6 = $v0e7bdcacca9012e2ed3543f64cb5647b->getFormattedDate();}$v00e4d6f48b09ca12c706380a667f7a58 = array();$v00e4d6f48b09ca12c706380a667f7a58['attribute:id'] = $vacd050ad8e72b0334557da0382c28f46;$v00e4d6f48b09ca12c706380a667f7a58['attribute:order-time'] = $v0e7bdcacca9012e2ed3543f64cb5647b->getFormattedDate("U");$v00e4d6f48b09ca12c706380a667f7a58['void:order_id'] = $vacd050ad8e72b0334557da0382c28f46;$v00e4d6f48b09ca12c706380a667f7a58['status'] = $vb373676bb979e6765e65bf71b71f0e59->getName();$v00e4d6f48b09ca12c706380a667f7a58['void:order_time'] = $v1821a344c08754f72d971a6191b14fe6;if ($vdf573038c69a34021e7572e3e4c0c2aa = $v015d7d5955a6c24c16819c190e17119c->getValue("eshop_order_currency")) {$v1af0389838508d7016a9841eb6273962 = umiObjectsCollection::getInstance()->getObject($vdf573038c69a34021e7572e3e4c0c2aa);if ($v1af0389838508d7016a9841eb6273962 && $vc5613a5a91579972fbae451acabeb080 = $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_symbol")) {$v00e4d6f48b09ca12c706380a667f7a58['currency_symbol'] = $vc5613a5a91579972fbae451acabeb080;}else {$v00e4d6f48b09ca12c706380a667f7a58['currency_symbol'] = "";}}if ($vc4ea8b956a71e857575c65f5a4320087 = $v015d7d5955a6c24c16819c190e17119c->getValue("currency_exchange_rate")) {$v28002bf2b560c4e03ffab4e24adaf2a0 = $v015d7d5955a6c24c16819c190e17119c->getValue("order_price")/$vc4ea8b956a71e857575c65f5a4320087;$v00e4d6f48b09ca12c706380a667f7a58['order_price'] = number_format($v28002bf2b560c4e03ffab4e24adaf2a0, $v28002bf2b560c4e03ffab4e24adaf2a0-floor($v28002bf2b560c4e03ffab4e24adaf2a0)>0.005 ? 2 : 0, '.', '');}else {$v00e4d6f48b09ca12c706380a667f7a58['order_price'] = $v015d7d5955a6c24c16819c190e17119c->getValue("order_price");}$va174e4943f30fb00991085c14845432c = (bool) $vb373676bb979e6765e65bf71b71f0e59->getValue('lock_cancel');$v00e4d6f48b09ca12c706380a667f7a58['void:cancel_button'] = "";if (!$va174e4943f30fb00991085c14845432c) {$v00e4d6f48b09ca12c706380a667f7a58['cancel_link'] = $this->pre_lang . "/eshop/cancel_order/{$vacd050ad8e72b0334557da0382c28f46}/";$v00e4d6f48b09ca12c706380a667f7a58['void:cancel_button'] = def_module::parseTemplate($v95fdc830fb6fdbea13988d7ade619c98, array("cancel_link" => $v00e4d6f48b09ca12c706380a667f7a58['cancel_link']));}else {$v00e4d6f48b09ca12c706380a667f7a58['void:cancel_button'] = def_module::parseTemplate($v28540ca4db4fa0ef449d0d785a34726a);}$v00e4d6f48b09ca12c706380a667f7a58['void:info_link'] = $this->pre_lang . "/eshop/user_order_info/{$vacd050ad8e72b0334557da0382c28f46}/".$v39f17319be96f2b5889115ba057e5c2a;$v00e4d6f48b09ca12c706380a667f7a58['xlink:href'] = "uobject://".$vacd050ad8e72b0334557da0382c28f46;$v0dc8a7853e0ac5b79403091c0c5876ea++;$vfca1bff8ad8b3a8585abfb0ad523ba42['void:lines'][] = def_module::parseTemplate($v4a865feb0ecdde1dc4ff9b58738c0e43, $v00e4d6f48b09ca12c706380a667f7a58, false, $vacd050ad8e72b0334557da0382c28f46);}umiObjectsCollection::getInstance()->unloadObject($vacd050ad8e72b0334557da0382c28f46);}}$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:lines'];if ($v0dc8a7853e0ac5b79403091c0c5876ea) {return def_module::parseTemplate($va4f7054523aa6ad190bab52e704de1ca, $vfca1bff8ad8b3a8585abfb0ad523ba42);}else {return def_module::parseTemplate($v0e8e0acfc36f60cb162a346a5b39a3d0, $vfca1bff8ad8b3a8585abfb0ad523ba42);}}public function renderOrderInfo($v99d66bded2c34a2de292eb583294cfd8, $v39f17319be96f2b5889115ba057e5c2a = "default") {if (!$v39f17319be96f2b5889115ba057e5c2a) $v39f17319be96f2b5889115ba057e5c2a = "default";$vc36891666d27ef9f0ad1c906807a25b7 = umiObjectsCollection::getInstance()->getObject($v99d66bded2c34a2de292eb583294cfd8);if (in_array((string) $v99d66bded2c34a2de292eb583294cfd8, $this->arrUserOrders) && $vc36891666d27ef9f0ad1c906807a25b7 instanceof umiObject) {list($v6134ada205f09ff558c788c8543e4803, $vd82a0be4a0dd8822631a01496de3fa14, $v75e084b10c1ce8603eb40c7ef0a69fec, $v95fdc830fb6fdbea13988d7ade619c98, $v28540ca4db4fa0ef449d0d785a34726a, $v59f61218051359c547e27d73907eaf15, $vf488ee156253a23fd375e0ca810a2a8f) = def_module::loadTemplates("tpls/eshop/orders/{$v39f17319be96f2b5889115ba057e5c2a}.tpl", "order_info_block", "order_info_line" ,"order_canceled", "cancel_button", "cancel_locked", "order_payment_block", "order_payment_locked");$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$v8fe28c0d2566be75ba389f80bde58dbe = $vc36891666d27ef9f0ad1c906807a25b7->getValue("status");$vb373676bb979e6765e65bf71b71f0e59 = umiObjectscollection::getInstance()->getObject($v8fe28c0d2566be75ba389f80bde58dbe);$v3cd9675997efe228bcce9ab9b8f62ccb = $vb373676bb979e6765e65bf71b71f0e59->getValue("id_name");if ($v3cd9675997efe228bcce9ab9b8f62ccb === "canceled" || $v3cd9675997efe228bcce9ab9b8f62ccb === "cart") {return def_module::parseTemplate($v75e084b10c1ce8603eb40c7ef0a69fec, $vfca1bff8ad8b3a8585abfb0ad523ba42, false, $v99d66bded2c34a2de292eb583294cfd8);}if ($vdf573038c69a34021e7572e3e4c0c2aa = $vc36891666d27ef9f0ad1c906807a25b7->getValue("eshop_order_currency")) {$v1af0389838508d7016a9841eb6273962 = umiObjectsCollection::getInstance()->getObject($vdf573038c69a34021e7572e3e4c0c2aa);if ($v1af0389838508d7016a9841eb6273962 && $vc5613a5a91579972fbae451acabeb080 = $v1af0389838508d7016a9841eb6273962->getValue("eshop_currency_symbol")) {$vfca1bff8ad8b3a8585abfb0ad523ba42['currency_symbol'] = $vc5613a5a91579972fbae451acabeb080;}else {$vfca1bff8ad8b3a8585abfb0ad523ba42['currency_symbol'] = $vc5613a5a91579972fbae451acabeb080;}}$vfca1bff8ad8b3a8585abfb0ad523ba42['status'] = $vb373676bb979e6765e65bf71b71f0e59->getName();$vfca1bff8ad8b3a8585abfb0ad523ba42['id'] = $v99d66bded2c34a2de292eb583294cfd8;$vfca1bff8ad8b3a8585abfb0ad523ba42['order_id'] = $v99d66bded2c34a2de292eb583294cfd8;$vfca1bff8ad8b3a8585abfb0ad523ba42['items'] = "";if ($v284ea52448f824ef121bd4920e036b64 = $vc36891666d27ef9f0ad1c906807a25b7->getValue("currency_exchange_rate")) {$v28002bf2b560c4e03ffab4e24adaf2a0 = $vc36891666d27ef9f0ad1c906807a25b7->getValue('order_price')/$v284ea52448f824ef121bd4920e036b64;$vfca1bff8ad8b3a8585abfb0ad523ba42['order_price'] = number_format($v28002bf2b560c4e03ffab4e24adaf2a0, $v28002bf2b560c4e03ffab4e24adaf2a0-floor($v28002bf2b560c4e03ffab4e24adaf2a0)>0.005 ? 2 : 0, '.', '');}else {$vfca1bff8ad8b3a8585abfb0ad523ba42['order_price'] = $vc36891666d27ef9f0ad1c906807a25b7->getValue('order_price');}$vfca1bff8ad8b3a8585abfb0ad523ba42['cancel_button'] = "";$vee86a2fcc0eb411048202342941f74de = (bool) $vb373676bb979e6765e65bf71b71f0e59->getValue('lock_cancel');if (!$vee86a2fcc0eb411048202342941f74de) {$vfca1bff8ad8b3a8585abfb0ad523ba42['cancel_link'] = $this->pre_lang . "/eshop/cancel_order/{$v99d66bded2c34a2de292eb583294cfd8}/";$vfca1bff8ad8b3a8585abfb0ad523ba42['cancel_button'] = def_module::parseTemplate($v95fdc830fb6fdbea13988d7ade619c98, array("cancel_link" => $vfca1bff8ad8b3a8585abfb0ad523ba42['cancel_link']));}else {$vfca1bff8ad8b3a8585abfb0ad523ba42['cancel_button'] = def_module::parseTemplate($v28540ca4db4fa0ef449d0d785a34726a);}$v09107f69ebfbc97c0103129be0171362 = $vc36891666d27ef9f0ad1c906807a25b7->getValue("items");for ($v168965c34d6a1fd6ad3d68aa5e76ae56 = 0;$v168965c34d6a1fd6ad3d68aa5e76ae56 < count($v09107f69ebfbc97c0103129be0171362);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$v131d975daeb54813fcccff6b008bd8cb = $v09107f69ebfbc97c0103129be0171362[$v168965c34d6a1fd6ad3d68aa5e76ae56];$v6a183de20981accc6e2669cd7c8e9f37 = umiObjectsCollection::getInstance()->getObject($v131d975daeb54813fcccff6b008bd8cb);if ($v6a183de20981accc6e2669cd7c8e9f37 instanceof umiObject) {$v69ba0c89abba8a3e9cc0c5e32be0d35d = array();$v69ba0c89abba8a3e9cc0c5e32be0d35d['element_id'] = $v6a183de20981accc6e2669cd7c8e9f37->getValue("catalog_relation");$v69ba0c89abba8a3e9cc0c5e32be0d35d['name'] = $v6a183de20981accc6e2669cd7c8e9f37->getName();$v69ba0c89abba8a3e9cc0c5e32be0d35d['count'] = (int) $v6a183de20981accc6e2669cd7c8e9f37->getValue("count");if ($v284ea52448f824ef121bd4920e036b64 = $vc36891666d27ef9f0ad1c906807a25b7->getValue("currency_exchange_rate")) {$v28002bf2b560c4e03ffab4e24adaf2a0 = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_item")/$v284ea52448f824ef121bd4920e036b64;$v8ffca2d842ddf43200d55648c8c4dd54 = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_total")/$v284ea52448f824ef121bd4920e036b64;$v69ba0c89abba8a3e9cc0c5e32be0d35d['price'] = number_format($v28002bf2b560c4e03ffab4e24adaf2a0, $v28002bf2b560c4e03ffab4e24adaf2a0-floor($v28002bf2b560c4e03ffab4e24adaf2a0)>0.005 ? 2 : 0, '.', '');;$v69ba0c89abba8a3e9cc0c5e32be0d35d['price_total'] = number_format($v8ffca2d842ddf43200d55648c8c4dd54, $v8ffca2d842ddf43200d55648c8c4dd54-floor($v8ffca2d842ddf43200d55648c8c4dd54)>0.005 ? 2 : 0, '.', '');;}else {$v69ba0c89abba8a3e9cc0c5e32be0d35d['price'] = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_item");$v69ba0c89abba8a3e9cc0c5e32be0d35d['price_total'] = (float) $v6a183de20981accc6e2669cd7c8e9f37->getValue("price_total");}$vfca1bff8ad8b3a8585abfb0ad523ba42['items'] .= def_module::parseTemplate($vd82a0be4a0dd8822631a01496de3fa14, $v69ba0c89abba8a3e9cc0c5e32be0d35d, $v69ba0c89abba8a3e9cc0c5e32be0d35d['element_id']);umiObjectsCollection::getInstance()->unloadObject($v131d975daeb54813fcccff6b008bd8cb);}}return def_module::parseTemplate($v6134ada205f09ff558c788c8543e4803, $vfca1bff8ad8b3a8585abfb0ad523ba42, false, $v99d66bded2c34a2de292eb583294cfd8);}}public function checkIsEmpty() {$v9f735923585d489d8baaf23faba610bc = true;if ($this->oUserBasket instanceof umiObject) {$vdc7a98f1b58b3830d6bad4f2d3d7f80c = $this->oUserBasket->getValue("items");if (count($vdc7a98f1b58b3830d6bad4f2d3d7f80c)) $v9f735923585d489d8baaf23faba610bc = false;}elseif (count($this->arrBasket)) {$v9f735923585d489d8baaf23faba610bc = false;}return $v9f735923585d489d8baaf23faba610bc;}public function order($v2e7f1cdc39fe6adb4cfdad652cea8b6d = false, $vdaaf0ddc865bc3ddfb292eb34404844a = "", $vca0181cec47fc685c701f1ba0de5f755 = false) {if ($this->oUserBasket instanceof umiObject && !$this->checkIsEmpty()) {$v2eabdcfcd6d845b5dc636416e3a12d19 = $this->oUserBasket;$v69ae498121c2d8e63f20c7144a0246d7 = umiObjectsCollection::getInstance();if (!$vca0181cec47fc685c701f1ba0de5f755) $vca0181cec47fc685c701f1ba0de5f755 = $this->getStatusBySId('wait');$v2eabdcfcd6d845b5dc636416e3a12d19->setValue("status", $vca0181cec47fc685c701f1ba0de5f755);$v2eabdcfcd6d845b5dc636416e3a12d19->setValue('order_time', new umiDate());$v2eabdcfcd6d845b5dc636416e3a12d19->setValue('order_price', (float) $this->recalcBasket());$v2eabdcfcd6d845b5dc636416e3a12d19->setValue('customer_comments', $vdaaf0ddc865bc3ddfb292eb34404844a);if ($v2e7f1cdc39fe6adb4cfdad652cea8b6d) {$v588c0a1a673b745f043a36c5455c4872 = $v69ae498121c2d8e63f20c7144a0246d7->cloneObject($v2e7f1cdc39fe6adb4cfdad652cea8b6d);$v8e6d8b4ddcf16f5544a9b03096ddbcaa = $v69ae498121c2d8e63f20c7144a0246d7->getObject($v588c0a1a673b745f043a36c5455c4872);if ($v8e6d8b4ddcf16f5544a9b03096ddbcaa instanceof umiObject) {$v2eabdcfcd6d845b5dc636416e3a12d19->setValue("delivery_address", $v8e6d8b4ddcf16f5544a9b03096ddbcaa->getId());}}$v2eabdcfcd6d845b5dc636416e3a12d19->commit();$this->oUserBasket = null;self::__construct();}}public function recalcCurrency($v62b8e450d57157534e5d0a3dae1918c2, $vd64fdd5fcc706fb720c03d808329c0e1 = false) {if (!$vb548d5e988da2abe0026be7e064e62fc = regedit::getInstance()->getVal("//modules/eshop/default_currency_code")) {return $v62b8e450d57157534e5d0a3dae1918c2;}if (!$va2c547d043132409dbbb92527ddf947b = $this->getCurrencyIdBySId($vb548d5e988da2abe0026be7e064e62fc)) {return $v62b8e450d57157534e5d0a3dae1918c2;}if ($vbd3adc4abcd2cd0e0ed0ef2ebc9babba = umiObjectsCollection::getInstance()->getObject($this->currencyInfo['ID'])) {$vb548d5e988da2abe0026be7e064e62fc = umiObjectsCollection::getInstance()->getObject($va2c547d043132409dbbb92527ddf947b);if ($v284ea52448f824ef121bd4920e036b64 = $vbd3adc4abcd2cd0e0ed0ef2ebc9babba->getValue("eshop_currency_exchange_rate")) {if(is_object($vb548d5e988da2abe0026be7e064e62fc) == false) {return $v62b8e450d57157534e5d0a3dae1918c2;}if ($vb548d5e988da2abe0026be7e064e62fc->getValue("eshop_currency_letter_code") != $vd64fdd5fcc706fb720c03d808329c0e1 ) {return $v62b8e450d57157534e5d0a3dae1918c2/$v284ea52448f824ef121bd4920e036b64;}else {return $v62b8e450d57157534e5d0a3dae1918c2;}}}}public function __destruct() {if ($this->oUserBasket instanceof umiObject) {}else {$_SESSION['umi_basket'] = $this->arrBasket;}}}?>