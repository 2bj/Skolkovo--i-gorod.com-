<?php
class umiRemoteFileGetter {const READ_PIECE_SIZE = 4096;public static function get($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c = false, $vbc7d420606e2e2ab63b4a2528a7bbadf = false, $vb6a628dce68ec509d970a41cc780b9f9 = false) {$v27c44a5aa7b7fef792dfdff2401836a1 = null;if(strpos($v7b4064db05ca12487032b3f21ae7b1dc, '://') === false) {$v9a0364b9e99bb480dd25e1f0284c8555 = @file_get_contents($v7b4064db05ca12487032b3f21ae7b1dc, false, $v5c18ef72771564b7f43c497dc507aeab);if($v9a0364b9e99bb480dd25e1f0284c8555 === false) throw new umiRemoteFileGetterException('Local file does not exists or can not be opened');if($ve62b9ecbd883c26642197a7dc8246d3c === false) {return $v9a0364b9e99bb480dd25e1f0284c8555;}else {@file_put_contents($ve62b9ecbd883c26642197a7dc8246d3c, $v9a0364b9e99bb480dd25e1f0284c8555);return true;}}try {$result = self::basicGet($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c, $vbc7d420606e2e2ab63b4a2528a7bbadf, $vb6a628dce68ec509d970a41cc780b9f9);return $result;}catch(umiRemoteFileGetterException $ve1671797c52e15f763380b45e841ec32) {$v27c44a5aa7b7fef792dfdff2401836a1 = $ve1671797c52e15f763380b45e841ec32;}try {$result = self::curlGet($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c, $vbc7d420606e2e2ab63b4a2528a7bbadf, $vb6a628dce68ec509d970a41cc780b9f9);return $result;}catch(umiRemoteFileGetterException $ve1671797c52e15f763380b45e841ec32) {$v27c44a5aa7b7fef792dfdff2401836a1 = $ve1671797c52e15f763380b45e841ec32;}try {$result = self::socketGet($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c, $vbc7d420606e2e2ab63b4a2528a7bbadf, $vb6a628dce68ec509d970a41cc780b9f9);return $result;}catch(umiRemoteFileGetterException $ve1671797c52e15f763380b45e841ec32) {$v27c44a5aa7b7fef792dfdff2401836a1 = $ve1671797c52e15f763380b45e841ec32;}if($v27c44a5aa7b7fef792dfdff2401836a1 != null) throw $v27c44a5aa7b7fef792dfdff2401836a1;return null;}private static function basicGet($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c, $vbc7d420606e2e2ab63b4a2528a7bbadf = false, $vb6a628dce68ec509d970a41cc780b9f9 = false) {if(!intval(ini_get('allow_url_fopen'))) {throw new umiRemoteFileGetterException('Not allowed');}$v5c18ef72771564b7f43c497dc507aeab = NULL;if(!empty($vbc7d420606e2e2ab63b4a2528a7bbadf) || !empty($vb6a628dce68ec509d970a41cc780b9f9)) {$vc14cdec3a3c0414bf4fee2a9233fcece = array('http'=>array());if(!empty($vbc7d420606e2e2ab63b4a2528a7bbadf)) {$vc14cdec3a3c0414bf4fee2a9233fcece['http']['header'] = self::buildHeaderString($vbc7d420606e2e2ab63b4a2528a7bbadf);}if(!empty($vb6a628dce68ec509d970a41cc780b9f9)) {$vc14cdec3a3c0414bf4fee2a9233fcece['http']['method']  = 'POST';$vc14cdec3a3c0414bf4fee2a9233fcece['http']['content'] = http_build_query($vb6a628dce68ec509d970a41cc780b9f9);}$v5c18ef72771564b7f43c497dc507aeab = stream_context_create($vc14cdec3a3c0414bf4fee2a9233fcece);}if($ve62b9ecbd883c26642197a7dc8246d3c === false) {$v9a0364b9e99bb480dd25e1f0284c8555 = @file_get_contents($v7b4064db05ca12487032b3f21ae7b1dc, false, $v5c18ef72771564b7f43c497dc507aeab);if($v9a0364b9e99bb480dd25e1f0284c8555 === false) throw new umiRemoteFileGetterException('Failure');return $v9a0364b9e99bb480dd25e1f0284c8555;}$v13b5bfe96f3e2fe411c9f66f4a582adf  = @fopen($v7b4064db05ca12487032b3f21ae7b1dc, 'r', false, $v5c18ef72771564b7f43c497dc507aeab);$vc68271a63ddbc431c307beb7d2918275 = @fopen($ve62b9ecbd883c26642197a7dc8246d3c, 'w');if(!$v13b5bfe96f3e2fe411c9f66f4a582adf || !$vc68271a63ddbc431c307beb7d2918275) {throw new umiRemoteFileGetterException('Can not open');}while(!feof($v13b5bfe96f3e2fe411c9f66f4a582adf)) {$v7f2db423a49b305459147332fb01cf87 = fread($v13b5bfe96f3e2fe411c9f66f4a582adf, umiRemoteFileGetter::READ_PIECE_SIZE);fwrite($vc68271a63ddbc431c307beb7d2918275, $v7f2db423a49b305459147332fb01cf87);}fflush($vc68271a63ddbc431c307beb7d2918275);fclose($vc68271a63ddbc431c307beb7d2918275);fclose($v13b5bfe96f3e2fe411c9f66f4a582adf);return new umiFile($ve62b9ecbd883c26642197a7dc8246d3c);}private static function curlGet($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c, $vbc7d420606e2e2ab63b4a2528a7bbadf = false, $vb6a628dce68ec509d970a41cc780b9f9 = false) {if(!function_exists('curl_init')) {throw new umiRemoteFileGetterException('CURL not supported');}$result = '';$vd88fc6edf21ea464d35ff76288b84103     = curl_init($v7b4064db05ca12487032b3f21ae7b1dc);if(!$vd88fc6edf21ea464d35ff76288b84103) {throw new umiRemoteFileGetterException('CURL init failed');}if($ve62b9ecbd883c26642197a7dc8246d3c === false) {curl_setopt($vd88fc6edf21ea464d35ff76288b84103, CURLOPT_RETURNTRANSFER, true);}else {$v0666f0acdeed38d4cd9084ade1739498 = fopen($ve62b9ecbd883c26642197a7dc8246d3c, "w");if(!$v0666f0acdeed38d4cd9084ade1739498) {throw new umiRemoteFileGetterException('Can not open target file');}curl_setopt($vd88fc6edf21ea464d35ff76288b84103, CURLOPT_FILE, $v0666f0acdeed38d4cd9084ade1739498);}if(!empty($vb6a628dce68ec509d970a41cc780b9f9)) {curl_setopt($vd88fc6edf21ea464d35ff76288b84103, CURLOPT_POST,   count($vb6a628dce68ec509d970a41cc780b9f9));curl_setopt($vd88fc6edf21ea464d35ff76288b84103, CURLOPT_POSTFIELDS, http_build_query($vb6a628dce68ec509d970a41cc780b9f9));}curl_setopt($vd88fc6edf21ea464d35ff76288b84103, CURLOPT_HEADER, empty($vbc7d420606e2e2ab63b4a2528a7bbadf) ? 0 : self::buildHeaderString($vbc7d420606e2e2ab63b4a2528a7bbadf) );$result = curl_exec($vd88fc6edf21ea464d35ff76288b84103);curl_close($vd88fc6edf21ea464d35ff76288b84103);if($ve62b9ecbd883c26642197a7dc8246d3c === false) {return $result;}else {fclose($v0666f0acdeed38d4cd9084ade1739498);return new umiFile($ve62b9ecbd883c26642197a7dc8246d3c);}}private static function socketGet($v7b4064db05ca12487032b3f21ae7b1dc, $ve62b9ecbd883c26642197a7dc8246d3c, $vbc7d420606e2e2ab63b4a2528a7bbadf = false, $vb6a628dce68ec509d970a41cc780b9f9 = false) {if(!function_exists('socket_create')) {throw new umiRemoteFileGetterException('Sockets not supported');}$result    = '';$vac9c1876b892b814d6c24e7a85a09f85 = parse_url($v7b4064db05ca12487032b3f21ae7b1dc);$v901555fb06e346cb065ceb9808dcfc25    = isset($vac9c1876b892b814d6c24e7a85a09f85['port']) ? $vac9c1876b892b814d6c24e7a85a09f85['port'] : getservbyname('www', 'tcp');$v884d9804999fc47a3c2694e49ad2536a = gethostbyname($vac9c1876b892b814d6c24e7a85a09f85['host']);$v61f2529360aec54f5dc9804b842cf3fa  = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);if(socket_connect($v61f2529360aec54f5dc9804b842cf3fa, $v884d9804999fc47a3c2694e49ad2536a, $v901555fb06e346cb065ceb9808dcfc25)) {if($ve62b9ecbd883c26642197a7dc8246d3c !== false) {$v0666f0acdeed38d4cd9084ade1739498 = fopen($ve62b9ecbd883c26642197a7dc8246d3c, 'w');}$v0546e8b62aa5fd8bf2522c04ae878d90     = (!empty($vb6a628dce68ec509d970a41cc780b9f9)) ? http_build_query($vb6a628dce68ec509d970a41cc780b9f9) : null;$v618699e56323a66d68ff3231ae0f9a6b = (empty($vb6a628dce68ec509d970a41cc780b9f9)?"GET ":"POST ").$vac9c1876b892b814d6c24e7a85a09f85['path']." HTTP/1.1\r\n".                          "Host: ".$vac9c1876b892b814d6c24e7a85a09f85['host']."\r\n".                   "User-Agent: umiRemoteFileGetter v1.0\r\n".                   (empty($vb6a628dce68ec509d970a41cc780b9f9) ? "" : "Content-Type: application/x-www-form-urlencoded\r\nContent-Length: ".bytes_strlen($v0546e8b62aa5fd8bf2522c04ae878d90)."\r\n") .                   self::buildHeaderString($vbc7d420606e2e2ab63b4a2528a7bbadf) .                   "Connection: close\r\n\r\n" . $v0546e8b62aa5fd8bf2522c04ae878d90;if(socket_send($v61f2529360aec54f5dc9804b842cf3fa, $v618699e56323a66d68ff3231ae0f9a6b, strlen($v618699e56323a66d68ff3231ae0f9a6b), 0) < 0) {throw new umiRemoteFileGetterException('Request send failed');}$v7f2db423a49b305459147332fb01cf87 = '';$v3c8759eb5f0fe45f9ea243dddbce2a67 = false;do{$vd871906e18d7e876e6494103da4beebd = socket_recv($v61f2529360aec54f5dc9804b842cf3fa, $v7f2db423a49b305459147332fb01cf87, umiRemoteFileGetter::READ_PIECE_SIZE, 0);if(!$v3c8759eb5f0fe45f9ea243dddbce2a67) {$v4340fd73e75df7a9d9e45902a59ba3a4 = substr($v7f2db423a49b305459147332fb01cf87, 0, strpos($v7f2db423a49b305459147332fb01cf87, "\r\n\r\n"));$v7f2db423a49b305459147332fb01cf87  = substr($v7f2db423a49b305459147332fb01cf87, strpos($v7f2db423a49b305459147332fb01cf87, "\r\n\r\n")+4);$vd871906e18d7e876e6494103da4beebd = $vd871906e18d7e876e6494103da4beebd - bytes_strlen($v4340fd73e75df7a9d9e45902a59ba3a4) - 4;$v3c8759eb5f0fe45f9ea243dddbce2a67 = true;$v4340fd73e75df7a9d9e45902a59ba3a4 = explode("\r\n", $v4340fd73e75df7a9d9e45902a59ba3a4);$v9acb44549b41563697bb490144ec6258  = explode(" ", $v4340fd73e75df7a9d9e45902a59ba3a4[0]);if($v9acb44549b41563697bb490144ec6258[1] != '200') {throw new umiRemoteFileGetterException('Remote file does not exists');}}if($ve62b9ecbd883c26642197a7dc8246d3c === false) {$result .= $v7f2db423a49b305459147332fb01cf87;}else {fwrite($v0666f0acdeed38d4cd9084ade1739498, $v7f2db423a49b305459147332fb01cf87, $vd871906e18d7e876e6494103da4beebd);}}while($vd871906e18d7e876e6494103da4beebd != 0);if($ve62b9ecbd883c26642197a7dc8246d3c !== false) {fclose($v0666f0acdeed38d4cd9084ade1739498);}}else {throw new umiRemoteFileGetterException('Cant connect to remote host');}socket_close($v61f2529360aec54f5dc9804b842cf3fa);if($ve62b9ecbd883c26642197a7dc8246d3c === false) {return $result;}else {return new umiFile($ve62b9ecbd883c26642197a7dc8246d3c);}}private static function getTemporaryName() {return self::getTemporaryDirectory() . '/' . md5( str_repeat(rand(0,10000).time(), 5) ) . '.tmp';}private static function getTemporaryDirectory() {static $vd6fe1d0be6347b8ef2427fa629c04485 = false;if($vd6fe1d0be6347b8ef2427fa629c04485 === false) {$vd6fe1d0be6347b8ef2427fa629c04485 = ini_get('upload_tmp_dir');if (!is_dir($vd6fe1d0be6347b8ef2427fa629c04485) || $vd6fe1d0be6347b8ef2427fa629c04485=='') {$vd6fe1d0be6347b8ef2427fa629c04485 = dirname(tempnam('127631782631827', 'foo'));if (!is_dir($vd6fe1d0be6347b8ef2427fa629c04485)) {$vd6fe1d0be6347b8ef2427fa629c04485 = CURRENT_WORKING_DIR . '/cache';}}}return $vd6fe1d0be6347b8ef2427fa629c04485;}private static function buildHeaderString($vbc7d420606e2e2ab63b4a2528a7bbadf) {$va8631f5df1a55262ef1365a0ed379990 = array();if(!empty($vbc7d420606e2e2ab63b4a2528a7bbadf))  foreach($vbc7d420606e2e2ab63b4a2528a7bbadf as $vb068931cc450442b63f5b3d276ea4297 => $v2063c1608d6e0baf80249c42e2be5804) {$va8631f5df1a55262ef1365a0ed379990[] = $vb068931cc450442b63f5b3d276ea4297 . ': ' . $v2063c1608d6e0baf80249c42e2be5804;}return empty($va8631f5df1a55262ef1365a0ed379990) ? '' : (implode("\r\n", $va8631f5df1a55262ef1365a0ed379990) . "\r\n");}};?>
