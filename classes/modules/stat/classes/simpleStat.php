<?php
abstract class simpleStat{const DATE_FORMAT = 'Y-m-d';protected $start;protected $finish;protected $host_id;protected $user_id;protected $user_login;protected $interval = '-10 days';abstract public function get();protected $v21ffce5b8a6cc8cc6a41448dd69623c9 = array();protected $vaa9f73eea60a006820d0f8768bc8a3fc = 10;protected $v7a86c157ee9713c34fbd7a1ee40f0c5a = 0;public function __construct($v3248bc7547ce97b2a197b2a06cf7283d = null, $vd2e16d3f793e62737a6cdf2d54b0d9c1 = null)    {if (!empty($v3248bc7547ce97b2a197b2a06cf7283d)) {$this->setFinish($v3248bc7547ce97b2a197b2a06cf7283d);}else {$this->setFinish(time());}$this->setDomain($_SERVER['HTTP_HOST']);if (empty($vd2e16d3f793e62737a6cdf2d54b0d9c1)) {$vd2e16d3f793e62737a6cdf2d54b0d9c1 = $this->interval;}else {$this->interval = $vd2e16d3f793e62737a6cdf2d54b0d9c1;}$this->setInterval($vd2e16d3f793e62737a6cdf2d54b0d9c1);$this->setUserIDs();$this->limit  = 10;$this->offset = 0;}public function setUserIDs($v789d8a8b3898df2d7cf5e5e8a6325148 = array()){if(is_array($v789d8a8b3898df2d7cf5e5e8a6325148))   $this->user_login = array_map("intval",$v789d8a8b3898df2d7cf5e5e8a6325148);else   $this->user_login = array(intval($v789d8a8b3898df2d7cf5e5e8a6325148));}public function setUser($_sUserName) {if(intval($_sUserName) == 0) {$this->user_id = array();return;}$this->user_id = array();$v141c7f42f6d7b3f5bf8bca910bc8d0b0 = "SELECT `id` FROM `cms_stat_users` WHERE `login`='".mysql_escape_string($_sUserName)."'";$result = l_mysql_query($v141c7f42f6d7b3f5bf8bca910bc8d0b0);while($vad4f3b23a9c1baee57e5d091271a0053 = mysql_fetch_row($result)) $this->user_id[] = $vad4f3b23a9c1baee57e5d091271a0053[0];if(empty($this->user_id)) $this->user_id[] = 0;}public function setDomain($v384ab91db68a931581f8f37d921e1db6) {$v2e71b61ee9403a8ed19154768ca6293c = strval($v384ab91db68a931581f8f37d921e1db6);$v0f99b2196fed3d7b67194b66d60ed7fb = intval($v384ab91db68a931581f8f37d921e1db6);if ($v0f99b2196fed3d7b67194b66d60ed7fb === -1 || strtoupper($v2e71b61ee9403a8ed19154768ca6293c) === "ALL" || $v2e71b61ee9403a8ed19154768ca6293c == "Все") {$this->host_id = -1;}elseif ($v0f99b2196fed3d7b67194b66d60ed7fb && (strval($v0f99b2196fed3d7b67194b66d60ed7fb) === strval($v384ab91db68a931581f8f37d921e1db6))) {$va6d72ae2fdaf715c2724451d66acc30c = domainsCollection::getInstance();$v5226fe0cf2cf9156c7e1bedbc1274937 = $va6d72ae2fdaf715c2724451d66acc30c->getDomain($v0f99b2196fed3d7b67194b66d60ed7fb);if ($v5226fe0cf2cf9156c7e1bedbc1274937) {$vf3e7552257b4e44beacffb073506f43d = "SELECT SQL_CACHE `group_id` AS 'id' FROM `cms_stat_sites` WHERE `name` = '".mysql_real_escape_string($v5226fe0cf2cf9156c7e1bedbc1274937->getHost())."'";$vd928cc1d83f0171a28882d74f268e946 = l_mysql_query($vf3e7552257b4e44beacffb073506f43d);while ($vabd12a9143f26fa85e562e69c01c48db = mysql_fetch_assoc($vd928cc1d83f0171a28882d74f268e946)) {$this->host_id = intval($vabd12a9143f26fa85e562e69c01c48db['id']);break;}}}else {$this->host_id = $this->searchHostIdByHostname($v2e71b61ee9403a8ed19154768ca6293c);}return $this->host_id;}public function setCmsDomainsArray($v8ef57923ab3049b18fb75541ff476ff7 = array()) {$veb706db5fa6ffda56c020f41aefe0579 = array();$va6d72ae2fdaf715c2724451d66acc30c = domainsCollection::getInstance();foreach($v8ef57923ab3049b18fb75541ff476ff7 as $v81042c80e17f58b652c7a6725f6bdbff) {$v5226fe0cf2cf9156c7e1bedbc1274937 = $va6d72ae2fdaf715c2724451d66acc30c->getDomain($v81042c80e17f58b652c7a6725f6bdbff);if ($v5226fe0cf2cf9156c7e1bedbc1274937) $veb706db5fa6ffda56c020f41aefe0579[] = mysql_real_escape_string($v5226fe0cf2cf9156c7e1bedbc1274937->getHost());}if (count($veb706db5fa6ffda56c020f41aefe0579)) {$v527c51d025c864129adc1ea3a6474a6f = "'".implode("','", $veb706db5fa6ffda56c020f41aefe0579)."'";$vf3e7552257b4e44beacffb073506f43d = "SELECT SQL_CACHE `group_id` AS 'id' FROM `cms_stat_sites` WHERE `name` IN (".$v527c51d025c864129adc1ea3a6474a6f.")";$vd928cc1d83f0171a28882d74f268e946 = l_mysql_query($vf3e7552257b4e44beacffb073506f43d);$veb706db5fa6ffda56c020f41aefe0579 = array();while ($vabd12a9143f26fa85e562e69c01c48db = mysql_fetch_assoc($vd928cc1d83f0171a28882d74f268e946)) $veb706db5fa6ffda56c020f41aefe0579[] = intval($vabd12a9143f26fa85e562e69c01c48db['id']);$this->host_id = $veb706db5fa6ffda56c020f41aefe0579;}else {$this->host_id = 0;}return $this->host_id;}protected function getHostSQL($vaab9e1de16f38176f86d7a92ba337a8d = "", $v06e3d36fa30cea095545139854ad1fb9="host_id") {if(!is_array($this->host_id)&&($this->host_id < 0)) return "";$va94ce50ec7c649aefc2936a423013e83 = " AND ".(($vaab9e1de16f38176f86d7a92ba337a8d!="")?"`".$vaab9e1de16f38176f86d7a92ba337a8d."`.":"")."`".$v06e3d36fa30cea095545139854ad1fb9."` ";if(is_array($this->host_id)) {$va94ce50ec7c649aefc2936a423013e83 .= " IN ('".implode("','", $this->host_id)."') ";}else {$va94ce50ec7c649aefc2936a423013e83 .= " = ".$this->host_id;}return $va94ce50ec7c649aefc2936a423013e83;}public function setFinish($v3248bc7547ce97b2a197b2a06cf7283d)    {if (!is_integer($v3248bc7547ce97b2a197b2a06cf7283d)) {throw new invalidParameterException('Значение свойства finish должно быть целочисленного типа и > 0', $v3248bc7547ce97b2a197b2a06cf7283d);}$this->finish = $v3248bc7547ce97b2a197b2a06cf7283d + 86400;}public function setStart($vea2b2676c28c0db26d39331a336c6b92)    {if (!is_integer($vea2b2676c28c0db26d39331a336c6b92)) {throw new invalidParameterException('Значение свойства start должно быть целочисленного типа и > 0', $vea2b2676c28c0db26d39331a336c6b92);}$this->start = $vea2b2676c28c0db26d39331a336c6b92;}public function setInterval($vd2e16d3f793e62737a6cdf2d54b0d9c1)    {$vea2b2676c28c0db26d39331a336c6b92 = strtotime($vd2e16d3f793e62737a6cdf2d54b0d9c1, $this->finish);if (!is_integer($vea2b2676c28c0db26d39331a336c6b92)) {throw new invalidParameterException('Интервал должен задаваться в соответствии с требованиями к входным параметрам функции strtotime', $vd2e16d3f793e62737a6cdf2d54b0d9c1);}$this->start = $vea2b2676c28c0db26d39331a336c6b92;}protected function searchHostIdByHostname($v0897acf49c7c1ea9f76efe59187aa046)    {$vb068931cc450442b63f5b3d276ea4297 = $v0897acf49c7c1ea9f76efe59187aa046;$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `rel` FROM `cms3_domain_mirrows` WHERE `host` = '".$vb068931cc450442b63f5b3d276ea4297."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['rel']) && ($vf1965a857bc285d26fe22023aa5ab50d['rel'] > 0)) {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `host` FROM `cms3_domains` WHERE `id`='". $vf1965a857bc285d26fe22023aa5ab50d['rel'] ."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(isset($vf1965a857bc285d26fe22023aa5ab50d['host']) && ($vf1965a857bc285d26fe22023aa5ab50d['host']!='')) $vb068931cc450442b63f5b3d276ea4297 = $vf1965a857bc285d26fe22023aa5ab50d['host'];}else {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms3_domains` WHERE `host`='". $vb068931cc450442b63f5b3d276ea4297 ."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(!isset($vf1965a857bc285d26fe22023aa5ab50d['id']) || ($vf1965a857bc285d26fe22023aa5ab50d['id']==0)) {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `host` FROM `cms3_domains` WHERE `is_default`='1'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(isset($vf1965a857bc285d26fe22023aa5ab50d['host']) && ($vf1965a857bc285d26fe22023aa5ab50d['host']!='')) $vb068931cc450442b63f5b3d276ea4297 = $vf1965a857bc285d26fe22023aa5ab50d['host'];}}$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `group_id` FROM `cms_stat_sites` WHERE `name` = '" . $vb068931cc450442b63f5b3d276ea4297 . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['group_id'])) {return $vf1965a857bc285d26fe22023aa5ab50d['group_id'];}$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sites_groups` (`name`) VALUES ('" . $vb068931cc450442b63f5b3d276ea4297 . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vb80bb7740288fda1f201890375a60c8f = mysql_insert_id();$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sites` (`name`, `group_id`) VALUES ('" . $vb068931cc450442b63f5b3d276ea4297 . "', " . $vb80bb7740288fda1f201890375a60c8f . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);return $vb80bb7740288fda1f201890375a60c8f;}protected function formatDate($v5fc732311905cb27e82d67f4f6511f7f)    {return date(self::DATE_FORMAT, $v5fc732311905cb27e82d67f4f6511f7f);}protected function getQueryInterval()    {return "'" . $this->formatDate($this->start) . "' AND '" . $this->formatDate($this->finish) . "'";}protected function getUserFilterTable($_sPathField, $_sCompareTable) {if(!is_array($this->user_id)||empty($this->user_id)) return "";return "\n INNER JOIN `cms_stat_paths` ON `cms_stat_paths`.`".$_sPathField."`=".$_sCompareTable." \n";}protected function getUserFilterWhere($_sTable = 'cms_stat_paths') {if(!is_array($this->user_id)||empty($this->user_id)) return "";return "\n AND `".$_sTable."`.`user_id` IN (".implode(", ", $this->user_id).") \n";}protected function simpleQuery($v1b1cc7f086b3f074da452bc3129981eb, $v71fc09bb0941ca0927db55c9e465570e = false)    {if ($v71fc09bb0941ca0927db55c9e465570e) $vbf8c8478a0c4be8fca706e63931733b1 = ini_set('mysql.trace_mode','Off');$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v1b1cc7f086b3f074da452bc3129981eb);if (!is_resource($v9b207167e5381c47682c6b4f58a623fb)) {}$result = array();if($v9b207167e5381c47682c6b4f58a623fb) {while ($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb)) {$result[] = $vf1965a857bc285d26fe22023aa5ab50d;}}$v67cd0fdf26c0bed2279bcd489a958043 = count($result);if ($v71fc09bb0941ca0927db55c9e465570e) {$v67cd0fdf26c0bed2279bcd489a958043 = 0;$v3528579414912ea7816656ea7b96b29e = l_mysql_query("SELECT FOUND_ROWS() as 'cnt'");if (is_resource($v9b207167e5381c47682c6b4f58a623fb)) {while ($vcb08a1efc05437dd1a1358f362b2ecb8 = mysql_fetch_assoc($v3528579414912ea7816656ea7b96b29e)) {$v67cd0fdf26c0bed2279bcd489a958043 = $vcb08a1efc05437dd1a1358f362b2ecb8['cnt'];break;}}$result = array('result'=>$result, 'FOUND_ROWS'=>$v67cd0fdf26c0bed2279bcd489a958043);ini_set('mysql.trace_mode', $vbf8c8478a0c4be8fca706e63931733b1);}return $result;}public function setParams($vf1f713c9e000f5d3f280adbd124df4f5 = array())    {foreach($this->params as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {if (isset($vf1f713c9e000f5d3f280adbd124df4f5[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {$this->params[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $vf1f713c9e000f5d3f280adbd124df4f5[$v3c6e0b8a9c15224a8228b9a98ca1531d];}}}public function setLimit($vaa9f73eea60a006820d0f8768bc8a3fc)    {if ((int)$vaa9f73eea60a006820d0f8768bc8a3fc > 0) {$this->limit = $vaa9f73eea60a006820d0f8768bc8a3fc;}}public function setOffset($v7a86c157ee9713c34fbd7a1ee40f0c5a)    {if ((int)$v7a86c157ee9713c34fbd7a1ee40f0c5a > 0) {$this->offset = $v7a86c157ee9713c34fbd7a1ee40f0c5a;}}}?>