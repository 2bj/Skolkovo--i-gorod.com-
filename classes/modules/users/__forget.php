<?php
 abstract class __forget_users {public function forget($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {list($v364f9b183bd2dd9e0beb45c754830a6c) = def_module::loadTemplates("tpls/users/forget/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "forget_block");$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();return def_module::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function forget_do($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {static $v79e333907d62f2b72da57dda128668fd;if($v79e333907d62f2b72da57dda128668fd) return $v79e333907d62f2b72da57dda128668fd;$v52f623ebadcb1cf5f979fc6d685ce828 = (string) getRequest('forget_login');$v8a252ca940ce2fc773565f8faa81a258 = xslTemplater::getInstance()->setIsInited(false);list(    $va486ceaee2f4ee73d780df2efb5239a9, $v0ac48bb8041672c4a0d023fcde8bc20f, $v6c460486d1f214b5328b737762b04c82, $v007539953425f342426de68ef954d39a   ) = def_module::loadTemplates("tpls/users/forget/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl",    "wrong_login_block", "forget_sended", "mail_verification", "mail_verification_subject"   );xslTemplater::getInstance()->setIsInited($v8a252ca940ce2fc773565f8faa81a258);$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('users', 'user');$v8be74552df93e31bbdd6b36ed74bdb6a->where('login')->equals($v52f623ebadcb1cf5f979fc6d685ce828);$v8be74552df93e31bbdd6b36ed74bdb6a->limit(0, 1);if($v8be74552df93e31bbdd6b36ed74bdb6a->first) {$ve8701ad48ba05a91604e480dd60899a3 = $v8be74552df93e31bbdd6b36ed74bdb6a->first->id;}else {$ve8701ad48ba05a91604e480dd60899a3 = false;}if($ve8701ad48ba05a91604e480dd60899a3) {$v3bc9aac1b3cb905dc3114c8375110b27 = md5(self::getRandomPassword());$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$vb56a862f58c661af1a91f1ba483d8585 = (bool) $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/users/without_act");if ($vb56a862f58c661af1a91f1ba483d8585 || intval($va8cfde6331bd59eb2ac96f8911c4b666->getValue('is_activated'))) {$va8cfde6331bd59eb2ac96f8911c4b666->setValue("activate_code", $v3bc9aac1b3cb905dc3114c8375110b27);$va8cfde6331bd59eb2ac96f8911c4b666->commit();$v0c83f57c786a0b4a39efab23731c7ebc = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("e-mail");$vf003984af6466a03625ae1b386ad8977 = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("lname") . " " . $va8cfde6331bd59eb2ac96f8911c4b666->getValue("fname") . " " . $va8cfde6331bd59eb2ac96f8911c4b666->getValue("father_name");$v6fa2ba59a01c45393ecd8c38f23bbd8b = regedit::getInstance()->getVal("//settings/email_from");$vf37ad7f8402a0da3486eda71efc5f9db = regedit::getInstance()->getVal("//settings/fio_from");$v49c6eb74fa1dacbaae83a9c8bd397ebd = Array();$v49c6eb74fa1dacbaae83a9c8bd397ebd['domain'] = $vad5f82e879a9c5d6b5b442eb37e50551 = $_SERVER['HTTP_HOST'];$v49c6eb74fa1dacbaae83a9c8bd397ebd['restore_link'] = "http://" . $vad5f82e879a9c5d6b5b442eb37e50551 . $this->pre_lang . "/users/restore/" . $v3bc9aac1b3cb905dc3114c8375110b27 . "/";$v8a252ca940ce2fc773565f8faa81a258 = xslTemplater::getInstance()->setIsInited(false);$ve7ade27667e6c2f068e2491ecab3190c = def_module::parseTemplate($v6c460486d1f214b5328b737762b04c82, $v49c6eb74fa1dacbaae83a9c8bd397ebd, false, $ve8701ad48ba05a91604e480dd60899a3);xslTemplater::getInstance()->setIsInited($v8a252ca940ce2fc773565f8faa81a258);$vac1db94df04db3fa46dbf716425be42f = new umiMail();$vac1db94df04db3fa46dbf716425be42f->addRecipient($v0c83f57c786a0b4a39efab23731c7ebc, $vf003984af6466a03625ae1b386ad8977);$vac1db94df04db3fa46dbf716425be42f->setFrom($v6fa2ba59a01c45393ecd8c38f23bbd8b, $vf37ad7f8402a0da3486eda71efc5f9db);$vac1db94df04db3fa46dbf716425be42f->setSubject($v007539953425f342426de68ef954d39a);$vac1db94df04db3fa46dbf716425be42f->setPriorityLevel("highest");$vac1db94df04db3fa46dbf716425be42f->setContent($ve7ade27667e6c2f068e2491ecab3190c);$vac1db94df04db3fa46dbf716425be42f->commit();$vac1db94df04db3fa46dbf716425be42f->send();$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("users_restore_password");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("user_id", $ve8701ad48ba05a91604e480dd60899a3);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:status'] = "success";return $v79e333907d62f2b72da57dda128668fd = def_module::parseTemplate($v0ac48bb8041672c4a0d023fcde8bc20f, $vfca1bff8ad8b3a8585abfb0ad523ba42);}else {$v12b29cd4a546ab7c02774080f819f7dc = getServer('HTTP_REFERER');if (!strlen($v12b29cd4a546ab7c02774080f819f7dc)) $v12b29cd4a546ab7c02774080f819f7dc = $this->pre_lang . "/users/forget/";$this->errorRegisterFailPage($v12b29cd4a546ab7c02774080f819f7dc);$this->errorNewMessage("%errors_forget_nonactivated_login%");$this->errorPanic();$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:status'] = "fail";$vfca1bff8ad8b3a8585abfb0ad523ba42['forget_login'] = $v52f623ebadcb1cf5f979fc6d685ce828;return $v79e333907d62f2b72da57dda128668fd = def_module::parseTemplate($va486ceaee2f4ee73d780df2efb5239a9, $vfca1bff8ad8b3a8585abfb0ad523ba42);}}else {$v12b29cd4a546ab7c02774080f819f7dc = getServer('HTTP_REFERER');if (!strlen($v12b29cd4a546ab7c02774080f819f7dc)) $v12b29cd4a546ab7c02774080f819f7dc = $this->pre_lang . "/users/forget/";$this->errorRegisterFailPage($v12b29cd4a546ab7c02774080f819f7dc);$this->errorNewMessage("%errors_forget_wrong_login%");$this->errorPanic();$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:status'] = "fail";$vfca1bff8ad8b3a8585abfb0ad523ba42['forget_login'] = $v52f623ebadcb1cf5f979fc6d685ce828;return $v79e333907d62f2b72da57dda128668fd = def_module::parseTemplate($va486ceaee2f4ee73d780df2efb5239a9, $vfca1bff8ad8b3a8585abfb0ad523ba42);}}public function restore($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $v3bc9aac1b3cb905dc3114c8375110b27 = false) {static $result = Array();if(isset($result[$v66f6181bcb4cff4cd38fbc804a036db6])) {return $result[$v66f6181bcb4cff4cd38fbc804a036db6];}$v8a252ca940ce2fc773565f8faa81a258 = xslTemplater::getInstance()->setIsInited(false);list($v9a2586da2259b2435ebb91669e4a80a7, $v287f5c7c81f258e51293e4766eb673dc, $v6d96bc801018277910b890dc1ae7ec88, $v767d4eccd897037e0aa2198223eb5118) = def_module::loadTemplates("tpls/users/forget/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "restore_failed_block", "restore_ok_block", "mail_password", "mail_password_subject");xslTemplater::getInstance()->setIsInited($v8a252ca940ce2fc773565f8faa81a258);if(!$v3bc9aac1b3cb905dc3114c8375110b27) {$v3bc9aac1b3cb905dc3114c8375110b27 = (string) getRequest('param0');$v3bc9aac1b3cb905dc3114c8375110b27 = trim($v3bc9aac1b3cb905dc3114c8375110b27);}$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("users", "user");$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$v9aacd922ddfbcaf92a10ca077689f460 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId("activate_code");$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('users', 'user');$v8be74552df93e31bbdd6b36ed74bdb6a->where('activate_code')->equals($v3bc9aac1b3cb905dc3114c8375110b27);$v8be74552df93e31bbdd6b36ed74bdb6a->limit(0, 1);if($v8be74552df93e31bbdd6b36ed74bdb6a->first) {$va8cfde6331bd59eb2ac96f8911c4b666 = $v8be74552df93e31bbdd6b36ed74bdb6a->first;$ve8701ad48ba05a91604e480dd60899a3 = $va8cfde6331bd59eb2ac96f8911c4b666->id;}else {$va8cfde6331bd59eb2ac96f8911c4b666 = false;$ve8701ad48ba05a91604e480dd60899a3 = false;}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();if($ve8701ad48ba05a91604e480dd60899a3 && $v3bc9aac1b3cb905dc3114c8375110b27) {$v5f4dcc3b5aa765d61d8327deb882cf99 = self::getRandomPassword();$vd56b699830e77ba53855679cb1d252da = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("login");$v0c83f57c786a0b4a39efab23731c7ebc = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("e-mail");$vf003984af6466a03625ae1b386ad8977  = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("lname") . " " . $va8cfde6331bd59eb2ac96f8911c4b666->getValue("fname") . " " . $va8cfde6331bd59eb2ac96f8911c4b666->getValue("father_name");$va8cfde6331bd59eb2ac96f8911c4b666->setValue("password", md5($v5f4dcc3b5aa765d61d8327deb882cf99));$va8cfde6331bd59eb2ac96f8911c4b666->setValue("activate_code", "");$va8cfde6331bd59eb2ac96f8911c4b666->commit();$v6fa2ba59a01c45393ecd8c38f23bbd8b = regedit::getInstance()->getVal("//settings/email_from");$vf37ad7f8402a0da3486eda71efc5f9db = regedit::getInstance()->getVal("//settings/fio_from");$v49c6eb74fa1dacbaae83a9c8bd397ebd = Array();$v49c6eb74fa1dacbaae83a9c8bd397ebd['domain'] = $vad5f82e879a9c5d6b5b442eb37e50551 = $_SERVER['HTTP_HOST'];$v49c6eb74fa1dacbaae83a9c8bd397ebd['password'] = $v5f4dcc3b5aa765d61d8327deb882cf99;$v8a252ca940ce2fc773565f8faa81a258 = xslTemplater::getInstance()->setIsInited(false);$ve7ade27667e6c2f068e2491ecab3190c = def_module::parseTemplate($v6d96bc801018277910b890dc1ae7ec88, $v49c6eb74fa1dacbaae83a9c8bd397ebd, false, $ve8701ad48ba05a91604e480dd60899a3);xslTemplater::getInstance()->setIsInited($v8a252ca940ce2fc773565f8faa81a258);$vac1db94df04db3fa46dbf716425be42f = new umiMail();$vac1db94df04db3fa46dbf716425be42f->addRecipient($v0c83f57c786a0b4a39efab23731c7ebc, $vf003984af6466a03625ae1b386ad8977);$vac1db94df04db3fa46dbf716425be42f->setFrom($v6fa2ba59a01c45393ecd8c38f23bbd8b, $vf37ad7f8402a0da3486eda71efc5f9db);$vac1db94df04db3fa46dbf716425be42f->setSubject($v767d4eccd897037e0aa2198223eb5118);$vac1db94df04db3fa46dbf716425be42f->setContent($ve7ade27667e6c2f068e2491ecab3190c);$vac1db94df04db3fa46dbf716425be42f->commit();$vac1db94df04db3fa46dbf716425be42f->send();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:status'] = "success";$vfca1bff8ad8b3a8585abfb0ad523ba42['login'] = $vd56b699830e77ba53855679cb1d252da;$vfca1bff8ad8b3a8585abfb0ad523ba42['password'] = $v5f4dcc3b5aa765d61d8327deb882cf99;return $result[$v66f6181bcb4cff4cd38fbc804a036db6] = def_module::parseTemplate($v287f5c7c81f258e51293e4766eb673dc, $vfca1bff8ad8b3a8585abfb0ad523ba42, false, $ve8701ad48ba05a91604e480dd60899a3);}else {$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:status'] = "fail";return $result[$v66f6181bcb4cff4cd38fbc804a036db6] = def_module::parseTemplate($v9a2586da2259b2435ebb91669e4a80a7, $vfca1bff8ad8b3a8585abfb0ad523ba42);}}public static function getRandomPassword ($v2fa47f7c65fec19cc163b195725e3844 = 12) {$ve600074f5086bdfc5c11f7728f7d67f0 = "$#@^&!1234567890qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM";$vf7bd60b75b29d79b660a2859395c1a24 = strlen($ve600074f5086bdfc5c11f7728f7d67f0);$vb5997cee0d1ef3e5f3f6dc7a8b3ad7d7 = "";for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v2fa47f7c65fec19cc163b195725e3844;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v4a8a08f09d37b73795649038408b5f33 = rand(0, $vf7bd60b75b29d79b660a2859395c1a24 - 1);$vb5997cee0d1ef3e5f3f6dc7a8b3ad7d7 .= $ve600074f5086bdfc5c11f7728f7d67f0[$v4a8a08f09d37b73795649038408b5f33];}return $vb5997cee0d1ef3e5f3f6dc7a8b3ad7d7;}};?>