<?php
 class permissionsCollection extends singleton implements iSingleton, iPermissionsCollection {protected $methodsPermissions = array(), $user_id = 0, $tempElementPermissions = array();const E_READ_ALLOWED   = 0;const E_EDIT_ALLOWED   = 1;const E_CREATE_ALLOWED = 2;const E_DELETE_ALLOWED = 3;const E_MOVE_ALLOWED   = 4;const E_READ_ALLOWED_BIT   = 1;const E_EDIT_ALLOWED_BIT   = 2;const E_CREATE_ALLOWED_BIT = 4;const E_DELETE_ALLOWED_BIT = 8;const E_MOVE_ALLOWED_BIT   = 16;public function __construct() {if(is_null(getRequest('guest-mode')) == false) {$this->user_id = self::getGuestId();return;}$v9bc65c2abec141778ffaa729489f3e87 = cmsController::getInstance()->getModule("users");if($v9bc65c2abec141778ffaa729489f3e87 instanceof def_module) {$this->user_id = $v9bc65c2abec141778ffaa729489f3e87->user_id;}}public static function getInstance() {return parent::getInstance(__CLASS__);}public function getOwnerType($v5e7b19364b8de2dedd3aa48cf62706e3) {if($v41064781857b29db62b319b579676852 = umiObjectsCollection::getInstance()->getObject($v5e7b19364b8de2dedd3aa48cf62706e3)) {if($v1471e4e05a4db95d353cc867fe317314 = $v41064781857b29db62b319b579676852->getPropByName("groups")) {return $v1471e4e05a4db95d353cc867fe317314->getValue();}else {return $v5e7b19364b8de2dedd3aa48cf62706e3;}}else {return false;}}public function makeSqlWhere($v5e7b19364b8de2dedd3aa48cf62706e3, $v8a7ee68c0472cf0cf8e3f2cba2134c27 = false) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3])) return $v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3];$v72122ce96bfec66e2396d2e25225d70a = $this->getOwnerType($v5e7b19364b8de2dedd3aa48cf62706e3);if(is_numeric($v72122ce96bfec66e2396d2e25225d70a)) {$v72122ce96bfec66e2396d2e25225d70a = array();}if($v5e7b19364b8de2dedd3aa48cf62706e3) {$v72122ce96bfec66e2396d2e25225d70a[] = $v5e7b19364b8de2dedd3aa48cf62706e3;}$v72122ce96bfec66e2396d2e25225d70a[] = self::getGuestId();$v72122ce96bfec66e2396d2e25225d70a = array_unique($v72122ce96bfec66e2396d2e25225d70a);if(sizeof($v72122ce96bfec66e2396d2e25225d70a) > 2) {foreach($v72122ce96bfec66e2396d2e25225d70a as $v865c0c0b4ab0e063e5caa3387c1a8741 => $vb80bb7740288fda1f201890375a60c8f) {if($vb80bb7740288fda1f201890375a60c8f == $v5e7b19364b8de2dedd3aa48cf62706e3 && $v8a7ee68c0472cf0cf8e3f2cba2134c27) {unset($v72122ce96bfec66e2396d2e25225d70a[$v865c0c0b4ab0e063e5caa3387c1a8741]);}}$v72122ce96bfec66e2396d2e25225d70a = array_unique($v72122ce96bfec66e2396d2e25225d70a);sort($v72122ce96bfec66e2396d2e25225d70a);}$vac5c74b64b4b8352ef2f181affb5ac2a = "";$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($v72122ce96bfec66e2396d2e25225d70a);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vac5c74b64b4b8352ef2f181affb5ac2a .= "cp.owner_id = '{$v72122ce96bfec66e2396d2e25225d70a[$v865c0c0b4ab0e063e5caa3387c1a8741]}'";if($v865c0c0b4ab0e063e5caa3387c1a8741 < ($v7dabf5c198b0bab2eaa42bb03a113e55 - 1)) {$vac5c74b64b4b8352ef2f181affb5ac2a .= " OR ";}}$vac5c74b64b4b8352ef2f181affb5ac2a = "({$vac5c74b64b4b8352ef2f181affb5ac2a})";return $v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3] = $vac5c74b64b4b8352ef2f181affb5ac2a;}public function isAllowedModule($v5e7b19364b8de2dedd3aa48cf62706e3, $v22884db148f0ffb0d830ba431102b0b5) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();if($v5e7b19364b8de2dedd3aa48cf62706e3 == false) {$v5e7b19364b8de2dedd3aa48cf62706e3 = $this->getUserId();}if($this->isSv($v5e7b19364b8de2dedd3aa48cf62706e3)) return true;if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3][$v22884db148f0ffb0d830ba431102b0b5])) return $v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3][$v22884db148f0ffb0d830ba431102b0b5];$v7a310d89a58d8189e31d766fb1fb745a = $this->makeSqlWhere($v5e7b19364b8de2dedd3aa48cf62706e3);$v22884db148f0ffb0d830ba431102b0b5 = mysql_real_escape_string($v22884db148f0ffb0d830ba431102b0b5);if(substr($v22884db148f0ffb0d830ba431102b0b5, 0, 7) == "macros_") return false;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE module, MAX(cp.allow) FROM cms_permissions cp WHERE method IS NULL AND {$v7a310d89a58d8189e31d766fb1fb745a} GROUP BY module";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v22884db148f0ffb0d830ba431102b0b5, $vb394126a0e52e75f1e3d535d0fb0d33c) = mysql_fetch_row($result)) {$v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3][$v22884db148f0ffb0d830ba431102b0b5] = $vb394126a0e52e75f1e3d535d0fb0d33c;}return isset($v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3][$v22884db148f0ffb0d830ba431102b0b5]) ? (bool) $v0fea6a13c52b4d4725368f24b045ca84[$v5e7b19364b8de2dedd3aa48cf62706e3][$v22884db148f0ffb0d830ba431102b0b5] : false;}public function isAllowedMethod($v5e7b19364b8de2dedd3aa48cf62706e3, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, $v8a7ee68c0472cf0cf8e3f2cba2134c27 = false) {if($v22884db148f0ffb0d830ba431102b0b5 == "content" && !strlen($vea9f6aca279138c58f705c8d4cb4b8ce)) return 1;if($v22884db148f0ffb0d830ba431102b0b5 == "config" && $vea9f6aca279138c58f705c8d4cb4b8ce == "menu") return 1;if($v22884db148f0ffb0d830ba431102b0b5 == "eshop" && $vea9f6aca279138c58f705c8d4cb4b8ce == "makeRealDivide") return 1;if($this->isAdmin($v5e7b19364b8de2dedd3aa48cf62706e3)) {if($this->isAdminAllowedMethod($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce)) {return 1;}}if($this->isSv($v5e7b19364b8de2dedd3aa48cf62706e3)) return true;if(!$v22884db148f0ffb0d830ba431102b0b5) return false;$vea9f6aca279138c58f705c8d4cb4b8ce = $this->getBaseMethodName($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce);$vcb69789460f93042a787f8d250ca26dc = &$this->methodsPermissions;if(!isset($vcb69789460f93042a787f8d250ca26dc[$v5e7b19364b8de2dedd3aa48cf62706e3]) || !is_array($vcb69789460f93042a787f8d250ca26dc[$v5e7b19364b8de2dedd3aa48cf62706e3])) {$vcb69789460f93042a787f8d250ca26dc[$v5e7b19364b8de2dedd3aa48cf62706e3] = array();}$v0fea6a13c52b4d4725368f24b045ca84 = &$vcb69789460f93042a787f8d250ca26dc[$v5e7b19364b8de2dedd3aa48cf62706e3];$v7a310d89a58d8189e31d766fb1fb745a = $this->makeSqlWhere($v5e7b19364b8de2dedd3aa48cf62706e3, $v8a7ee68c0472cf0cf8e3f2cba2134c27);if($v22884db148f0ffb0d830ba431102b0b5 == "backup" && $vea9f6aca279138c58f705c8d4cb4b8ce == "rollback") return true;if($v22884db148f0ffb0d830ba431102b0b5 == "autoupdate" && $vea9f6aca279138c58f705c8d4cb4b8ce == "service") return true;if($v22884db148f0ffb0d830ba431102b0b5 == "config" && ($vea9f6aca279138c58f705c8d4cb4b8ce == "lang_list" || $vea9f6aca279138c58f705c8d4cb4b8ce == "lang_phrases")) return true;if($v22884db148f0ffb0d830ba431102b0b5 == "users" && ($vea9f6aca279138c58f705c8d4cb4b8ce == "auth" || $vea9f6aca279138c58f705c8d4cb4b8ce == "login_do" || $vea9f6aca279138c58f705c8d4cb4b8ce == "login")) return true;$v0a42907b589a309ad94f8874eacbc63f = $v22884db148f0ffb0d830ba431102b0b5;if(!array_key_exists($v0a42907b589a309ad94f8874eacbc63f, $v0fea6a13c52b4d4725368f24b045ca84)) {$v248064bbf6355f96570c9a17b0b1f781 = cacheFrontend::getInstance()->loadData('module_perms_' . $v5e7b19364b8de2dedd3aa48cf62706e3 . '_' . $v0a42907b589a309ad94f8874eacbc63f);if(is_array($v248064bbf6355f96570c9a17b0b1f781)) {$v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5] = $v248064bbf6355f96570c9a17b0b1f781;}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE cp.method, MAX(cp.allow) FROM cms_permissions cp WHERE module = '{$v22884db148f0ffb0d830ba431102b0b5}' AND {$v7a310d89a58d8189e31d766fb1fb745a} GROUP BY module, method";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5] = array();while(list($v05dd82e678780573a4af462d35d7f06d) = mysql_fetch_row($result)) {$v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f][] = $v05dd82e678780573a4af462d35d7f06d;}cacheFrontend::getInstance()->saveData('module_perms_' . $v5e7b19364b8de2dedd3aa48cf62706e3 . '_' . $v0a42907b589a309ad94f8874eacbc63f, $v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5], 3600);}}if (in_array($vea9f6aca279138c58f705c8d4cb4b8ce, $v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f]) || in_array(strtolower($vea9f6aca279138c58f705c8d4cb4b8ce), $v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f])) {return true;}else {return false;}}public function isAllowedObject($v5e7b19364b8de2dedd3aa48cf62706e3, $vaf31437ce61345f416579830a98c91e5, $vbd354405a20aa635025421c9edb5d41d = false) {$vaf31437ce61345f416579830a98c91e5 = (int) $vaf31437ce61345f416579830a98c91e5;if($vaf31437ce61345f416579830a98c91e5 == 0) return array(false, false, false, false, false);if($this->isSv($v5e7b19364b8de2dedd3aa48cf62706e3)) {return array(true, true, true, true, true);}if(array_key_exists($vaf31437ce61345f416579830a98c91e5, $this->tempElementPermissions)) {$vc9e9a848920877e76685b2e4e76de38d = $this->tempElementPermissions[$vaf31437ce61345f416579830a98c91e5];return array((bool)($vc9e9a848920877e76685b2e4e76de38d&1), (bool)($vc9e9a848920877e76685b2e4e76de38d&2), (bool)($vc9e9a848920877e76685b2e4e76de38d&4), (bool)($vc9e9a848920877e76685b2e4e76de38d&8), (bool)($vc9e9a848920877e76685b2e4e76de38d&16) );}static $v0fea6a13c52b4d4725368f24b045ca84;if(!is_array($v0fea6a13c52b4d4725368f24b045ca84)) {$v0fea6a13c52b4d4725368f24b045ca84 = array();}$v0a42907b589a309ad94f8874eacbc63f = $v5e7b19364b8de2dedd3aa48cf62706e3 . "." . $vaf31437ce61345f416579830a98c91e5;if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f]) && is_array($v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f])) {return $v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f];}$v7a310d89a58d8189e31d766fb1fb745a = $this->makeSqlWhere($v5e7b19364b8de2dedd3aa48cf62706e3);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE BIT_OR(cp.level) FROM cms3_permissions cp WHERE rel_id = '{$vaf31437ce61345f416579830a98c91e5}' AND {$v7a310d89a58d8189e31d766fb1fb745a}";$vc9e9a848920877e76685b2e4e76de38d = false;cacheFrontend::getInstance()->loadSql($vac5c74b64b4b8352ef2f181affb5ac2a);if(!$vc9e9a848920877e76685b2e4e76de38d || $vbd354405a20aa635025421c9edb5d41d) {$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list($vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row($result);$vc9e9a848920877e76685b2e4e76de38d = array((bool)($vc9e9a848920877e76685b2e4e76de38d&1), (bool)($vc9e9a848920877e76685b2e4e76de38d&2), (bool)($vc9e9a848920877e76685b2e4e76de38d&4), (bool)($vc9e9a848920877e76685b2e4e76de38d&8), (bool)($vc9e9a848920877e76685b2e4e76de38d&16) );}if($vc9e9a848920877e76685b2e4e76de38d) {cacheFrontend::getInstance()->saveSql($vac5c74b64b4b8352ef2f181affb5ac2a, $vc9e9a848920877e76685b2e4e76de38d, 600);}$v0fea6a13c52b4d4725368f24b045ca84[$v0a42907b589a309ad94f8874eacbc63f] = $vc9e9a848920877e76685b2e4e76de38d;return $vc9e9a848920877e76685b2e4e76de38d;}public function isSv($ve8701ad48ba05a91604e480dd60899a3 = false) {static $v1b747442de0fb075fcdc59af978fa41b = array();if($ve8701ad48ba05a91604e480dd60899a3 === false) {$ve8701ad48ba05a91604e480dd60899a3 = $this->getUserId();}if(isset($v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3])) {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3];}if(is_null(getRequest('guest-mode')) == false) {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3] = false;}if($vee11cbb19052e40b07aac0ca060c23ee = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3)) {if($ve8701ad48ba05a91604e480dd60899a3 == 15) {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3] = true;}if($v1471e4e05a4db95d353cc867fe317314 = $vee11cbb19052e40b07aac0ca060c23ee->getPropByName("groups")) {if(in_array(15, $v1471e4e05a4db95d353cc867fe317314->getValue())) {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3] = true;}else {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3] = false;}}else {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3] = false;}}else {return $v1b747442de0fb075fcdc59af978fa41b[$ve8701ad48ba05a91604e480dd60899a3] = false;}}public function isAdmin($ve8701ad48ba05a91604e480dd60899a3 = false) {static $vc60879c6b41321704ee88fbc7b9a73e4 = array();if($ve8701ad48ba05a91604e480dd60899a3 === false) $ve8701ad48ba05a91604e480dd60899a3 = $this->getUserId();if(isset($vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3])) return $vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3];if($this->isSv($ve8701ad48ba05a91604e480dd60899a3)) return $vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3] = true;if(is_array(getSession('is_admin'))) {$vc60879c6b41321704ee88fbc7b9a73e4 = getSession('is_admin');if(isset($vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3])) return $vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3];}$v7a310d89a58d8189e31d766fb1fb745a = $this->makeSqlWhere($ve8701ad48ba05a91604e480dd60899a3);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT SQL_CACHE COUNT(cp.allow) 
	FROM cms_permissions cp 
	WHERE method IS NULL AND {$v7a310d89a58d8189e31d766fb1fb745a} AND cp.allow IN (1, 2) GROUP BY module
SQL;   $result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list($v2817f701d5e1a1181e657251363295fd) = mysql_fetch_row($result);$vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3] = (bool) $v2817f701d5e1a1181e657251363295fd;$_SESSION['is_admin'] = $vc60879c6b41321704ee88fbc7b9a73e4;return $vc60879c6b41321704ee88fbc7b9a73e4[$ve8701ad48ba05a91604e480dd60899a3];}public function isOwnerOfObject($vaf31437ce61345f416579830a98c91e5, $ve8701ad48ba05a91604e480dd60899a3 = false) {if($ve8701ad48ba05a91604e480dd60899a3 == false) {$ve8701ad48ba05a91604e480dd60899a3 = $this->getUserId();}if($ve8701ad48ba05a91604e480dd60899a3 == $vaf31437ce61345f416579830a98c91e5) {return true;}else {$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()->getObject($vaf31437ce61345f416579830a98c91e5);if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject) {$v5e7b19364b8de2dedd3aa48cf62706e3 = $va8cfde6331bd59eb2ac96f8911c4b666->getOwnerId();}else {$v5e7b19364b8de2dedd3aa48cf62706e3 = 0;}if($v5e7b19364b8de2dedd3aa48cf62706e3 == 0 || $v5e7b19364b8de2dedd3aa48cf62706e3 == $ve8701ad48ba05a91604e480dd60899a3) {return true;}else {if($v5e7b19364b8de2dedd3aa48cf62706e3 == 2373 && class_exists('customer')) {$v91ec1f9324753048c0096d036a694f86 = customer::get();if($v8a3c732c25ee535ad675a88301525231 && ($v91ec1f9324753048c0096d036a694f86->id == $v5e7b19364b8de2dedd3aa48cf62706e3)) {return true;}}return false;}}}public function setDefaultPermissions($v7057e8409c7c531a1a6e9ac3df4ed549) {if(!umiHierarchy::getInstance()->isExists($v7057e8409c7c531a1a6e9ac3df4ed549)) {return false;}l_mysql_query("START TRANSACTION");$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_permissions WHERE rel_id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true, true);$v0715f6d9497f93911417c9c324265771 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getTypeId();$vb946c44d711ade3b061653732977d043 = umiHierarchyTypesCollection::getInstance()->getType($v0715f6d9497f93911417c9c324265771);$v22884db148f0ffb0d830ba431102b0b5 = $vb946c44d711ade3b061653732977d043->getName();$vea9f6aca279138c58f705c8d4cb4b8ce = $vb946c44d711ade3b061653732977d043->getExt();$v94757cae63fd3e398c0811a976dd6bbe = umiObjectTypesCollection::getInstance()->getBaseType("users", "user");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setObjectTypeFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v94757cae63fd3e398c0811a976dd6bbe);$v31b536969506cd993ffe6c80f210b435 = umiObjectTypesCollection::getInstance()->getType($v94757cae63fd3e398c0811a976dd6bbe)->getFieldId("groups");$v8be74552df93e31bbdd6b36ed74bdb6a->setPropertyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterIsNull($v31b536969506cd993ffe6c80f210b435);$v9bc65c2abec141778ffaa729489f3e87 = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("users", "users");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setObjectTypeFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v87306dd4235ed712ebc07fe169b76f83);$v1471e4e05a4db95d353cc867fe317314 = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$v5891da2d64975cae48d175d1e001f5da = array_merge($v9bc65c2abec141778ffaa729489f3e87, $v1471e4e05a4db95d353cc867fe317314);$v5e7b19364b8de2dedd3aa48cf62706e3 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getObject()->getOwnerId();if($v72122ce96bfec66e2396d2e25225d70a = umiObjectsCollection::getInstance()->getObject($v5e7b19364b8de2dedd3aa48cf62706e3)) {if($va8ba6ec990d9c7eeadb629f342dbab1e = $v72122ce96bfec66e2396d2e25225d70a->getValue("groups")) {$vd7be1bb48db472fbda8dbc2e05e98083 = $va8ba6ec990d9c7eeadb629f342dbab1e;}else {$vd7be1bb48db472fbda8dbc2e05e98083 = array($v5e7b19364b8de2dedd3aa48cf62706e3);}}else {$vd7be1bb48db472fbda8dbc2e05e98083 = array();}foreach($v5891da2d64975cae48d175d1e001f5da as $v8a0462e9b477e23253ef0cd29b0e7ab7) {if($v8a0462e9b477e23253ef0cd29b0e7ab7 == SV_GROUP_ID) continue;if($v22884db148f0ffb0d830ba431102b0b5 == "content") $vea9f6aca279138c58f705c8d4cb4b8ce == "page";if($this->isAllowedMethod($v8a0462e9b477e23253ef0cd29b0e7ab7, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce)) {if(in_array($v8a0462e9b477e23253ef0cd29b0e7ab7, $vd7be1bb48db472fbda8dbc2e05e98083) || $v8a0462e9b477e23253ef0cd29b0e7ab7 == SV_GROUP_ID || $this->isAllowedMethod($v8a0462e9b477e23253ef0cd29b0e7ab7, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce . ".edit")) {$vc9e9a848920877e76685b2e4e76de38d = permissionsCollection::E_READ_ALLOWED_BIT +         permissionsCollection::E_EDIT_ALLOWED_BIT +         permissionsCollection::E_CREATE_ALLOWED_BIT +         permissionsCollection::E_DELETE_ALLOWED_BIT +         permissionsCollection::E_MOVE_ALLOWED_BIT;}else {$vc9e9a848920877e76685b2e4e76de38d = permissionsCollection::E_READ_ALLOWED_BIT;}$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_permissions (rel_id, owner_id, level) VALUES('{$v7057e8409c7c531a1a6e9ac3df4ed549}', '{$v8a0462e9b477e23253ef0cd29b0e7ab7}', '{$vc9e9a848920877e76685b2e4e76de38d}')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);}}l_mysql_query("COMMIT");l_mysql_query("SET AUTOCOMMIT=1");$this->cleanupElementPermissions($v7057e8409c7c531a1a6e9ac3df4ed549);$v0a42907b589a309ad94f8874eacbc63f = $this->user_id . "." . $v7057e8409c7c531a1a6e9ac3df4ed549;cacheFrontend::getInstance()->saveSql($v0a42907b589a309ad94f8874eacbc63f, array(true, true));}public function setInheritedPermissions($v7552cd149af7495ee7d8225974e50f80) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();if(!($v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7552cd149af7495ee7d8225974e50f80))) return false;$vbfa030fe63bacd523dd70a76cfaed98a = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();$v6e52c40bb8fc91ff39ee5c79b4211f67 = $this->getRecordedPermissions($vbfa030fe63bacd523dd70a76cfaed98a);$vf09cc7ee3a9a93273f4b80601cafb00c  = array();foreach($v6e52c40bb8fc91ff39ee5c79b4211f67 as $vb0ab4f7791b60b1e8ea01057b77873b0 => $vc9e9a848920877e76685b2e4e76de38d) {$vf09cc7ee3a9a93273f4b80601cafb00c[] = "('{$v7552cd149af7495ee7d8225974e50f80}', '{$vb0ab4f7791b60b1e8ea01057b77873b0}', '{$vc9e9a848920877e76685b2e4e76de38d}')";}if(empty($vf09cc7ee3a9a93273f4b80601cafb00c)) return;l_mysql_query("START TRANSACTION");$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_permissions WHERE rel_id = '{$v7552cd149af7495ee7d8225974e50f80}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_permissions (rel_id, owner_id, level) VALUES ".implode(", ", $vf09cc7ee3a9a93273f4b80601cafb00c);l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);l_mysql_query("COMMIT");l_mysql_query("SET AUTOCOMMIT=1");return true;}public function resetElementPermissions($v7552cd149af7495ee7d8225974e50f80, $vb0ab4f7791b60b1e8ea01057b77873b0 = false) {$v7552cd149af7495ee7d8225974e50f80 = (int) $v7552cd149af7495ee7d8225974e50f80;if($vb0ab4f7791b60b1e8ea01057b77873b0 === false) {$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_permissions WHERE rel_id = '{$v7552cd149af7495ee7d8225974e50f80}'";}else {$vb0ab4f7791b60b1e8ea01057b77873b0 = (int) $vb0ab4f7791b60b1e8ea01057b77873b0;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_permissions WHERE owner_id = '{$vb0ab4f7791b60b1e8ea01057b77873b0}' AND rel_id = '{$v7552cd149af7495ee7d8225974e50f80}'";}l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}public function resetModulesPermissions($vb0ab4f7791b60b1e8ea01057b77873b0, $v0eb9b3af2e4a00837a1b1a854c9ea18c = NULL) {$vb0ab4f7791b60b1e8ea01057b77873b0 = (int) $vb0ab4f7791b60b1e8ea01057b77873b0;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms_permissions WHERE owner_id = '{$vb0ab4f7791b60b1e8ea01057b77873b0}'";if(is_array($v0eb9b3af2e4a00837a1b1a854c9ea18c)) {if(sizeof($v0eb9b3af2e4a00837a1b1a854c9ea18c)) {$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms_permissions WHERE owner_id = '{$vb0ab4f7791b60b1e8ea01057b77873b0}' AND module IN ('" . implode("', '", $v0eb9b3af2e4a00837a1b1a854c9ea18c) . "')";}}l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();foreach($v0eb9b3af2e4a00837a1b1a854c9ea18c as $v22884db148f0ffb0d830ba431102b0b5) {$vb99eb979e6f6efabc396f777b503f7e7->deleteKey('module_perms_' . $vb0ab4f7791b60b1e8ea01057b77873b0 . '_' . $v22884db148f0ffb0d830ba431102b0b5, true);}return true;}public function setElementPermissions($vb0ab4f7791b60b1e8ea01057b77873b0, $v7552cd149af7495ee7d8225974e50f80, $vc9e9a848920877e76685b2e4e76de38d) {$vb0ab4f7791b60b1e8ea01057b77873b0 = (int) $vb0ab4f7791b60b1e8ea01057b77873b0;$v7552cd149af7495ee7d8225974e50f80 = (int) $v7552cd149af7495ee7d8225974e50f80;$vc9e9a848920877e76685b2e4e76de38d = (int) $vc9e9a848920877e76685b2e4e76de38d;if($v7552cd149af7495ee7d8225974e50f80 == 0 || $vb0ab4f7791b60b1e8ea01057b77873b0 == 0) {return false;}$v6a7f46dad32f8b8b17febd2ac9dca521 = "DELETE FROM cms3_permissions WHERE owner_id = '".$vb0ab4f7791b60b1e8ea01057b77873b0."' AND rel_id = '".$v7552cd149af7495ee7d8225974e50f80."'";l_mysql_query($v6a7f46dad32f8b8b17febd2ac9dca521);$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_permissions (owner_id, rel_id, level) VALUES('{$vb0ab4f7791b60b1e8ea01057b77873b0}', '{$v7552cd149af7495ee7d8225974e50f80}', '{$vc9e9a848920877e76685b2e4e76de38d}')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$this->cleanupElementPermissions($v7552cd149af7495ee7d8225974e50f80);$this->isAllowedObject($vb0ab4f7791b60b1e8ea01057b77873b0, $v7552cd149af7495ee7d8225974e50f80, true);return true;}public function setModulesPermissions($vb0ab4f7791b60b1e8ea01057b77873b0, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce = false, $v75a2a330879d5ddd5512ff17851f0061 = true) {$vb0ab4f7791b60b1e8ea01057b77873b0 = (int) $vb0ab4f7791b60b1e8ea01057b77873b0;$v22884db148f0ffb0d830ba431102b0b5 = mysql_real_escape_string($v22884db148f0ffb0d830ba431102b0b5);if($vea9f6aca279138c58f705c8d4cb4b8ce !== false) {return $this->setMethodPermissions($vb0ab4f7791b60b1e8ea01057b77873b0, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce);}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms_permissions (owner_id, module, method, allow) VALUES('{$vb0ab4f7791b60b1e8ea01057b77873b0}', '{$v22884db148f0ffb0d830ba431102b0b5}', NULL, '1')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v75a2a330879d5ddd5512ff17851f0061) $this->cleanupBasePermissions();return true;}}protected function setMethodPermissions($vb0ab4f7791b60b1e8ea01057b77873b0, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, $v75a2a330879d5ddd5512ff17851f0061 = true) {$vea9f6aca279138c58f705c8d4cb4b8ce = mysql_real_escape_string($vea9f6aca279138c58f705c8d4cb4b8ce);$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms_permissions (owner_id, module, method, allow) VALUES('{$vb0ab4f7791b60b1e8ea01057b77873b0}', '{$v22884db148f0ffb0d830ba431102b0b5}', '{$vea9f6aca279138c58f705c8d4cb4b8ce}', '1')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v75a2a330879d5ddd5512ff17851f0061) $this->cleanupBasePermissions();return true;}public function hasUserPermissions($vb0ab4f7791b60b1e8ea01057b77873b0) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT COUNT(*) FROM cms3_permissions WHERE owner_id = '{$vb0ab4f7791b60b1e8ea01057b77873b0}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list($v2817f701d5e1a1181e657251363295fd) = mysql_fetch_row($result);return $v2817f701d5e1a1181e657251363295fd;}public function copyHierarchyPermissions($v1fa96cda79d6a13e7abbc85448084fcf, $v3504006854d4e51b5c97e94f19baba29) {if($v1fa96cda79d6a13e7abbc85448084fcf == self::getGuestId()) {return false;}$v1fa96cda79d6a13e7abbc85448084fcf = (int) $v1fa96cda79d6a13e7abbc85448084fcf;$v3504006854d4e51b5c97e94f19baba29 = (int) $v3504006854d4e51b5c97e94f19baba29;$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_permissions (level, rel_id, owner_id) SELECT level, rel_id, '{$v3504006854d4e51b5c97e94f19baba29}' FROM cms3_permissions WHERE owner_id = '{$v1fa96cda79d6a13e7abbc85448084fcf}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}public function getStaticPermissions($v22884db148f0ffb0d830ba431102b0b5) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5])) {return $v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5];}$v8e0891fe51dd9fe334c902144be6bd90 = CURRENT_WORKING_DIR . "/classes/modules/" . $v22884db148f0ffb0d830ba431102b0b5 . "/permissions.php";if(file_exists($v8e0891fe51dd9fe334c902144be6bd90)) {require $v8e0891fe51dd9fe334c902144be6bd90;if(isset($permissions)) {$v31bdd6780dad16b675b3e57ffb3f2272 = $permissions;$v9645b439bd2d770beb425162e180d91c = CURRENT_WORKING_DIR . "/classes/modules/" . $v22884db148f0ffb0d830ba431102b0b5 . "/permissions.custom.php";if(file_exists($v9645b439bd2d770beb425162e180d91c)) {unset($permissions);require $v9645b439bd2d770beb425162e180d91c;if(isset($permissions)) {$v31bdd6780dad16b675b3e57ffb3f2272 = array_merge_recursive($v31bdd6780dad16b675b3e57ffb3f2272, $permissions);}}$v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5] = $v31bdd6780dad16b675b3e57ffb3f2272;unset($v31bdd6780dad16b675b3e57ffb3f2272);unset($permissions);}else {$v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5] = false;}}else {$v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5] = false;}return $v0fea6a13c52b4d4725368f24b045ca84[$v22884db148f0ffb0d830ba431102b0b5];}protected function getBaseMethodName($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce) {$va9ac5a6cc3cbe84f9c18323af2b9007f = $this->getStaticPermissions($v22884db148f0ffb0d830ba431102b0b5);if($vea9f6aca279138c58f705c8d4cb4b8ce && is_array($va9ac5a6cc3cbe84f9c18323af2b9007f)) {if(array_key_exists($vea9f6aca279138c58f705c8d4cb4b8ce, $va9ac5a6cc3cbe84f9c18323af2b9007f)) {return $vea9f6aca279138c58f705c8d4cb4b8ce;}else {foreach($va9ac5a6cc3cbe84f9c18323af2b9007f as $va85c62c99bf80aeffb74914fb56a1942 => $v568356dafd7353c803edafa5eb5d438f) {if(is_array($v568356dafd7353c803edafa5eb5d438f)) {if(in_array($vea9f6aca279138c58f705c8d4cb4b8ce, $v568356dafd7353c803edafa5eb5d438f) || in_array(strtolower($vea9f6aca279138c58f705c8d4cb4b8ce), $v568356dafd7353c803edafa5eb5d438f)) {return $va85c62c99bf80aeffb74914fb56a1942;}}}return $vea9f6aca279138c58f705c8d4cb4b8ce;}}else {return $vea9f6aca279138c58f705c8d4cb4b8ce;}}public function getUserId() {return $this->user_id;}public function cleanupBasePermissions() {$v92ad7554e2e0d208f33729db6d54b59b = self::getGuestId();$vac5c74b64b4b8352ef2f181affb5ac2a    = "SELECT module, method FROM cms_permissions WHERE owner_id = '{$v92ad7554e2e0d208f33729db6d54b59b}' AND allow = 1";$result = mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = array();while(list($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce) = mysql_fetch_row($result)) {if($vea9f6aca279138c58f705c8d4cb4b8ce) {$vac5c74b64b4b8352ef2f181affb5ac2a[] = "(module = '{$v22884db148f0ffb0d830ba431102b0b5}' AND method = '{$vea9f6aca279138c58f705c8d4cb4b8ce}')";}else {$vac5c74b64b4b8352ef2f181affb5ac2a[] = "(module = '{$v22884db148f0ffb0d830ba431102b0b5}' AND method IS NULL)";}}if(!empty($vac5c74b64b4b8352ef2f181affb5ac2a))     mysql_query("DELETE FROM cms_permissions WHERE owner_id != '{$v92ad7554e2e0d208f33729db6d54b59b}' AND (" . implode(' OR ', $vac5c74b64b4b8352ef2f181affb5ac2a) . ")");}protected function cleanupElementPermissions($vd5d4bb9b2c282937ee64b1fb0495ef08) {$vd5d4bb9b2c282937ee64b1fb0495ef08 = (int) $vd5d4bb9b2c282937ee64b1fb0495ef08;$v92ad7554e2e0d208f33729db6d54b59b = self::getGuestId();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT level FROM cms3_permissions WHERE owner_id = '{$v92ad7554e2e0d208f33729db6d54b59b}' AND rel_id = {$vd5d4bb9b2c282937ee64b1fb0495ef08}";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v075d12d847ab6a1266bae1458b09cfc0 = 0;while(list($vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row($result)) {if($vc9e9a848920877e76685b2e4e76de38d>$v075d12d847ab6a1266bae1458b09cfc0) $v075d12d847ab6a1266bae1458b09cfc0 = $vc9e9a848920877e76685b2e4e76de38d;}mysql_query("DELETE FROM cms3_permissions WHERE owner_id != '{$v92ad7554e2e0d208f33729db6d54b59b}' AND level <= {$v075d12d847ab6a1266bae1458b09cfc0} AND rel_id = {$vd5d4bb9b2c282937ee64b1fb0495ef08}");}public function isAllowedDomain($v5e7b19364b8de2dedd3aa48cf62706e3, $v662cbf1253ac7d8750ed9190c52163e5) {$v5e7b19364b8de2dedd3aa48cf62706e3 = (int) $v5e7b19364b8de2dedd3aa48cf62706e3;$v662cbf1253ac7d8750ed9190c52163e5 = (int) $v662cbf1253ac7d8750ed9190c52163e5;if($this->isSv($v5e7b19364b8de2dedd3aa48cf62706e3)) {return 1;}$v877a071b41344936293b7b8e9922d1ef = $this->makeSqlWhere($v5e7b19364b8de2dedd3aa48cf62706e3);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT MAX(cp.allow) FROM cms_permissions cp WHERE cp.module = 'domain' AND cp.method = '{$v662cbf1253ac7d8750ed9190c52163e5}' AND " . $v877a071b41344936293b7b8e9922d1ef;$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result)) {list($vc9e9a848920877e76685b2e4e76de38d) = $vf1965a857bc285d26fe22023aa5ab50d;return (int) $vc9e9a848920877e76685b2e4e76de38d;}else return 0;}public function setAllowedDomain($v5e7b19364b8de2dedd3aa48cf62706e3, $v662cbf1253ac7d8750ed9190c52163e5, $vb394126a0e52e75f1e3d535d0fb0d33c = 1) {$v5e7b19364b8de2dedd3aa48cf62706e3 = (int) $v5e7b19364b8de2dedd3aa48cf62706e3;$v662cbf1253ac7d8750ed9190c52163e5 = (int) $v662cbf1253ac7d8750ed9190c52163e5;$vb394126a0e52e75f1e3d535d0fb0d33c = (int) $vb394126a0e52e75f1e3d535d0fb0d33c;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms_permissions WHERE module = 'domain' AND method = '{$v662cbf1253ac7d8750ed9190c52163e5}' AND owner_id = '{$v5e7b19364b8de2dedd3aa48cf62706e3}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms_permissions (module, method, owner_id, allow) VALUES('domain', '{$v662cbf1253ac7d8750ed9190c52163e5}', '{$v5e7b19364b8de2dedd3aa48cf62706e3}', '{$vb394126a0e52e75f1e3d535d0fb0d33c}')";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}public function setDefaultElementPermissions(iUmiHierarchyElement $v8e2dcfd7e7e24b1ca76c1193f645902b, $v5e7b19364b8de2dedd3aa48cf62706e3) {$v22884db148f0ffb0d830ba431102b0b5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getModule();$vea9f6aca279138c58f705c8d4cb4b8ce = $v8e2dcfd7e7e24b1ca76c1193f645902b->getMethod();$vc9e9a848920877e76685b2e4e76de38d = 0;if($this->isAllowedMethod($v5e7b19364b8de2dedd3aa48cf62706e3, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, true)) {$vc9e9a848920877e76685b2e4e76de38d = 1;}if($this->isAllowedMethod($v5e7b19364b8de2dedd3aa48cf62706e3, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce . ".edit", true)) {$vc9e9a848920877e76685b2e4e76de38d = 2;}$this->setElementPermissions($v5e7b19364b8de2dedd3aa48cf62706e3, $v8e2dcfd7e7e24b1ca76c1193f645902b->getId(), $vc9e9a848920877e76685b2e4e76de38d);return $vc9e9a848920877e76685b2e4e76de38d;}public function setAllElementsDefaultPermissions($v5e7b19364b8de2dedd3aa48cf62706e3) {$v5e7b19364b8de2dedd3aa48cf62706e3 = (int) $v5e7b19364b8de2dedd3aa48cf62706e3;$v6942e8fa62b3cc9d93881a58210e2fd7 = umiHierarchyTypesCollection::getInstance();$v72122ce96bfec66e2396d2e25225d70a = $this->getOwnerType($v5e7b19364b8de2dedd3aa48cf62706e3);if(is_numeric($v72122ce96bfec66e2396d2e25225d70a)) {$v72122ce96bfec66e2396d2e25225d70a = array();}$v72122ce96bfec66e2396d2e25225d70a[] = self::getGuestId();$v72122ce96bfec66e2396d2e25225d70a = array_unique($v72122ce96bfec66e2396d2e25225d70a);l_mysql_query("START TRANSACTION");$vecae13117d6f0584c25a9da6c8f8415e = array();$vefb2a684e4afb7d55e6147fbe5a332ee = array();foreach($v6942e8fa62b3cc9d93881a58210e2fd7->getTypesList() as $v89b0b9deff65f8b9cd1f71bc74ce36ba) {$v22884db148f0ffb0d830ba431102b0b5 = $v89b0b9deff65f8b9cd1f71bc74ce36ba->getName();$vea9f6aca279138c58f705c8d4cb4b8ce = $v89b0b9deff65f8b9cd1f71bc74ce36ba->getExt();if($this->isAllowedMethod($v5e7b19364b8de2dedd3aa48cf62706e3, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce . ".edit", true)) {foreach($v72122ce96bfec66e2396d2e25225d70a as $v2d53a8fb7abf5be7f4a3cf4b565cc75c) {if($this->isAllowedMethod($v2d53a8fb7abf5be7f4a3cf4b565cc75c, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce . ".edit", true)) {continue 2;}}$vefb2a684e4afb7d55e6147fbe5a332ee[] = $v89b0b9deff65f8b9cd1f71bc74ce36ba->getId();$vc9e9a848920877e76685b2e4e76de38d = 2;}else if($this->isAllowedMethod($v5e7b19364b8de2dedd3aa48cf62706e3, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, true)) {foreach($v72122ce96bfec66e2396d2e25225d70a as $v2d53a8fb7abf5be7f4a3cf4b565cc75c) {if($this->isAllowedMethod($v2d53a8fb7abf5be7f4a3cf4b565cc75c, $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, true)) {continue 2;}}$vecae13117d6f0584c25a9da6c8f8415e[] = $v89b0b9deff65f8b9cd1f71bc74ce36ba->getId();$vc9e9a848920877e76685b2e4e76de38d = 1;}else {$vc9e9a848920877e76685b2e4e76de38d = 0;}}if(sizeof($vecae13117d6f0584c25a9da6c8f8415e)) {$vd14a8022b085f9ef19d479cbdd581127 = implode(", ", $vecae13117d6f0584c25a9da6c8f8415e);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_permissions (level, owner_id, rel_id) 
	SELECT 1, '{$v5e7b19364b8de2dedd3aa48cf62706e3}', id FROM cms3_hierarchy WHERE type_id IN ({$vd14a8022b085f9ef19d479cbdd581127})
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);}if(sizeof($vefb2a684e4afb7d55e6147fbe5a332ee)) {$vd14a8022b085f9ef19d479cbdd581127 = implode(", ", $vefb2a684e4afb7d55e6147fbe5a332ee);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_permissions (level, owner_id, rel_id) 
	SELECT 31, '{$v5e7b19364b8de2dedd3aa48cf62706e3}', id FROM cms3_hierarchy WHERE type_id IN ({$vd14a8022b085f9ef19d479cbdd581127})
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);}l_mysql_query("COMMIT");}public function getUsersByElementPermissions($v7552cd149af7495ee7d8225974e50f80, $vc9e9a848920877e76685b2e4e76de38d = 1) {$v7552cd149af7495ee7d8225974e50f80 = (int) $v7552cd149af7495ee7d8225974e50f80;$vc9e9a848920877e76685b2e4e76de38d = (int) $vc9e9a848920877e76685b2e4e76de38d;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT owner_id FROM cms3_permissions WHERE rel_id = '{$v7552cd149af7495ee7d8225974e50f80}' AND level >= '{$vc9e9a848920877e76685b2e4e76de38d}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vb132392a317588e56460e77a8fd74229 = array();while(list($vb0ab4f7791b60b1e8ea01057b77873b0) = mysql_fetch_row($result)) {$vb132392a317588e56460e77a8fd74229[] = (int) $vb0ab4f7791b60b1e8ea01057b77873b0;}return $vb132392a317588e56460e77a8fd74229;}public function getRecordedPermissions($v7552cd149af7495ee7d8225974e50f80) {$v7552cd149af7495ee7d8225974e50f80 = (int) $v7552cd149af7495ee7d8225974e50f80;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT owner_id, level FROM cms3_permissions WHERE rel_id = '{$v7552cd149af7495ee7d8225974e50f80}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v6e52c40bb8fc91ff39ee5c79b4211f67 = array();while(list($vb0ab4f7791b60b1e8ea01057b77873b0, $vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row($result)) {$v6e52c40bb8fc91ff39ee5c79b4211f67[$vb0ab4f7791b60b1e8ea01057b77873b0] = (int) $vc9e9a848920877e76685b2e4e76de38d;}return $v6e52c40bb8fc91ff39ee5c79b4211f67;}public function pushElementPermissions($v7552cd149af7495ee7d8225974e50f80, $vc9e9a848920877e76685b2e4e76de38d = 1) {$this->tempElementPermissions[$v7552cd149af7495ee7d8225974e50f80] = (int) $vc9e9a848920877e76685b2e4e76de38d;}public function isAuth() {return ($this->getUserId() != self::getGuestId());}public static function getGuestId() {static $v92ad7554e2e0d208f33729db6d54b59b;if(!$v92ad7554e2e0d208f33729db6d54b59b) {$v92ad7554e2e0d208f33729db6d54b59b = (int) regedit::getInstance()->getVal("//modules/users/guest_id");}return $v92ad7554e2e0d208f33729db6d54b59b;}public function loginAsUser($v8e44f0089b076e18a718eb9ca3d94674) {if(is_null($v8e44f0089b076e18a718eb9ca3d94674)) return false;if(is_array($v8e44f0089b076e18a718eb9ca3d94674) && sizeof($v8e44f0089b076e18a718eb9ca3d94674)) {list($v8e44f0089b076e18a718eb9ca3d94674) = $v8e44f0089b076e18a718eb9ca3d94674;}if($v8e44f0089b076e18a718eb9ca3d94674 instanceof iUmiObject) {$vee11cbb19052e40b07aac0ca060c23ee = $v8e44f0089b076e18a718eb9ca3d94674;$v8e44f0089b076e18a718eb9ca3d94674 = $vee11cbb19052e40b07aac0ca060c23ee->id;}else $vee11cbb19052e40b07aac0ca060c23ee = selector::get('object')->id($v8e44f0089b076e18a718eb9ca3d94674);$this->user_id = $v8e44f0089b076e18a718eb9ca3d94674;$vd56b699830e77ba53855679cb1d252da = $vee11cbb19052e40b07aac0ca060c23ee->login;$v1c29135e8dc2245721632ee1f5adb22e = $vee11cbb19052e40b07aac0ca060c23ee->password;if(getRequest('u-login-store')) {$v07cc694b9b3fc636710fa08b6922c42b = time() + 31536000;setcookie("u-login", $vee11cbb19052e40b07aac0ca060c23ee->login, $v07cc694b9b3fc636710fa08b6922c42b, "/");setcookie("u-password-md5", $v1c29135e8dc2245721632ee1f5adb22e, $v07cc694b9b3fc636710fa08b6922c42b, "/");}$_SESSION['cms_login'] = $vd56b699830e77ba53855679cb1d252da;$_SESSION['cms_pass'] = $v1c29135e8dc2245721632ee1f5adb22e;$_SESSION['user_id'] = $v8e44f0089b076e18a718eb9ca3d94674;return true;}public function checkLogin($vd56b699830e77ba53855679cb1d252da, $v5f4dcc3b5aa765d61d8327deb882cf99) {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('users', 'user');$v8be74552df93e31bbdd6b36ed74bdb6a->where('login')->equals($vd56b699830e77ba53855679cb1d252da);$v8be74552df93e31bbdd6b36ed74bdb6a->where('password')->equals(md5($v5f4dcc3b5aa765d61d8327deb882cf99));$v8be74552df93e31bbdd6b36ed74bdb6a->where('is_activated')->equals(true);return $v8be74552df93e31bbdd6b36ed74bdb6a->first;}public function getPrivileged($v58f57b98cc8cfb81907179e9b4635762) {if(!sizeof($v58f57b98cc8cfb81907179e9b4635762)) return array();$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT owner_id FROM cms_permissions WHERE ';$v59f8ce5cb01404063bd7eb308df3b7dc = array();foreach($v58f57b98cc8cfb81907179e9b4635762 as $vca659200663cf654dc4410ed494451ee) {$v22884db148f0ffb0d830ba431102b0b5 = mysql_real_escape_string(getArrayKey($vca659200663cf654dc4410ed494451ee, 0));$vea9f6aca279138c58f705c8d4cb4b8ce = mysql_real_escape_string($this->getBaseMethodName($v22884db148f0ffb0d830ba431102b0b5, getArrayKey($vca659200663cf654dc4410ed494451ee, 1)));$v59f8ce5cb01404063bd7eb308df3b7dc[] = "(module = '{$v22884db148f0ffb0d830ba431102b0b5}' AND method = '{$vea9f6aca279138c58f705c8d4cb4b8ce}')";}$vac5c74b64b4b8352ef2f181affb5ac2a .= implode(' OR ', $v59f8ce5cb01404063bd7eb308df3b7dc);$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vb132392a317588e56460e77a8fd74229 = array();while(list($vb0ab4f7791b60b1e8ea01057b77873b0) = mysql_fetch_row($result)) {$vb132392a317588e56460e77a8fd74229[] = $vb0ab4f7791b60b1e8ea01057b77873b0;}return $vb132392a317588e56460e77a8fd74229;}protected function isAdminAllowedMethod($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce) {$va9ac5a6cc3cbe84f9c18323af2b9007f = array(   'content' =>    array('json_mini_browser', 'old_json_load_files', 'json_load_files',        'json_load_zip_folder', 'load_tree_node', 'get_editable_region',       'save_editable_region', 'widget_create', 'widget_delete',       'getObjectsByTypeList', 'getObjectsByBaseTypeList',        'json_get_images_panel', 'json_create_imanager_object',       'domainTemplates', 'json_unlock_page', 'tree_unlock_page'),   'backup' =>     array('backup_panel'),   'data'   =>     array('guide_items', 'guide_items_all', 'json_load_hierarchy_level'),   'webo' => array('show'),   'users'  => array('getFavourites', 'json_change_dock', 'saveUserSettings', 'loadUserSettings'),   '*'   =>  array('dataset_config')   );if(isset($va9ac5a6cc3cbe84f9c18323af2b9007f[$v22884db148f0ffb0d830ba431102b0b5])) {if(in_array($vea9f6aca279138c58f705c8d4cb4b8ce, $va9ac5a6cc3cbe84f9c18323af2b9007f[$v22884db148f0ffb0d830ba431102b0b5])) {return true;}}if(isset($va9ac5a6cc3cbe84f9c18323af2b9007f['*'])) {if(in_array($vea9f6aca279138c58f705c8d4cb4b8ce, $va9ac5a6cc3cbe84f9c18323af2b9007f['*'])) {return true;}}return false;}};?>