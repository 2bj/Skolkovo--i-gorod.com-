<?php
 class umiImageFile extends umiFile implements iUmiImageFile {private static $aSupportedTypes = null;private static $useWatermark = false;public function __construct($v6a2a431fe8b621037ea949531c28551d) {parent::__construct($v6a2a431fe8b621037ea949531c28551d);if (!$this->is_broken) {$this->is_broken = ! self::getIsImage($this->name);}}public static function getSupportedImageTypes() {if (is_null(self::$aSupportedTypes)) {self::$aSupportedTypes = array();self::$aSupportedTypes[] = "GIF";self::$aSupportedTypes[] = "JPG";self::$aSupportedTypes[] = "JPEG";self::$aSupportedTypes[] = "PNG";self::$aSupportedTypes[] = "WBMP";self::$aSupportedTypes[] = "BMP";self::$aSupportedTypes[] = "SWF";}return self::$aSupportedTypes;}public static function setWatermarkOn () {self::$useWatermark = true;}public static function setWatermarkOff () {self::$useWatermark = false;}public static function upload($veeeb23fbd23e52a6a6ff78b9f18cbc4e, $v86536e21993c5a96a4d4c9c9afcc9b17, $vb2ed5fc91c9760886b14c955ac6c82d7, $vb80bb7740288fda1f201890375a60c8f = false) {self::$class_name = __CLASS__;$v6a2a431fe8b621037ea949531c28551d = parent::upload($veeeb23fbd23e52a6a6ff78b9f18cbc4e, $v86536e21993c5a96a4d4c9c9afcc9b17, $vb2ed5fc91c9760886b14c955ac6c82d7, $vb80bb7740288fda1f201890375a60c8f);$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$ve6a7ab42343e8bc9131d89646abcb773 = (int) $vb1444fb0c07653567ad325aa25d4e37a->getVal("//settings/max_img_filesize");$v79001f389eb5f5185f6945430cb57be1 = (int) ini_get("upload_max_filesize");$ve6a7ab42343e8bc9131d89646abcb773 = ($ve6a7ab42343e8bc9131d89646abcb773 < $v79001f389eb5f5185f6945430cb57be1) ? $ve6a7ab42343e8bc9131d89646abcb773 : $v79001f389eb5f5185f6945430cb57be1;$v11b4278c7e5a79003db77272c1ed2cf5 = (int) filesize("." . $v6a2a431fe8b621037ea949531c28551d);$ve6a7ab42343e8bc9131d89646abcb773 = (int) $ve6a7ab42343e8bc9131d89646abcb773*1024*1024;if($ve6a7ab42343e8bc9131d89646abcb773 > 0) {if($ve6a7ab42343e8bc9131d89646abcb773 < $v11b4278c7e5a79003db77272c1ed2cf5) {unlink("." . $v6a2a431fe8b621037ea949531c28551d);return false;}}$vcaf9b6b99962bf5c2264824231d7a40c = @getimagesize(".".$v6a2a431fe8b621037ea949531c28551d);if(!is_array($vcaf9b6b99962bf5c2264824231d7a40c)) {@unlink("." . $v6a2a431fe8b621037ea949531c28551d);return false;}if (self::$useWatermark) {self::addWatermark ("./".$v6a2a431fe8b621037ea949531c28551d);}self::setWatermarkOff ();return $v6a2a431fe8b621037ea949531c28551d;}public static function getIsImage($v718f2106be68f0edfc366ed06124fe55) {$vdc94d607c2365888317e7b14f9ea0a9d = explode(".", $v718f2106be68f0edfc366ed06124fe55);$vdd3d03de4e016ecdd03c280fe46c86a3 = strtoupper(array_pop($vdc94d607c2365888317e7b14f9ea0a9d));return in_array($vdd3d03de4e016ecdd03c280fe46c86a3, self::getSupportedImageTypes());}public function getWidth() {list($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81) = getimagesize($this->filepath);return $veaae26a6fb20ed3ef54fb23bfa0b1fcc;}public function getHeight() {list($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81) = getimagesize($this->filepath);return $vb435e227d5dd201e1768b2bcb2e0aa81;}public static function addWatermark ($v47826cacc65c665212b821e6ff80b9b0) {$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance ();$v9234d6561fcbf96ed0c3f0ee5794032d = $vb1444fb0c07653567ad325aa25d4e37a->getVal ("//settings/watermark/image");$v0246d16e9822ba3b810310987d165c71 = 80;$v8fa8b46b17731c7c9c882faede387741 = $vb1444fb0c07653567ad325aa25d4e37a->getVal ("//settings/watermark/alpha");$v379da31305f1eba200307fcdf9cf0ca0 = $vb1444fb0c07653567ad325aa25d4e37a->getVal ("//settings/watermark/valign");$vb1c37415e373f67b34bfbdeac8a8338f = $vb1444fb0c07653567ad325aa25d4e37a->getVal ("//settings/watermark/halign");if (!file_exists ($v9234d6561fcbf96ed0c3f0ee5794032d)) {return false;}if (!$v8fa8b46b17731c7c9c882faede387741) {$v8fa8b46b17731c7c9c882faede387741 = 70;}if (!$v379da31305f1eba200307fcdf9cf0ca0) {$v379da31305f1eba200307fcdf9cf0ca0 = "bottom";}if (!$vb1c37415e373f67b34bfbdeac8a8338f) {$vb1c37415e373f67b34bfbdeac8a8338f = "right";}$vfc1eb20506413fbbdc753afe5117cff0 = self::createImage ($v9234d6561fcbf96ed0c3f0ee5794032d);$v6226ba4abbac63dbd2114cb5966b1bf8 = self::createImage ($v47826cacc65c665212b821e6ff80b9b0);$vfcf76116d23aa625909b9eb0e709b276 = pathinfo ($v47826cacc65c665212b821e6ff80b9b0);if (!$vfc1eb20506413fbbdc753afe5117cff0 || !$v6226ba4abbac63dbd2114cb5966b1bf8) {return false;}$v9174d2f2b3c032f04911450bb5b7b25e = $vfc1eb20506413fbbdc753afe5117cff0["height"] / $v6226ba4abbac63dbd2114cb5966b1bf8["height"];$v3393d19d534fb6257afdc49390e536c4 = $vfc1eb20506413fbbdc753afe5117cff0["width"] / $v6226ba4abbac63dbd2114cb5966b1bf8["width"];if (($v9174d2f2b3c032f04911450bb5b7b25e > $v0246d16e9822ba3b810310987d165c71/100) || ($v3393d19d534fb6257afdc49390e536c4 > $v0246d16e9822ba3b810310987d165c71/100)) {$v0cb47aeb6e5f9323f0969e628c4e59f5 = ($v0246d16e9822ba3b810310987d165c71 / 100) / (($v9174d2f2b3c032f04911450bb5b7b25e > $v3393d19d534fb6257afdc49390e536c4) ? $v9174d2f2b3c032f04911450bb5b7b25e : $v3393d19d534fb6257afdc49390e536c4);$v91890ebc9d3427ff4a7d27c8f94caefc = floor($vfc1eb20506413fbbdc753afe5117cff0["height"] * $v0cb47aeb6e5f9323f0969e628c4e59f5);$vdee127a12af5fa50ceb8944739d5ef01 = floor($vfc1eb20506413fbbdc753afe5117cff0["width"] * $v0cb47aeb6e5f9323f0969e628c4e59f5);}else {$v91890ebc9d3427ff4a7d27c8f94caefc = $vfc1eb20506413fbbdc753afe5117cff0["height"];$vdee127a12af5fa50ceb8944739d5ef01 = $vfc1eb20506413fbbdc753afe5117cff0["width"];}$v98ac273381790591214fbee1fa05a6e9 = imagecreatetruecolor ($vdee127a12af5fa50ceb8944739d5ef01, $v91890ebc9d3427ff4a7d27c8f94caefc);$v4362482a4ee187713f71bacd03c3f3b8 = imagecolorallocate ($v98ac273381790591214fbee1fa05a6e9, 255, 255, 255);imagefilledrectangle ($v98ac273381790591214fbee1fa05a6e9, 0, 0, $vdee127a12af5fa50ceb8944739d5ef01, $v91890ebc9d3427ff4a7d27c8f94caefc, $v4362482a4ee187713f71bacd03c3f3b8);imagecopyresized ($v98ac273381790591214fbee1fa05a6e9, $vfc1eb20506413fbbdc753afe5117cff0["im"], 0, 0, 0, 0, $vdee127a12af5fa50ceb8944739d5ef01, $v91890ebc9d3427ff4a7d27c8f94caefc, $vfc1eb20506413fbbdc753afe5117cff0["width"], $vfc1eb20506413fbbdc753afe5117cff0["height"]);imagedestroy ($vfc1eb20506413fbbdc753afe5117cff0["im"]);$vfc1eb20506413fbbdc753afe5117cff0 = array (    "im" => $v98ac273381790591214fbee1fa05a6e9,    "width" => $vdee127a12af5fa50ceb8944739d5ef01,    "height" => $v91890ebc9d3427ff4a7d27c8f94caefc   );$v98ac273381790591214fbee1fa05a6e9 = imagecreatetruecolor ($v6226ba4abbac63dbd2114cb5966b1bf8["width"], $v6226ba4abbac63dbd2114cb5966b1bf8["height"]);$v4362482a4ee187713f71bacd03c3f3b8 = imagecolorallocate ($v98ac273381790591214fbee1fa05a6e9, 255, 255, 255);imagecopy ($v98ac273381790591214fbee1fa05a6e9, $v6226ba4abbac63dbd2114cb5966b1bf8["im"], 0,0,0,0, $v6226ba4abbac63dbd2114cb5966b1bf8["width"], $v6226ba4abbac63dbd2114cb5966b1bf8["height"]);$v6382f6cf920a5e1f12258b86b3fcac3b = 0;$v44ef37a80954a70dc24d955310d80967 = 0;switch ($vb1c37415e373f67b34bfbdeac8a8338f){case "center" : {$v6382f6cf920a5e1f12258b86b3fcac3b = floor (($v6226ba4abbac63dbd2114cb5966b1bf8["width"] - $vfc1eb20506413fbbdc753afe5117cff0["width"]) / 2);break;}case "right" : {$v6382f6cf920a5e1f12258b86b3fcac3b = $v6226ba4abbac63dbd2114cb5966b1bf8["width"] - $vfc1eb20506413fbbdc753afe5117cff0["width"];}}switch ($v379da31305f1eba200307fcdf9cf0ca0) {case "center" : {$v44ef37a80954a70dc24d955310d80967 = floor (($v6226ba4abbac63dbd2114cb5966b1bf8["height"] - $vfc1eb20506413fbbdc753afe5117cff0["height"]) / 2);break;}case "bottom" : {$v44ef37a80954a70dc24d955310d80967 = $v6226ba4abbac63dbd2114cb5966b1bf8["height"] - $vfc1eb20506413fbbdc753afe5117cff0["height"];}}imagecopymerge ($v98ac273381790591214fbee1fa05a6e9, $vfc1eb20506413fbbdc753afe5117cff0["im"], $v6382f6cf920a5e1f12258b86b3fcac3b, $v44ef37a80954a70dc24d955310d80967, 0, 0, $vfc1eb20506413fbbdc753afe5117cff0["width"], $vfc1eb20506413fbbdc753afe5117cff0["height"], $v8fa8b46b17731c7c9c882faede387741);switch ($vfcf76116d23aa625909b9eb0e709b276['extension']) {case "jpeg" :    case "jpg"  :    case "JPEG" :    case "JPG"  : {imagejpeg ($v98ac273381790591214fbee1fa05a6e9, $v47826cacc65c665212b821e6ff80b9b0, 90);break;}case "png" :    case "PNG" : {imagepng ($v98ac273381790591214fbee1fa05a6e9, $v47826cacc65c665212b821e6ff80b9b0);}case "gif" :    case "GIF" : {imagegif ($v98ac273381790591214fbee1fa05a6e9, $v47826cacc65c665212b821e6ff80b9b0);break;}case "bmp" :    case "BMP" : {}}imagedestroy ($v6226ba4abbac63dbd2114cb5966b1bf8["im"]);imagedestroy ($vfc1eb20506413fbbdc753afe5117cff0["im"]);imagedestroy ($v98ac273381790591214fbee1fa05a6e9);return true;}private static function createImage ($vfdc0a99c383c1558bed83c633f57a836) {$v931072b8630108758003074932646789 = 0;$va93b85dcfbb9969f5bb3c6be71737ed5 = parse_url ($vfdc0a99c383c1558bed83c633f57a836);$vfdc0a99c383c1558bed83c633f57a836 = (substr ($va93b85dcfbb9969f5bb3c6be71737ed5["path"], 0, 1) == "/")        ? substr ($va93b85dcfbb9969f5bb3c6be71737ed5["path"], 1)        : $va93b85dcfbb9969f5bb3c6be71737ed5["path"];list ($veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81, $v599dcce2998a6b40b1e38e8c6006cb0a, $v815be97df65d6c4b510cd07189c5347a) = getimagesize ($vfdc0a99c383c1558bed83c633f57a836);$vd14a8022b085f9ef19d479cbdd581127 = array (    "GIF" => "1",    "JPG" => "2",    "PNG" => "3",    "WBMP"=> "15",    "XBM" => "16"   );switch($v599dcce2998a6b40b1e38e8c6006cb0a){case $vd14a8022b085f9ef19d479cbdd581127["GIF"] : {$v931072b8630108758003074932646789 = imagecreatefromgif ($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127["JPG"] : {$v931072b8630108758003074932646789 = imagecreatefromjpeg ($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127["PNG"] : {$v931072b8630108758003074932646789 = imagecreatefrompng ($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127["WBMP"] : {$v931072b8630108758003074932646789 = imagecreatefromwbmp ($vfdc0a99c383c1558bed83c633f57a836);break;}case $vd14a8022b085f9ef19d479cbdd581127["XBM"]: {$v931072b8630108758003074932646789 = imagecreatefromxbm ($vfdc0a99c383c1558bed83c633f57a836);}}if (!$v931072b8630108758003074932646789) {return false;}return array (    "im"     => $v931072b8630108758003074932646789,    "width"  => $veaae26a6fb20ed3ef54fb23bfa0b1fcc,    "height" => $vb435e227d5dd201e1768b2bcb2e0aa81   );}}?>
