<?php
class PHException extends Exception {const ERR_CANTCREATEPACKAGEFOLDER = 8101;const MSG_CANTCREATEPACKAGEFOLDER = "Can not create folder for package extraction";const ERR_CANTEXTRACTPACKAGE   = 8102;const MSG_CANTEXTRACTPACKAGE   = "Can not extract package";const ERR_TIMELIMITEXCEED = 8888;const MSG_TIMELIMITEXCEED = "Time limit exceed";public function __construct($_message, $_code) {parent::__construct($_message, $_code);}};abstract class packageHandlerBase {protected $packageFile   = null;protected $rootFolder    = null;protected $extractFolder = null;protected $manifest      = null;protected $timeCounter   = null;const TIME_LIMIT       = 12;public function __construct($v5b063e275d506f65ebf1b02d926f19a4, $vffa63171cdd50d0e6f9805f721e650cd) {$this->packageFile   = $v5b063e275d506f65ebf1b02d926f19a4;$this->rootFolder    = $vffa63171cdd50d0e6f9805f721e650cd;$this->extractFolder = "./install-temp";$this->timeCounter   = microtime(true);$this->checkFolder($this->extractFolder);}public function __destruct() {if($this->manifest instanceof umiSimpleXML) {file_put_contents($this->extractFolder . "/index.xml", $this->manifest->saveXML());}}protected function loadManifest() {$v79b763ee4c26bde2943c8d3801c9659a  = file_get_contents($this->extractFolder . "/index.xml");$this->manifest = new umiSimpleXML( $v79b763ee4c26bde2943c8d3801c9659a );}public function install (&$v9acb44549b41563697bb490144ec6258) {}protected function checkFolder($v851148b4fd8fd7ae74bd9100c5c0c898) {if(!is_dir($v851148b4fd8fd7ae74bd9100c5c0c898)) {mkdir($v851148b4fd8fd7ae74bd9100c5c0c898);@chmod($v851148b4fd8fd7ae74bd9100c5c0c898, 0777);}}protected function unpackPackageZIP() {if(!file_exists($this->extractFolder . '/index.xml')) {__dbg("Extracting...");if(!is_dir($this->extractFolder)) {if(!mkdir($this->extractFolder)) {throw new PHException(PHException::MSG_CANTCREATEPACKAGEFOLDER, PHException::ERR_CANTCREATEPACKAGEFOLDER);}}$vde05b146e724942c4be776d95484405f = getcwd();$v66f833253f4349dc9264658bca9a312c = realpath($this->packageFile);chdir($this->extractFolder);shell_exec("unzip -x ".$v66f833253f4349dc9264658bca9a312c);chdir($vde05b146e724942c4be776d95484405f);if(!file_exists($this->extractFolder . '/index.xml')) {$vadcdbd79a8d84175c229b192aadc02f2 = new PclZip($this->packageFile);if($vadcdbd79a8d84175c229b192aadc02f2->extract(PCLZIP_OPT_PATH, $this->extractFolder) <= 0) throw new PHException(PHException::MSG_CANTEXTRACTPACKAGE, PHException::ERR_CANTEXTRACTPACKAGE);unset($vadcdbd79a8d84175c229b192aadc02f2);}}}protected function checkTimeLimitExceeded($va4fc99f623eee95837deae1b93c5ee7d = false) {if (defined("UMI_TIME_LIMIT_DISABLED")) return false;if((microtime(true) - $this->timeCounter) > packageHandlerBase::TIME_LIMIT) {if($va4fc99f623eee95837deae1b93c5ee7d) {return true;}throw new PHException(PHException::MSG_TIMELIMITEXCEED, PHException::ERR_TIMELIMITEXCEED);}return false;}};class packageChecker extends packageHandlerBase {private static $errorList = array('files' => array(), 'folders' => array());private $repeatCounter    = 0;public function __construct($v5b063e275d506f65ebf1b02d926f19a4, $vffa63171cdd50d0e6f9805f721e650cd){parent::__construct($v5b063e275d506f65ebf1b02d926f19a4, $vffa63171cdd50d0e6f9805f721e650cd);}public function check(&$v9acb44549b41563697bb490144ec6258) {$v9acb44549b41563697bb490144ec6258['errors']    = &packageChecker::$errorList;$this->repeatCounter = isset($v9acb44549b41563697bb490144ec6258['check_repeat']) ? $v9acb44549b41563697bb490144ec6258['check_repeat'] : 0;$v9acb44549b41563697bb490144ec6258['result']    = $this->checkResult($v9acb44549b41563697bb490144ec6258);$this->unpackPackageZIP();if($this->checkTimeLimitExceeded(true)) return false;$this->loadManifest();$v4725dcf446a342f1473a8228e42dfa48 = $this->manifest->xpath("//component[not(@check-status='{$this->repeatCounter}')]", true);if($v4725dcf446a342f1473a8228e42dfa48) {if(!is_array($v4725dcf446a342f1473a8228e42dfa48)) $v4725dcf446a342f1473a8228e42dfa48 = array($v4725dcf446a342f1473a8228e42dfa48);foreach($v4725dcf446a342f1473a8228e42dfa48 as $v700c216fb376666eaeda0c892e8bdc09) {try {$this->checkComponent($v700c216fb376666eaeda0c892e8bdc09, $v9acb44549b41563697bb490144ec6258);}catch(Exception $ve1671797c52e15f763380b45e841ec32) {if($ve1671797c52e15f763380b45e841ec32->getCode() == PHException::ERR_TIMELIMITEXCEED) {$v9acb44549b41563697bb490144ec6258['result'] = $this->checkResult($v9acb44549b41563697bb490144ec6258);return false;}else {throw $ve1671797c52e15f763380b45e841ec32;}}$v700c216fb376666eaeda0c892e8bdc09->attribute("check-status", (string)$this->repeatCounter);}}$v9acb44549b41563697bb490144ec6258['result'] = $this->checkResult($v9acb44549b41563697bb490144ec6258);return true;}private function checkComponent(umiSimpleXML $v700c216fb376666eaeda0c892e8bdc09, &$v9acb44549b41563697bb490144ec6258) {$v9acb44549b41563697bb490144ec6258['component'] = $v700c216fb376666eaeda0c892e8bdc09->attribute("name");$v2fc9e51174a78dd5bfc57e8e368590b3   = $v700c216fb376666eaeda0c892e8bdc09->package;$v83dece06dbc961347f19cf3221874b38 = $v700c216fb376666eaeda0c892e8bdc09->files;if($v2fc9e51174a78dd5bfc57e8e368590b3) {if(!is_array($v2fc9e51174a78dd5bfc57e8e368590b3)) $v2fc9e51174a78dd5bfc57e8e368590b3 = array($v2fc9e51174a78dd5bfc57e8e368590b3);foreach($v2fc9e51174a78dd5bfc57e8e368590b3 as $vefe90a8e604a7c840e88d03a67f6b7d8) {$ve8ccbb476bc0acfafd87c722eff7da4b      = ltrim($vefe90a8e604a7c840e88d03a67f6b7d8->attribute("src"), "~");$v9109ce802c32cc82f3706d729d5f2268 = new packageChecker($this->extractFolder . $ve8ccbb476bc0acfafd87c722eff7da4b, $this->rootFolder);if(!$v9109ce802c32cc82f3706d729d5f2268->check($v9acb44549b41563697bb490144ec6258)) {throw new PHException(PHException::MSG_TIMELIMITEXCEED, PHException::ERR_TIMELIMITEXCEED);}}}if($v83dece06dbc961347f19cf3221874b38) {$this->checkFolders($v83dece06dbc961347f19cf3221874b38->xpath("folder[not(@check-status='{$this->repeatCounter}')]", true));$this->checkFiles($v83dece06dbc961347f19cf3221874b38->xpath("file[not(@check-status='{$this->repeatCounter}')]", true));}}private function checkFolders($v2882248c3ef65a048365b939aec03be5) {if($v2882248c3ef65a048365b939aec03be5 instanceof umiSimpleXML) {$v2882248c3ef65a048365b939aec03be5 = array($v2882248c3ef65a048365b939aec03be5);}if(is_array($v2882248c3ef65a048365b939aec03be5) && !empty($v2882248c3ef65a048365b939aec03be5)) {foreach($v2882248c3ef65a048365b939aec03be5 as $v5d109cea561ac72c0c6d3b7e08be8292) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->rootFolder . "/" . $v5d109cea561ac72c0c6d3b7e08be8292;if(is_dir($vd6fe1d0be6347b8ef2427fa629c04485)) {if(!is_writeable($vd6fe1d0be6347b8ef2427fa629c04485)) {packageChecker::$errorList['folders'][] = $v5d109cea561ac72c0c6d3b7e08be8292;}}else if(is_dir(dirname($vd6fe1d0be6347b8ef2427fa629c04485)) && !is_writeable(dirname($vd6fe1d0be6347b8ef2427fa629c04485))) {packageChecker::$errorList['folders'][] = dirname($v5d109cea561ac72c0c6d3b7e08be8292);}$v5d109cea561ac72c0c6d3b7e08be8292->attribute("check-status", (string)$this->repeatCounter);$this->checkTimeLimitExceeded();}}}private function checkFiles($v248fea73e23025df76c623003446cd5d) {if($v248fea73e23025df76c623003446cd5d instanceof umiSimpleXML) {$v248fea73e23025df76c623003446cd5d = array($v248fea73e23025df76c623003446cd5d);}if(is_array($v248fea73e23025df76c623003446cd5d) && !empty($v248fea73e23025df76c623003446cd5d)) {foreach($v248fea73e23025df76c623003446cd5d as $v5b063e275d506f65ebf1b02d926f19a4) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->rootFolder."/".$v5b063e275d506f65ebf1b02d926f19a4;if(is_file($vd6fe1d0be6347b8ef2427fa629c04485) && !is_writeable($vd6fe1d0be6347b8ef2427fa629c04485)) {packageChecker::$errorList['files'][] = $v5b063e275d506f65ebf1b02d926f19a4;}$v5b063e275d506f65ebf1b02d926f19a4->attribute("check-status", (string)$this->repeatCounter);$this->checkTimeLimitExceeded();}}}private function checkResult($v9acb44549b41563697bb490144ec6258) {return ($v9acb44549b41563697bb490144ec6258['result'] && empty(packageChecker::$errorList['files']) && empty(packageChecker::$errorList['folders']));}};class packageInstaller extends packageHandlerBase {public function __construct($v5b063e275d506f65ebf1b02d926f19a4, $vffa63171cdd50d0e6f9805f721e650cd){parent::__construct($v5b063e275d506f65ebf1b02d926f19a4, $vffa63171cdd50d0e6f9805f721e650cd);}public function install(&$v9acb44549b41563697bb490144ec6258) {__dbg("Installing package "  .$this->packageFile);$this->unpackPackageZIP();if($this->checkTimeLimitExceeded(true)) return false;$this->loadManifest();$v4725dcf446a342f1473a8228e42dfa48 = $this->manifest->xpath("//component[not(@update-status)]", true);if($v4725dcf446a342f1473a8228e42dfa48) {if(!is_array($v4725dcf446a342f1473a8228e42dfa48)) $v4725dcf446a342f1473a8228e42dfa48 = array($v4725dcf446a342f1473a8228e42dfa48);foreach($v4725dcf446a342f1473a8228e42dfa48 as $v700c216fb376666eaeda0c892e8bdc09) {try {$this->installComponent($v700c216fb376666eaeda0c892e8bdc09, $v9acb44549b41563697bb490144ec6258);}catch(Exception $ve1671797c52e15f763380b45e841ec32) {if($ve1671797c52e15f763380b45e841ec32->getCode() == PHException::ERR_TIMELIMITEXCEED) {return false;}else {throw $ve1671797c52e15f763380b45e841ec32;}}$v700c216fb376666eaeda0c892e8bdc09->attribute("update-status", "done");}}__dbg("Done package "  .$this->packageFile);return true;}private function installComponent(umiSimpleXML $v700c216fb376666eaeda0c892e8bdc09, &$v9acb44549b41563697bb490144ec6258) {__dbg("- Installing component " . $v700c216fb376666eaeda0c892e8bdc09->attribute("name"));$v9acb44549b41563697bb490144ec6258['component'] = $v700c216fb376666eaeda0c892e8bdc09->attribute("name");$v0e591676949d1032471f2681537da651  = $v700c216fb376666eaeda0c892e8bdc09->require;$v2fc9e51174a78dd5bfc57e8e368590b3   = $v700c216fb376666eaeda0c892e8bdc09->package;$v83dece06dbc961347f19cf3221874b38 = $v700c216fb376666eaeda0c892e8bdc09->files;$v950d9efcf7c7124de68647a9e3180ad0   = $v700c216fb376666eaeda0c892e8bdc09->xpath("database-image");__dbg("---- Packages");if($v2fc9e51174a78dd5bfc57e8e368590b3) {if(!is_array($v2fc9e51174a78dd5bfc57e8e368590b3)) $v2fc9e51174a78dd5bfc57e8e368590b3 = array($v2fc9e51174a78dd5bfc57e8e368590b3);foreach($v2fc9e51174a78dd5bfc57e8e368590b3 as $vefe90a8e604a7c840e88d03a67f6b7d8) {$ve8ccbb476bc0acfafd87c722eff7da4b      = ltrim($vefe90a8e604a7c840e88d03a67f6b7d8->attribute("src"), "~");$v247455ad836ecefe14e6ae5a75156a2c = new packageInstaller($this->extractFolder . $ve8ccbb476bc0acfafd87c722eff7da4b, $this->rootFolder);if(!$v247455ad836ecefe14e6ae5a75156a2c->install($v9acb44549b41563697bb490144ec6258)) {throw new PHException(PHException::MSG_TIMELIMITEXCEED, PHException::ERR_TIMELIMITEXCEED);}}}$v0cc175b9c0f1b6a831c399e269772661 = (float)($v700c216fb376666eaeda0c892e8bdc09->count("/component/files/*[@update-status]") + $v700c216fb376666eaeda0c892e8bdc09->count("/component/database-image/*/*[@update-status]"));$v92eb5ffee6ae2fec3ad71c777531578f = (float)($v700c216fb376666eaeda0c892e8bdc09->count("/component/files/*") + $v700c216fb376666eaeda0c892e8bdc09->count("/component/database-image/*/*"));$v9acb44549b41563697bb490144ec6258['percent'] = ($v92eb5ffee6ae2fec3ad71c777531578f != 0) ? ($v0cc175b9c0f1b6a831c399e269772661 / $v92eb5ffee6ae2fec3ad71c777531578f * 100.0) : 0.0;$v9acb44549b41563697bb490144ec6258['percent'] = round($v9acb44549b41563697bb490144ec6258['percent']);if($v950d9efcf7c7124de68647a9e3180ad0) {if(!defined("DB_DRIVER")) {define("DB_DRIVER", "mysql");}if($va4f86f7bfc24194b276c22e0ef158197 = $v950d9efcf7c7124de68647a9e3180ad0->xpath("rule[@driver='".DB_DRIVER."' or @driver='*']")) {$v9acb44549b41563697bb490144ec6258['part'] = 'custom';if(is_array($va4f86f7bfc24194b276c22e0ef158197)) {$v22020cc03a548f222140d8ec60fd5195 = array();foreach($va4f86f7bfc24194b276c22e0ef158197 as $v4b43b0aee35624cd95b910189b3dc231) {$vfa816edb83e95bf0c8da580bdfd491ef = $va4f86f7bfc24194b276c22e0ef158197->xpath("*[not(@update-status)]");if($vfa816edb83e95bf0c8da580bdfd491ef)       $v22020cc03a548f222140d8ec60fd5195 = array_merge($v22020cc03a548f222140d8ec60fd5195, is_array($vfa816edb83e95bf0c8da580bdfd491ef) ? $vfa816edb83e95bf0c8da580bdfd491ef : array($vfa816edb83e95bf0c8da580bdfd491ef));}}else {$vfa816edb83e95bf0c8da580bdfd491ef = $va4f86f7bfc24194b276c22e0ef158197->xpath("*[not(@update-status)]");if($vfa816edb83e95bf0c8da580bdfd491ef)      $v22020cc03a548f222140d8ec60fd5195 = is_array($vfa816edb83e95bf0c8da580bdfd491ef) ? $vfa816edb83e95bf0c8da580bdfd491ef : array($vfa816edb83e95bf0c8da580bdfd491ef);}$this->performCustomActions($v22020cc03a548f222140d8ec60fd5195);}}if($v83dece06dbc961347f19cf3221874b38) {__dbg("---- Folders");$v9acb44549b41563697bb490144ec6258['part'] = 'folders';$this->installFolders($v83dece06dbc961347f19cf3221874b38->xpath("folder[not(@update-status)]"));__dbg("---- Files");$v9acb44549b41563697bb490144ec6258['part'] = 'files';$this->installFiles($v83dece06dbc961347f19cf3221874b38->xpath("file[not(@update-status)]"));}if($v950d9efcf7c7124de68647a9e3180ad0) {if($v6942e8fa62b3cc9d93881a58210e2fd7 = $v950d9efcf7c7124de68647a9e3180ad0->xpath("hierarchy-types")) {__dbg("---- Update hierarchy types");$v9acb44549b41563697bb490144ec6258['part'] = 'hierarchy types';$this->installHierarchyTypesUpdate($v6942e8fa62b3cc9d93881a58210e2fd7->xpath("hierarchy-type[not(@update-status)]", true));}if($v0e8133eb006c0f85ed9444ae07a60842 = $v950d9efcf7c7124de68647a9e3180ad0->xpath("object-types")) {__dbg("---- Update object types");$v9acb44549b41563697bb490144ec6258['part'] = 'object types';$this->installObjectTypesUpdate($v0e8133eb006c0f85ed9444ae07a60842->xpath("object-type[not(@update-status)]", true));}if($v5891da2d64975cae48d175d1e001f5da = $v950d9efcf7c7124de68647a9e3180ad0->xpath("objects")) {__dbg("---- Update objects");$v9acb44549b41563697bb490144ec6258['part'] = 'objects';$this->installObjectsUpdate($v5891da2d64975cae48d175d1e001f5da->xpath("object[not(@update-status)]", true));}if($vb3b32a2d422265cd25c3323ed0157f81 = $v950d9efcf7c7124de68647a9e3180ad0->xpath("pages")) {__dbg("---- Update pages");$v9acb44549b41563697bb490144ec6258['part'] = 'pages';$this->installPagesUpdate($vb3b32a2d422265cd25c3323ed0157f81->xpath("page[not(@update-status)]", true));}if($vb3b32a2d422265cd25c3323ed0157f81 = $v950d9efcf7c7124de68647a9e3180ad0->xpath("pages")) {__dbg("---- Update pages symlink values");$v9acb44549b41563697bb490144ec6258['part'] = 'pages smylinks';$this->installPagesSymlinkUpdate($vb3b32a2d422265cd25c3323ed0157f81->xpath("page[.//property[@temp = 'symlink']]", true));}if($va9205dcfd4a6f7c2cbe8be01566ff84a = $v950d9efcf7c7124de68647a9e3180ad0->regedit) {__dbg("---- Update registry");$v9acb44549b41563697bb490144ec6258['part'] = 'registry';$this->installRegistryUpdate($va9205dcfd4a6f7c2cbe8be01566ff84a->xpath("key[not(@update-status)]"));}}}private function installFolders($v2882248c3ef65a048365b939aec03be5) {if($v2882248c3ef65a048365b939aec03be5 instanceof umiSimpleXML) {$v2882248c3ef65a048365b939aec03be5 = array($v2882248c3ef65a048365b939aec03be5);}if(is_array($v2882248c3ef65a048365b939aec03be5) && !empty($v2882248c3ef65a048365b939aec03be5)) {foreach($v2882248c3ef65a048365b939aec03be5 as $v5d109cea561ac72c0c6d3b7e08be8292) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->rootFolder . "/" . $v5d109cea561ac72c0c6d3b7e08be8292->value();if(!is_dir($vd6fe1d0be6347b8ef2427fa629c04485)) {if(!mkdir($vd6fe1d0be6347b8ef2427fa629c04485)) {__dbg("-------------- Folder creation error: ".$v5d109cea561ac72c0c6d3b7e08be8292->value());}}$v5d109cea561ac72c0c6d3b7e08be8292->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function installFiles($v248fea73e23025df76c623003446cd5d) {if($v248fea73e23025df76c623003446cd5d instanceof umiSimpleXML) {$v248fea73e23025df76c623003446cd5d = array($v248fea73e23025df76c623003446cd5d);}if(is_array($v248fea73e23025df76c623003446cd5d) && !empty($v248fea73e23025df76c623003446cd5d)) {$v993631de65b0c6c85be1d14605def23c = $this->extractFolder . "/files";foreach($v248fea73e23025df76c623003446cd5d as $v5b063e275d506f65ebf1b02d926f19a4) {if(!copy($v993631de65b0c6c85be1d14605def23c."/".$v5b063e275d506f65ebf1b02d926f19a4->value(), $this->rootFolder."/".$v5b063e275d506f65ebf1b02d926f19a4->value())) {__dbg("-------------- File error: ".$v5b063e275d506f65ebf1b02d926f19a4->value());}$v5b063e275d506f65ebf1b02d926f19a4->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function performCustomActions($v22020cc03a548f222140d8ec60fd5195) {if(!defined("CMS_DOCUMENT_ROOT"))   define("CMS_DOCUMENT_ROOT", $this->rootFolder."/");foreach($v22020cc03a548f222140d8ec60fd5195 as $v418c5509e2171d55b0aee5c2ea4442b5) {$v418c5509e2171d55b0aee5c2ea4442b5->attribute("update-status", "done");switch($v418c5509e2171d55b0aee5c2ea4442b5->name()) {case 'sql': mysql_query($v418c5509e2171d55b0aee5c2ea4442b5->value());break;case 'php':        if($v5a5dd4fd29235b1438d822b2a353c386 = $v418c5509e2171d55b0aee5c2ea4442b5->attribute("src")) {include dirname($this->packageFile) . "/" . basename($this->packageFile, ".zip") . "/" . $v5a5dd4fd29235b1438d822b2a353c386;}else {@eval($v418c5509e2171d55b0aee5c2ea4442b5->value());}break;}$this->checkTimeLimitExceeded();}}private function installRegistryUpdate($v2c8b230813a1e2edd906f72e6d15040a) {if($v2c8b230813a1e2edd906f72e6d15040a instanceof umiSimpleXML) {$v2c8b230813a1e2edd906f72e6d15040a = array($v2c8b230813a1e2edd906f72e6d15040a);}if(is_array($v2c8b230813a1e2edd906f72e6d15040a) && !empty($v2c8b230813a1e2edd906f72e6d15040a)) {$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();foreach($v2c8b230813a1e2edd906f72e6d15040a as $v6cc4b6ceb44baf30c515ef06b75d1ba2) {if($v6cc4b6ceb44baf30c515ef06b75d1ba2->attribute("status") == "deleted") {$vb1444fb0c07653567ad325aa25d4e37a->delVar($v6cc4b6ceb44baf30c515ef06b75d1ba2->attribute("id"));}else {$vb1444fb0c07653567ad325aa25d4e37a->setVar($v6cc4b6ceb44baf30c515ef06b75d1ba2->attribute("id"), $v6cc4b6ceb44baf30c515ef06b75d1ba2->value());}$v6cc4b6ceb44baf30c515ef06b75d1ba2->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function installHierarchyTypesUpdate($vcd6336c7ce4e005e98373396698489be) {if($vcd6336c7ce4e005e98373396698489be instanceof umiSimpleXML) {$vcd6336c7ce4e005e98373396698489be = array($vcd6336c7ce4e005e98373396698489be);}if(is_array($vcd6336c7ce4e005e98373396698489be) && !empty($vcd6336c7ce4e005e98373396698489be)) {$v9efd24bc9f3822cb392f808f8df8514f = umiHierarchyTypesCollection::getInstance();foreach($vcd6336c7ce4e005e98373396698489be as $v486256b5571a230a185684ee265b25cd) {switch($v486256b5571a230a185684ee265b25cd->attribute("status")) {case "changed"  :   $v599dcce2998a6b40b1e38e8c6006cb0a = $v9efd24bc9f3822cb392f808f8df8514f->getTypeByName($v486256b5571a230a185684ee265b25cd->attribute("module"), $v486256b5571a230a185684ee265b25cd->attribute("method"));if($v599dcce2998a6b40b1e38e8c6006cb0a) {$v599dcce2998a6b40b1e38e8c6006cb0a->setTitle($v486256b5571a230a185684ee265b25cd->attribute("title"));$v599dcce2998a6b40b1e38e8c6006cb0a->commit();break;}case "new"   :   $v9efd24bc9f3822cb392f808f8df8514f->addType($v486256b5571a230a185684ee265b25cd->attribute("module"),                    $v486256b5571a230a185684ee265b25cd->attribute("title"),                    $v486256b5571a230a185684ee265b25cd->attribute("method"));break;case "deleted" : $v599dcce2998a6b40b1e38e8c6006cb0a = $v9efd24bc9f3822cb392f808f8df8514f->getTypeByName($v486256b5571a230a185684ee265b25cd->attribute("module"), $v486256b5571a230a185684ee265b25cd->attribute("method"));$v9efd24bc9f3822cb392f808f8df8514f->delType($v599dcce2998a6b40b1e38e8c6006cb0a->getId());break;}$v486256b5571a230a185684ee265b25cd->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function installObjectTypesUpdate($vcd6336c7ce4e005e98373396698489be) {if($vcd6336c7ce4e005e98373396698489be instanceof umiSimpleXML) {$vcd6336c7ce4e005e98373396698489be = array($vcd6336c7ce4e005e98373396698489be);}if(is_array($vcd6336c7ce4e005e98373396698489be) && !empty($vcd6336c7ce4e005e98373396698489be)) {$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$v6942e8fa62b3cc9d93881a58210e2fd7  = umiHierarchyTypesCollection::getInstance();foreach($vcd6336c7ce4e005e98373396698489be as $v486256b5571a230a185684ee265b25cd) {$vb80bb7740288fda1f201890375a60c8f = $this->findObjectTypeId($v486256b5571a230a185684ee265b25cd);if(!$vb80bb7740288fda1f201890375a60c8f) {$vbfa030fe63bacd523dd70a76cfaed98a = $this->findObjectTypeParentId($v486256b5571a230a185684ee265b25cd);$vb80bb7740288fda1f201890375a60c8f = $vb3827f7111095f5ba1a9f49988fe9382->addType($vbfa030fe63bacd523dd70a76cfaed98a, $v486256b5571a230a185684ee265b25cd->attribute("title"));}else {$vbfa030fe63bacd523dd70a76cfaed98a = 0;}$v486256b5571a230a185684ee265b25cd->attribute("id",     $vb80bb7740288fda1f201890375a60c8f);$v486256b5571a230a185684ee265b25cd->attribute("parent", $vbfa030fe63bacd523dd70a76cfaed98a);$v599dcce2998a6b40b1e38e8c6006cb0a = $vb3827f7111095f5ba1a9f49988fe9382->getType($vb80bb7740288fda1f201890375a60c8f);if(!$v599dcce2998a6b40b1e38e8c6006cb0a) continue;$v599dcce2998a6b40b1e38e8c6006cb0a->setIsLocked(false);if($v486256b5571a230a185684ee265b25cd->attribute("status") == "deleted") {$vb3827f7111095f5ba1a9f49988fe9382->delType($vb80bb7740288fda1f201890375a60c8f);}else {$this->updateTypeGroups($v599dcce2998a6b40b1e38e8c6006cb0a, $v486256b5571a230a185684ee265b25cd->group);if($v736bd6aff67175f061a94ea8e4006e3a = $v486256b5571a230a185684ee265b25cd->xpath("hierarchy-type")) {$v7f1e080bc3c4ce1e4a57cec40f93c41c = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName($v736bd6aff67175f061a94ea8e4006e3a->attribute("module"), $v736bd6aff67175f061a94ea8e4006e3a->attribute("method"));$v599dcce2998a6b40b1e38e8c6006cb0a->setHierarchyTypeId( $v7f1e080bc3c4ce1e4a57cec40f93c41c ? $v7f1e080bc3c4ce1e4a57cec40f93c41c->getId() : 0 );}$v599dcce2998a6b40b1e38e8c6006cb0a->setIsGuidable($v486256b5571a230a185684ee265b25cd->attribute("guidable"));$v599dcce2998a6b40b1e38e8c6006cb0a->setIsPublic($v486256b5571a230a185684ee265b25cd->attribute("public"));$v599dcce2998a6b40b1e38e8c6006cb0a->setIsLocked($v486256b5571a230a185684ee265b25cd->attribute("locked"));$v599dcce2998a6b40b1e38e8c6006cb0a->commit();}$v486256b5571a230a185684ee265b25cd->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function installObjectsUpdate($v99b87cd0d2f1c974aaca5557323d8de0) {if($v99b87cd0d2f1c974aaca5557323d8de0 instanceof umiSimpleXML) {$v99b87cd0d2f1c974aaca5557323d8de0 = array($v99b87cd0d2f1c974aaca5557323d8de0);}if(is_array($v99b87cd0d2f1c974aaca5557323d8de0) && !empty($v99b87cd0d2f1c974aaca5557323d8de0)) {$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectsCollection::getInstance();$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();foreach($v99b87cd0d2f1c974aaca5557323d8de0 as $v0e017e24a4ca3bd0716d784507aac89f) {if($v0e017e24a4ca3bd0716d784507aac89f->attribute('status') == 'deleted') {continue;}$v967da15314b2aadfa0155d0737dd0661   = $v0e017e24a4ca3bd0716d784507aac89f->attribute("type-index");$vbe49cb70fcdf9df523de9083301d46b6  = $v0e017e24a4ca3bd0716d784507aac89f->xpath("/component/database-image/object-types/object-type[@index='{$v967da15314b2aadfa0155d0737dd0661}']");if(!$vbe49cb70fcdf9df523de9083301d46b6) {continue;}$v5f694956811487225d15e973ca38fbab   = $vbe49cb70fcdf9df523de9083301d46b6->attribute("id");$vb068931cc450442b63f5b3d276ea4297 = $v0e017e24a4ca3bd0716d784507aac89f->attribute('name');$v726e8e4809d4c1b28a6549d86436a124 = $v0e8133eb006c0f85ed9444ae07a60842->getType($v5f694956811487225d15e973ca38fbab);$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v5f694956811487225d15e973ca38fbab);$v8be74552df93e31bbdd6b36ed74bdb6a->addNameFilterEquals($vb068931cc450442b63f5b3d276ea4297);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);if(sizeof($result)) {$v16b2b26000987faccb260b9d39df1269 = $result[0];}else {$v16b2b26000987faccb260b9d39df1269 = $vdb6d9b451b818ccc9a449383f2f0c450->addObject($vb068931cc450442b63f5b3d276ea4297, $v5f694956811487225d15e973ca38fbab);}$va8cfde6331bd59eb2ac96f8911c4b666 = $vdb6d9b451b818ccc9a449383f2f0c450->getObject($v16b2b26000987faccb260b9d39df1269);if(!$va8cfde6331bd59eb2ac96f8911c4b666) continue;$v50fe03ab7bf37089a7e88da9b31ffb3b = $v0e017e24a4ca3bd0716d784507aac89f->xpath('property', true);if($v50fe03ab7bf37089a7e88da9b31ffb3b) $this->updateProps($v50fe03ab7bf37089a7e88da9b31ffb3b, $v726e8e4809d4c1b28a6549d86436a124, $va8cfde6331bd59eb2ac96f8911c4b666);$va8cfde6331bd59eb2ac96f8911c4b666->commit();$v0e017e24a4ca3bd0716d784507aac89f->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function installPagesUpdate($v824c87d3b8e31d2c496e9f6ba508cc09) {if($v824c87d3b8e31d2c496e9f6ba508cc09 instanceof umiSimpleXML) {$v824c87d3b8e31d2c496e9f6ba508cc09 = array($v824c87d3b8e31d2c496e9f6ba508cc09);}if(is_array($v824c87d3b8e31d2c496e9f6ba508cc09) && !empty($v824c87d3b8e31d2c496e9f6ba508cc09)) {$permissions = permissionsCollection::getInstance();$v72ee76c5c29383b7c9f9225c1fa4d10b = ($vfa816edb83e95bf0c8da580bdfd491ef = domainsCollection::getInstance()->getDefaultDomain()) ? $vfa816edb83e95bf0c8da580bdfd491ef->getId() : 0;$vf585b7f018bb4ced15a03683a733e50b   = ($vfa816edb83e95bf0c8da580bdfd491ef = langsCollection::getInstance()->getDefaultLang()) ? $vfa816edb83e95bf0c8da580bdfd491ef->getId() : 0;$vb81ca7c0ccaa77e7aa91936ab0070695   = umiHierarchy::getInstance();$v6942e8fa62b3cc9d93881a58210e2fd7 = umiHierarchyTypesCollection::getInstance();$vfed36e93a0509e20f2dc96cbbd85b678 = templatesCollection::getInstance();$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();$vd05b6ed7d2345020440df396d6da7f73 = umiFieldsCollection::getInstance();$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();umiObjectProperty::$IGNORE_FILTER_INPUT_STRING = true;foreach($v824c87d3b8e31d2c496e9f6ba508cc09 as $va383be211e1514554df317a12fd69ee4) {if($va383be211e1514554df317a12fd69ee4->attribute('status') != 'new') {continue;}$v85866646134b10869b7c66b6e9bfbb60    = $va383be211e1514554df317a12fd69ee4->basetype;$v89b0b9deff65f8b9cd1f71bc74ce36ba = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName($v85866646134b10869b7c66b6e9bfbb60->attribute('module'), $v85866646134b10869b7c66b6e9bfbb60->attribute('method'));$v967da15314b2aadfa0155d0737dd0661   = $va383be211e1514554df317a12fd69ee4->attribute("type-index");$vbe49cb70fcdf9df523de9083301d46b6  = $va383be211e1514554df317a12fd69ee4->xpath("/component/database-image/object-types/object-type[@index='{$v967da15314b2aadfa0155d0737dd0661}']");if(!$vbe49cb70fcdf9df523de9083301d46b6) {continue;}$v5f694956811487225d15e973ca38fbab   = $vbe49cb70fcdf9df523de9083301d46b6->attribute("id");$v2a304a1348456ccd2234cd71a81bd338     = $va383be211e1514554df317a12fd69ee4->link->value();$v0330da281541887f65b0a60066351c91  = substr($v2a304a1348456ccd2234cd71a81bd338, strrpos($v2a304a1348456ccd2234cd71a81bd338, '/', -2) + 1, -1);$vd6fe1d0be6347b8ef2427fa629c04485     = substr($v2a304a1348456ccd2234cd71a81bd338, 0, strrpos($v2a304a1348456ccd2234cd71a81bd338, '/', -2) + 1);if($vd6fe1d0be6347b8ef2427fa629c04485 == "/") {$vbfa030fe63bacd523dd70a76cfaed98a = 0;}else {$vbfa030fe63bacd523dd70a76cfaed98a = $vb81ca7c0ccaa77e7aa91936ab0070695->getIdByPath($vd6fe1d0be6347b8ef2427fa629c04485, true);}$v810d2618ba63da2e91ef6c508006d355 = $va383be211e1514554df317a12fd69ee4->template;$v3200a31fc05da4e9d5a0465c36822e2f   = false;$v4334e531f3928afebdbe8f44febfc0fa = $vfed36e93a0509e20f2dc96cbbd85b678->getTemplatesList($v72ee76c5c29383b7c9f9225c1fa4d10b, $vf585b7f018bb4ced15a03683a733e50b);foreach($v4334e531f3928afebdbe8f44febfc0fa as $v66f6181bcb4cff4cd38fbc804a036db6) {if($v66f6181bcb4cff4cd38fbc804a036db6->getFilename() == $v810d2618ba63da2e91ef6c508006d355->value()) {$v3200a31fc05da4e9d5a0465c36822e2f = $v66f6181bcb4cff4cd38fbc804a036db6->getId();break;}}if($v3200a31fc05da4e9d5a0465c36822e2f == false) {$v3200a31fc05da4e9d5a0465c36822e2f = $vfed36e93a0509e20f2dc96cbbd85b678->addTemplate($v810d2618ba63da2e91ef6c508006d355->value(), $v810d2618ba63da2e91ef6c508006d355->attribute('title'), $v72ee76c5c29383b7c9f9225c1fa4d10b, $vf585b7f018bb4ced15a03683a733e50b);if($v810d2618ba63da2e91ef6c508006d355->attribute('default') == 'default') {$vfed36e93a0509e20f2dc96cbbd85b678->setDefaultTemplate($v3200a31fc05da4e9d5a0465c36822e2f, $v72ee76c5c29383b7c9f9225c1fa4d10b, $vf585b7f018bb4ced15a03683a733e50b);}}$vb80bb7740288fda1f201890375a60c8f = $vb81ca7c0ccaa77e7aa91936ab0070695->addElement((int) $vbfa030fe63bacd523dd70a76cfaed98a, $v89b0b9deff65f8b9cd1f71bc74ce36ba->getId(), $va383be211e1514554df317a12fd69ee4->attribute('name'), $v0330da281541887f65b0a60066351c91, $v5f694956811487225d15e973ca38fbab, false, false, $v3200a31fc05da4e9d5a0465c36822e2f);$permissions->setElementPermissions(2373, $vb80bb7740288fda1f201890375a60c8f, 1);$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vb80bb7740288fda1f201890375a60c8f, true);$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive($va383be211e1514554df317a12fd69ee4->attribute('active') == 'active');$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsDefault($va383be211e1514554df317a12fd69ee4->attribute('default') == 'default');$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsVisible($va383be211e1514554df317a12fd69ee4->attribute('visible') == 'visible');$v6301cee35ea764a1e241978f93f01069 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getObjectTypeId();$v726e8e4809d4c1b28a6549d86436a124 = $v0e8133eb006c0f85ed9444ae07a60842->getType($v6301cee35ea764a1e241978f93f01069);$v50fe03ab7bf37089a7e88da9b31ffb3b = $va383be211e1514554df317a12fd69ee4->xpath('property', true);if($v50fe03ab7bf37089a7e88da9b31ffb3b) $this->updateProps($v50fe03ab7bf37089a7e88da9b31ffb3b, $v726e8e4809d4c1b28a6549d86436a124, $v8e2dcfd7e7e24b1ca76c1193f645902b);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$va383be211e1514554df317a12fd69ee4->attribute("update-status", "done");$this->checkTimeLimitExceeded();}}}private function updateProps ($v50fe03ab7bf37089a7e88da9b31ffb3b, $v726e8e4809d4c1b28a6549d86436a124, $v645ec79f22bec5efe970061d395cf7c4) {$vb81ca7c0ccaa77e7aa91936ab0070695   = umiHierarchy::getInstance();$v6942e8fa62b3cc9d93881a58210e2fd7 = umiHierarchyTypesCollection::getInstance();$vfed36e93a0509e20f2dc96cbbd85b678 = templatesCollection::getInstance();$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();$vd05b6ed7d2345020440df396d6da7f73 = umiFieldsCollection::getInstance();$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();foreach($v50fe03ab7bf37089a7e88da9b31ffb3b as $v9eb041c6b7c8195f1d0ed4c51f94c004) {if($v9eb041c6b7c8195f1d0ed4c51f94c004->value) {if($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('temp') == "symlink") continue;if($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('temp') == "done") continue;if($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('temp') == 'optioned') {$v2063c1608d6e0baf80249c42e2be5804 = array();foreach($v9eb041c6b7c8195f1d0ed4c51f94c004->xpath('.//option', true) as $v5ecf0a02e02bd528df985f4f51a5af41) {$v2063c1608d6e0baf80249c42e2be5804[] = array(          'float' => (string) $v5ecf0a02e02bd528df985f4f51a5af41->float,          'rel' => (string) $v5ecf0a02e02bd528df985f4f51a5af41->rel,          'int' => (string) $v5ecf0a02e02bd528df985f4f51a5af41->int,          'varchar' => (string) $v5ecf0a02e02bd528df985f4f51a5af41->varchar,          'symlink' => (string) $v5ecf0a02e02bd528df985f4f51a5af41->symlink      );}$v645ec79f22bec5efe970061d395cf7c4->setValue($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('name'), $v2063c1608d6e0baf80249c42e2be5804);}else {$v645ec79f22bec5efe970061d395cf7c4->setValue($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('name'), $v9eb041c6b7c8195f1d0ed4c51f94c004->value->value());}}else if ($v9eb041c6b7c8195f1d0ed4c51f94c004->object) {$v945100186b119048837b9859c2c46410 = $v726e8e4809d4c1b28a6549d86436a124->getFieldId($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('name'));$v06e3d36fa30cea095545139854ad1fb9 = $vd05b6ed7d2345020440df396d6da7f73->getField($v945100186b119048837b9859c2c46410);if($v06e3d36fa30cea095545139854ad1fb9->getFieldType()->getDataType() == "relation") {if($v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = $v06e3d36fa30cea095545139854ad1fb9->getGuideId()) {$v2063c1608d6e0baf80249c42e2be5804 = array();foreach($v9eb041c6b7c8195f1d0ed4c51f94c004->xpath('object', true) as $v447b7147e84be512208dcc0995d67ebc) {$vb068931cc450442b63f5b3d276ea4297 = $v447b7147e84be512208dcc0995d67ebc->attribute('name');if(!$vb068931cc450442b63f5b3d276ea4297) $vb068931cc450442b63f5b3d276ea4297 = $v447b7147e84be512208dcc0995d67ebc->value();if($vb068931cc450442b63f5b3d276ea4297 == 'lyxsus') continue;$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v52eb29c6d8ea0d3a5bb3654f49bbd7c7);$v8be74552df93e31bbdd6b36ed74bdb6a->addNameFilterEquals($vb068931cc450442b63f5b3d276ea4297);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);if(sizeof($result)) {list($v59a814aa020a1b32c4674a5887a35022) = $result;}else {$v59a814aa020a1b32c4674a5887a35022 = $v5891da2d64975cae48d175d1e001f5da->addObject($vb068931cc450442b63f5b3d276ea4297, $v52eb29c6d8ea0d3a5bb3654f49bbd7c7);}$v2063c1608d6e0baf80249c42e2be5804[] = $v59a814aa020a1b32c4674a5887a35022;}$v645ec79f22bec5efe970061d395cf7c4->setValue($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('name'), $v2063c1608d6e0baf80249c42e2be5804);}}$v645ec79f22bec5efe970061d395cf7c4->commit();}}}private function installPagesSymlinkUpdate($v824c87d3b8e31d2c496e9f6ba508cc09) {if($v824c87d3b8e31d2c496e9f6ba508cc09 instanceof umiSimpleXML) {$v824c87d3b8e31d2c496e9f6ba508cc09 = array($v824c87d3b8e31d2c496e9f6ba508cc09);}if(is_array($v824c87d3b8e31d2c496e9f6ba508cc09) && !empty($v824c87d3b8e31d2c496e9f6ba508cc09)) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();foreach($v824c87d3b8e31d2c496e9f6ba508cc09 as $va383be211e1514554df317a12fd69ee4) {$v2a304a1348456ccd2234cd71a81bd338     = $va383be211e1514554df317a12fd69ee4->link->value();$v7552cd149af7495ee7d8225974e50f80 = $vb81ca7c0ccaa77e7aa91936ab0070695->getIdBypath($v2a304a1348456ccd2234cd71a81bd338);$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7552cd149af7495ee7d8225974e50f80, true, true);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement == false) continue;foreach($va383be211e1514554df317a12fd69ee4->property as $v9eb041c6b7c8195f1d0ed4c51f94c004) {if($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('temp') != "symlink") continue;if($v9eb041c6b7c8195f1d0ed4c51f94c004->value) {if($v9eb041c6b7c8195f1d0ed4c51f94c004->value->link) {if(is_array($v9eb041c6b7c8195f1d0ed4c51f94c004->value->link)) {$v807765384d9d5527da8848df14a4f02f = $v9eb041c6b7c8195f1d0ed4c51f94c004->value->link;}else {$v807765384d9d5527da8848df14a4f02f = array($v9eb041c6b7c8195f1d0ed4c51f94c004->value->link);}$vb2021c4149dfd5dc85c88823b7df34bd = Array();foreach($v807765384d9d5527da8848df14a4f02f as $v0975a4d4826cb6ec76b9c14bdf353a50) {$vf8e19f449f17c9d37dcc93dd244ec3bb = $v0975a4d4826cb6ec76b9c14bdf353a50->value();$vb80bb7740288fda1f201890375a60c8f = $vb81ca7c0ccaa77e7aa91936ab0070695->getIdByPath($vf8e19f449f17c9d37dcc93dd244ec3bb);if($vb80bb7740288fda1f201890375a60c8f) {$vb2021c4149dfd5dc85c88823b7df34bd[] = $vb80bb7740288fda1f201890375a60c8f;}}if(sizeof($vb2021c4149dfd5dc85c88823b7df34bd)) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue($v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('name'), $vb2021c4149dfd5dc85c88823b7df34bd);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();}}}$v9eb041c6b7c8195f1d0ed4c51f94c004->attribute('temp', 'done');}$this->checkTimeLimitExceeded();}}}private function updateTypeGroups(umiObjectType $v599dcce2998a6b40b1e38e8c6006cb0a, $v1471e4e05a4db95d353cc867fe317314) {if($v1471e4e05a4db95d353cc867fe317314 instanceof umiSimpleXML) {$v1471e4e05a4db95d353cc867fe317314 = array($v1471e4e05a4db95d353cc867fe317314);}if(is_array($v1471e4e05a4db95d353cc867fe317314) && !empty($v1471e4e05a4db95d353cc867fe317314)) {foreach($v1471e4e05a4db95d353cc867fe317314 as $v2e847b4bdd51143b305f4f5ad6691d5f) {$vdb0f6f37ebeb6ea09489124345af2a45 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldsGroupByName($v2e847b4bdd51143b305f4f5ad6691d5f->attribute("name"));if(!$vdb0f6f37ebeb6ea09489124345af2a45) {$v47db2588331bbe530c80dd001fc60aed = $v599dcce2998a6b40b1e38e8c6006cb0a->addFieldsGroup($v2e847b4bdd51143b305f4f5ad6691d5f->attribute("name"), $v2e847b4bdd51143b305f4f5ad6691d5f->attribute("title"));$vdb0f6f37ebeb6ea09489124345af2a45   = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldsGroup($v47db2588331bbe530c80dd001fc60aed);}if($vdb0f6f37ebeb6ea09489124345af2a45 instanceof umiFieldsGroup) {if($v2e847b4bdd51143b305f4f5ad6691d5f->attribute("status") == "deleted") {continue;}$vdb0f6f37ebeb6ea09489124345af2a45->setTitle($v2e847b4bdd51143b305f4f5ad6691d5f->attribute("title"));$vdb0f6f37ebeb6ea09489124345af2a45->setIsLocked((bool)$v2e847b4bdd51143b305f4f5ad6691d5f->attribute("locked"));$vdb0f6f37ebeb6ea09489124345af2a45->setIsVisible((bool)$v2e847b4bdd51143b305f4f5ad6691d5f->attribute("visible"));$vdb0f6f37ebeb6ea09489124345af2a45->commit();$this->updateGroupFields($v599dcce2998a6b40b1e38e8c6006cb0a, $vdb0f6f37ebeb6ea09489124345af2a45, $v2e847b4bdd51143b305f4f5ad6691d5f->field);}}}}private function updateGroupFields(umiObjectType $v599dcce2998a6b40b1e38e8c6006cb0a, umiFieldsGroup $vdb0f6f37ebeb6ea09489124345af2a45, $vd05b6ed7d2345020440df396d6da7f73) {if($vd05b6ed7d2345020440df396d6da7f73 instanceof umiSimpleXML) {$vd05b6ed7d2345020440df396d6da7f73 = array($vd05b6ed7d2345020440df396d6da7f73);}if(is_array($vd05b6ed7d2345020440df396d6da7f73) && !empty($vd05b6ed7d2345020440df396d6da7f73)) {$v8797e64b0b663bbad43134e3003a4ef4 = umiFieldsCollection::getInstance();foreach($vd05b6ed7d2345020440df396d6da7f73 as $v77be71a4a1d487f740f26b2d29b7991e) {$v945100186b119048837b9859c2c46410 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId($v77be71a4a1d487f740f26b2d29b7991e->attribute("name"));$vce495ab8d79db0d37413d8e95b54e606    = ($v77be71a4a1d487f740f26b2d29b7991e->attribute("multiple") == "multiple");if(!$v945100186b119048837b9859c2c46410 && ($v77be71a4a1d487f740f26b2d29b7991e->attribute("status") == "new")) {$vb068931cc450442b63f5b3d276ea4297        = $v77be71a4a1d487f740f26b2d29b7991e->attribute("name");$vd5d3db1765287eef77d7927cc956f50a       = $v77be71a4a1d487f740f26b2d29b7991e->attribute("title");if($vb068931cc450442b63f5b3d276ea4297 == "linked_objs") {}$ve2aeb4e882d60b1eb4b7c8cd97986a28 = $this->getFieldTypeIdByDataType($v77be71a4a1d487f740f26b2d29b7991e->attribute("type"), $vce495ab8d79db0d37413d8e95b54e606);$v945100186b119048837b9859c2c46410   = $v8797e64b0b663bbad43134e3003a4ef4->addField($vb068931cc450442b63f5b3d276ea4297, $vd5d3db1765287eef77d7927cc956f50a, $ve2aeb4e882d60b1eb4b7c8cd97986a28);$vdb0f6f37ebeb6ea09489124345af2a45->attachField($v945100186b119048837b9859c2c46410);}else {}$v06e3d36fa30cea095545139854ad1fb9   = $v8797e64b0b663bbad43134e3003a4ef4->getField($v945100186b119048837b9859c2c46410);if(!$v06e3d36fa30cea095545139854ad1fb9) continue;$v06e3d36fa30cea095545139854ad1fb9->setIsLocked(false);if($v77be71a4a1d487f740f26b2d29b7991e->attribute("status") == "deleted") {$v8797e64b0b663bbad43134e3003a4ef4->delField($v945100186b119048837b9859c2c46410);continue;}$v06e3d36fa30cea095545139854ad1fb9->setTitle($v77be71a4a1d487f740f26b2d29b7991e->attribute("title"));$v06e3d36fa30cea095545139854ad1fb9->setFieldTypeId($this->getFieldTypeIdByDataType($v77be71a4a1d487f740f26b2d29b7991e->attribute("type"), $vce495ab8d79db0d37413d8e95b54e606));$v06e3d36fa30cea095545139854ad1fb9->setIsVisible($v77be71a4a1d487f740f26b2d29b7991e->attribute("visible"));$v06e3d36fa30cea095545139854ad1fb9->setIsInheritable($v77be71a4a1d487f740f26b2d29b7991e->attribute("inheritable"));$v06e3d36fa30cea095545139854ad1fb9->setGuideId( $this->findObjectTypeId($v77be71a4a1d487f740f26b2d29b7991e->xpath("//object-type[@index='". $v77be71a4a1d487f740f26b2d29b7991e->attribute("guide-index") ."']") ) );$v06e3d36fa30cea095545139854ad1fb9->setIsInSearch($v77be71a4a1d487f740f26b2d29b7991e->attribute("in-search"));$v06e3d36fa30cea095545139854ad1fb9->setIsInFilter($v77be71a4a1d487f740f26b2d29b7991e->attribute("in-filter"));$v06e3d36fa30cea095545139854ad1fb9->setTip($v77be71a4a1d487f740f26b2d29b7991e->attribute("tip"));$v06e3d36fa30cea095545139854ad1fb9->setIsRequired($v77be71a4a1d487f740f26b2d29b7991e->attribute("required"));$v06e3d36fa30cea095545139854ad1fb9->setIsLocked($v77be71a4a1d487f740f26b2d29b7991e->attribute("locked"));$v06e3d36fa30cea095545139854ad1fb9->commit();}}}private function findObjectTypeId($v486256b5571a230a185684ee265b25cd, $vbfa030fe63bacd523dd70a76cfaed98a = 0) {if(!$v486256b5571a230a185684ee265b25cd) return 0;$vb80bb7740288fda1f201890375a60c8f    = 0;$vd5d3db1765287eef77d7927cc956f50a = $v486256b5571a230a185684ee265b25cd->attribute("title");$vacf567c9c3d6cf7c6e2cc0ce108e0631 = null;if($v736bd6aff67175f061a94ea8e4006e3a = $v486256b5571a230a185684ee265b25cd->xpath("hierarchy-type")) {$vdb2eba2d5a30015b3103e1325f067551 = umiHierarchyTypesCollection::getInstance()->getTypeByName( $v736bd6aff67175f061a94ea8e4006e3a->attribute("module"), $v736bd6aff67175f061a94ea8e4006e3a->attribute("method"));if($vdb2eba2d5a30015b3103e1325f067551) $vacf567c9c3d6cf7c6e2cc0ce108e0631 = $vdb2eba2d5a30015b3103e1325f067551->getId();}$vbfa030fe63bacd523dd70a76cfaed98a = $this->findObjectTypeParentId($v486256b5571a230a185684ee265b25cd, $vbfa030fe63bacd523dd70a76cfaed98a);$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$vd01aeedf44f5ec36e5bcb846f2112a9a  = $vb3827f7111095f5ba1a9f49988fe9382->getSubTypesList($vbfa030fe63bacd523dd70a76cfaed98a);foreach($vd01aeedf44f5ec36e5bcb846f2112a9a as $v5f694956811487225d15e973ca38fbab) {$v599dcce2998a6b40b1e38e8c6006cb0a = $vb3827f7111095f5ba1a9f49988fe9382->getType($v5f694956811487225d15e973ca38fbab);if(strcmp($v599dcce2998a6b40b1e38e8c6006cb0a->getName(), $vd5d3db1765287eef77d7927cc956f50a) == 0 &&     ($vacf567c9c3d6cf7c6e2cc0ce108e0631 == null || $v599dcce2998a6b40b1e38e8c6006cb0a->getHierarchyTypeId() == $vacf567c9c3d6cf7c6e2cc0ce108e0631) ) {$vb80bb7740288fda1f201890375a60c8f = $v5f694956811487225d15e973ca38fbab;$v486256b5571a230a185684ee265b25cd->attribute("id", $vb80bb7740288fda1f201890375a60c8f);$v486256b5571a230a185684ee265b25cd->attribute("parent", $vbfa030fe63bacd523dd70a76cfaed98a);break;}}return $vb80bb7740288fda1f201890375a60c8f;}private function findObjectTypeParentId($v486256b5571a230a185684ee265b25cd, $vbfa030fe63bacd523dd70a76cfaed98a = 0) {if($vd2eb444e35c0a71f0a85df8194acb5b6 = $v486256b5571a230a185684ee265b25cd->attribute("parent")) return $vd2eb444e35c0a71f0a85df8194acb5b6;if($v486256b5571a230a185684ee265b25cd->legend && $vc68ad910ed49ac65f21f1bf2c5dbf912 = $v486256b5571a230a185684ee265b25cd->legend->xpath("object-type")) {if(!is_array($vc68ad910ed49ac65f21f1bf2c5dbf912)) $vc68ad910ed49ac65f21f1bf2c5dbf912 = array($vc68ad910ed49ac65f21f1bf2c5dbf912);foreach($vc68ad910ed49ac65f21f1bf2c5dbf912 as $v2d167696e35bbbaa2b026d0ffbbeaf68) {$vbfa030fe63bacd523dd70a76cfaed98a = $this->findObjectTypeId($v2d167696e35bbbaa2b026d0ffbbeaf68, $vbfa030fe63bacd523dd70a76cfaed98a);}}return $vbfa030fe63bacd523dd70a76cfaed98a;}private function getFieldTypeIdByDataType($_dataType, $_multiple) {static $v69552af3a03df9391f70eb1851f817c5 = null;if(!$v69552af3a03df9391f70eb1851f817c5) {$v69552af3a03df9391f70eb1851f817c5 = umiFieldTypesCollection::getInstance()->getFieldTypesList();}foreach($v69552af3a03df9391f70eb1851f817c5 as $v599dcce2998a6b40b1e38e8c6006cb0a) {if(strcmp(strtolower($v599dcce2998a6b40b1e38e8c6006cb0a->getDataType()), strtolower($_dataType)) == 0 && $v599dcce2998a6b40b1e38e8c6006cb0a->getIsMultiple() == $_multiple) {return $v599dcce2998a6b40b1e38e8c6006cb0a->getId();}}return 0;}private function removeFolder($v5d109cea561ac72c0c6d3b7e08be8292) {$v8b9f572ea60cc8b47e60608c3923fda9 = glob($v5d109cea561ac72c0c6d3b7e08be8292 . "/*");foreach($v8b9f572ea60cc8b47e60608c3923fda9 as $vb068931cc450442b63f5b3d276ea4297) {if(is_dir($vb068931cc450442b63f5b3d276ea4297)) {if(!$this->removeFolder($vb068931cc450442b63f5b3d276ea4297)) return false;rmdir($vb068931cc450442b63f5b3d276ea4297);}else {unlink($vb068931cc450442b63f5b3d276ea4297);}if($this->checkTimeLimitExceeded(true)) return false;}rmdir($v5d109cea561ac72c0c6d3b7e08be8292);return true;}};?>