<?php
 class xslTemplater extends singleton implements iXslTemplater {protected $xslTemplatesFolder = "./xsltTpls/";protected $domDocument = false,    $xmlTranslator = false,    $xslFilePath = false,        $globalVariables = Array(),    $isInited = false;protected function __construct() {}public static function getInstance() {return parent::getInstance(__CLASS__);}public function init($v6a559eac8ab38b0b76a6fca32dcb9749 = false) {if($this->checkFile($v6a559eac8ab38b0b76a6fca32dcb9749) || $v6a559eac8ab38b0b76a6fca32dcb9749 === false) {$this->xslFilePath = $v6a559eac8ab38b0b76a6fca32dcb9749;}else {$this->generateTplNotFoundError();}if(!$this->isInited) {$this->prepareXmlDocument();$this->prepareXmlTranslator();$this->initGlobalVariables();$this->initXmlDocument();}$this->isInited = true;}protected function generateTplNotFoundError() {$v7f2db423a49b305459147332fb01cf87 = outputBuffer::current();$v7f2db423a49b305459147332fb01cf87->contentType('text/html');$v7f2db423a49b305459147332fb01cf87->charset('utf-8');$v7f2db423a49b305459147332fb01cf87->clear();require "./errors/no_design_template.html";$v7f2db423a49b305459147332fb01cf87->end();}public function getIsInited() {return $this->isInited;}public function setIsInited($v22af645d1859cb5ca6da0c484f1f37ea) {$v149603e6c03516362a8da23f624db945 = $this->isInited;$this->isInited = (bool) $v22af645d1859cb5ca6da0c484f1f37ea;return $v149603e6c03516362a8da23f624db945;}protected function checkFile($v47826cacc65c665212b821e6ff80b9b0) {if(file_exists($v47826cacc65c665212b821e6ff80b9b0)) {if(is_readable($v47826cacc65c665212b821e6ff80b9b0)) {return true;}}return false;}protected function prepareXmlDocument() {$vdd988cfd769c9f7fbd795a0f5da8e751 = new DOMDocument("1.0", "utf-8");$vdd988cfd769c9f7fbd795a0f5da8e751->formatOutput = XML_FORMAT_OUTPUT;$this->domDocument = $vdd988cfd769c9f7fbd795a0f5da8e751;}protected function prepareXmlTranslator() {$this->xmlTranslator = new xmlTranslator($this->getXmlDocument());}protected function initGlobalVariables() {$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();$permissions = permissionsCollection::getInstance();$v8e44f0089b076e18a718eb9ca3d94674 = $permissions->getUserId();$v7057e8409c7c531a1a6e9ac3df4ed549 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentElementId();$v7abdda3251de25a51bf5fb15d7c3391d = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentModule();$vdb206b4902d295196025b8e70cbb0896 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentMethod();if($permissions->isAllowedMethod($v8e44f0089b076e18a718eb9ca3d94674, $v7abdda3251de25a51bf5fb15d7c3391d, $vdb206b4902d295196025b8e70cbb0896)) {$vdc103d75e269b8c2bb112e8a59761bcf = false;if($v7057e8409c7c531a1a6e9ac3df4ed549 && !$permissions->isAllowedObject($v8e44f0089b076e18a718eb9ca3d94674, $v7057e8409c7c531a1a6e9ac3df4ed549)) {$vdc103d75e269b8c2bb112e8a59761bcf = true;}}else {$vdc103d75e269b8c2bb112e8a59761bcf = true;}if($vdc103d75e269b8c2bb112e8a59761bcf) {$v7abdda3251de25a51bf5fb15d7c3391d = "users";$vdb206b4902d295196025b8e70cbb0896 = "login";$v8b1dc169bf460ee884fceef66c6607d6->setCurrentModule($v7abdda3251de25a51bf5fb15d7c3391d);$v8b1dc169bf460ee884fceef66c6607d6->setCurrentMethod($vdb206b4902d295196025b8e70cbb0896);}$this->globalVariables['attribute:module'] = $v7abdda3251de25a51bf5fb15d7c3391d;$this->globalVariables['attribute:method'] = $vdb206b4902d295196025b8e70cbb0896;$this->globalVariables['attribute:domain'] = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain()->getHost();$this->globalVariables['attribute:lang'] = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentLang()->getPrefix();$this->globalVariables['attribute:pre-lang'] = $v8b1dc169bf460ee884fceef66c6607d6->pre_lang;$this->globalVariables['attribute:header'] = templater::getInstance()->parseInput(macros_header());$this->globalVariables['attribute:title'] = templater::getInstance()->parseInput(macros_title());$this->globalVariables['meta'] = Array();$this->globalVariables['meta']['keywords'] = macros_keywords();$this->globalVariables['meta']['description'] = macros_describtion();if(is_null(getRequest('p')) == false) {$this->globalVariables['attribute:paging'] = "yes";}if($vb6ee27ee7fe19b0c0dd907d5f947aa12 = getServer('REQUEST_URI')) {$vafbad9dc43d3b9eb8533cd54a4df6a87 = parse_url($vb6ee27ee7fe19b0c0dd907d5f947aa12);$vb6ee27ee7fe19b0c0dd907d5f947aa12 = getArrayKey($vafbad9dc43d3b9eb8533cd54a4df6a87, 'path');$vf7cc8e4882789cf3335d9ed97f208c6f = getArrayKey($vafbad9dc43d3b9eb8533cd54a4df6a87, 'query');if($vf7cc8e4882789cf3335d9ed97f208c6f) {parse_str($vf7cc8e4882789cf3335d9ed97f208c6f, $v5ebb3c9d5620968cde8459888eff1702);if(isset($v5ebb3c9d5620968cde8459888eff1702['p'])) unset($v5ebb3c9d5620968cde8459888eff1702['p']);if(isset($v5ebb3c9d5620968cde8459888eff1702['xmlMode'])) unset($v5ebb3c9d5620968cde8459888eff1702['xmlMode']);$vf7cc8e4882789cf3335d9ed97f208c6f = http_build_query($v5ebb3c9d5620968cde8459888eff1702);if($vf7cc8e4882789cf3335d9ed97f208c6f) $vb6ee27ee7fe19b0c0dd907d5f947aa12 .= '?' . $vf7cc8e4882789cf3335d9ed97f208c6f;}$this->globalVariables['attribute:request-uri'] = $vb6ee27ee7fe19b0c0dd907d5f947aa12;}$vee11cbb19052e40b07aac0ca060c23ee = array();$vee11cbb19052e40b07aac0ca060c23ee['attribute:id'] = $ve8701ad48ba05a91604e480dd60899a3 = $v8b1dc169bf460ee884fceef66c6607d6->getModule('users')->user_id;$v3d88fcbaa3581c4957147ef9ad47ec5e = 'guest';if($permissions->isAuth()) {$v3d88fcbaa3581c4957147ef9ad47ec5e = 'user';if($permissions->isAdmin()) {$v3d88fcbaa3581c4957147ef9ad47ec5e = 'admin';if($permissions->isSv()) $v3d88fcbaa3581c4957147ef9ad47ec5e = 'sv';}}$vee11cbb19052e40b07aac0ca060c23ee['attribute:type'] = $v3d88fcbaa3581c4957147ef9ad47ec5e;if($permissions->isAuth()) {$vee11cbb19052e40b07aac0ca060c23ee['attribute:status'] = "auth";$v9fe0bb93b257b012f0c9427fb1d48ffd = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);if($v9fe0bb93b257b012f0c9427fb1d48ffd instanceof umiObject) {$vee11cbb19052e40b07aac0ca060c23ee['attribute:login'] = $v9fe0bb93b257b012f0c9427fb1d48ffd->login;}$vee11cbb19052e40b07aac0ca060c23ee['xlink:href'] = $v9fe0bb93b257b012f0c9427fb1d48ffd->xlink;}if($vabb341de59578cc2eefc8b95d451142b = $v8b1dc169bf460ee884fceef66c6607d6->getModule("geoip")) {$vdfc4832c05a0296e4f53eff66626baec = $vabb341de59578cc2eefc8b95d451142b->lookupIp();$vee11cbb19052e40b07aac0ca060c23ee['geo'] = array(     'code'  => $vdfc4832c05a0296e4f53eff66626baec[2],     'country' => $vdfc4832c05a0296e4f53eff66626baec[6],     'region' => $vdfc4832c05a0296e4f53eff66626baec[8],     'city'  => $vdfc4832c05a0296e4f53eff66626baec[1],     'latitude' => $vdfc4832c05a0296e4f53eff66626baec[3],     'longitude' => $vdfc4832c05a0296e4f53eff66626baec[4]    );}$this->globalVariables['user'] = $vee11cbb19052e40b07aac0ca060c23ee;if($v7057e8409c7c531a1a6e9ac3df4ed549) {$this->globalVariables['attribute:pageId'] = $v7057e8409c7c531a1a6e9ac3df4ed549;$this->globalVariables['parents'] = Array();$this->globalVariables['parents']['nodes:page'] = Array();$v587a02d1eb09e2b2fd6514d36a7c3438 = umiHierarchy::getInstance()->getAllParents($v7057e8409c7c531a1a6e9ac3df4ed549);foreach($v587a02d1eb09e2b2fd6514d36a7c3438 as $v72352a4d26581ef082a6d2243c5a6b88) {if($v72352a4d26581ef082a6d2243c5a6b88 == 0) continue;if($va4f09cfeea7392a1f6df6a3de5c3bc9e = umiHierarchy::getInstance()->getElement($v72352a4d26581ef082a6d2243c5a6b88)) {$this->globalVariables['parents']['nodes:page'][] = $va4f09cfeea7392a1f6df6a3de5c3bc9e;}else continue;}$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$this->globalVariables['page'] = $v8e2dcfd7e7e24b1ca76c1193f645902b;templater::pushEditable($v7abdda3251de25a51bf5fb15d7c3391d, $vdb206b4902d295196025b8e70cbb0896, $v7057e8409c7c531a1a6e9ac3df4ed549);}else {if($v7abdda3251de25a51bf5fb15d7c3391d === "content" && $vdb206b4902d295196025b8e70cbb0896 === "content") {header("HTTP/1.0 404 Not Found");header("Status: 404 Not Found");$this->globalVariables['attribute:method'] = "notfound";}}}protected function initXmlDocument() {$vdd988cfd769c9f7fbd795a0f5da8e751 = $this->getXmlDocument();$v173a1756d2d82394cb803161f70f9a38 = $vdd988cfd769c9f7fbd795a0f5da8e751->createElement("result");$vdd988cfd769c9f7fbd795a0f5da8e751->appendChild($v173a1756d2d82394cb803161f70f9a38);$v173a1756d2d82394cb803161f70f9a38->setAttribute('xmlns:xlink', 'http://www.w3.org/TR/xlink');$this->getXmlTranslator()->translateToXml($v173a1756d2d82394cb803161f70f9a38, $this->globalVariables);}public function getXmlDocument() {return $this->domDocument;}public function setXmlDocument(DOMDocument $v9a09b4dfda82e3e665e31092d1c3ec8d) {$this->domDocument = $v9a09b4dfda82e3e665e31092d1c3ec8d;}protected function getXmlTranslator() {return $this->xmlTranslator;}public function parseResult() {$vdd988cfd769c9f7fbd795a0f5da8e751 = $this->getXmlDocument();$vc3aaa7dd2c4cf0305f95e82438b46e82 = new DomDocument;$vc3aaa7dd2c4cf0305f95e82438b46e82->resolveExternals = true;$vc3aaa7dd2c4cf0305f95e82438b46e82->substituteEntities = true;$vc3aaa7dd2c4cf0305f95e82438b46e82->load($this->xslFilePath, DOM_LOAD_OPTIONS);checkXmlError($vc3aaa7dd2c4cf0305f95e82438b46e82);$v801f7201346b43f8ee8390a1ef20ddcd = new xsltProcessor;$v801f7201346b43f8ee8390a1ef20ddcd->registerPHPFunctions();$v818f9c45cfa30eeff277ef38bcbe9910 = errorsXsltListen();$v801f7201346b43f8ee8390a1ef20ddcd->importStyleSheet($vc3aaa7dd2c4cf0305f95e82438b46e82);$this->addRequestParams($v801f7201346b43f8ee8390a1ef20ddcd, $_REQUEST);$this->addRequestParams($v801f7201346b43f8ee8390a1ef20ddcd, $_SERVER, "_");$v9b207167e5381c47682c6b4f58a623fb = $v801f7201346b43f8ee8390a1ef20ddcd->transformToXML($vdd988cfd769c9f7fbd795a0f5da8e751);errorsXsltCheck($v818f9c45cfa30eeff277ef38bcbe9910);return $v9b207167e5381c47682c6b4f58a623fb;}protected function addRequestParams(&$v801f7201346b43f8ee8390a1ef20ddcd, $vf1f713c9e000f5d3f280adbd124df4f5, $v851f5ac9941d720844d143ed9cfcf60a = "") {foreach($vf1f713c9e000f5d3f280adbd124df4f5 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$v3c6e0b8a9c15224a8228b9a98ca1531d = strtolower($v3c6e0b8a9c15224a8228b9a98ca1531d);if(!is_array($v3a6d0284e743dc4a9b86f97d6dd1a3bf)) {$v801f7201346b43f8ee8390a1ef20ddcd->setParameter("", $v851f5ac9941d720844d143ed9cfcf60a . $v3c6e0b8a9c15224a8228b9a98ca1531d, $v3a6d0284e743dc4a9b86f97d6dd1a3bf);}else {$this->addRequestParams($v801f7201346b43f8ee8390a1ef20ddcd, $v3a6d0284e743dc4a9b86f97d6dd1a3bf, $v851f5ac9941d720844d143ed9cfcf60a . $v3c6e0b8a9c15224a8228b9a98ca1531d . ".");}}}public function flushXml() {$vdd988cfd769c9f7fbd795a0f5da8e751 = $this->getXmlDocument();return $vdd988cfd769c9f7fbd795a0f5da8e751->saveXml();}public function loadTemplates($v6a2a431fe8b621037ea949531c28551d, $v4a8a08f09d37b73795649038408b5f33, $args) {$v9b207167e5381c47682c6b4f58a623fb = Array();for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v4a8a08f09d37b73795649038408b5f33;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v9b207167e5381c47682c6b4f58a623fb[$v865c0c0b4ab0e063e5caa3387c1a8741] = Array();}return $v9b207167e5381c47682c6b4f58a623fb;}public function parseTemplate($v21ffce5b8a6cc8cc6a41448dd69623c9) {$v9b207167e5381c47682c6b4f58a623fb = array();foreach($v21ffce5b8a6cc8cc6a41448dd69623c9 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {if(is_null($v3a6d0284e743dc4a9b86f97d6dd1a3bf) || $v3a6d0284e743dc4a9b86f97d6dd1a3bf === false || $v3a6d0284e743dc4a9b86f97d6dd1a3bf === "" || $v3a6d0284e743dc4a9b86f97d6dd1a3bf === 0) continue;$v518d8dec3947df909fe6e4c9940f98a6 = $this->getXmlTranslator()->getSubKey($v3c6e0b8a9c15224a8228b9a98ca1531d);if($v518d8dec3947df909fe6e4c9940f98a6 == "subnodes") {$vde0366a04f7345d0b277b28f9e86f357 = $this->getXmlTranslator()->getRealKey($v3c6e0b8a9c15224a8228b9a98ca1531d);$v9b207167e5381c47682c6b4f58a623fb[$vde0366a04f7345d0b277b28f9e86f357] = array(      'nodes:item' => $v3a6d0284e743dc4a9b86f97d6dd1a3bf     );continue;}$v9b207167e5381c47682c6b4f58a623fb[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $v3a6d0284e743dc4a9b86f97d6dd1a3bf;}return $v9b207167e5381c47682c6b4f58a623fb;}};?>