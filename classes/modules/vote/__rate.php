<?php
 abstract class __rate_vote {public function json_rate($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) getRequest('param0');$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);if(regedit::getInstance()->getVal("//modules/vote/is_graded")) {$v12879fe24168807c1ef38cd5e580ee3a = (int) getRequest('param1');if($v12879fe24168807c1ef38cd5e580ee3a > 5) $v12879fe24168807c1ef38cd5e580ee3a = 5;if($v12879fe24168807c1ef38cd5e580ee3a < 0) $v12879fe24168807c1ef38cd5e580ee3a = 0;}else {$v12879fe24168807c1ef38cd5e580ee3a = ((bool) getRequest('param1')) ? 1 : -1;}xslTemplater::getInstance()->setIsInited(false);list($v1fa430067bff4b562b4fea311608025d, $vd05436474f7bcb2bbf127041efa0e1ec, $v283cdf44ea49ed943b1a0a6398c53e07, $v01e4e8f290a9861b994d42021d6e817d) = def_module::loadTemplates("tpls/vote/rate/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "rate_ok", "rate_not_found", "rate_rated", "rate_permitted");if($vd4b57c8b8ab85804d1657273cb5a9ef8 = (bool) regedit::getInstance()->getVal("//modules/vote/is_private")) {$v24af3aa6132f2de2388dc4d034732920 = cmsController::getInstance()->getModule("users");if(!$v24af3aa6132f2de2388dc4d034732920->is_auth()) {header("Content-type: text/javascript; charset=utf-8");$v01e4e8f290a9861b994d42021d6e817d = def_module::parseTemplate($v01e4e8f290a9861b994d42021d6e817d, $vfca1bff8ad8b3a8585abfb0ad523ba42, $v7057e8409c7c531a1a6e9ac3df4ed549);$this->flush($v01e4e8f290a9861b994d42021d6e817d);}}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['request_id'] = getRequest('requestId');if($v8e2dcfd7e7e24b1ca76c1193f645902b) {$vfca1bff8ad8b3a8585abfb0ad523ba42['element_id'] = $v7057e8409c7c531a1a6e9ac3df4ed549;if(self::getIsRated($v7057e8409c7c531a1a6e9ac3df4ed549)) {$v954859ad4e0f0387e880de7688cb3612 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("rate_voters");$v10e37297de2ec3a4b159f8c8626b64a5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("rate_sum");$v9b207167e5381c47682c6b4f58a623fb = $v283cdf44ea49ed943b1a0a6398c53e07;}else {$v954859ad4e0f0387e880de7688cb3612 = (int) $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("rate_voters");$v10e37297de2ec3a4b159f8c8626b64a5 = (int) $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("rate_sum") + (int) $v12879fe24168807c1ef38cd5e580ee3a;$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("rate_voters", ++$v954859ad4e0f0387e880de7688cb3612);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("rate_sum", $v10e37297de2ec3a4b159f8c8626b64a5);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("rate", round($v10e37297de2ec3a4b159f8c8626b64a5 / $v954859ad4e0f0387e880de7688cb3612, 2));$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();umiHierarchy::getInstance()->unloadElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v9b207167e5381c47682c6b4f58a623fb = $v1fa430067bff4b562b4fea311608025d;self::setIsRated($v7057e8409c7c531a1a6e9ac3df4ed549);}$vfca1bff8ad8b3a8585abfb0ad523ba42['current_rating'] = $v10e37297de2ec3a4b159f8c8626b64a5 / $v954859ad4e0f0387e880de7688cb3612;}else {$v9b207167e5381c47682c6b4f58a623fb = $vd05436474f7bcb2bbf127041efa0e1ec;}$v9b207167e5381c47682c6b4f58a623fb = def_module::parseTemplate($v9b207167e5381c47682c6b4f58a623fb, $vfca1bff8ad8b3a8585abfb0ad523ba42, $v7057e8409c7c531a1a6e9ac3df4ed549);header("Content-type: text/javascript; charset=utf-8");$this->flush($v9b207167e5381c47682c6b4f58a623fb);}public function getElementRating($v7057e8409c7c531a1a6e9ac3df4ed549) {$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);if (!$v8e2dcfd7e7e24b1ca76c1193f645902b) return '';$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$vfca1bff8ad8b3a8585abfb0ad523ba42['rate_sum'] = (int) $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("rate_sum");$vfca1bff8ad8b3a8585abfb0ad523ba42['rate_voters'] = (int) $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("rate_voters");$vfca1bff8ad8b3a8585abfb0ad523ba42['is_rated'] = self::getIsRated($v7057e8409c7c531a1a6e9ac3df4ed549);if ($vfca1bff8ad8b3a8585abfb0ad523ba42['rate_voters'] > 0) {$vfca1bff8ad8b3a8585abfb0ad523ba42['rate'] = round($vfca1bff8ad8b3a8585abfb0ad523ba42['rate_sum'] / $vfca1bff8ad8b3a8585abfb0ad523ba42['rate_voters'], 2);$vfca1bff8ad8b3a8585abfb0ad523ba42['ceil_rate'] = round($vfca1bff8ad8b3a8585abfb0ad523ba42['rate']);}return def_module::parseTemplate("", $vfca1bff8ad8b3a8585abfb0ad523ba42, $v7057e8409c7c531a1a6e9ac3df4ed549);}public static function getIsRated($v7057e8409c7c531a1a6e9ac3df4ed549) {$vd4b57c8b8ab85804d1657273cb5a9ef8 = (bool) regedit::getInstance()->getVal("//modules/vote/is_private");if($vd4b57c8b8ab85804d1657273cb5a9ef8) {$v24af3aa6132f2de2388dc4d034732920 = cmsController::getInstance()->getModule("users");$ve8701ad48ba05a91604e480dd60899a3 = $v24af3aa6132f2de2388dc4d034732920->user_id;$vee11cbb19052e40b07aac0ca060c23ee = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);$v2c8c492c00fa4d258bf80ef67d0bb96c = $vee11cbb19052e40b07aac0ca060c23ee->getValue("rated_pages");$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);return in_array($v8e2dcfd7e7e24b1ca76c1193f645902b, $v2c8c492c00fa4d258bf80ef67d0bb96c);}return is_array(getSession('rated')) && in_array($v7057e8409c7c531a1a6e9ac3df4ed549, getSession('rated'));}public static function setIsRated($v7057e8409c7c531a1a6e9ac3df4ed549) {$vd4b57c8b8ab85804d1657273cb5a9ef8 = (bool) regedit::getInstance()->getVal("//modules/vote/is_private");if($vd4b57c8b8ab85804d1657273cb5a9ef8) {$v24af3aa6132f2de2388dc4d034732920 = cmsController::getInstance()->getModule("users");$ve8701ad48ba05a91604e480dd60899a3 = $v24af3aa6132f2de2388dc4d034732920->user_id;$vee11cbb19052e40b07aac0ca060c23ee = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v2c8c492c00fa4d258bf80ef67d0bb96c = $vee11cbb19052e40b07aac0ca060c23ee->getValue("rated_pages");$v2c8c492c00fa4d258bf80ef67d0bb96c[] = $v8e2dcfd7e7e24b1ca76c1193f645902b;$vee11cbb19052e40b07aac0ca060c23ee->setValue("rated_pages", $v2c8c492c00fa4d258bf80ef67d0bb96c);$vee11cbb19052e40b07aac0ca060c23ee->commit();}if(!is_array(getSession('rated'))) {$_SESSION['rated'] = Array();}$_SESSION['rated'][] = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;}};?>