<?php
 class umiDistrReader {protected $distrFilePath, $fh;public  $signature = "ucp", $author, $comment, $timestamp, $totalSize;protected $version = "1.0.0";public function __construct($vfa03d051a60ae017e45ababa450025bc) {if(!is_file($vfa03d051a60ae017e45ababa450025bc)) {throw new Exception("Distributive file \"{$vfa03d051a60ae017e45ababa450025bc}\" doesn't exists", E_USER_ERROR);}$this->distrFilePath = $vfa03d051a60ae017e45ababa450025bc;$this->readHeader();}public function __destruct() {if(is_resource($this->fh)) {fclose($this->fh);}}protected function readHeader() {if(!is_readable($this->distrFilePath)) {throw new Exception("Distributive file \"{$this->distrFilePath}\" is not readable", E_USER_ERROR);}$this->fh = $v8fa14cdd754f91cc6554c9e71929cce7 = fopen($this->distrFilePath, "r");fseek($v8fa14cdd754f91cc6554c9e71929cce7, 0);if(stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 5, "\0") != $this->signature) {throw new Exception("Distributive file corrupted: wrong signature", E_USER_ERROR);return false;}fseek($v8fa14cdd754f91cc6554c9e71929cce7, 5);if(version_compare($v3680337aa2756317b4f51911126a75df = stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 5, "\0"), $this->version, "<=") != 1) {throw new Exception("You need installer at least version {$v3680337aa2756317b4f51911126a75df} to read this distribute file", E_USER_ERROR);return false;}fseek($v8fa14cdd754f91cc6554c9e71929cce7, 10);$this->timestamp = (int) stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 15, "\0");fseek($v8fa14cdd754f91cc6554c9e71929cce7, 25);$this->totalSize = (int) stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 25, "\0");fseek($v8fa14cdd754f91cc6554c9e71929cce7, 50);$this->author = (string) stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 25, "\0");fseek($v8fa14cdd754f91cc6554c9e71929cce7, 75);$this->comment = (string) stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 330, "\0");fseek($v8fa14cdd754f91cc6554c9e71929cce7, 331);}public function getNextResource($v5e0bdcbddccca4d66d74ba8c1cee1a68 = false) {$v8fa14cdd754f91cc6554c9e71929cce7 = $this->fh;if($v5e0bdcbddccca4d66d74ba8c1cee1a68 !== false) {fseek($v8fa14cdd754f91cc6554c9e71929cce7, $v5e0bdcbddccca4d66d74ba8c1cee1a68);}$v83878c91171338902e0fe0fb97a8c47a = ftell($v8fa14cdd754f91cc6554c9e71929cce7);$v480d1b61a0432d1319f7504a3d7318dd = (int) stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 25, "\0");fseek($v8fa14cdd754f91cc6554c9e71929cce7, $v83878c91171338902e0fe0fb97a8c47a + 25);$v214db69b84e8e3579228ff9279bfd837 = (string) stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, $v480d1b61a0432d1319f7504a3d7318dd);if(strlen($v214db69b84e8e3579228ff9279bfd837) == $v480d1b61a0432d1319f7504a3d7318dd) {$vbe8f80182e0c983916da7338c2c1c040 = unserialize(base64_decode($v214db69b84e8e3579228ff9279bfd837));return $vbe8f80182e0c983916da7338c2c1c040;}else {return false;}}public function getCurrentPos() {return ftell($this->fh);}};abstract class umiDistrInstallItem {abstract public function __construct($v47826cacc65c665212b821e6ff80b9b0 = false);abstract public function pack();abstract public static function unpack($v8d777f385d3dfec8815d20f7496026dc);abstract public function restore();abstract public function getDescription();};class umiDistrFolder extends umiDistrInstallItem {protected $filePath, $permissions;public function __construct($v47826cacc65c665212b821e6ff80b9b0 = false) {if($v47826cacc65c665212b821e6ff80b9b0 !== false) {$this->filePath = $v47826cacc65c665212b821e6ff80b9b0;$this->permissions = fileperms($v47826cacc65c665212b821e6ff80b9b0) & 0x1FF;}}public function pack() {return base64_encode(serialize($this));}public static function unpack($v8d777f385d3dfec8815d20f7496026dc) {return base64_decode(unserialize($v8d777f385d3dfec8815d20f7496026dc));}public function restore() {$this->filePath = str_replace("\\", "/", $this->filePath);if(!file_exists($this->filePath)) {$va93b85dcfbb9969f5bb3c6be71737ed5 = pathinfo($this->filePath);if(is_dir($va93b85dcfbb9969f5bb3c6be71737ed5['dirname'])) {if(is_writable(dirname($this->filePath))) {mkdir($this->filePath);}else {throw new Exception("Folder {$this->filePath} is not writable");}}}if(is_dir($this->filePath)) {if(function_exists("posix_getuid")) {@chmod($this->filePath, $this->permissions);return true;}}else {return false;}}public function getDescription() {$this->filePath = str_replace("\\", "/", $this->filePath);return $this->filePath;}};class umiDistrFile extends umiDistrInstallItem {protected $filePath, $permissions, $content;public function __construct($v47826cacc65c665212b821e6ff80b9b0 = false) {if($v47826cacc65c665212b821e6ff80b9b0 !== false) {$this->filePath = $v47826cacc65c665212b821e6ff80b9b0;$this->permissions = fileperms($v47826cacc65c665212b821e6ff80b9b0) & 0x1FF;$this->content = file_get_contents($v47826cacc65c665212b821e6ff80b9b0);}}public function pack() {return base64_encode(serialize($this));}public static function unpack($v8d777f385d3dfec8815d20f7496026dc) {return base64_decode(unserialize($v8d777f385d3dfec8815d20f7496026dc));}public function restore() {$this->filePath = str_replace("\\", "/", $this->filePath);if(!is_file($this->filePath)) {$v954eef6d6eac59aca304b6d7abb4fb3e = dirname($this->filePath);if(!is_dir($v954eef6d6eac59aca304b6d7abb4fb3e)) {throw new Exception("Directory {$v954eef6d6eac59aca304b6d7abb4fb3e} doesn't exists");}if(!is_writable($v954eef6d6eac59aca304b6d7abb4fb3e)) {throw new Exception("Directory {$v954eef6d6eac59aca304b6d7abb4fb3e} is not writable");}file_put_contents($this->filePath, $this->content);}if(is_file($this->filePath)) {if(!is_writable($this->filePath)) {throw new Exception("File {$this->filePath} is not writable");}if(function_exists("posix_getuid")) {@chmod($this->filePath, $this->permissions);}file_put_contents($this->filePath, $this->content);return true;}else {throw new Exception("Failed to create file (\"{$this->filePath}\")", E_USER_ERROR);return false;}}public function getDescription() {$this->filePath = str_replace("\\", "/", $this->filePath);return $this->filePath;}};class umiDistrMySql extends umiDistrInstallItem {protected $tableName, $permissions, $sqls = Array();public function __construct($v80071f37861c360a27b7327e132c911a = false) {if($v80071f37861c360a27b7327e132c911a !== false) {$this->tableName = $v80071f37861c360a27b7327e132c911a;$this->readTableDefinition();$this->readData();}}public function pack() {return base64_encode(serialize($this));}public static function unpack($v8d777f385d3dfec8815d20f7496026dc) {return base64_decode(unserialize($v8d777f385d3dfec8815d20f7496026dc));}public function restore() {$vac5c74b64b4b8352ef2f181affb5ac2a = "DROP TABLE IF EXISTS {$this->tableName}";mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($this->tableName == 'cms3_object_content') {$vac5c74b64b4b8352ef2f181affb5ac2a = "SHOW TABLES LIKE 'cms3_object_content%'";$result = mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($vaafb96b2fa8806be307c4496867bad56) = mysql_fetch_row($result)) {mysql_query("DROP TABLE {$vaafb96b2fa8806be307c4496867bad56}");}}$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($this->sqls);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vac5c74b64b4b8352ef2f181affb5ac2a = $this->sqls[$v865c0c0b4ab0e063e5caa3387c1a8741];if($v865c0c0b4ab0e063e5caa3387c1a8741 == 0) {$vac5c74b64b4b8352ef2f181affb5ac2a = str_replace("\"", "`", $vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a .= " ENGINE=InnoDb";}mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new Exception("Error while creating table {$this->tableName}: " . $v56bd7107802ebe56c6918992f0608ec6);}}}protected function readTableDefinition() {$vac5c74b64b4b8352ef2f181affb5ac2a = "SHOW CREATE TABLE {$this->tableName}";$result = mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list(, $v568d8e07bbe5575518d5005e559743c3) = mysql_fetch_row($result);$this->sqls[] = $v568d8e07bbe5575518d5005e559743c3;}protected function readData() {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT * FROM {$this->tableName}";$result = mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($result)) {$this->sqls[] = $this->generateInsertRow($vf1965a857bc285d26fe22023aa5ab50d);}}protected function generateInsertRow($vf1965a857bc285d26fe22023aa5ab50d) {$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO {$this->tableName} (";$vd05b6ed7d2345020440df396d6da7f73 = array_keys($vf1965a857bc285d26fe22023aa5ab50d);$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($vd05b6ed7d2345020440df396d6da7f73);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vac5c74b64b4b8352ef2f181affb5ac2a .= $vd05b6ed7d2345020440df396d6da7f73[$v865c0c0b4ab0e063e5caa3387c1a8741];if($v865c0c0b4ab0e063e5caa3387c1a8741 < ($v7dabf5c198b0bab2eaa42bb03a113e55 - 1)) {$vac5c74b64b4b8352ef2f181affb5ac2a .= ", ";}}unset($vd05b6ed7d2345020440df396d6da7f73);$vac5c74b64b4b8352ef2f181affb5ac2a .= ") VALUES(";$vf09cc7ee3a9a93273f4b80601cafb00c = array_values($vf1965a857bc285d26fe22023aa5ab50d);$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($vf09cc7ee3a9a93273f4b80601cafb00c);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vac5c74b64b4b8352ef2f181affb5ac2a .= "'" . mysql_escape_string($vf09cc7ee3a9a93273f4b80601cafb00c[$v865c0c0b4ab0e063e5caa3387c1a8741]) . "'";if($v865c0c0b4ab0e063e5caa3387c1a8741 < ($v7dabf5c198b0bab2eaa42bb03a113e55 - 1)) {$vac5c74b64b4b8352ef2f181affb5ac2a .= ", ";}}unset($vf09cc7ee3a9a93273f4b80601cafb00c);$vac5c74b64b4b8352ef2f181affb5ac2a .= ")";return $vac5c74b64b4b8352ef2f181affb5ac2a;}public function getDescription() {return $this->tableName;}};?>