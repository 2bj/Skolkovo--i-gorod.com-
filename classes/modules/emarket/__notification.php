<?php
 abstract class __emarket_notification {public function notifyOrderStatusChange(order $v70a17ffa722a3985b86d30b034ad06d7, $v72e0c0d64040e3df53850d24c2757461) {$v70a17ffa722a3985b86d30b034ad06d7->need_export = true;if($v72e0c0d64040e3df53850d24c2757461 == "status_id") {$v70a17ffa722a3985b86d30b034ad06d7->status_change_date = new umiDate();}if(order::getCodeByStatus($v70a17ffa722a3985b86d30b034ad06d7->getPaymentStatus()) == "accepted" && !$v70a17ffa722a3985b86d30b034ad06d7->delivery_allow_date) {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('emarket', 'delivery');if($v8be74552df93e31bbdd6b36ed74bdb6a->length) {$v70a17ffa722a3985b86d30b034ad06d7->delivery_allow_date = new umiDate();}}$v03c07d5bea3270c79066ec0a8b6b5d28 = $v70a17ffa722a3985b86d30b034ad06d7->getValue($v72e0c0d64040e3df53850d24c2757461);$vadceddddb69e6187bceace83aa4ab0f6 = order::getCodeByStatus($v03c07d5bea3270c79066ec0a8b6b5d28);if($v72e0c0d64040e3df53850d24c2757461 == 'status_id' && (!$v03c07d5bea3270c79066ec0a8b6b5d28 || $vadceddddb69e6187bceace83aa4ab0f6 == 'payment')) return;$this->sendCustomerNotification($v70a17ffa722a3985b86d30b034ad06d7, $v72e0c0d64040e3df53850d24c2757461, $vadceddddb69e6187bceace83aa4ab0f6);if($v72e0c0d64040e3df53850d24c2757461 == 'status_id' && $vadceddddb69e6187bceace83aa4ab0f6 == 'waiting') {$this->sendManagerNotification($v70a17ffa722a3985b86d30b034ad06d7);}}public function sendCustomerNotification(order $v70a17ffa722a3985b86d30b034ad06d7, $vca349097527794aa9fab85bf9d79d5e8, $vadceddddb69e6187bceace83aa4ab0f6) {$v91ec1f9324753048c0096d036a694f86 = umiObjectsCollection::getInstance()->getObject($v70a17ffa722a3985b86d30b034ad06d7->getCustomerId());$v0c83f57c786a0b4a39efab23731c7ebc    = $v91ec1f9324753048c0096d036a694f86->email ? $v91ec1f9324753048c0096d036a694f86->email : $v91ec1f9324753048c0096d036a694f86->getValue("e-mail");if($v0c83f57c786a0b4a39efab23731c7ebc) {$vb068931cc450442b63f5b3d276ea4297  = $v91ec1f9324753048c0096d036a694f86->lname . " " .$v91ec1f9324753048c0096d036a694f86->fname . " " . $v91ec1f9324753048c0096d036a694f86->father_name;$v5a05866850c28651fe234659f6c92ada = cmsController::getInstance()->langs;$v3558de09c5e26943bdd79a898f00e57d = "";switch($vca349097527794aa9fab85bf9d79d5e8) {case 'status_id' : {if($vadceddddb69e6187bceace83aa4ab0f6 == 'waiting') {$vf9236f061aba83e3a0534e4746ab7762 = order::getCodeByStatus($v70a17ffa722a3985b86d30b034ad06d7->getPaymentStatus());$v326c06328813b0030847b99a605990f3 = 'notification-status-payment-' . $vf9236f061aba83e3a0534e4746ab7762;$v8795c748789888942a34659930cec654 = 'notification-status-' . $vadceddddb69e6187bceace83aa4ab0f6;$v3558de09c5e26943bdd79a898f00e57d = ($vf9236f061aba83e3a0534e4746ab7762 == 'initialized') ?                        ( (isset($v5a05866850c28651fe234659f6c92ada[$v8795c748789888942a34659930cec654]) ? ($v5a05866850c28651fe234659f6c92ada[$v8795c748789888942a34659930cec654] . " " . $v5a05866850c28651fe234659f6c92ada['notification-and']) : "") . (isset($v5a05866850c28651fe234659f6c92ada[$v326c06328813b0030847b99a605990f3]) ? (" ".$v5a05866850c28651fe234659f6c92ada[$v326c06328813b0030847b99a605990f3]) : "" ) ) :            ( (isset($v5a05866850c28651fe234659f6c92ada[$v326c06328813b0030847b99a605990f3]) ? ($v5a05866850c28651fe234659f6c92ada[$v326c06328813b0030847b99a605990f3] . " " . $v5a05866850c28651fe234659f6c92ada['notification-and']) : "") . (isset($v5a05866850c28651fe234659f6c92ada[$v8795c748789888942a34659930cec654]) ? (" ".$v5a05866850c28651fe234659f6c92ada[$v8795c748789888942a34659930cec654]) : "" ) );}else {$v3c6e0b8a9c15224a8228b9a98ca1531d = 'notification-status-' . $vadceddddb69e6187bceace83aa4ab0f6;$v3558de09c5e26943bdd79a898f00e57d = isset($v5a05866850c28651fe234659f6c92ada[$v3c6e0b8a9c15224a8228b9a98ca1531d]) ? $v5a05866850c28651fe234659f6c92ada[$v3c6e0b8a9c15224a8228b9a98ca1531d] : "_";}break;}case 'payment_status_id': {$v3c6e0b8a9c15224a8228b9a98ca1531d = 'notification-status-payment-' . $vadceddddb69e6187bceace83aa4ab0f6;$v3558de09c5e26943bdd79a898f00e57d = isset($v5a05866850c28651fe234659f6c92ada[$v3c6e0b8a9c15224a8228b9a98ca1531d]) ? $v5a05866850c28651fe234659f6c92ada[$v3c6e0b8a9c15224a8228b9a98ca1531d] : "_";break;}case 'delivery_status_id': {$v3c6e0b8a9c15224a8228b9a98ca1531d = 'notification-status-delivery-' . $vadceddddb69e6187bceace83aa4ab0f6;$v3558de09c5e26943bdd79a898f00e57d = isset($v5a05866850c28651fe234659f6c92ada[$v3c6e0b8a9c15224a8228b9a98ca1531d]) ? $v5a05866850c28651fe234659f6c92ada[$v3c6e0b8a9c15224a8228b9a98ca1531d] : "_";break;}}$v8ce1a19060c7f3777242272261830ee1 = xslTemplater::getInstance();$v56083788416cdf82813e528787bdaced = $v8ce1a19060c7f3777242272261830ee1->setIsInited(false);$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectsCollection::getInstance();$vaa5d593390f7a6d87b33f23abd358a19 = $vdb6d9b451b818ccc9a449383f2f0c450->getObject($v70a17ffa722a3985b86d30b034ad06d7->payment_id);if($vaa5d593390f7a6d87b33f23abd358a19) {$vb48020bb47e1a3cff51727ed69c382a1   = $vdb6d9b451b818ccc9a449383f2f0c450->getObject($vaa5d593390f7a6d87b33f23abd358a19->payment_type_id);$vfa9610232b5d98c6fb8f2701adf38a05 = $vb48020bb47e1a3cff51727ed69c382a1->class_name;}else {$vfa9610232b5d98c6fb8f2701adf38a05 = null;}$v918d83c715c19dd93ff49f87e2fae0b3  = ($vfa9610232b5d98c6fb8f2701adf38a05 == "receipt") ? "status_notification_receipt" : "status_notification";list($v66f6181bcb4cff4cd38fbc804a036db6) = def_module::loadTemplates("tpls/emarket/mail/default.tpl", $v918d83c715c19dd93ff49f87e2fae0b3);$veca07335a33c5aeb5e1bc7c98b4b9d80 = array();$veca07335a33c5aeb5e1bc7c98b4b9d80["order_id"]   = $v70a17ffa722a3985b86d30b034ad06d7->id;$veca07335a33c5aeb5e1bc7c98b4b9d80["order_name"] = $v70a17ffa722a3985b86d30b034ad06d7->name;$veca07335a33c5aeb5e1bc7c98b4b9d80["order_number"] = $v70a17ffa722a3985b86d30b034ad06d7->number;$veca07335a33c5aeb5e1bc7c98b4b9d80["status"]     = $v3558de09c5e26943bdd79a898f00e57d;if($vfa9610232b5d98c6fb8f2701adf38a05 == "receipt") {$veca07335a33c5aeb5e1bc7c98b4b9d80["receipt_signature"] = sha1("{$v91ec1f9324753048c0096d036a694f86->id}:{$v91ec1f9324753048c0096d036a694f86->email}:{$v70a17ffa722a3985b86d30b034ad06d7->order_date}");}$v9a0364b9e99bb480dd25e1f0284c8555 = def_module::parseTemplate($v66f6181bcb4cff4cd38fbc804a036db6, $veca07335a33c5aeb5e1bc7c98b4b9d80);$v8ce1a19060c7f3777242272261830ee1->setIsInited($v56083788416cdf82813e528787bdaced);$vb1444fb0c07653567ad325aa25d4e37a  = regedit::getInstance();$vf5b75010ea8a54b96f8fe7dafac65c18   = new umiMail();$vf5b75010ea8a54b96f8fe7dafac65c18->addRecipient($v0c83f57c786a0b4a39efab23731c7ebc, $vb068931cc450442b63f5b3d276ea4297);$vf5b75010ea8a54b96f8fe7dafac65c18->setFrom($vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/emarket/from-email'),         $vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/emarket/from-name'));$vf5b75010ea8a54b96f8fe7dafac65c18->setSubject($v5a05866850c28651fe234659f6c92ada['notification-status-subject']);$vf5b75010ea8a54b96f8fe7dafac65c18->setContent($v9a0364b9e99bb480dd25e1f0284c8555);$vf5b75010ea8a54b96f8fe7dafac65c18->commit();$vf5b75010ea8a54b96f8fe7dafac65c18->send();}}public function sendManagerNotification(order $v70a17ffa722a3985b86d30b034ad06d7) {$vb1444fb0c07653567ad325aa25d4e37a  = regedit::getInstance();$v0c83f57c786a0b4a39efab23731c7ebc   = $vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/emarket/manager-email');if(!strlen($v0c83f57c786a0b4a39efab23731c7ebc)) return;$v8ce1a19060c7f3777242272261830ee1 = xslTemplater::getInstance();$v56083788416cdf82813e528787bdaced = $v8ce1a19060c7f3777242272261830ee1->setIsInited(false);list($v66f6181bcb4cff4cd38fbc804a036db6) = def_module::loadTemplates("tpls/emarket/mail/default.tpl", "neworder_notification");try {$vf83c2a85d972a89238f31296c63f0dbc = payment::get($v70a17ffa722a3985b86d30b034ad06d7->payment_id);$v59985644607259484f714d567cf61e8c  = $vf83c2a85d972a89238f31296c63f0dbc->name;$vb566652f43edab8a3e305f16a9428123  = order::getCodeByStatus($v70a17ffa722a3985b86d30b034ad06d7->getPaymentStatus());}catch(coreException $ve1671797c52e15f763380b45e841ec32) {$v59985644607259484f714d567cf61e8c  = "";$vb566652f43edab8a3e305f16a9428123  = "";}$v9a0364b9e99bb480dd25e1f0284c8555 = def_module::parseTemplate($v66f6181bcb4cff4cd38fbc804a036db6, array("order_id"     => $v70a17ffa722a3985b86d30b034ad06d7->id,                  "order_name"   => $v70a17ffa722a3985b86d30b034ad06d7->name,                  "order_number" => $v70a17ffa722a3985b86d30b034ad06d7->number,                  "payment_type" => $v59985644607259484f714d567cf61e8c,                  "payment_status" => $vb566652f43edab8a3e305f16a9428123,                  "price"        => $v70a17ffa722a3985b86d30b034ad06d7->getActualPrice(),                  ));$v8ce1a19060c7f3777242272261830ee1->setIsInited($v56083788416cdf82813e528787bdaced);$v5a05866850c28651fe234659f6c92ada = cmsController::getInstance()->langs;$vf5b75010ea8a54b96f8fe7dafac65c18 = new umiMail();$vf5b75010ea8a54b96f8fe7dafac65c18->addRecipient($v0c83f57c786a0b4a39efab23731c7ebc);$vf5b75010ea8a54b96f8fe7dafac65c18->setFrom($vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/emarket/from-email'),        $vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/emarket/from-name'));$vf5b75010ea8a54b96f8fe7dafac65c18->setSubject($v5a05866850c28651fe234659f6c92ada['notification-neworder-subject'] . " (#{$v70a17ffa722a3985b86d30b034ad06d7->number})");$vf5b75010ea8a54b96f8fe7dafac65c18->setContent($v9a0364b9e99bb480dd25e1f0284c8555);$vf5b75010ea8a54b96f8fe7dafac65c18->commit();$vf5b75010ea8a54b96f8fe7dafac65c18->send();}};?>