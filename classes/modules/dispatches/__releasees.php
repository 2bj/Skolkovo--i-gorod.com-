<?php
 abstract class __releasees_releasees {private $arrReleasees = array();public function getNewReleaseInstanceId($v48a1815cdd3ea285c80e708c16b439fc = false) {if (!$v48a1815cdd3ea285c80e708c16b439fc) {$v48a1815cdd3ea285c80e708c16b439fc = getRequest("param0");}$v6ddfc58f41216767bf09678f7b4b625e = false;if (isset($v5f29827cd6aa173c5ce1940a8646bba1[$v48a1815cdd3ea285c80e708c16b439fc])) {$v6ddfc58f41216767bf09678f7b4b625e = $v5f29827cd6aa173c5ce1940a8646bba1[$v48a1815cdd3ea285c80e708c16b439fc];}else {$v3d419c49644abd564f8cb6fdecc592ca = new umiSelection;$v3d419c49644abd564f8cb6fdecc592ca->setObjectTypeFilter();$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "release")->getId();$v5bda0f9e0217addfbf4c5cd813606c92 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$vdb41887ee1ba3f6365e3ea649da2bd47 = umiObjectTypesCollection::getInstance()->getType($v5bda0f9e0217addfbf4c5cd813606c92);$v3d419c49644abd564f8cb6fdecc592ca->addObjectType($v5bda0f9e0217addfbf4c5cd813606c92);$v3d419c49644abd564f8cb6fdecc592ca->setPropertyFilter();$v3d419c49644abd564f8cb6fdecc592ca->addPropertyFilterIsNull($vdb41887ee1ba3f6365e3ea649da2bd47->getFieldId('status'), 0, true);$v3d419c49644abd564f8cb6fdecc592ca->addPropertyFilterEqual($vdb41887ee1ba3f6365e3ea649da2bd47->getFieldId('disp_reference'), $v48a1815cdd3ea285c80e708c16b439fc);$v1c0742f6c0ec3c1ff468040904993b8a = umiSelectionsParser::runSelection($v3d419c49644abd564f8cb6fdecc592ca);$v7c81ca33db788583d4876b8695215f08 = false;if (is_array($v1c0742f6c0ec3c1ff468040904993b8a) && isset($v1c0742f6c0ec3c1ff468040904993b8a[0])) {$v6ddfc58f41216767bf09678f7b4b625e = $v1c0742f6c0ec3c1ff468040904993b8a[0];$v506a74ef5d3f17cb41ad70330e105c2c = umiObjectsCollection::getInstance()->getObject($v6ddfc58f41216767bf09678f7b4b625e);}else {$v6ddfc58f41216767bf09678f7b4b625e = umiObjectsCollection::getInstance()->addObject("", $v5bda0f9e0217addfbf4c5cd813606c92);$v7c81ca33db788583d4876b8695215f08 = true;}$v506a74ef5d3f17cb41ad70330e105c2c = umiObjectsCollection::getInstance()->getObject($v6ddfc58f41216767bf09678f7b4b625e);if ($v506a74ef5d3f17cb41ad70330e105c2c instanceof umiObject) {if ($v7c81ca33db788583d4876b8695215f08) {$v506a74ef5d3f17cb41ad70330e105c2c->setName('-');$v506a74ef5d3f17cb41ad70330e105c2c->setValue('status', false);$v506a74ef5d3f17cb41ad70330e105c2c->setValue('disp_reference', $v48a1815cdd3ea285c80e708c16b439fc);$v506a74ef5d3f17cb41ad70330e105c2c->commit();}$v5f29827cd6aa173c5ce1940a8646bba1[$v48a1815cdd3ea285c80e708c16b439fc] = $v506a74ef5d3f17cb41ad70330e105c2c->getId();}}return $v6ddfc58f41216767bf09678f7b4b625e;}public function fill_release($v7869befb76ea7c96c9dce0e116588ef9 = false, $v3a3c71719ef77e253db10d88b4456814 = false) {$v48a1815cdd3ea285c80e708c16b439fc = $v7869befb76ea7c96c9dce0e116588ef9 ? $v7869befb76ea7c96c9dce0e116588ef9 : getRequest('param0');$v957a440fc90ceb51983c3285530dd8cc = umiObjectsCollection::getInstance()->getObject($v48a1815cdd3ea285c80e708c16b439fc);if ($v957a440fc90ceb51983c3285530dd8cc instanceof umiObject) {$v6ddfc58f41216767bf09678f7b4b625e = $this->getNewReleaseInstanceId($v48a1815cdd3ea285c80e708c16b439fc);$v3ebdaf01a52db720060ad11add63141d = $v957a440fc90ceb51983c3285530dd8cc->getValue("news_relation");$v0030db21814668e0fa99071f526e4e86 = umiHierarchy::getInstance()->getObjectInstances($v3ebdaf01a52db720060ad11add63141d, false, true);$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "release")->getId();$v5bda0f9e0217addfbf4c5cd813606c92 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$vdb41887ee1ba3f6365e3ea649da2bd47 = umiObjectTypesCollection::getInstance()->getType($v5bda0f9e0217addfbf4c5cd813606c92);$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setObjectTypeFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v5bda0f9e0217addfbf4c5cd813606c92);$v8be74552df93e31bbdd6b36ed74bdb6a->setPropertyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($vdb41887ee1ba3f6365e3ea649da2bd47->getFieldId('disp_reference'), $v48a1815cdd3ea285c80e708c16b439fc);$v97bad054a676c4eb8b148399f4ecabea =  umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);if (count($v0030db21814668e0fa99071f526e4e86)) {$vdada7698e90003048a305e981875250f = (int) $v0030db21814668e0fa99071f526e4e86[0];$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("news", "item")->getId();$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("news", "item");$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795);$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($vdada7698e90003048a305e981875250f, 0, true);$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit(50);$v8be74552df93e31bbdd6b36ed74bdb6a->setIsLangIgnored(true);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);for ($v168965c34d6a1fd6ad3d68aa5e76ae56 = 0;$v168965c34d6a1fd6ad3d68aa5e76ae56 < count($result);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$v5fe46bc3d512b2d22f8fbdd5a216478c = $result[$v168965c34d6a1fd6ad3d68aa5e76ae56];$v6e1116f12f4d205a51c62a5af0a40927 = umiHierarchy::getInstance()->getElement($v5fe46bc3d512b2d22f8fbdd5a216478c);if ($v6e1116f12f4d205a51c62a5af0a40927 instanceof umiHierarchyElement) {$vfc19ae0e7cb9076cc4077381bbe0b168 = $v6e1116f12f4d205a51c62a5af0a40927->getName();$v5047d8b42685c9b77af376220c71ad73 = $v6e1116f12f4d205a51c62a5af0a40927->getValue('h1');$v4267305bf921871dbce91dface3515e3 = $v6e1116f12f4d205a51c62a5af0a40927->getValue('anons');$vc32e13633ba3c3faea1235c6bf43328c = $v6e1116f12f4d205a51c62a5af0a40927->getValue('content');$vb2f507299419aae36ac0e7dbe5821ff0 = $v6e1116f12f4d205a51c62a5af0a40927->getValue('publish_time');if(!strlen($vc32e13633ba3c3faea1235c6bf43328c)) $vc32e13633ba3c3faea1235c6bf43328c = $v4267305bf921871dbce91dface3515e3;$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "message")->getId();$v78eeb37a9161c69d9b97bf9b09a50018 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$v615f76a008a7453051904597fd1612a6 = umiObjectTypesCollection::getInstance()->getType($v78eeb37a9161c69d9b97bf9b09a50018);$v770c309c1aed0fbfabad24a3d5933129 = new umiSelection;$v770c309c1aed0fbfabad24a3d5933129->setObjectTypeFilter();$v770c309c1aed0fbfabad24a3d5933129->addObjectType($v78eeb37a9161c69d9b97bf9b09a50018);$v770c309c1aed0fbfabad24a3d5933129->setPropertyFilter();$v770c309c1aed0fbfabad24a3d5933129->addPropertyFilterEqual($v615f76a008a7453051904597fd1612a6->getFieldId('new_relation'), $v5fe46bc3d512b2d22f8fbdd5a216478c);$v770c309c1aed0fbfabad24a3d5933129->setPropertyFilter();$v770c309c1aed0fbfabad24a3d5933129->addPropertyFilterEqual($v615f76a008a7453051904597fd1612a6->getFieldId('release_reference'), $v97bad054a676c4eb8b148399f4ecabea);$v770c309c1aed0fbfabad24a3d5933129->setLimitFilter();$v770c309c1aed0fbfabad24a3d5933129->addLimit(1);$v4001fcc4579ade3073c3d6b350f1cb1d = umiSelectionsParser::runSelectionCounts($v770c309c1aed0fbfabad24a3d5933129);if ($v4001fcc4579ade3073c3d6b350f1cb1d > 0) continue;$v5a28b2421441ac06a23bea9d97780282 = umiObjectsCollection::getInstance()->addObject($vfc19ae0e7cb9076cc4077381bbe0b168, $v78eeb37a9161c69d9b97bf9b09a50018);$v598dfd8e6f953e47ae5f63cf8e022c5e = umiObjectsCollection::getInstance()->getObject($v5a28b2421441ac06a23bea9d97780282);if ($v598dfd8e6f953e47ae5f63cf8e022c5e instanceof umiObject) {$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('release_reference', $v6ddfc58f41216767bf09678f7b4b625e);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('header', $v5047d8b42685c9b77af376220c71ad73);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('body', $vc32e13633ba3c3faea1235c6bf43328c);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('short_body', $v4267305bf921871dbce91dface3515e3);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('new_relation', array($v5fe46bc3d512b2d22f8fbdd5a216478c));if ($vb2f507299419aae36ac0e7dbe5821ff0 instanceof umiDate) {$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('msg_date', $vb2f507299419aae36ac0e7dbe5821ff0);}$v598dfd8e6f953e47ae5f63cf8e022c5e->commit();}}}}}if (!$v3a3c71719ef77e253db10d88b4456814) $this->chooseRedirect('/admin/dispatches/edit/'.$v48a1815cdd3ea285c80e708c16b439fc.'/');}public function onAutosendDispathes($v4119639092e62c55ea8be348e4d9260d) {$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('dispatches', 'dispatch');$vbc20c7050037bb4faaa8a377a59b54ea = $v8be74552df93e31bbdd6b36ed74bdb6a->result;foreach ($vbc20c7050037bb4faaa8a377a59b54ea as $v9dddf2a4f7d94594ec2ea98407a410e1) {$vabcad86d4d46e46a5866a97aa7b4ca26 = $v9dddf2a4f7d94594ec2ea98407a410e1->disp_last_release;if ($vabcad86d4d46e46a5866a97aa7b4ca26 instanceof umiDate && $vabcad86d4d46e46a5866a97aa7b4ca26->timestamp > time() - 3600) {break;}$v402ad290078afa96c85099fba935a111 = false;$v75d162420101fcb46aff3d02adbc5de3 = $v9dddf2a4f7d94594ec2ea98407a410e1->days;if (is_array($v75d162420101fcb46aff3d02adbc5de3)) {foreach ($v75d162420101fcb46aff3d02adbc5de3 as $ve5744a70df9b3ed6daa2d18870a2d609) {$v628b7db04235f228d40adc671413a8c8 = $v5891da2d64975cae48d175d1e001f5da->getObject($ve5744a70df9b3ed6daa2d18870a2d609);if ($v628b7db04235f228d40adc671413a8c8->number == intval(date("N"))) {$v402ad290078afa96c85099fba935a111 = true;break;}}}if (!$v402ad290078afa96c85099fba935a111) continue;$v402ad290078afa96c85099fba935a111 = false;$vfc9d6daaad5d1585800936e0968b5148 = $v9dddf2a4f7d94594ec2ea98407a410e1->hours;if (is_array($vfc9d6daaad5d1585800936e0968b5148)) {foreach ($vfc9d6daaad5d1585800936e0968b5148 as $vd5df2f1aff7ffa138e06dea849961147) {$v896c55cc5e46fab38ce9f51ebf7bfcd3 = $v5891da2d64975cae48d175d1e001f5da->getObject($vd5df2f1aff7ffa138e06dea849961147);if ($v896c55cc5e46fab38ce9f51ebf7bfcd3->number == intval(date("H"))) {$v402ad290078afa96c85099fba935a111 = true;break;}}}if (!$v402ad290078afa96c85099fba935a111) continue;$this->fill_release($v9dddf2a4f7d94594ec2ea98407a410e1->id, true);$this->release_send_full($v9dddf2a4f7d94594ec2ea98407a410e1->id);}exit();}public function release_send_full($v48a1815cdd3ea285c80e708c16b439fc) {$v5829f3773b9c8e66e039b5d1a5d94418 = xslTemplater::getInstance()->setIsInited(false);$v6ddfc58f41216767bf09678f7b4b625e = $this->getNewReleaseInstanceId($v48a1815cdd3ea285c80e708c16b439fc);$v2e4489650d896624f2790c3538e71929 = true;$v957a440fc90ceb51983c3285530dd8cc = umiObjectsCollection::getinstance()->getObject($v48a1815cdd3ea285c80e708c16b439fc);$v506a74ef5d3f17cb41ad70330e105c2c = umiObjectsCollection::getInstance()->getObject($v6ddfc58f41216767bf09678f7b4b625e);if (!$v957a440fc90ceb51983c3285530dd8cc instanceof umiObject || !$v506a74ef5d3f17cb41ad70330e105c2c instanceof umiObject) {return false;}if($v506a74ef5d3f17cb41ad70330e105c2c->getValue('status')) {return false;}$v57c1277b589b2de94a525806940ccc85 = new umiDate(time());$v957a440fc90ceb51983c3285530dd8cc->setValue('disp_last_release', $v57c1277b589b2de94a525806940ccc85);$v957a440fc90ceb51983c3285530dd8cc->commit();$va48a6be31f2564aeccb22da9e481f79f = array();$vf633c10cf775e6c69d4a64985425f392 = cmsController::getInstance()->getModule('organization');$ve7a023431b2a5434065c028984b65b98 = array();if ($vf633c10cf775e6c69d4a64985425f392) {if (isset($v3908403feb784aede19477893b6fc941['195273'])) {$v59ee19ab278d5406f42456ee22c0bce9 = $v3908403feb784aede19477893b6fc941['195273'];$v972bede07aa78708b601f8ca2df87582 = array();if (is_array($v59ee19ab278d5406f42456ee22c0bce9) && count($v59ee19ab278d5406f42456ee22c0bce9)) {$v972bede07aa78708b601f8ca2df87582 = $vf633c10cf775e6c69d4a64985425f392->getOrgUsers($v59ee19ab278d5406f42456ee22c0bce9);}foreach ($v972bede07aa78708b601f8ca2df87582 as $v7ad6e70c936a7223ff2f1663258f4a0a) {$v17f0aadebed948c1bcfba25dbd190afe = new umiSubscriber($v7ad6e70c936a7223ff2f1663258f4a0a);$ve7a023431b2a5434065c028984b65b98[] = $v17f0aadebed948c1bcfba25dbd190afe->getId();}}}$v12b074f374d94bf7b4469556d6bab7b9 = array();$v8c2773e75a289cbc043b24c44c45ab1e = array();if ($v2e4489650d896624f2790c3538e71929 || !$vf633c10cf775e6c69d4a64985425f392) {$v18ea1849dbf10a18b2dfd4ed0eb3a231 = new umiSelection;$v18ea1849dbf10a18b2dfd4ed0eb3a231->setObjectTypeFilter();$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "subscriber")->getId();$v3ec9f372b2dad35356b9884c89cf0ef2 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$vff500849b1c1163f66c899c7aec17813 = umiObjectTypesCollection::getInstance()->getType($v3ec9f372b2dad35356b9884c89cf0ef2);$v18ea1849dbf10a18b2dfd4ed0eb3a231->addObjectType($v3ec9f372b2dad35356b9884c89cf0ef2);$v18ea1849dbf10a18b2dfd4ed0eb3a231->setPropertyFilter();$v18ea1849dbf10a18b2dfd4ed0eb3a231->addPropertyFilterEqual($vff500849b1c1163f66c899c7aec17813->getFieldId('subscriber_dispatches'), $v48a1815cdd3ea285c80e708c16b439fc);$v12b074f374d94bf7b4469556d6bab7b9 = umiSelectionsParser::runSelection($v18ea1849dbf10a18b2dfd4ed0eb3a231);$vf633c10cf775e6c69d4a64985425f392 = cmsController::getInstance()->getModule('organization');if ($vf633c10cf775e6c69d4a64985425f392) {$v928e67f5afdbbb731a9dbdd12f41c24e = $v957a440fc90ceb51983c3285530dd8cc->getValue("forced_subscribers");$ve65eeebb7b685ad49851674cacf421fd = array();if (count($v928e67f5afdbbb731a9dbdd12f41c24e)) {$ve65eeebb7b685ad49851674cacf421fd = $vf633c10cf775e6c69d4a64985425f392->getOrgUsers($v928e67f5afdbbb731a9dbdd12f41c24e);}foreach ($ve65eeebb7b685ad49851674cacf421fd as $v7ad6e70c936a7223ff2f1663258f4a0a) {$v17f0aadebed948c1bcfba25dbd190afe = new umiSubscriber($v7ad6e70c936a7223ff2f1663258f4a0a);$v8c2773e75a289cbc043b24c44c45ab1e[] = $v17f0aadebed948c1bcfba25dbd190afe->getId();}}}$va48a6be31f2564aeccb22da9e481f79f = array_unique(array_merge($ve7a023431b2a5434065c028984b65b98, $v12b074f374d94bf7b4469556d6bab7b9, $v8c2773e75a289cbc043b24c44c45ab1e));$va48a6be31f2564aeccb22da9e481f79f = array_values($va48a6be31f2564aeccb22da9e481f79f);$v61adcb2cd3bec191f3057b6c9bef9158 = cmsController::getInstance()->getCurrentDomain()->getHost();$vad62f93fa84ff0777633f4430eabf276 = new umiMail();$vc606a78635e012f164d7dc28beea350d = array();$vcf9e396411c174031b15d612b900269d =    list($vbceb422dbe7e673dd489764daf429e04, $vc206b1db8a5478b344d010116cad82ee) = def_module::loadTemplates("tpls/dispatches/release.tpl", "release_body", "release_message");$vbe690e4d4803bac445f8ed279e5ca3b7 = "";$v52e0cdea9bfffed31478d9593ea1da3b = new umiSelection;$v52e0cdea9bfffed31478d9593ea1da3b->setObjectTypeFilter();$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "message")->getId();$v78eeb37a9161c69d9b97bf9b09a50018 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$v615f76a008a7453051904597fd1612a6 = umiObjectTypesCollection::getInstance()->getType($v78eeb37a9161c69d9b97bf9b09a50018);$v52e0cdea9bfffed31478d9593ea1da3b->addObjectType($v78eeb37a9161c69d9b97bf9b09a50018);$v52e0cdea9bfffed31478d9593ea1da3b->setPropertyFilter();$v52e0cdea9bfffed31478d9593ea1da3b->addPropertyFilterEqual($v615f76a008a7453051904597fd1612a6->getFieldId('release_reference'), $v6ddfc58f41216767bf09678f7b4b625e);$v1c0742f6c0ec3c1ff468040904993b8a = umiSelectionsParser::runSelection($v52e0cdea9bfffed31478d9593ea1da3b);$vc606a78635e012f164d7dc28beea350d['header'] = $v957a440fc90ceb51983c3285530dd8cc->getName();$vc606a78635e012f164d7dc28beea350d['messages'] = "";if (is_array($v1c0742f6c0ec3c1ff468040904993b8a) && count($v1c0742f6c0ec3c1ff468040904993b8a)) {for ($v168965c34d6a1fd6ad3d68aa5e76ae56=0;$v168965c34d6a1fd6ad3d68aa5e76ae56<count($v1c0742f6c0ec3c1ff468040904993b8a);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$v4afdcc5f3d49894d7e08adc6f020b2bd = umiObjectsCollection::getInstance()->getObject($v1c0742f6c0ec3c1ff468040904993b8a[$v168965c34d6a1fd6ad3d68aa5e76ae56]);if ($v4afdcc5f3d49894d7e08adc6f020b2bd instanceof umiObject) {$vcdaf09c4e0a9d1485a21cd30948185c8 = array();$vcdaf09c4e0a9d1485a21cd30948185c8['body'] = $v4afdcc5f3d49894d7e08adc6f020b2bd->getValue('body');$vcdaf09c4e0a9d1485a21cd30948185c8['header'] = $v4afdcc5f3d49894d7e08adc6f020b2bd->getValue('header');$vc606a78635e012f164d7dc28beea350d['messages'] .= def_module::parseTemplate($vc206b1db8a5478b344d010116cad82ee, $vcdaf09c4e0a9d1485a21cd30948185c8);$vf9cd3dee3a89adde948e804d9e02a4e7 = $v4afdcc5f3d49894d7e08adc6f020b2bd->getValue('attach_file');if ($vf9cd3dee3a89adde948e804d9e02a4e7 instanceof umiFile && !$vf9cd3dee3a89adde948e804d9e02a4e7->getIsBroken()) {$vad62f93fa84ff0777633f4430eabf276->attachFile($vf9cd3dee3a89adde948e804d9e02a4e7);}}unset($v4afdcc5f3d49894d7e08adc6f020b2bd);umiObjectsCollection::getInstance()->unloadObject($v1c0742f6c0ec3c1ff468040904993b8a[$v168965c34d6a1fd6ad3d68aa5e76ae56]);}}else {return false;}$vad62f93fa84ff0777633f4430eabf276->setFrom(regedit::getInstance()->getVal("//settings/email_from"), regedit::getInstance()->getVal("//settings/fio_from"));$vad62f93fa84ff0777633f4430eabf276->setSubject($vc606a78635e012f164d7dc28beea350d['header']);$v1be49e11f24a53a8d13e6d2faa97e11c = array();for ($v168965c34d6a1fd6ad3d68aa5e76ae56 = 0;$v168965c34d6a1fd6ad3d68aa5e76ae56 < count($va48a6be31f2564aeccb22da9e481f79f);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$vc3c0c354e5c8039632bb5fecdd07f958 = clone $vad62f93fa84ff0777633f4430eabf276;$v75bd106cd3bef574957cdb49634dd343 = new umiSubscriber($va48a6be31f2564aeccb22da9e481f79f[$v168965c34d6a1fd6ad3d68aa5e76ae56]);$v4b5789f850e658bcfb56173ae0a5b7ca =  $v75bd106cd3bef574957cdb49634dd343->getValue('lname')." ".$v75bd106cd3bef574957cdb49634dd343->getValue('fname')." ".$v75bd106cd3bef574957cdb49634dd343->getValue('father_name');$vb83a886a5c437ccd9ac15473fd6f1788 = $v75bd106cd3bef574957cdb49634dd343->getValue('email');if (!strlen($vb83a886a5c437ccd9ac15473fd6f1788)) {$vb83a886a5c437ccd9ac15473fd6f1788 = $v75bd106cd3bef574957cdb49634dd343->getName();}$vc606a78635e012f164d7dc28beea350d['unsubscribe_link'] = "http://".$v61adcb2cd3bec191f3057b6c9bef9158."/dispatches/unsubscribe/".$v75bd106cd3bef574957cdb49634dd343->getId() . '/?email=' . $vb83a886a5c437ccd9ac15473fd6f1788;$vbe690e4d4803bac445f8ed279e5ca3b7 = def_module::parseTemplate($vbceb422dbe7e673dd489764daf429e04, $vc606a78635e012f164d7dc28beea350d, false, $v75bd106cd3bef574957cdb49634dd343->getId());$vc3c0c354e5c8039632bb5fecdd07f958->setContent($vbe690e4d4803bac445f8ed279e5ca3b7);$vc3c0c354e5c8039632bb5fecdd07f958->addRecipient($vb83a886a5c437ccd9ac15473fd6f1788, $v4b5789f850e658bcfb56173ae0a5b7ca);$vc3c0c354e5c8039632bb5fecdd07f958->commit();$vc3c0c354e5c8039632bb5fecdd07f958->send();}$v506a74ef5d3f17cb41ad70330e105c2c->setValue('status', true);$v506a74ef5d3f17cb41ad70330e105c2c->setValue('date', $v57c1277b589b2de94a525806940ccc85);$v506a74ef5d3f17cb41ad70330e105c2c->setName($v57c1277b589b2de94a525806940ccc85->getFormattedDate('d-m-Y H:i'));$v506a74ef5d3f17cb41ad70330e105c2c->commit();xslTemplater::getInstance()->setIsInited($v5829f3773b9c8e66e039b5d1a5d94418);return true;}public function release_send() {$v5829f3773b9c8e66e039b5d1a5d94418 = xslTemplater::getInstance()->setIsInited(false);$v48a1815cdd3ea285c80e708c16b439fc = (int) getRequest('param0');$v6ddfc58f41216767bf09678f7b4b625e = $this->getNewReleaseInstanceId($v48a1815cdd3ea285c80e708c16b439fc);$v3908403feb784aede19477893b6fc941 = getRequest("data_values");$v2e4489650d896624f2790c3538e71929 = (bool) getRequest("include_subscribers");$v957a440fc90ceb51983c3285530dd8cc = umiObjectsCollection::getinstance()->getObject($v48a1815cdd3ea285c80e708c16b439fc);$v506a74ef5d3f17cb41ad70330e105c2c = umiObjectsCollection::getInstance()->getObject($v6ddfc58f41216767bf09678f7b4b625e);if (!$v957a440fc90ceb51983c3285530dd8cc instanceof umiObject || !$v506a74ef5d3f17cb41ad70330e105c2c instanceof umiObject) {$vde4a7efe6d3b7d10fba90c97414419fd = '<?xml version="1.0" encoding="utf-8"?>';$vde4a7efe6d3b7d10fba90c97414419fd .= <<<END
						<error>Не указан идентификатор рассылки</error>
END;    $this->flush($vde4a7efe6d3b7d10fba90c97414419fd, "text/xml");}if($v506a74ef5d3f17cb41ad70330e105c2c->getValue('status')) {$vde4a7efe6d3b7d10fba90c97414419fd = '<?xml version="1.0" encoding="utf-8"?>';$vde4a7efe6d3b7d10fba90c97414419fd .= <<<END
						<error>Этот выпуск уже был отправлен</error>
END;    $this->flush($vde4a7efe6d3b7d10fba90c97414419fd, "text/xml");}$va48a6be31f2564aeccb22da9e481f79f = array();if (!isset($_SESSION['umi_send_list_' . $v6ddfc58f41216767bf09678f7b4b625e])) {$vf633c10cf775e6c69d4a64985425f392 = cmsController::getInstance()->getModule('organization');$ve7a023431b2a5434065c028984b65b98 = array();if ($vf633c10cf775e6c69d4a64985425f392) {if (isset($v3908403feb784aede19477893b6fc941['195273'])) {$v59ee19ab278d5406f42456ee22c0bce9 = $v3908403feb784aede19477893b6fc941['195273'];$v972bede07aa78708b601f8ca2df87582 = array();if (is_array($v59ee19ab278d5406f42456ee22c0bce9) && count($v59ee19ab278d5406f42456ee22c0bce9)) {$v972bede07aa78708b601f8ca2df87582 = $vf633c10cf775e6c69d4a64985425f392->getOrgUsers($v59ee19ab278d5406f42456ee22c0bce9);}foreach ($v972bede07aa78708b601f8ca2df87582 as $v7ad6e70c936a7223ff2f1663258f4a0a) {$v17f0aadebed948c1bcfba25dbd190afe = new umiSubscriber($v7ad6e70c936a7223ff2f1663258f4a0a);$ve7a023431b2a5434065c028984b65b98[] = $v17f0aadebed948c1bcfba25dbd190afe->getId();}}}$v12b074f374d94bf7b4469556d6bab7b9 = array();$v8c2773e75a289cbc043b24c44c45ab1e = array();if ($v2e4489650d896624f2790c3538e71929 || !$vf633c10cf775e6c69d4a64985425f392) {$v18ea1849dbf10a18b2dfd4ed0eb3a231 = new umiSelection;$v18ea1849dbf10a18b2dfd4ed0eb3a231->setObjectTypeFilter();$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "subscriber")->getId();$v3ec9f372b2dad35356b9884c89cf0ef2 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$vff500849b1c1163f66c899c7aec17813 = umiObjectTypesCollection::getInstance()->getType($v3ec9f372b2dad35356b9884c89cf0ef2);$v18ea1849dbf10a18b2dfd4ed0eb3a231->addObjectType($v3ec9f372b2dad35356b9884c89cf0ef2);$v18ea1849dbf10a18b2dfd4ed0eb3a231->setPropertyFilter();$v18ea1849dbf10a18b2dfd4ed0eb3a231->addPropertyFilterEqual($vff500849b1c1163f66c899c7aec17813->getFieldId('subscriber_dispatches'), $v48a1815cdd3ea285c80e708c16b439fc);$v12b074f374d94bf7b4469556d6bab7b9 = umiSelectionsParser::runSelection($v18ea1849dbf10a18b2dfd4ed0eb3a231);$vf633c10cf775e6c69d4a64985425f392 = cmsController::getInstance()->getModule('organization');if ($vf633c10cf775e6c69d4a64985425f392) {$v928e67f5afdbbb731a9dbdd12f41c24e = $v957a440fc90ceb51983c3285530dd8cc->getValue("forced_subscribers");$ve65eeebb7b685ad49851674cacf421fd = array();if (count($v928e67f5afdbbb731a9dbdd12f41c24e)) {$ve65eeebb7b685ad49851674cacf421fd = $vf633c10cf775e6c69d4a64985425f392->getOrgUsers($v928e67f5afdbbb731a9dbdd12f41c24e);}foreach ($ve65eeebb7b685ad49851674cacf421fd as $v7ad6e70c936a7223ff2f1663258f4a0a) {$v17f0aadebed948c1bcfba25dbd190afe = new umiSubscriber($v7ad6e70c936a7223ff2f1663258f4a0a);$v8c2773e75a289cbc043b24c44c45ab1e[] = $v17f0aadebed948c1bcfba25dbd190afe->getId();}}}$va48a6be31f2564aeccb22da9e481f79f = array_unique(array_merge($ve7a023431b2a5434065c028984b65b98, $v12b074f374d94bf7b4469556d6bab7b9, $v8c2773e75a289cbc043b24c44c45ab1e));$_SESSION['umi_send_list_' . $v6ddfc58f41216767bf09678f7b4b625e] = $va48a6be31f2564aeccb22da9e481f79f;$_SESSION['umi_send_list_' . $v6ddfc58f41216767bf09678f7b4b625e . '_count'] = count($va48a6be31f2564aeccb22da9e481f79f);}else {$va48a6be31f2564aeccb22da9e481f79f = getSession('umi_send_list_' . $v6ddfc58f41216767bf09678f7b4b625e);}$va48a6be31f2564aeccb22da9e481f79f = array_values($va48a6be31f2564aeccb22da9e481f79f);$v61adcb2cd3bec191f3057b6c9bef9158 = cmsController::getInstance()->getCurrentDomain()->getHost();$vad62f93fa84ff0777633f4430eabf276 = new umiMail();$vc606a78635e012f164d7dc28beea350d = array();$vcf9e396411c174031b15d612b900269d =    list($vbceb422dbe7e673dd489764daf429e04, $vc206b1db8a5478b344d010116cad82ee) = def_module::loadTemplates("tpls/dispatches/release.tpl", "release_body", "release_message");$vbe690e4d4803bac445f8ed279e5ca3b7 = "";$v52e0cdea9bfffed31478d9593ea1da3b = new umiSelection;$v52e0cdea9bfffed31478d9593ea1da3b->setObjectTypeFilter();$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "message")->getId();$v78eeb37a9161c69d9b97bf9b09a50018 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$v615f76a008a7453051904597fd1612a6 = umiObjectTypesCollection::getInstance()->getType($v78eeb37a9161c69d9b97bf9b09a50018);$v52e0cdea9bfffed31478d9593ea1da3b->addObjectType($v78eeb37a9161c69d9b97bf9b09a50018);$v52e0cdea9bfffed31478d9593ea1da3b->setPropertyFilter();$v52e0cdea9bfffed31478d9593ea1da3b->addPropertyFilterEqual($v615f76a008a7453051904597fd1612a6->getFieldId('release_reference'), $v6ddfc58f41216767bf09678f7b4b625e);$v1c0742f6c0ec3c1ff468040904993b8a = umiSelectionsParser::runSelection($v52e0cdea9bfffed31478d9593ea1da3b);$vc606a78635e012f164d7dc28beea350d['header'] = $v957a440fc90ceb51983c3285530dd8cc->getName();$vc606a78635e012f164d7dc28beea350d['messages'] = "";if (is_array($v1c0742f6c0ec3c1ff468040904993b8a) && count($v1c0742f6c0ec3c1ff468040904993b8a)) {for ($v168965c34d6a1fd6ad3d68aa5e76ae56=0;$v168965c34d6a1fd6ad3d68aa5e76ae56<count($v1c0742f6c0ec3c1ff468040904993b8a);$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$v4afdcc5f3d49894d7e08adc6f020b2bd = umiObjectsCollection::getInstance()->getObject($v1c0742f6c0ec3c1ff468040904993b8a[$v168965c34d6a1fd6ad3d68aa5e76ae56]);if ($v4afdcc5f3d49894d7e08adc6f020b2bd instanceof umiObject) {$vcdaf09c4e0a9d1485a21cd30948185c8 = array();$vcdaf09c4e0a9d1485a21cd30948185c8['body'] = $v4afdcc5f3d49894d7e08adc6f020b2bd->getValue('body');$vcdaf09c4e0a9d1485a21cd30948185c8['header'] = $v4afdcc5f3d49894d7e08adc6f020b2bd->getValue('header');$vc606a78635e012f164d7dc28beea350d['messages'] .= def_module::parseTemplate($vc206b1db8a5478b344d010116cad82ee, $vcdaf09c4e0a9d1485a21cd30948185c8);$vf9cd3dee3a89adde948e804d9e02a4e7 = $v4afdcc5f3d49894d7e08adc6f020b2bd->getValue('attach_file');if ($vf9cd3dee3a89adde948e804d9e02a4e7 instanceof umiFile && !$vf9cd3dee3a89adde948e804d9e02a4e7->getIsBroken()) {$vad62f93fa84ff0777633f4430eabf276->attachFile($vf9cd3dee3a89adde948e804d9e02a4e7);}}unset($v4afdcc5f3d49894d7e08adc6f020b2bd);umiObjectsCollection::getInstance()->unloadObject($v1c0742f6c0ec3c1ff468040904993b8a[$v168965c34d6a1fd6ad3d68aa5e76ae56]);}}else {$vde4a7efe6d3b7d10fba90c97414419fd = '<?xml version="1.0" encoding="utf-8"?>';$vde4a7efe6d3b7d10fba90c97414419fd .= <<<END
						<error>В выпуске нет сообщений</error>
END;    $this->flush($vde4a7efe6d3b7d10fba90c97414419fd, "text/xml");}$vad62f93fa84ff0777633f4430eabf276->setFrom(regedit::getInstance()->getVal("//settings/email_from"), regedit::getInstance()->getVal("//settings/fio_from"));$vad62f93fa84ff0777633f4430eabf276->setSubject($vc606a78635e012f164d7dc28beea350d['header']);$v1be49e11f24a53a8d13e6d2faa97e11c = array();$va78e90d184fe48399d6ef2b49f290227 = 5;$v7dabf5c198b0bab2eaa42bb03a113e55 = count($va48a6be31f2564aeccb22da9e481f79f);$vd5fe9dbcef0605c8053e5537573d7af6 = $v7dabf5c198b0bab2eaa42bb03a113e55 - $va78e90d184fe48399d6ef2b49f290227;if ($vd5fe9dbcef0605c8053e5537573d7af6 < 0) $vd5fe9dbcef0605c8053e5537573d7af6 = 0;$v205ef13aeaebd5c21fcc961844d76a97 = ($vd5fe9dbcef0605c8053e5537573d7af6 + $va78e90d184fe48399d6ef2b49f290227) > $v7dabf5c198b0bab2eaa42bb03a113e55 ? $v7dabf5c198b0bab2eaa42bb03a113e55 : $vd5fe9dbcef0605c8053e5537573d7af6 + $va78e90d184fe48399d6ef2b49f290227;for ($v168965c34d6a1fd6ad3d68aa5e76ae56 = $vd5fe9dbcef0605c8053e5537573d7af6;$v168965c34d6a1fd6ad3d68aa5e76ae56 < $v205ef13aeaebd5c21fcc961844d76a97;$v168965c34d6a1fd6ad3d68aa5e76ae56++) {$vc3c0c354e5c8039632bb5fecdd07f958 = clone $vad62f93fa84ff0777633f4430eabf276;$v75bd106cd3bef574957cdb49634dd343 = new umiSubscriber($va48a6be31f2564aeccb22da9e481f79f[$v168965c34d6a1fd6ad3d68aa5e76ae56]);$v4b5789f850e658bcfb56173ae0a5b7ca =  $v75bd106cd3bef574957cdb49634dd343->getValue('lname')." ".$v75bd106cd3bef574957cdb49634dd343->getValue('fname')." ".$v75bd106cd3bef574957cdb49634dd343->getValue('father_name');$vb83a886a5c437ccd9ac15473fd6f1788 = $v75bd106cd3bef574957cdb49634dd343->getValue('email');if (!strlen($vb83a886a5c437ccd9ac15473fd6f1788)) {$vb83a886a5c437ccd9ac15473fd6f1788 = $v75bd106cd3bef574957cdb49634dd343->getName();}$vc606a78635e012f164d7dc28beea350d['unsubscribe_link'] = "http://".$v61adcb2cd3bec191f3057b6c9bef9158."/dispatches/unsubscribe/".$v75bd106cd3bef574957cdb49634dd343->getId() . '/?email=' . $vb83a886a5c437ccd9ac15473fd6f1788;$vbe690e4d4803bac445f8ed279e5ca3b7 = def_module::parseTemplate($vbceb422dbe7e673dd489764daf429e04, $vc606a78635e012f164d7dc28beea350d, false, $v75bd106cd3bef574957cdb49634dd343->getId());$vc3c0c354e5c8039632bb5fecdd07f958->setContent($vbe690e4d4803bac445f8ed279e5ca3b7);$vc3c0c354e5c8039632bb5fecdd07f958->addRecipient($vb83a886a5c437ccd9ac15473fd6f1788, $v4b5789f850e658bcfb56173ae0a5b7ca);$vc3c0c354e5c8039632bb5fecdd07f958->commit();$vc3c0c354e5c8039632bb5fecdd07f958->send();unset($vc3c0c354e5c8039632bb5fecdd07f958);unset($va48a6be31f2564aeccb22da9e481f79f[$v168965c34d6a1fd6ad3d68aa5e76ae56]);}umiMail::clearFilesCache();$_SESSION['umi_send_list_' . $v6ddfc58f41216767bf09678f7b4b625e] = $va48a6be31f2564aeccb22da9e481f79f;if (!count($va48a6be31f2564aeccb22da9e481f79f)) {$v506a74ef5d3f17cb41ad70330e105c2c->setValue('status', true);$v57c1277b589b2de94a525806940ccc85 = new umiDate(time());$v506a74ef5d3f17cb41ad70330e105c2c->setValue('date', $v57c1277b589b2de94a525806940ccc85);$v506a74ef5d3f17cb41ad70330e105c2c->setName($v57c1277b589b2de94a525806940ccc85->getFormattedDate('d-m-Y H:i'));$v506a74ef5d3f17cb41ad70330e105c2c->commit();$v957a440fc90ceb51983c3285530dd8cc->setValue('disp_last_release', $v57c1277b589b2de94a525806940ccc85);$v957a440fc90ceb51983c3285530dd8cc->commit();}xslTemplater::getInstance()->setIsInited($v5829f3773b9c8e66e039b5d1a5d94418);$vfd4065b8a1d04f40ee550f3c90201a01 = (int) getSession('umi_send_list_' . $v6ddfc58f41216767bf09678f7b4b625e . '_count');$v54ebaaba558dd540ad973945992c4931 = $vfd4065b8a1d04f40ee550f3c90201a01 - count($va48a6be31f2564aeccb22da9e481f79f);$vdccc8c8d061984a56d899361b4934477 = '<?xml version="1.0" encoding="utf-8"?>';usleep(500000);$vdccc8c8d061984a56d899361b4934477 .= <<<END
					<release dispatch="{$v48a1815cdd3ea285c80e708c16b439fc}">
						<total>{$vfd4065b8a1d04f40ee550f3c90201a01}</total>
						<sended>{$v54ebaaba558dd540ad973945992c4931}</sended>
					</release>
END;   $this->flush($vdccc8c8d061984a56d899361b4934477, "text/xml");}public function collectAllChanges($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, $v72352a4d26581ef082a6d2243c5a6b88 = false) {$vc5b5790b8b74a68d0cde09c8f1080fc5 = time();$v4eb96f2ac30c9408cb753e8b5bf991c9 = ($vc5b5790b8b74a68d0cde09c8f1080fc5 - 3600*24*30);$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce)->getId();$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce);$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, false);$v8be74552df93e31bbdd6b36ed74bdb6a->setPropertyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterBetween($vd0d5ad0219c6bb59a29b5027add37795, $v4eb96f2ac30c9408cb753e8b5bf991c9, $vc5b5790b8b74a68d0cde09c8f1080fc5);if($v72352a4d26581ef082a6d2243c5a6b88 !== false) {if(!is_numeric($v72352a4d26581ef082a6d2243c5a6b88)) {$v72352a4d26581ef082a6d2243c5a6b88 = umiHierarchy::getInstance()->getIdByPath($v72352a4d26581ef082a6d2243c5a6b88);}$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v72352a4d26581ef082a6d2243c5a6b88);}$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v9b207167e5381c47682c6b4f58a623fb = Array();foreach($result as $v7552cd149af7495ee7d8225974e50f80) {$vadce578d04ed03c31f6ac59451fcf8e4 = sizeof(umiHierarchy::getInstance()->getChilds($v7552cd149af7495ee7d8225974e50f80));$v9b207167e5381c47682c6b4f58a623fb[] = Array("id" => $v7552cd149af7495ee7d8225974e50f80, "childs" => $vadce578d04ed03c31f6ac59451fcf8e4);}return Array("result" => $v9b207167e5381c47682c6b4f58a623fb, "total" => $vfbb44b4487415b134bce9c790a27fe5e);}public function getChanges($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, $v72352a4d26581ef082a6d2243c5a6b88 = false) {list($v364f9b183bd2dd9e0beb45c754830a6c, $v28d65bb7a643774ada22f54ca0679289, $ve6a2fd7211958cfe50efa4d14bd332f5, $vb57486b49d738cf1aaf7e4a7ffae069e) = def_module::loadTemplates("./tpls/dispatches/changes/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "block", "block_empty", "block_line", "block_line_counts");$result = $this->collectAllChanges($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce, $v72352a4d26581ef082a6d2243c5a6b88);$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['total'] = $vfbb44b4487415b134bce9c790a27fe5e = (int) $result['total'];if($vfbb44b4487415b134bce9c790a27fe5e == 0) {return $v28d65bb7a643774ada22f54ca0679289;}umiHierarchy::getInstance()->forceAbsolutePath(true);$v691d502cfd0e0626cd3b058e5682ad1c = Array();foreach($result['result'] as $v36c4536996ca5615dcf9911f068786dc) {$ve253bed1357afcefc5fadfbc92f9eb97 = Array();$ve253bed1357afcefc5fadfbc92f9eb97['id'] = $v7552cd149af7495ee7d8225974e50f80 = $v36c4536996ca5615dcf9911f068786dc['id'];$ve2942a04780e223b215eb8b663cf5353 = $v36c4536996ca5615dcf9911f068786dc['childs'];if($ve2942a04780e223b215eb8b663cf5353) {$v87566ed7ed2a932af11f5b631f7f81a1 = Array();$v87566ed7ed2a932af11f5b631f7f81a1['count'] = $ve2942a04780e223b215eb8b663cf5353;$v0700cd3e2cd8b37ef510dd5aa2c81fc6 = def_module::parseTemplate($vb57486b49d738cf1aaf7e4a7ffae069e, $v87566ed7ed2a932af11f5b631f7f81a1);}else {$v0700cd3e2cd8b37ef510dd5aa2c81fc6 = "";}$ve253bed1357afcefc5fadfbc92f9eb97['counts'] = $v0700cd3e2cd8b37ef510dd5aa2c81fc6;$ve253bed1357afcefc5fadfbc92f9eb97['link'] = umiHierarchy::getInstance()->getPathById($v7552cd149af7495ee7d8225974e50f80);$v691d502cfd0e0626cd3b058e5682ad1c[] = def_module::parseTemplate($ve6a2fd7211958cfe50efa4d14bd332f5, $ve253bed1357afcefc5fadfbc92f9eb97, $v7552cd149af7495ee7d8225974e50f80);}umiHierarchy::getInstance()->forceAbsolutePath(false);$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = $v691d502cfd0e0626cd3b058e5682ad1c;return def_module::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function getAllChanges($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {list($v364f9b183bd2dd9e0beb45c754830a6c) = def_module::loadTemplates("./tpls/dispatches/changes/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "message");return def_module::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c);}public function publishChanges() {$vb790175058e05911758cdaedd66fe5d9 = "Monthly dispatch";$v6198270de3ca609e23bf2d366296b4fd = regedit::getInstance()->getVal("//modules/forum/dispatch_id");if(!$v6198270de3ca609e23bf2d366296b4fd) return false;$vadf5d1a74df1589306cd6dfe81be0d16 = cmsController::getInstance()->getModule('dispatches');if(!$vadf5d1a74df1589306cd6dfe81be0d16) {return false;}$v10c4b55f31b64898e699a5a4f7b48d17 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "message")->getId();$v78eeb37a9161c69d9b97bf9b09a50018 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($v10c4b55f31b64898e699a5a4f7b48d17);$v615f76a008a7453051904597fd1612a6 = umiObjectTypesCollection::getInstance()->getType($v78eeb37a9161c69d9b97bf9b09a50018);$v5a28b2421441ac06a23bea9d97780282 = umiObjectsCollection::getInstance()->addObject($vb790175058e05911758cdaedd66fe5d9, $v78eeb37a9161c69d9b97bf9b09a50018);$v598dfd8e6f953e47ae5f63cf8e022c5e = umiObjectsCollection::getInstance()->getObject($v5a28b2421441ac06a23bea9d97780282);if ($v598dfd8e6f953e47ae5f63cf8e022c5e instanceof umiObject) {$v6ddfc58f41216767bf09678f7b4b625e = $vadf5d1a74df1589306cd6dfe81be0d16->getNewReleaseInstanceId($v6198270de3ca609e23bf2d366296b4fd);$v841a2d689ad86bd1611447453c22c6fc = $vadf5d1a74df1589306cd6dfe81be0d16->getAllChanges();$v841a2d689ad86bd1611447453c22c6fc = templater::getInstance()->parseInput($v841a2d689ad86bd1611447453c22c6fc);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('release_reference', $v6ddfc58f41216767bf09678f7b4b625e);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('header', $vb790175058e05911758cdaedd66fe5d9);$v598dfd8e6f953e47ae5f63cf8e022c5e->setValue('body', $v841a2d689ad86bd1611447453c22c6fc);$v598dfd8e6f953e47ae5f63cf8e022c5e->commit();return true;}else {return false;}}};?>