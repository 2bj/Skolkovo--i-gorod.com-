<?php
 class umiHierarchyElement extends umiEntinty implements iUmiEntinty, iUmiHierarchyElement {private $rel, $alt_name, $ord, $object_id,   $type_id, $domain_id, $lang_id, $tpl_id,   $is_deleted = false, $is_active = true, $is_visible = true, $is_default = false, $name,   $update_time,   $object,   $is_broken = false;protected $store_type = "element";public function getIsDeleted() {return $this->is_deleted;}public function getIsActive() {return $this->is_active;}public function getIsVisible() {return $this->is_visible;}public function getLangId() {return $this->lang_id;}public function getDomainId() {return $this->domain_id;}public function getTplId() {return $this->tpl_id;}public function getTypeId() {return $this->type_id;}public function getUpdateTime() {return $this->update_time;}public function getOrd() {return $this->ord;}public function getRel() {return $this->rel;}public function getAltName() {return $this->alt_name;}public function getIsDefault() {return $this->is_default;}public function getObject() {if(isset($this->object) && $this->object) {return $this->object;}else if(isset($this->object_id)) {$this->object = umiObjectsCollection::getInstance()->getObject($this->object_id);return $this->object;}else {return null;}}public function getParentId() {return $this->rel;}public function getName() {return $this->translateLabel($this->name);}public function setName($vb068931cc450442b63f5b3d276ea4297) {$v9b207167e5381c47682c6b4f58a623fb = $this->getObject()->setName($vb068931cc450442b63f5b3d276ea4297);$this->setIsUpdated(true);return $v9b207167e5381c47682c6b4f58a623fb;}public function getValue($vdfc394bd05a4b48161c790034af522a8, $v21ffce5b8a6cc8cc6a41448dd69623c9 = NULL) {$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject();return $va8cfde6331bd59eb2ac96f8911c4b666 ? $va8cfde6331bd59eb2ac96f8911c4b666->getValue($vdfc394bd05a4b48161c790034af522a8, $v21ffce5b8a6cc8cc6a41448dd69623c9) : false;}public function setValue($vdfc394bd05a4b48161c790034af522a8, $v2771be291c4a714ca95fd1f45a32403e) {if($va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject()) {$result = $va8cfde6331bd59eb2ac96f8911c4b666->setValue($vdfc394bd05a4b48161c790034af522a8, $v2771be291c4a714ca95fd1f45a32403e);$this->setIsUpdated(true);return $result;}else {return false;}}public function setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = true) {if ($this->is_visible !== ((bool)$ve1c6c9ef2fcbe75f26f815c4ef2e60b4)) {$this->is_visible = (bool) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4;$this->setIsUpdated();}}public function setIsActive($v4264c638e0098acb172519b0436db099 = true) {if ($this->is_active !== ((bool)$v4264c638e0098acb172519b0436db099)) {$this->is_active = (bool) $v4264c638e0098acb172519b0436db099;$this->setIsUpdated();}}public function setIsDeleted($vf49e2553045b3240a95c36854d36dddc = false) {if ($this->is_deleted !== ((bool)$vf49e2553045b3240a95c36854d36dddc)) {$this->is_deleted = (bool) $vf49e2553045b3240a95c36854d36dddc;$this->setIsUpdated();}}public function setTypeId($v94757cae63fd3e398c0811a976dd6bbe) {if ($this->type_id !== ((int)$v94757cae63fd3e398c0811a976dd6bbe)) {$this->type_id = (int) $v94757cae63fd3e398c0811a976dd6bbe;$this->setIsUpdated();}}public function setLangId($v78e6dd7a49f5b0cb2106a3a434dd5c86) {if ($this->lang_id !== ((int)$v78e6dd7a49f5b0cb2106a3a434dd5c86)) {$this->lang_id = (int) $v78e6dd7a49f5b0cb2106a3a434dd5c86;$this->setIsUpdated();}}public function setTplId($vd02e12eb6d6c3f6ebd763197df01e211) {if ($this->tpl_id !== ((int)$vd02e12eb6d6c3f6ebd763197df01e211)) {$this->tpl_id = (int) $vd02e12eb6d6c3f6ebd763197df01e211;$this->setIsUpdated();}}public function setDomainId($v662cbf1253ac7d8750ed9190c52163e5) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vadce578d04ed03c31f6ac59451fcf8e4 = $vb81ca7c0ccaa77e7aa91936ab0070695->getChilds($this->id, true, true);foreach($vadce578d04ed03c31f6ac59451fcf8e4 as $vf36263a38d7de5cdaa953c1e2b2f79b5 => $v1a13105b7e4eb5fb2e7c9515ac06aa48) {$v1b7d5726533ab525a8760351e9b5e415 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vf36263a38d7de5cdaa953c1e2b2f79b5, true, true);$v1b7d5726533ab525a8760351e9b5e415->setDomainId($v662cbf1253ac7d8750ed9190c52163e5);$vb81ca7c0ccaa77e7aa91936ab0070695->unloadElement($vf36263a38d7de5cdaa953c1e2b2f79b5);unset($v1b7d5726533ab525a8760351e9b5e415);}if ($this->domain_id !== ((int)$v662cbf1253ac7d8750ed9190c52163e5)) {$this->domain_id = (int) $v662cbf1253ac7d8750ed9190c52163e5;$this->setIsUpdated();}}public function setUpdateTime($ve0df5a999da22bc6fa9e26b115eb4ae4 = 0) {if($ve0df5a999da22bc6fa9e26b115eb4ae4 == 0) {$ve0df5a999da22bc6fa9e26b115eb4ae4 = umiHierarchy::getTimeStamp();}if ($this->update_time !== ((int)$ve0df5a999da22bc6fa9e26b115eb4ae4)) {$this->update_time = (int) $ve0df5a999da22bc6fa9e26b115eb4ae4;$this->setIsUpdated();}}public function setOrd($v8bef1cc20ada3bef55fdf132cb2a1cb9) {if ($this->ord !== ((int)$v8bef1cc20ada3bef55fdf132cb2a1cb9)) {$this->ord = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->setIsUpdated();}}public function setRel($v7ffc4d510260a8544e5550e62ec56bc1) {if ($this->rel !== ((int)$v7ffc4d510260a8544e5550e62ec56bc1)) {$this->rel = (int) $v7ffc4d510260a8544e5550e62ec56bc1;$this->setIsUpdated();}}public function setObject(umiObject $va8cfde6331bd59eb2ac96f8911c4b666, $vac2a04437278cf6e6e597b1b9295b193 = true) {$this->object = $va8cfde6331bd59eb2ac96f8911c4b666;$this->object_id = $va8cfde6331bd59eb2ac96f8911c4b666->getId();if ($vac2a04437278cf6e6e597b1b9295b193) $this->setIsUpdated();}public function setAltName($vd84ff935144e00c3e1d395c2379aca47, $v5c42c04954c401e189bb85786bde8adb = true) {if(!$vd84ff935144e00c3e1d395c2379aca47) {$vd84ff935144e00c3e1d395c2379aca47 = $this->getName();}if($v5c42c04954c401e189bb85786bde8adb) {$vd84ff935144e00c3e1d395c2379aca47 = umiHierarchy::convertAltName($vd84ff935144e00c3e1d395c2379aca47);if(!$vd84ff935144e00c3e1d395c2379aca47) $vd84ff935144e00c3e1d395c2379aca47 = "_";}$vd295b8117d72bf06e54a27bcbfc782cf = $this->alt_name;$this->alt_name = $this->getRightAltName(umiObjectProperty::filterInputString($vd84ff935144e00c3e1d395c2379aca47));if(!$this->alt_name) {$this->alt_name = $vd84ff935144e00c3e1d395c2379aca47;}$v1988c61c48f30d2b39eed4edcf1e3c8b = $this->alt_name;if ($v1988c61c48f30d2b39eed4edcf1e3c8b !== $vd295b8117d72bf06e54a27bcbfc782cf) $this->setIsUpdated();}public function __destruct() {$v16b2b26000987faccb260b9d39df1269 = $this->object_id;parent::__destruct();unset($this->object_id);unset($this->object);umiObjectsCollection::getInstance()->unloadObject($v16b2b26000987faccb260b9d39df1269);}private function getRightAltName($vd84ff935144e00c3e1d395c2379aca47, $v0161cd78b4dc4a09ae9d2bbdb93dddc4 = false) {if (empty($vd84ff935144e00c3e1d395c2379aca47)) $vd84ff935144e00c3e1d395c2379aca47 = '1';if ($this->getRel() == 0 && !IGNORE_MODULE_NAMES_OVERWRITE) {$v6c63406410aa57b3c97b88d3feb09990 = regedit::getInstance()->getList("//modules");foreach($v6c63406410aa57b3c97b88d3feb09990 as $v854203cccade0bbe21be239a208aea49) {if ($vd84ff935144e00c3e1d395c2379aca47 == $v854203cccade0bbe21be239a208aea49[0]) {$vd84ff935144e00c3e1d395c2379aca47 .= '1';break;}}if (langsCollection::getInstance()->getLangId($vd84ff935144e00c3e1d395c2379aca47)) {$vd84ff935144e00c3e1d395c2379aca47 .= '1';}}$vc1332a8893475d77a4cb5226b0e6246d =  array();preg_match("/^([a-z0-9_.-]*)(\d*?)$/U", $vd84ff935144e00c3e1d395c2379aca47, $v66373a9c960d5bb19f89068c5a2797b0);$va2d2953131ec91efe3c90d4dbcee3777 = isset($v66373a9c960d5bb19f89068c5a2797b0[2]) ? $v66373a9c960d5bb19f89068c5a2797b0[2] : NULL;$v544988e29afe707b134aa03709eb443e = isset($v66373a9c960d5bb19f89068c5a2797b0[1]) ? $v66373a9c960d5bb19f89068c5a2797b0[1] : NULL;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $this->getLangId();$v662cbf1253ac7d8750ed9190c52163e5 = $this->getDomainId();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT alt_name FROM cms3_hierarchy WHERE rel={$this->getRel()} AND id <> {$this->getId()} AND is_deleted = '0' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}' AND alt_name LIKE '{$v544988e29afe707b134aa03709eb443e}%';";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v447b7147e84be512208dcc0995d67ebc) = mysql_fetch_row($result)) $vc1332a8893475d77a4cb5226b0e6246d[] = $v447b7147e84be512208dcc0995d67ebc;if (!empty($vc1332a8893475d77a4cb5226b0e6246d) and in_array($vd84ff935144e00c3e1d395c2379aca47,$vc1332a8893475d77a4cb5226b0e6246d)){foreach($vc1332a8893475d77a4cb5226b0e6246d as $v52dfbb9b0e571701b76699a145406d48){preg_match("/^([a-z0-9_.-]*)(\d*?)$/U", $v52dfbb9b0e571701b76699a145406d48, $v66373a9c960d5bb19f89068c5a2797b0);if (!empty($v66373a9c960d5bb19f89068c5a2797b0[2])) $va2d2953131ec91efe3c90d4dbcee3777 = max($va2d2953131ec91efe3c90d4dbcee3777,$v66373a9c960d5bb19f89068c5a2797b0[2]);}++$va2d2953131ec91efe3c90d4dbcee3777;if ($v0161cd78b4dc4a09ae9d2bbdb93dddc4) {$v363b122c528f54df4a0446b6bab05515 = 0;for ($v363b122c528f54df4a0446b6bab05515 = 1;$v363b122c528f54df4a0446b6bab05515<$va2d2953131ec91efe3c90d4dbcee3777;$v363b122c528f54df4a0446b6bab05515++) {if (!in_array($v544988e29afe707b134aa03709eb443e . $v363b122c528f54df4a0446b6bab05515, $vc1332a8893475d77a4cb5226b0e6246d)) {$va2d2953131ec91efe3c90d4dbcee3777 = $v363b122c528f54df4a0446b6bab05515;break;}}}}return $v544988e29afe707b134aa03709eb443e . $va2d2953131ec91efe3c90d4dbcee3777;}public function setIsDefault($vf62baf4c4ead98d50d516eca0ac5a746 = true) {if ($this->is_default !== ((int)$vf62baf4c4ead98d50d516eca0ac5a746)) {cacheFrontend::getInstance()->flush();$this->is_default = (int) $vf62baf4c4ead98d50d516eca0ac5a746;$this->setIsUpdated();}}public function getFieldId($v73f329f154a663bfda020aadcdd0b775) {return umiObjectTypesCollection::getInstance()->getType($this->getObject()->getTypeId())->getFieldId($v73f329f154a663bfda020aadcdd0b775);}protected function loadInfo() {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE h.rel, h.type_id, h.lang_id, h.domain_id, h.tpl_id, h.obj_id, h.ord, h.alt_name, h.is_active, h.is_visible, h.is_deleted, h.updatetime, h.is_default, o.name FROM cms3_hierarchy h, cms3_objects o WHERE h.id = '{$this->id}' AND o.id = h.obj_id";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a, true);if(list($v7ffc4d510260a8544e5550e62ec56bc1, $v94757cae63fd3e398c0811a976dd6bbe, $v78e6dd7a49f5b0cb2106a3a434dd5c86, $v662cbf1253ac7d8750ed9190c52163e5, $vd02e12eb6d6c3f6ebd763197df01e211, $v818ad5ef6588e140ecb9f81e810c028a, $v8bef1cc20ada3bef55fdf132cb2a1cb9, $vd84ff935144e00c3e1d395c2379aca47, $v4264c638e0098acb172519b0436db099, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4, $vf49e2553045b3240a95c36854d36dddc, $v3e04dc2abd929a9d02e2e0fa41d24bf9, $vf62baf4c4ead98d50d516eca0ac5a746, $vb068931cc450442b63f5b3d276ea4297) = mysql_fetch_row($result)) {if(!$v818ad5ef6588e140ecb9f81e810c028a) {umiHierarchy::getInstance()->delElement($this->id);$this->is_broken = true;return false;}$this->rel = (int) $v7ffc4d510260a8544e5550e62ec56bc1;$this->type_id = (int) $v94757cae63fd3e398c0811a976dd6bbe;$this->lang_id = (int) $v78e6dd7a49f5b0cb2106a3a434dd5c86;$this->domain_id = (int) $v662cbf1253ac7d8750ed9190c52163e5;$this->tpl_id = (int) $vd02e12eb6d6c3f6ebd763197df01e211;$this->object_id = (int) $v818ad5ef6588e140ecb9f81e810c028a;$this->ord = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->alt_name = $vd84ff935144e00c3e1d395c2379aca47;$this->is_active = (bool) $v4264c638e0098acb172519b0436db099;$this->is_visible = (bool) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4;$this->is_deleted = (bool) $vf49e2553045b3240a95c36854d36dddc;$this->is_default = (bool) $vf62baf4c4ead98d50d516eca0ac5a746;$this->name = $vb068931cc450442b63f5b3d276ea4297;if (!$v3e04dc2abd929a9d02e2e0fa41d24bf9) {$v3e04dc2abd929a9d02e2e0fa41d24bf9 = umiHierarchy::getTimeStamp();}$this->update_time = (int)$v3e04dc2abd929a9d02e2e0fa41d24bf9;return true;}else {$this->is_broken = true;return false;}}protected function save() {$v7ffc4d510260a8544e5550e62ec56bc1 = (int) $this->rel;$v94757cae63fd3e398c0811a976dd6bbe = (int) $this->type_id;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = (int) $this->lang_id;$v662cbf1253ac7d8750ed9190c52163e5 = (int) $this->domain_id;$vd02e12eb6d6c3f6ebd763197df01e211 = (int) $this->tpl_id;$vaf31437ce61345f416579830a98c91e5 = (int) $this->object_id;$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $this->ord;$vd84ff935144e00c3e1d395c2379aca47 = self::filterInputString($this->alt_name);$v4264c638e0098acb172519b0436db099 = (int) $this->is_active;$ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = (int) $this->is_visible;$vf49e2553045b3240a95c36854d36dddc = (int) $this->is_deleted;$ve0df5a999da22bc6fa9e26b115eb4ae4 = (int) $this->update_time;$vf62baf4c4ead98d50d516eca0ac5a746 = (int) $this->is_default;if($vf62baf4c4ead98d50d516eca0ac5a746) {$vac5c74b64b4b8352ef2f181affb5ac2a ="UPDATE cms3_hierarchy SET is_default = '0' WHERE is_default = '1' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);}$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_hierarchy SET rel = '{$v7ffc4d510260a8544e5550e62ec56bc1}', type_id = '{$v94757cae63fd3e398c0811a976dd6bbe}', lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}', domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}', tpl_id = '{$vd02e12eb6d6c3f6ebd763197df01e211}', obj_id = '{$vaf31437ce61345f416579830a98c91e5}', ord = '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}', alt_name = '{$vd84ff935144e00c3e1d395c2379aca47}', is_active = '{$v4264c638e0098acb172519b0436db099}', is_visible = '{$ve1c6c9ef2fcbe75f26f815c4ef2e60b4}', is_deleted = '{$vf49e2553045b3240a95c36854d36dddc}', updatetime = '{$ve0df5a999da22bc6fa9e26b115eb4ae4}', is_default = '{$vf62baf4c4ead98d50d516eca0ac5a746}' WHERE id = '{$this->id}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if ($this->is_updated) {$v06a943c59f33a34bb5924aaf72cd2995 = searchModel::getInstance();if(PAGES_AUTO_INDEX) {if($this->getIsActive() && $this->getIsDeleted() == false) {$v06a943c59f33a34bb5924aaf72cd2995->index_item($this->id);}else {$v06a943c59f33a34bb5924aaf72cd2995->unindex_items($this->id);}}}return true;}public function setIsUpdated($v50e544b8aa9b48fae6d78fb7574d402f = true) {parent::setIsUpdated($v50e544b8aa9b48fae6d78fb7574d402f);$this->update_time = time();umiHierarchy::getInstance()->addUpdatedElementId($this->id);if($this->rel) {umiHierarchy::getInstance()->addUpdatedElementId($this->rel);}}public function getIsBroken() {return $this->is_broken;}public function commit() {$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject();if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject) {$va8cfde6331bd59eb2ac96f8911c4b666->commit();$v16b2b26000987faccb260b9d39df1269 = $va8cfde6331bd59eb2ac96f8911c4b666->getId();$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();cacheFrontend::getInstance()->del($v16b2b26000987faccb260b9d39df1269, "object");$va7f1f2c46c62415198e0884b827bd2d2 = $vb81ca7c0ccaa77e7aa91936ab0070695->getObjectInstances($v16b2b26000987faccb260b9d39df1269, true, true);foreach($va7f1f2c46c62415198e0884b827bd2d2 as $va3e6bf52d6871a75cae73e5262de04af) {cacheFrontend::getInstance()->del($va3e6bf52d6871a75cae73e5262de04af, "element");}}parent::commit();}public function getObjectTypeId() {return $this->getObject()->getTypeId();}public function getHierarchyType() {return umiHierarchyTypesCollection::getInstance()->getType($this->type_id);}public function getObjectId() {return $this->object_id;}protected function getType() {$v1723bdd4ee51910267a625cae41ced8a = umiHierarchyTypesCollection::getInstance();return $v1723bdd4ee51910267a625cae41ced8a->getType($this->getTypeId());}public function getModule() {return $this->getType()->getName();}public function getMethod() {return $this->getType()->getExt();}public function delete() {umiHierarchy::getInstance()->delElement($this->id);}public function __sleep() {$vb63119da730344b345cdc8f62a4711e9 = get_class_vars(get_class($this));$vb63119da730344b345cdc8f62a4711e9['object'] = NULL;return array_keys($vb63119da730344b345cdc8f62a4711e9);}public function __get($v51746fc9cfaaf892e94c2d56d7508b37) {switch($v51746fc9cfaaf892e94c2d56d7508b37) {case "id":   return $this->id;case "objectId": return $this->object_id;case "name":  return $this->getName();case "altName":  return $this->getAltName();case "isActive": return $this->getIsActive();case "isVisible": return $this->getIsVisible();case "isDeleted": return $this->getIsDeleted();case "xlink":  return 'upage://' . $this->id;case "link": {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();return $vb81ca7c0ccaa77e7aa91936ab0070695->getPathById($this->id);}default:   return $this->getValue($v51746fc9cfaaf892e94c2d56d7508b37);}}public function __set($v51746fc9cfaaf892e94c2d56d7508b37, $v2063c1608d6e0baf80249c42e2be5804) {switch($v51746fc9cfaaf892e94c2d56d7508b37) {case "id":   throw new coreException("Object id could not be changed");case "name":  return $this->setName($v2063c1608d6e0baf80249c42e2be5804);case "altName":  return $this->setAltName($v2063c1608d6e0baf80249c42e2be5804);case "isActive": return $this->setIsActive($v2063c1608d6e0baf80249c42e2be5804);case "isVisible": return $this->setIsVisible($v2063c1608d6e0baf80249c42e2be5804);case "isDeleted": return $this->setIsDeleted($v2063c1608d6e0baf80249c42e2be5804);default:   return $this->setValue($v51746fc9cfaaf892e94c2d56d7508b37, $v2063c1608d6e0baf80249c42e2be5804);}}public function beforeSerialize($v324b23d9adc662d7f9e99634ed47ab65 = false) {static $va8cfde6331bd59eb2ac96f8911c4b666 = null;if($v324b23d9adc662d7f9e99634ed47ab65 && !is_null($va8cfde6331bd59eb2ac96f8911c4b666)) {$result = $va8cfde6331bd59eb2ac96f8911c4b666;$va8cfde6331bd59eb2ac96f8911c4b666 = null;return $result;}$va8cfde6331bd59eb2ac96f8911c4b666 = $this->object;$this->object = null;}public function afterSerialize() {$this->beforeSerialize(true);}};?>