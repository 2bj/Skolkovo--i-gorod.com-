<?php
class users extends def_module {public $user_login = "%users_anonymous_login%";public $user_id = 2;public $user_fullname = "%users_anonymous_fullname%";public $groups = "";public function __construct() {parent::__construct();define('SV_GROUP_ID', 15);define('SV_USER_ID', 14);$v38d1e18b54816e157dda5426c36970e3 = $this->getCommonTabs();if($v38d1e18b54816e157dda5426c36970e3) {$v38d1e18b54816e157dda5426c36970e3->add('users_list_all', array('users_list'));$v38d1e18b54816e157dda5426c36970e3->add('groups_list');}$this->__admin();$this->is_auth();}public function __call($v0cc175b9c0f1b6a831c399e269772661, $v92eb5ffee6ae2fec3ad71c777531578f) {return parent::__call($v0cc175b9c0f1b6a831c399e269772661, $v92eb5ffee6ae2fec3ad71c777531578f);}public function __admin() {parent::__admin();if(cmsController::getInstance()->getCurrentMode() == "admin" && !class_exists("__imp__" . get_class($this))) {$this->__loadLib("__config.php");$this->__implement("__config_" . get_class($this));$this->__loadLib("__custom_adm.php");$this->__implement("__custom_adm_users");}else {$this->__loadLib("__register.php");$this->__implement("__register_users");$this->__loadLib("__forget.php");$this->__implement("__forget_users");$this->__loadLib("__profile.php");$this->__implement("__profile_users");$this->__loadLib("__list.php");$this->__implement("__list_users");$this->__loadLib("__custom.php");$this->__implement("__custom_users");}$this->__loadLib("__import.php");$this->__implement("__imp__" . get_class($this));$this->__loadLib("__author.php");$this->__implement("__author_users");$this->__loadLib("__settings.php");$this->__implement("__settings_users");}public function login($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";$v2299078f0c50659e8da53d9dcdc55654 = getRequest('from_page');if(!$v2299078f0c50659e8da53d9dcdc55654) {$v2299078f0c50659e8da53d9dcdc55654 = getServer('REQUEST_URI');}list($v1875f8b5b688257f387df91047cf0184) = self::loadTemplates("tpls/users/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "login");$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['from_page'] = self::protectStringVariable($v2299078f0c50659e8da53d9dcdc55654);return self::parseTemplate($v1875f8b5b688257f387df91047cf0184, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function login_do() {$vd56b699830e77ba53855679cb1d252da = getRequest('login');$v5f4dcc3b5aa765d61d8327deb882cf99 = getRequest('password');$vb75604f619867058aa706f3a1dc5bd34 = getRequest('skin_sel');$v2299078f0c50659e8da53d9dcdc55654 = getRequest('from_page');if(!$vd56b699830e77ba53855679cb1d252da) return $this->auth();$permissions = permissionsCollection::getInstance();$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();$vee11cbb19052e40b07aac0ca060c23ee = $permissions->checkLogin($vd56b699830e77ba53855679cb1d252da, $v5f4dcc3b5aa765d61d8327deb882cf99);if($vee11cbb19052e40b07aac0ca060c23ee instanceof iUmiObject) {$permissions->loginAsUser($vee11cbb19052e40b07aac0ca060c23ee);session_commit();$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("users_login_successfull");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("user_id", $vee11cbb19052e40b07aac0ca060c23ee->id);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);if($v8b1dc169bf460ee884fceef66c6607d6->getCurrentMode() == "admin") {ulangStream::getLangPrefix();xslAdminTemplater::getCurrentSkinName();$this->chooseRedirect($v2299078f0c50659e8da53d9dcdc55654);}else {if(!$v2299078f0c50659e8da53d9dcdc55654) {$v2299078f0c50659e8da53d9dcdc55654 = getServer('HTTP_REFERER');}$this->redirect($v2299078f0c50659e8da53d9dcdc55654 ? $v2299078f0c50659e8da53d9dcdc55654 : ($this->pre_lang . '/users/auth/'));}}else {$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("users_login_failed");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("login", $vd56b699830e77ba53855679cb1d252da);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("password", $v5f4dcc3b5aa765d61d8327deb882cf99);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$v9b207167e5381c47682c6b4f58a623fb = '<p><warning>%users_error_loginfailed%</warning></p>%users auth()%';if($v8b1dc169bf460ee884fceef66c6607d6->getCurrentMode() == "admin") {throw new publicAdminException(getLabel('label-text-error'));}else return $this->auth();}return $v9b207167e5381c47682c6b4f58a623fb;}public function welcome($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";if($this->is_auth()) {return $this->auth($v66f6181bcb4cff4cd38fbc804a036db6);}else {return "";}}public function auth($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";if($this->is_auth()) {if(cmsController::getInstance()->getCurrentMode() == "admin") {$this->redirect($this->pre_lang . "/admin/");}else {list($v18bb029d4bde6d2762548d111ce0005a) = self::loadTemplates("tpls/users/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "logged");$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['xlink:href'] = "uobject://" . $this->user_id;$vfca1bff8ad8b3a8585abfb0ad523ba42['user_id'] = $this->user_id;$vfca1bff8ad8b3a8585abfb0ad523ba42['user_name'] = $this->user_fullname;$vfca1bff8ad8b3a8585abfb0ad523ba42['user_login'] = $this->user_login;return self::parseTemplate($v18bb029d4bde6d2762548d111ce0005a, $vfca1bff8ad8b3a8585abfb0ad523ba42, false, $this->user_id);}}else {$v9b207167e5381c47682c6b4f58a623fb = $this->login($v66f6181bcb4cff4cd38fbc804a036db6);}return $v9b207167e5381c47682c6b4f58a623fb;}public function is_auth() {static $v6c41d2cc1a45c247fe8b4146885e4cf5;if($v6c41d2cc1a45c247fe8b4146885e4cf5 === false || $v6c41d2cc1a45c247fe8b4146885e4cf5 === true) {return $v6c41d2cc1a45c247fe8b4146885e4cf5;}$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$v64701d7f752fa8fced8c627c33baaa68 = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/users/guest_id");$ve8701ad48ba05a91604e480dd60899a3 = getSession('user_id');$vd56b699830e77ba53855679cb1d252da = getSession('cms_login');$v1a1dc91c907325c69271ddf0c944bc72 = getSession('cms_pass');$this->user_login = "%users_anonymous_login%";$this->user_fullname = "%users_anonymous_fullname%";if($ve8701ad48ba05a91604e480dd60899a3) {if($ve8701ad48ba05a91604e480dd60899a3 == $v64701d7f752fa8fced8c627c33baaa68) {$this->user_id = $ve8701ad48ba05a91604e480dd60899a3;return $v6c41d2cc1a45c247fe8b4146885e4cf5 = false;}else {$vee11cbb19052e40b07aac0ca060c23ee = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);if($vee11cbb19052e40b07aac0ca060c23ee instanceof umiObject) {if($v1a1dc91c907325c69271ddf0c944bc72 != $vee11cbb19052e40b07aac0ca060c23ee->getValue('password')) {unset($_SESSION['user_id']);$this->user_id = $v64701d7f752fa8fced8c627c33baaa68;return $v6c41d2cc1a45c247fe8b4146885e4cf5 = false;}$vd56b699830e77ba53855679cb1d252da = $vee11cbb19052e40b07aac0ca060c23ee->getValue('login');$va3da707b651c79ecc39a4986516180b2 = $vee11cbb19052e40b07aac0ca060c23ee->getValue('fname');$vbfbb12dc2dce9d328e8303093db2ca33 = $vee11cbb19052e40b07aac0ca060c23ee->getValue('lname');$v1471e4e05a4db95d353cc867fe317314 = $vee11cbb19052e40b07aac0ca060c23ee->getValue('groups');$this->groups = $v1471e4e05a4db95d353cc867fe317314;$this->user_id = $ve8701ad48ba05a91604e480dd60899a3;$this->user_login = $vd56b699830e77ba53855679cb1d252da;$this->user_fullname = "{$va3da707b651c79ecc39a4986516180b2} {$vbfbb12dc2dce9d328e8303093db2ca33}";$this->updateUserLastRequestTime($ve8701ad48ba05a91604e480dd60899a3);return $v6c41d2cc1a45c247fe8b4146885e4cf5 = true;}}}if($vd56b699830e77ba53855679cb1d252da && $v1a1dc91c907325c69271ddf0c944bc72) {$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();$v87306dd4235ed712ebc07fe169b76f83 = $v0e8133eb006c0f85ed9444ae07a60842->getBaseType("users", "user");$v7ae7003da59ae71dcc9f8638ef50593d = $v0e8133eb006c0f85ed9444ae07a60842->getType($v87306dd4235ed712ebc07fe169b76f83);$v8e2ef84e859894740680432fe7d5f3d3 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId("login");$v771013e0be88b16751f79217efb28266 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId("password");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit(1);$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($v0e8133eb006c0f85ed9444ae07a60842->getChildClasses($v87306dd4235ed712ebc07fe169b76f83));$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($v8e2ef84e859894740680432fe7d5f3d3, $vd56b699830e77ba53855679cb1d252da);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($v771013e0be88b16751f79217efb28266, $v1a1dc91c907325c69271ddf0c944bc72);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);}else {$result = Array();}if(sizeof($result) == 1) {$ve8701ad48ba05a91604e480dd60899a3 = $result[0];$v7473dc8595a67e35fb56479108c76190 = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);$vd56b699830e77ba53855679cb1d252da = $v7473dc8595a67e35fb56479108c76190->getValue("login");$va3da707b651c79ecc39a4986516180b2 = $v7473dc8595a67e35fb56479108c76190->getValue("fname");$vbfbb12dc2dce9d328e8303093db2ca33 = $v7473dc8595a67e35fb56479108c76190->getValue("lname");$this->updateUserLastRequestTime($ve8701ad48ba05a91604e480dd60899a3);$v1471e4e05a4db95d353cc867fe317314 = $v7473dc8595a67e35fb56479108c76190->getValue("groups");$this->groups = $v1471e4e05a4db95d353cc867fe317314;$this->user_id = $ve8701ad48ba05a91604e480dd60899a3;$this->user_login = $vd56b699830e77ba53855679cb1d252da;$this->user_fullname = "{$va3da707b651c79ecc39a4986516180b2} {$vbfbb12dc2dce9d328e8303093db2ca33}";$_SESSION['user_id'] = $ve8701ad48ba05a91604e480dd60899a3;return $v6c41d2cc1a45c247fe8b4146885e4cf5 = true;}else {$this->user_id = $v64701d7f752fa8fced8c627c33baaa68;$_SESSION['user_id'] = $v64701d7f752fa8fced8c627c33baaa68;return $v6c41d2cc1a45c247fe8b4146885e4cf5 = false;}}public function logout() {$_SESSION['cms_login'] = "";$_SESSION['cms_pass'] = "";$_SESSION['user_id'] = false;if (isset($_SESSION['u-login'])) unset($_SESSION['u-login']);if (isset($_SESSION['u-password'])) unset($_SESSION['u-password']);if (isset($_SESSION['u-password-md5'])) unset($_SESSION['u-password-md5']);if (isset($_SESSION['u-session-id'])) unset($_SESSION['u-session-id']);$v9200dff13536775b0403786f82503726 = setcookie('u-login', "", time() - 3600, "/");$v9200dff13536775b0403786f82503726 = setcookie('u-password', "", time() - 3600, "/");$v9200dff13536775b0403786f82503726 = setcookie('u-password-md5', "", time() - 3600, "/");$v9200dff13536775b0403786f82503726 = setcookie(ini_get('session.name'), "", time() - 3600, "/");$v9200dff13536775b0403786f82503726 = setcookie('umicms_session', "", time() - 3600, "/");session_destroy();$v931812c3a2642304d0b620205c35fc08 = getRequest('redirect_url');$this->redirect($v931812c3a2642304d0b620205c35fc08);}public static function protectStringVariable($vf95f80d07ee5889d7f96248332e0f25d = "") {$vf95f80d07ee5889d7f96248332e0f25d = htmlspecialchars($vf95f80d07ee5889d7f96248332e0f25d);return $vf95f80d07ee5889d7f96248332e0f25d;}public function getFavourites($v8e44f0089b076e18a718eb9ca3d94674 = false) {if(!$v8e44f0089b076e18a718eb9ca3d94674) {$v8e44f0089b076e18a718eb9ca3d94674 = getRequest('param0');}$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$permissions = permissionsCollection::getInstance();$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$vbc6dc8a5f52db49ad53399e0b9c08578 = ulangStream::getLangPrefix();$v719e46b94442c37f8f0ff39a2a1a2bd4 = array('free', 'lite', 'freelance');$ve1d0b5628397925219f004cf551db060 = array('vote', 'forum', 'webforms');$v4844df28986273458eed2bb9a1087707 = array('search', 'stat');$vee11cbb19052e40b07aac0ca060c23ee = $v5891da2d64975cae48d175d1e001f5da->getObject($v8e44f0089b076e18a718eb9ca3d94674);if($vee11cbb19052e40b07aac0ca060c23ee instanceof iUmiObject == false) return;$vceb594c5f1b9a87761fe1885ffc65259 = $permissions->isAllowedMethod($v8e44f0089b076e18a718eb9ca3d94674, 'data', 'trash');$v9df58516747c6f40be3a2f80190229c5 = explode(',', $vee11cbb19052e40b07aac0ca060c23ee->user_dock);$v691d502cfd0e0626cd3b058e5682ad1c = array();foreach($v9df58516747c6f40be3a2f80190229c5 as $v52a43e48ec4649dee819dadabcab1bde) {if($vb1444fb0c07653567ad325aa25d4e37a->getVal('/modules/' . $v52a43e48ec4649dee819dadabcab1bde) == false && $v52a43e48ec4649dee819dadabcab1bde != 'trash') continue;if($permissions->isAllowedModule(false, $v52a43e48ec4649dee819dadabcab1bde) == false) {if($v52a43e48ec4649dee819dadabcab1bde == 'trash') {if($vceb594c5f1b9a87761fe1885ffc65259 == false) continue;}else continue;}if(defined('CURRENT_VERSION_LINE')) {if(in_array(CURRENT_VERSION_LINE, $v719e46b94442c37f8f0ff39a2a1a2bd4)) {if($v52a43e48ec4649dee819dadabcab1bde == 'data') continue;if(CURRENT_VERSION_LINE != 'freelance' && in_array($v52a43e48ec4649dee819dadabcab1bde, $ve1d0b5628397925219f004cf551db060)) continue;}}if(DB_DRIVER == 'xml' && in_array($v52a43e48ec4649dee819dadabcab1bde, $v4844df28986273458eed2bb9a1087707)) continue;if($vbc6dc8a5f52db49ad53399e0b9c08578 != "ru" && $v52a43e48ec4649dee819dadabcab1bde == "seo") continue;$v691d502cfd0e0626cd3b058e5682ad1c[] = self::parseTemplate("", array(    'attribute:id' => $v52a43e48ec4649dee819dadabcab1bde,    'attribute:label' => getLabel('module-' . $v52a43e48ec4649dee819dadabcab1bde)   ));}return self::parseTemplate("", array(   'subnodes:items' => $v691d502cfd0e0626cd3b058e5682ad1c  ));}public function updateUserLastRequestTime($ve8701ad48ba05a91604e480dd60899a3) {if($ve8701ad48ba05a91604e480dd60899a3 == 2373) {return false;}$v7473dc8595a67e35fb56479108c76190 = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);if($v7473dc8595a67e35fb56479108c76190 instanceof iUmiObject == false) {return false;}if(cmsController::getInstance()->getCurrentMode() != "admin") {$v07cc694b9b3fc636710fa08b6922c42b = time();if(($v7473dc8595a67e35fb56479108c76190->last_request_time + 60) < $v07cc694b9b3fc636710fa08b6922c42b) {$v7473dc8595a67e35fb56479108c76190->last_request_time = $v07cc694b9b3fc636710fa08b6922c42b;$v7473dc8595a67e35fb56479108c76190->commit();}}}public function getObjectEditLink($v16b2b26000987faccb260b9d39df1269, $v599dcce2998a6b40b1e38e8c6006cb0a) {return $this->pre_lang . "/admin/users/edit/" . $v16b2b26000987faccb260b9d39df1269 . "/";}public function checkIsUniqueEmail($v0c83f57c786a0b4a39efab23731c7ebc, $v8e44f0089b076e18a718eb9ca3d94674 = false) {if(!$v0c83f57c786a0b4a39efab23731c7ebc) return false;$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('users', 'user');$v8be74552df93e31bbdd6b36ed74bdb6a->where('e-mail')->equals($v0c83f57c786a0b4a39efab23731c7ebc);$v8be74552df93e31bbdd6b36ed74bdb6a->limit(0, 1);if($v8be74552df93e31bbdd6b36ed74bdb6a->first) {return ($v8e44f0089b076e18a718eb9ca3d94674 !== false) ? ($v8be74552df93e31bbdd6b36ed74bdb6a->first->id == $v8e44f0089b076e18a718eb9ca3d94674) : false;}else return true;}public function checkIsUniqueLogin($vd56b699830e77ba53855679cb1d252da, $v8e44f0089b076e18a718eb9ca3d94674 = false) {if(!$vd56b699830e77ba53855679cb1d252da) return false;$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('users', 'user');$v8be74552df93e31bbdd6b36ed74bdb6a->where('name')->equals($vd56b699830e77ba53855679cb1d252da);$v8be74552df93e31bbdd6b36ed74bdb6a->limit(0, 1);if($v8be74552df93e31bbdd6b36ed74bdb6a->first) {return ($v8e44f0089b076e18a718eb9ca3d94674 !== false) ? $v8be74552df93e31bbdd6b36ed74bdb6a->first->id : false;}else return true;}};?>
