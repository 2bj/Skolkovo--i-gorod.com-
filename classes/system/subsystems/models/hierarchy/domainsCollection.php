<?php
 class domainsCollection extends singleton implements iSingleton, iDomainsCollection {private $domains = Array(), $def_domain;protected function __construct() {$this->loadDomains();}public static function getInstance() {return parent::getInstance(__CLASS__);}public function addDomain($v67b3dba8bc6778101892eb77249db32e, $v78e6dd7a49f5b0cb2106a3a434dd5c86, $vf62baf4c4ead98d50d516eca0ac5a746 = false) {if($v662cbf1253ac7d8750ed9190c52163e5 = $this->getDomainId($v67b3dba8bc6778101892eb77249db32e)) {return $v662cbf1253ac7d8750ed9190c52163e5;}else {cacheFrontend::getInstance()->flush();$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_domains VALUES()";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v662cbf1253ac7d8750ed9190c52163e5 = mysql_insert_id();$this->domains[$v662cbf1253ac7d8750ed9190c52163e5] = $vad5f82e879a9c5d6b5b442eb37e50551 = new domain($v662cbf1253ac7d8750ed9190c52163e5);$vad5f82e879a9c5d6b5b442eb37e50551->setHost($v67b3dba8bc6778101892eb77249db32e);$vad5f82e879a9c5d6b5b442eb37e50551->setIsDefault($vf62baf4c4ead98d50d516eca0ac5a746);$vad5f82e879a9c5d6b5b442eb37e50551->setDefaultLangId($v78e6dd7a49f5b0cb2106a3a434dd5c86);if($vf62baf4c4ead98d50d516eca0ac5a746) $this->setDefaultDomain($v662cbf1253ac7d8750ed9190c52163e5);$vad5f82e879a9c5d6b5b442eb37e50551->commit();return $v662cbf1253ac7d8750ed9190c52163e5;}}public function setDefaultDomain($v662cbf1253ac7d8750ed9190c52163e5) {if($this->isExists($v662cbf1253ac7d8750ed9190c52163e5)) {cacheFrontend::getInstance()->flush();$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_domains SET is_default = '0' WHERE is_default = '1'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v2dc2d350ce3298213f154e90eb3211c3 = $this->getDefaultDomain()) {$v2dc2d350ce3298213f154e90eb3211c3->setIsDefault(false);$v2dc2d350ce3298213f154e90eb3211c3->commit();}$this->def_domain = $v662cbf1253ac7d8750ed9190c52163e5;$this->def_domain->setIsDefault(true);$this->def_domain->commit();}else return false;}public function delDomain($v662cbf1253ac7d8750ed9190c52163e5) {if($this->isExists($v662cbf1253ac7d8750ed9190c52163e5)) {$vad5f82e879a9c5d6b5b442eb37e50551 = $this->getDomain($v662cbf1253ac7d8750ed9190c52163e5);$vad5f82e879a9c5d6b5b442eb37e50551->delAllMirrows();cacheFrontend::getInstance()->flush();if($vad5f82e879a9c5d6b5b442eb37e50551->getIsDefault()) {$this->def_domain = false;}unset($vad5f82e879a9c5d6b5b442eb37e50551);unset($this->domains[$v662cbf1253ac7d8750ed9190c52163e5]);$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_hierarchy WHERE domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_domains WHERE id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}else throw new coreException("Domain #{$v662cbf1253ac7d8750ed9190c52163e5} doesn't exists.");}public function getDomain($v662cbf1253ac7d8750ed9190c52163e5) {return $this->isExists($v662cbf1253ac7d8750ed9190c52163e5) ? $this->domains[$v662cbf1253ac7d8750ed9190c52163e5] : false;}public function getDefaultDomain() {return ($this->def_domain) ? $this->def_domain : false;}public function getList() {return $this->domains;}public function isExists($v662cbf1253ac7d8750ed9190c52163e5) {return (bool) array_key_exists($v662cbf1253ac7d8750ed9190c52163e5, $this->domains);}public function getDomainId($v67b3dba8bc6778101892eb77249db32e, $vee68968f28c875319a24db7a4687bcc6 = true) {foreach($this->domains as $vad5f82e879a9c5d6b5b442eb37e50551) {if($vad5f82e879a9c5d6b5b442eb37e50551->getHost() == $v67b3dba8bc6778101892eb77249db32e) {return $vad5f82e879a9c5d6b5b442eb37e50551->getId();}else {if($vee68968f28c875319a24db7a4687bcc6) {$v1971009c5db21ab4fa6ae028d9fd2c9f = $vad5f82e879a9c5d6b5b442eb37e50551->getMirrowsList();foreach($v1971009c5db21ab4fa6ae028d9fd2c9f as $v15515d42c0242547a1c1972abb21cfad) {if($v15515d42c0242547a1c1972abb21cfad->getHost() == $v67b3dba8bc6778101892eb77249db32e) {return $vad5f82e879a9c5d6b5b442eb37e50551->getId();}}}}}return false;}private function loadDomains() {$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$v926a85278ca49b9c4de5ca08a420fa6d = $vb99eb979e6f6efabc396f777b503f7e7->loadData('domains_list');if(!is_array($v926a85278ca49b9c4de5ca08a420fa6d)) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id, host, is_default, default_lang_id FROM cms3_domains";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v926a85278ca49b9c4de5ca08a420fa6d = array();while(list($v662cbf1253ac7d8750ed9190c52163e5) = $vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result)) {$v926a85278ca49b9c4de5ca08a420fa6d[$v662cbf1253ac7d8750ed9190c52163e5] = $vf1965a857bc285d26fe22023aa5ab50d;}$vb99eb979e6f6efabc396f777b503f7e7->saveData('domains_list', $v926a85278ca49b9c4de5ca08a420fa6d, 3600);}else $vf1965a857bc285d26fe22023aa5ab50d = false;foreach($v926a85278ca49b9c4de5ca08a420fa6d as $v662cbf1253ac7d8750ed9190c52163e5 => $vf1965a857bc285d26fe22023aa5ab50d) {$vad5f82e879a9c5d6b5b442eb37e50551 = $vb99eb979e6f6efabc396f777b503f7e7->load($v662cbf1253ac7d8750ed9190c52163e5, 'domain');if($vad5f82e879a9c5d6b5b442eb37e50551 instanceof domain == false) {try {$vad5f82e879a9c5d6b5b442eb37e50551 = new domain($v662cbf1253ac7d8750ed9190c52163e5, $vf1965a857bc285d26fe22023aa5ab50d);}catch(privateException $ve1671797c52e15f763380b45e841ec32) {continue;}$vb99eb979e6f6efabc396f777b503f7e7->save($vad5f82e879a9c5d6b5b442eb37e50551, 'domain');}$this->domains[$v662cbf1253ac7d8750ed9190c52163e5] = $vad5f82e879a9c5d6b5b442eb37e50551;if($vad5f82e879a9c5d6b5b442eb37e50551->getIsDefault()) {$this->def_domain = $vad5f82e879a9c5d6b5b442eb37e50551;}}return true;}}?>