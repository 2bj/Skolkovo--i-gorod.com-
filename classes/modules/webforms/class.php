<?php
class webforms extends def_module {public function __construct() {parent::__construct();if(cmsController::getInstance()->getCurrentMode() == "admin") {$this->__loadLib("__admin.php");$this->__implement("__webforms");$v38d1e18b54816e157dda5426c36970e3 = $this->getCommonTabs();if($v38d1e18b54816e157dda5426c36970e3) {$v38d1e18b54816e157dda5426c36970e3->add("addresses");if(!in_array(CURRENT_VERSION_LINE, array("free", "lite", "freelance")) ) {$v38d1e18b54816e157dda5426c36970e3->add("forms");$v38d1e18b54816e157dda5426c36970e3->add("templates");$v38d1e18b54816e157dda5426c36970e3->add("messages");}}}else {$this->__loadLib("__custom.php");$this->__implement("__custom_webforms");}$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();if(!$vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/webforms/imported')) {if(!defined('DB_DRIVER') || DB_DRIVER != 'xml') {$vc56c4b05ed55494b480fe745c3c24542 = umiObjectsCollection::getInstance();$v963cecbdfa91757f2c7a4a9e794f3da7     = umiObjectTypesCollection::getInstance()->getBaseType('webforms', 'address');$va94ce50ec7c649aefc2936a423013e83    = 'SELECT * FROM cms_webforms';$v39039f6df7f3f60965be6337ab051e66 = mysql_query($va94ce50ec7c649aefc2936a423013e83);while($vad4f3b23a9c1baee57e5d091271a0053 = mysql_fetch_assoc($v39039f6df7f3f60965be6337ab051e66)) {$v8c1604c64857e79a748c27062fedf5a2     = $vc56c4b05ed55494b480fe745c3c24542->addObject($vad4f3b23a9c1baee57e5d091271a0053['id'], $v963cecbdfa91757f2c7a4a9e794f3da7);$vd82f268d5a82fc66260ad083d1a2e5b4 = $vc56c4b05ed55494b480fe745c3c24542->getObject($v8c1604c64857e79a748c27062fedf5a2);$vd82f268d5a82fc66260ad083d1a2e5b4->setValue('address_description', $vad4f3b23a9c1baee57e5d091271a0053['descr']);$vd82f268d5a82fc66260ad083d1a2e5b4->setValue('address_list', $vad4f3b23a9c1baee57e5d091271a0053['email']);$vd82f268d5a82fc66260ad083d1a2e5b4->setValue('insert_id', $vad4f3b23a9c1baee57e5d091271a0053['id']);$vd82f268d5a82fc66260ad083d1a2e5b4->commit();}mysql_query('TRUNCATE TABLE cms_webforms');}$vb1444fb0c07653567ad325aa25d4e37a->setVal('//modules/webforms/imported', 1);}}public function getEditLink($v7057e8409c7c531a1a6e9ac3df4ed549, $vb8910fa4dc8f637c214b8e9094ef35b9) {return array(false, '/admin/content/edit/'.$v7057e8409c7c531a1a6e9ac3df4ed549.'/');}public function page() {if($this->breakMe()) return;$v4d424a5679c0aa6e84a0235ec1949c43 = cmsController::getInstance();$va6eb4816205178e88dad66a16a19ff45 = $v4d424a5679c0aa6e84a0235ec1949c43->getCurrentElementId();if($vd34fec3e69adc884a61c941174d12dc0 = $v4d424a5679c0aa6e84a0235ec1949c43->getModule('content'))   return $vd34fec3e69adc884a61c941174d12dc0->content($va6eb4816205178e88dad66a16a19ff45);return false;}public function getBindedPage($v307b98da43f9d6c6fb4d231412b42631 = false) {if($v307b98da43f9d6c6fb4d231412b42631 === false) {$v307b98da43f9d6c6fb4d231412b42631 = ($vfa816edb83e95bf0c8da580bdfd491ef = getRequest('param0')) ? $vfa816edb83e95bf0c8da580bdfd491ef : $v307b98da43f9d6c6fb4d231412b42631;}if(!$v307b98da43f9d6c6fb4d231412b42631) return array('page'=>array('attribute:id'=>0));$vdb2eba2d5a30015b3103e1325f067551  = umiHierarchyTypesCollection::getInstance()->getTypeByName('webforms', 'page');$v5f694956811487225d15e973ca38fbab = umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($vdb2eba2d5a30015b3103e1325f067551->getId());$v599dcce2998a6b40b1e38e8c6006cb0a   = umiObjectTypesCollection::getInstance()->getType($v5f694956811487225d15e973ca38fbab);$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($vdb2eba2d5a30015b3103e1325f067551->getId());$v8be74552df93e31bbdd6b36ed74bdb6a->addActiveFilter(true);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual( $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId('form_id'), $v307b98da43f9d6c6fb4d231412b42631 );$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);if(!empty($result))    return array('page'=>array('attribute:id'=>$result[0], 'attribute:href'=>umiHierarchy::getInstance()->getPathById($result[0])));$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($vdb2eba2d5a30015b3103e1325f067551->getId());$v8be74552df93e31bbdd6b36ed74bdb6a->addActiveFilter(false);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual( $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId('form_id'), $v307b98da43f9d6c6fb4d231412b42631 );$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);if(!empty($result))    return array('page'=>array('attribute:id'=>$result[0], 'attribute:href'=>umiHierarchy::getInstance()->getPathById($result[0])));return array('page'=>array('attribute:id'=>0));}private function getPropertyValue(umiObject $vbe8f80182e0c983916da7338c2c1c040, $v46b9e6004c49d9cc040029c197cab278) {if($v23a5b8ab834cb5140fa6665622eb6417 = $vbe8f80182e0c983916da7338c2c1c040->getPropByName($v46b9e6004c49d9cc040029c197cab278)) {switch($v23a5b8ab834cb5140fa6665622eb6417->getDataType()) {case 'date' : {if(($v5fc732311905cb27e82d67f4f6511f7f = $v23a5b8ab834cb5140fa6665622eb6417->getValue()) instanceof umiDate)      return $v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate();return '';}case 'relation': {$result = array();$vbf516925bb37a8544c8ee19a24e15c05    = $v23a5b8ab834cb5140fa6665622eb6417->getValue();if(!is_array($vbf516925bb37a8544c8ee19a24e15c05)) $vbf516925bb37a8544c8ee19a24e15c05 = array($vbf516925bb37a8544c8ee19a24e15c05);foreach($vbf516925bb37a8544c8ee19a24e15c05 as $vb80bb7740288fda1f201890375a60c8f) {if($v2063c1608d6e0baf80249c42e2be5804 = umiObjectsCollection::getInstance()->getObject($vb80bb7740288fda1f201890375a60c8f)) {$result[] = $v2063c1608d6e0baf80249c42e2be5804->getName();}}return empty($result) ? '' : implode(', ', $result);}case 'boolean': {$v5a05866850c28651fe234659f6c92ada = cmsController::getInstance()->langs;$v2063c1608d6e0baf80249c42e2be5804 = $v23a5b8ab834cb5140fa6665622eb6417->getValue();return $v2063c1608d6e0baf80249c42e2be5804 ? $v5a05866850c28651fe234659f6c92ada['boolean_true'] : $v5a05866850c28651fe234659f6c92ada['boolean_false'] ;}default: return $v23a5b8ab834cb5140fa6665622eb6417->getValue();}}return '';}public function formatMessage($_iMessageId, $_bProcessAll = false) {$vfc5ecff8bf18f57d6c531d097242e888    = umiObjectsCollection::getInstance();$va6c14a9f66c0d4991a26650d653fe785  = umiObjectTypesCollection::getInstance()->getBaseType('webforms', 'template');$v6b1ccda374484ed882a205b82a4779d5    = array('from_email_template' => '', 'from_template'=>'', 'subject_template'=>'', 'master_template'=>'', 'autoreply_from_email_template'=>'', 'autoreply_from_template'=>'', 'autoreply_subject_template'=>'', 'autoreply_template'=>'');$vcb5f4ad7207c057352ca1f1d7555035a    = $vfc5ecff8bf18f57d6c531d097242e888->getObject($_iMessageId);$vc8817601983fc326b1b304ca47a1a933 = $vcb5f4ad7207c057352ca1f1d7555035a->getTypeId();$vb3d22b06afa2487fe5ed4f0f3919aa83     = umiObjectTypesCollection::getInstance()->getType($vc8817601983fc326b1b304ca47a1a933)->getAllFields(true);$v434562cd71f8a6b1a9c345a90267abf9    = umiObjectTypesCollection::getInstance()->getType($va6c14a9f66c0d4991a26650d653fe785);$v28bfcfa5817454e27c68c4c6165c6d1d  = new umiSelection;$v28bfcfa5817454e27c68c4c6165c6d1d->addObjectType( $va6c14a9f66c0d4991a26650d653fe785 );$v28bfcfa5817454e27c68c4c6165c6d1d->addPropertyFilterEqual($v434562cd71f8a6b1a9c345a90267abf9->getFieldId('form_id'), $vc8817601983fc326b1b304ca47a1a933);$v28bfcfa5817454e27c68c4c6165c6d1d->setPropertyFilter();$v1f0492ad97b8c76253171279acc6bc65  = umiSelectionsParser::runSelection($v28bfcfa5817454e27c68c4c6165c6d1d);$v588814ea8388bbd1c7cb1948306ca29e   = empty($v1f0492ad97b8c76253171279acc6bc65) ? false : $vfc5ecff8bf18f57d6c531d097242e888->getObject( $v1f0492ad97b8c76253171279acc6bc65[0] );if(!$v588814ea8388bbd1c7cb1948306ca29e) {$vd19ba8682c84b8d6b3deccef08151a38 = '';foreach($vb3d22b06afa2487fe5ed4f0f3919aa83 as $v2017d400f0721e7ec4bf10b008d381be) {$vd19ba8682c84b8d6b3deccef08151a38 .= $this->getPropertyValue($vcb5f4ad7207c057352ca1f1d7555035a, $v2017d400f0721e7ec4bf10b008d381be->getName()) . "<br />\n";}if($_bProcessAll) $v6b1ccda374484ed882a205b82a4779d5['master_template'] = $vd19ba8682c84b8d6b3deccef08151a38;else              $v6b1ccda374484ed882a205b82a4779d5 = $vd19ba8682c84b8d6b3deccef08151a38;}else {if($_bProcessAll) {$v6b1ccda374484ed882a205b82a4779d5 = array();$vb3d22b06afa2487fe5ed4f0f3919aa83  = umiObjectTypesCollection::getInstance()->getType( $v588814ea8388bbd1c7cb1948306ca29e->getTypeId() )->getAllFields();foreach($vb3d22b06afa2487fe5ed4f0f3919aa83 as $v2017d400f0721e7ec4bf10b008d381be) {$vc691ed6bf2621f90ec88cbc6c729eb09     = array();$v4b522982caa4aa985432277c73e00619 = $v2017d400f0721e7ec4bf10b008d381be->getName();$v39f17319be96f2b5889115ba057e5c2a  = str_replace(array("&#037;", "&#37;"), "%", $v588814ea8388bbd1c7cb1948306ca29e->getValue($v4b522982caa4aa985432277c73e00619));preg_match_all("/%[A-z0-9_]+%/", $v39f17319be96f2b5889115ba057e5c2a, $vc691ed6bf2621f90ec88cbc6c729eb09);foreach($vc691ed6bf2621f90ec88cbc6c729eb09[0] as $v17a9b2320d701f4a9c7bdfdb56267f19)       $v39f17319be96f2b5889115ba057e5c2a = str_replace($v17a9b2320d701f4a9c7bdfdb56267f19, $this->getPropertyValue($vcb5f4ad7207c057352ca1f1d7555035a, trim($v17a9b2320d701f4a9c7bdfdb56267f19, '% ')), $v39f17319be96f2b5889115ba057e5c2a);$v6b1ccda374484ed882a205b82a4779d5[$v4b522982caa4aa985432277c73e00619] = $v39f17319be96f2b5889115ba057e5c2a;}}else {$v39f17319be96f2b5889115ba057e5c2a = str_replace("&#037;", "%", $v588814ea8388bbd1c7cb1948306ca29e->getValue('master_template'));preg_match_all("/%[A-z0-9_]+%/", $v39f17319be96f2b5889115ba057e5c2a, $vc691ed6bf2621f90ec88cbc6c729eb09);foreach($vc691ed6bf2621f90ec88cbc6c729eb09[0] as $v17a9b2320d701f4a9c7bdfdb56267f19)      $v39f17319be96f2b5889115ba057e5c2a = str_replace($v17a9b2320d701f4a9c7bdfdb56267f19, $this->getPropertyValue($vcb5f4ad7207c057352ca1f1d7555035a, trim($v17a9b2320d701f4a9c7bdfdb56267f19, '% ')), $v39f17319be96f2b5889115ba057e5c2a);$v6b1ccda374484ed882a205b82a4779d5 = $v39f17319be96f2b5889115ba057e5c2a;}}return $v6b1ccda374484ed882a205b82a4779d5;}public function guessAddressId($_sAddress) {if(is_numeric($_sAddress)) return $_sAddress;$_sFind     = str_replace( array(' ', ','), array('%', '%'), $_sAddress );$v69d8e0d7451cce623d8d6bc078646534     = umiObjectTypesCollection::getInstance();$v963cecbdfa91757f2c7a4a9e794f3da7    = $v69d8e0d7451cce623d8d6bc078646534->getBaseType('webforms', 'address');$v28bfcfa5817454e27c68c4c6165c6d1d = new umiSelection;$v28bfcfa5817454e27c68c4c6165c6d1d->addObjectType( $v963cecbdfa91757f2c7a4a9e794f3da7 );$v28bfcfa5817454e27c68c4c6165c6d1d->addPropertyFilterLike( $v69d8e0d7451cce623d8d6bc078646534->getType($v963cecbdfa91757f2c7a4a9e794f3da7)->getFieldId('address_list') , $_sFind);$v09dbbbbb33bce9accf8459a7a164ba44      = umiSelectionsParser::runSelection($v28bfcfa5817454e27c68c4c6165c6d1d);return (!empty($v09dbbbbb33bce9accf8459a7a164ba44)) ? $v09dbbbbb33bce9accf8459a7a164ba44[0] : $_sAddress;}public function checkAddressExistence($_sAddress) {$vea170e2cafb1337755c8b3d5ae4437f4   = '%' . $_sAddress . '%';$v69d8e0d7451cce623d8d6bc078646534     = umiObjectTypesCollection::getInstance();$v963cecbdfa91757f2c7a4a9e794f3da7    = $v69d8e0d7451cce623d8d6bc078646534->getBaseType('webforms', 'address');$v28bfcfa5817454e27c68c4c6165c6d1d = new umiSelection;$v28bfcfa5817454e27c68c4c6165c6d1d->addObjectType( $v963cecbdfa91757f2c7a4a9e794f3da7 );$v28bfcfa5817454e27c68c4c6165c6d1d->addPropertyFilterLike( $v69d8e0d7451cce623d8d6bc078646534->getType($v963cecbdfa91757f2c7a4a9e794f3da7)->getFieldId('address_list') , $vea170e2cafb1337755c8b3d5ae4437f4);$ve2942a04780e223b215eb8b663cf5353      = umiSelectionsParser::runSelectionCounts($v28bfcfa5817454e27c68c4c6165c6d1d);if(!$ve2942a04780e223b215eb8b663cf5353) {throw new publicException('%unknown_address%');}}public function guessAddressValue($_iID) {if(is_numeric($_iID)) {$vfc5ecff8bf18f57d6c531d097242e888 = umiObjectsCollection::getInstance();if(!$vfc5ecff8bf18f57d6c531d097242e888->isExists($_iID)) return $_iID;return $vfc5ecff8bf18f57d6c531d097242e888->getObject($_iID)->getValue('address_list');}else {$this->checkAddressExistence($_iID);return $_iID;}}public function guessAddressName($_iID) {if(is_numeric($_iID)) {$vfc5ecff8bf18f57d6c531d097242e888 = umiObjectsCollection::getInstance();if(!$vfc5ecff8bf18f57d6c531d097242e888->isExists($_iID)) return false;return $vfc5ecff8bf18f57d6c531d097242e888->getObject($_iID)->getName();}else {return $_iID;}}public function checkRequiredFields($v5f694956811487225d15e973ca38fbab) {$ve62e4d22f2d8630f6e44e2b7c3f70ddc = getRequest('data');if((!$ve62e4d22f2d8630f6e44e2b7c3f70ddc || !@is_array($ve62e4d22f2d8630f6e44e2b7c3f70ddc['new'])) && (!isset($_FILES['data']['name']['new'])) ) {$ve62e4d22f2d8630f6e44e2b7c3f70ddc = array();}else {$vfa816edb83e95bf0c8da580bdfd491ef = array();if(@is_array($ve62e4d22f2d8630f6e44e2b7c3f70ddc['new']))    $vfa816edb83e95bf0c8da580bdfd491ef = array_merge($vfa816edb83e95bf0c8da580bdfd491ef, $ve62e4d22f2d8630f6e44e2b7c3f70ddc['new']);if(isset($_FILES['data']['name']['new']) && is_array($_FILES['data']['name']['new']))    $vfa816edb83e95bf0c8da580bdfd491ef = array_merge($vfa816edb83e95bf0c8da580bdfd491ef, $_FILES['data']['name']['new']);$ve62e4d22f2d8630f6e44e2b7c3f70ddc = $vfa816edb83e95bf0c8da580bdfd491ef;}$v070b66f82a0cbca506de4ff9f468658c   = umiObjectTypesCollection::getInstance()->getType($v5f694956811487225d15e973ca38fbab)->getAllFields();$v9a1d2ad0d1938a6ce3f94fd6bf7406b8 = array();foreach($v070b66f82a0cbca506de4ff9f468658c as $v06e3d36fa30cea095545139854ad1fb9) {if($v06e3d36fa30cea095545139854ad1fb9->getIsRequired()) {$v972bf3f05d14ffbdb817bef60638ff00 = $v06e3d36fa30cea095545139854ad1fb9->getName();if(!isset($ve62e4d22f2d8630f6e44e2b7c3f70ddc[$v972bf3f05d14ffbdb817bef60638ff00]) || !strlen($ve62e4d22f2d8630f6e44e2b7c3f70ddc[$v972bf3f05d14ffbdb817bef60638ff00])) {$v9a1d2ad0d1938a6ce3f94fd6bf7406b8[] = $v06e3d36fa30cea095545139854ad1fb9->getId();}}}return !empty($v9a1d2ad0d1938a6ce3f94fd6bf7406b8) ? $v9a1d2ad0d1938a6ce3f94fd6bf7406b8 : true;}public function assembleErrorFields($v9a1d2ad0d1938a6ce3f94fd6bf7406b8) {$result     = array();$vdb6d9b451b818ccc9a449383f2f0c450 = umiFieldsCollection::getInstance();foreach($v9a1d2ad0d1938a6ce3f94fd6bf7406b8 as $v945100186b119048837b9859c2c46410){$v06e3d36fa30cea095545139854ad1fb9 = $vdb6d9b451b818ccc9a449383f2f0c450->getField($v945100186b119048837b9859c2c46410);$result[] = $v06e3d36fa30cea095545139854ad1fb9->getTitle();}return !empty($result) ? implode(', ', $result) : '';}private function writeAddressSelect($v66f6181bcb4cff4cd38fbc804a036db6) {list($v14511f2f5564650d129ca7cabc333278, $v6438c669e0d0de98e6929c2cc0fac474) = def_module::loadTemplates("tpls/data/reflection/".$v66f6181bcb4cff4cd38fbc804a036db6.".tpl", "address_select_block", 'address_select_block_line');$vfc5ecff8bf18f57d6c531d097242e888   = umiObjectsCollection::getInstance();$v28bfcfa5817454e27c68c4c6165c6d1d = new umiSelection;$v28bfcfa5817454e27c68c4c6165c6d1d->addObjectType( umiObjectTypesCollection::getInstance()->getBaseType('webforms', 'address') );$v09dbbbbb33bce9accf8459a7a164ba44      = umiSelectionsParser::runSelection($v28bfcfa5817454e27c68c4c6165c6d1d);$v30690957e49e38626486e46e6d6f665e  = array();foreach($v09dbbbbb33bce9accf8459a7a164ba44 as $v41b5ebf97022261268985726508135e2) {$vb790175058e05911758cdaedd66fe5d9  = $vfc5ecff8bf18f57d6c531d097242e888->getObject($v41b5ebf97022261268985726508135e2)->getValue('address_description');$v007d8c3c5f894c63ad8af6f491aa6dac  = array();$v007d8c3c5f894c63ad8af6f491aa6dac['attribute:id'] = $v41b5ebf97022261268985726508135e2;$v007d8c3c5f894c63ad8af6f491aa6dac['node:text'] = $vb790175058e05911758cdaedd66fe5d9;$v30690957e49e38626486e46e6d6f665e[] = self::parseTemplate($v6438c669e0d0de98e6929c2cc0fac474, $v007d8c3c5f894c63ad8af6f491aa6dac);}$v017b0f18009a57a2723c5baf03fe7a95 = array();$v017b0f18009a57a2723c5baf03fe7a95['void:options'] = $v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v30690957e49e38626486e46e6d6f665e;return self::parseTemplate($v14511f2f5564650d129ca7cabc333278, $v017b0f18009a57a2723c5baf03fe7a95);}private function writeSeparateAddresses($va0f384e8c830d06cd00a325b21d5a43e, $v66f6181bcb4cff4cd38fbc804a036db6) {list($v14511f2f5564650d129ca7cabc333278, $v6438c669e0d0de98e6929c2cc0fac474) = def_module::loadTemplates("tpls/data/reflection/".$v66f6181bcb4cff4cd38fbc804a036db6.".tpl", "address_separate_block", 'address_separate_block_line');$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectsCollection::getInstance();$v30690957e49e38626486e46e6d6f665e = array();foreach($va0f384e8c830d06cd00a325b21d5a43e as $vb80bb7740288fda1f201890375a60c8f) {if($v884d9804999fc47a3c2694e49ad2536a = $vdb6d9b451b818ccc9a449383f2f0c450->getObject($vb80bb7740288fda1f201890375a60c8f)) {$ve1096cde0e7e98b154a5494ac0d1b1d0 = array();$ve1096cde0e7e98b154a5494ac0d1b1d0['id']          = 'address_'.$vb80bb7740288fda1f201890375a60c8f;$ve1096cde0e7e98b154a5494ac0d1b1d0['name']    = 'system_email_to[]';$ve1096cde0e7e98b154a5494ac0d1b1d0['value']    = $vb80bb7740288fda1f201890375a60c8f;$ve1096cde0e7e98b154a5494ac0d1b1d0['description'] = $v884d9804999fc47a3c2694e49ad2536a->getValue('address_description');$v30690957e49e38626486e46e6d6f665e[] = self::parseTemplate($v6438c669e0d0de98e6929c2cc0fac474, $ve1096cde0e7e98b154a5494ac0d1b1d0);}}$v017b0f18009a57a2723c5baf03fe7a95 = array();$v017b0f18009a57a2723c5baf03fe7a95['void:lines'] = $v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v30690957e49e38626486e46e6d6f665e;return self::parseTemplate($v14511f2f5564650d129ca7cabc333278, $v017b0f18009a57a2723c5baf03fe7a95);}public function add($vd6cba1ad2c0b131207c9dc2584126130 = false, $v53d670af9bb16ea82e7ef41ee23ec6df = "", $v66f6181bcb4cff4cd38fbc804a036db6="webforms") {$v007d8c3c5f894c63ad8af6f491aa6dac   = array();$v16017a754a8bde75200a80d719efd650       = '';$v69d8e0d7451cce623d8d6bc078646534      = umiObjectTypesCollection::getInstance();$vecd3739802ba39f77b829bab3943f71c = $v69d8e0d7451cce623d8d6bc078646534->getBaseType("webforms", "form");if(is_numeric($vd6cba1ad2c0b131207c9dc2584126130)) {if(!$v69d8e0d7451cce623d8d6bc078646534->isExists($vd6cba1ad2c0b131207c9dc2584126130) || $v69d8e0d7451cce623d8d6bc078646534->getParentClassId($vd6cba1ad2c0b131207c9dc2584126130) != $vecd3739802ba39f77b829bab3943f71c) {$vd6cba1ad2c0b131207c9dc2584126130 = false;}}if(!is_numeric($vd6cba1ad2c0b131207c9dc2584126130) || $vd6cba1ad2c0b131207c9dc2584126130 === false) {$v7d8f378d5c6ab456f11cc631eca138d9 = $v69d8e0d7451cce623d8d6bc078646534->getChildClasses($vecd3739802ba39f77b829bab3943f71c);if(empty($v7d8f378d5c6ab456f11cc631eca138d9)) {list($v66f6181bcb4cff4cd38fbc804a036db6) = def_module::loadTemplates("tpls/data/reflection/".$v66f6181bcb4cff4cd38fbc804a036db6.".tpl", "error_no_form");return $v66f6181bcb4cff4cd38fbc804a036db6;}else {$v865c0c0b4ab0e063e5caa3387c1a8741 = 0;do{$vdaf3dfba989f67953c5e6f71493ca89a = $v69d8e0d7451cce623d8d6bc078646534->getType($v7d8f378d5c6ab456f11cc631eca138d9[$v865c0c0b4ab0e063e5caa3387c1a8741]);$v865c0c0b4ab0e063e5caa3387c1a8741++;}while($v865c0c0b4ab0e063e5caa3387c1a8741<count($v7d8f378d5c6ab456f11cc631eca138d9) && $vdaf3dfba989f67953c5e6f71493ca89a->getName() != $vd6cba1ad2c0b131207c9dc2584126130);$vd6cba1ad2c0b131207c9dc2584126130 = $vdaf3dfba989f67953c5e6f71493ca89a->getId();}}$v007d8c3c5f894c63ad8af6f491aa6dac['attribute:form_id']  = $vd6cba1ad2c0b131207c9dc2584126130;$v007d8c3c5f894c63ad8af6f491aa6dac['attribute:template'] = $v66f6181bcb4cff4cd38fbc804a036db6;if(!strlen($v53d670af9bb16ea82e7ef41ee23ec6df)) {$v2257e5158d2780eeedcc82678b348dd7 = $this->writeAddressSelect($v66f6181bcb4cff4cd38fbc804a036db6);if(is_array($v2257e5158d2780eeedcc82678b348dd7)) {if(isset($v2257e5158d2780eeedcc82678b348dd7['items'])) $v007d8c3c5f894c63ad8af6f491aa6dac['items'] =  $v2257e5158d2780eeedcc82678b348dd7['items'];else return;}else {if(strlen($v2257e5158d2780eeedcc82678b348dd7)) $v007d8c3c5f894c63ad8af6f491aa6dac['address_select'] = $v2257e5158d2780eeedcc82678b348dd7;else return;}}else {$v88b168e5b6481933731065d1a1ce0d11 = $this->guessAddressId($v53d670af9bb16ea82e7ef41ee23ec6df);if(func_num_args() > 3) {$v963e3a2fe559e393bad631f3dc686f69 = array_slice(func_get_args(), 3);foreach($v963e3a2fe559e393bad631f3dc686f69 as &$v3ef9a0d7fab5d2bcabf0978c0a35244e) $v3ef9a0d7fab5d2bcabf0978c0a35244e = $this->guessAddressId($v3ef9a0d7fab5d2bcabf0978c0a35244e);$v963e3a2fe559e393bad631f3dc686f69 = array_merge(array($v88b168e5b6481933731065d1a1ce0d11), $v963e3a2fe559e393bad631f3dc686f69);$v007d8c3c5f894c63ad8af6f491aa6dac['res_to'] = $v007d8c3c5f894c63ad8af6f491aa6dac['address_select'] = $this->writeSeparateAddresses($v963e3a2fe559e393bad631f3dc686f69, $v66f6181bcb4cff4cd38fbc804a036db6);}else {$v007d8c3c5f894c63ad8af6f491aa6dac['res_to'] = $v007d8c3c5f894c63ad8af6f491aa6dac['address_select'] = '<input type="hidden" name="system_email_to" value="'.$v88b168e5b6481933731065d1a1ce0d11.'" />';}}$v007d8c3c5f894c63ad8af6f491aa6dac['groups'] = cmsController::getInstance()->getModule('data')->getCreateForm($vd6cba1ad2c0b131207c9dc2584126130, $v66f6181bcb4cff4cd38fbc804a036db6);list($v986eab15ced2b8e3368ee0c3f92324be) = def_module::loadTemplates("tpls/data/reflection/".$v66f6181bcb4cff4cd38fbc804a036db6.".tpl", "form_block");return self::parseTemplate($v986eab15ced2b8e3368ee0c3f92324be, $v007d8c3c5f894c63ad8af6f491aa6dac);}public function send() {if (isset($_REQUEST['captcha'])) {$_SESSION['user_captcha'] = md5((int) $_REQUEST['captcha']);}if (!umiCaptcha::checkCaptcha()) {$this->errorNewMessage("%errors_wrong_captcha%");$this->errorPanic();}$v6b1ccda374484ed882a205b82a4779d5    = '';$v69d8e0d7451cce623d8d6bc078646534      = umiObjectTypesCollection::getInstance();$vecd3739802ba39f77b829bab3943f71c = $v69d8e0d7451cce623d8d6bc078646534->getBaseType("webforms", "form");$vc8817601983fc326b1b304ca47a1a933 = $_REQUEST['system_form_id'];$ve950fd0bf7ca9cdb49df8d7e244e669a   = $_SERVER['REMOTE_ADDR'];$vab88bd4e7e44b5e05aab3f182f76db1f       = new umiDate( time() );$v092d4e13eb3d3b1b20a807ed068431a9  = getRequest('system_email_to');if(!is_array($v092d4e13eb3d3b1b20a807ed068431a9)) $v092d4e13eb3d3b1b20a807ed068431a9 = array($v092d4e13eb3d3b1b20a807ed068431a9);$v7ab1518eadc49cb54957164a00f4ae29 = array();foreach($v092d4e13eb3d3b1b20a807ed068431a9 as $v884d9804999fc47a3c2694e49ad2536a){$v39c2c5b6d82b66423d37cc0c26bfcd0d = $this->guessAddressValue($v884d9804999fc47a3c2694e49ad2536a);$v7b914989a934081f3a630ba4af0d2161 = $this->guessAddressName($v884d9804999fc47a3c2694e49ad2536a);$v7ab1518eadc49cb54957164a00f4ae29[] = array('email'=>$v39c2c5b6d82b66423d37cc0c26bfcd0d, 'name'=>$v7b914989a934081f3a630ba4af0d2161);}if(!$v69d8e0d7451cce623d8d6bc078646534->isExists($vc8817601983fc326b1b304ca47a1a933) || $v69d8e0d7451cce623d8d6bc078646534->getParentClassId($vc8817601983fc326b1b304ca47a1a933) != $vecd3739802ba39f77b829bab3943f71c) {throw new publicException('Wrong form type');}if(($vfeb78cc258bdc76867354f01c22dbe43 = $this->checkRequiredFields($vc8817601983fc326b1b304ca47a1a933)) !== true) {$this->errorNewMessage(getLabel('error-required_list').$this->assembleErrorFields($vfeb78cc258bdc76867354f01c22dbe43));}$_REQUEST['data']['new']['sender_ip'] = $ve950fd0bf7ca9cdb49df8d7e244e669a;$v1695a701f52ceead4b55d6c14c584579 = umiObjectsCollection::getInstance();$va77b1053cb200e022574f213c7553d88          = $v1695a701f52ceead4b55d6c14c584579->addObject($v7b914989a934081f3a630ba4af0d2161, $vc8817601983fc326b1b304ca47a1a933);cmsController::getInstance()->getModule('data')->saveEditedObject($va77b1053cb200e022574f213c7553d88, true);$vd82f268d5a82fc66260ad083d1a2e5b4            = $v1695a701f52ceead4b55d6c14c584579->getObject($va77b1053cb200e022574f213c7553d88);$vd82f268d5a82fc66260ad083d1a2e5b4->setValue('destination_address', $v39c2c5b6d82b66423d37cc0c26bfcd0d);$vd82f268d5a82fc66260ad083d1a2e5b4->setValue('sender_ip', $ve950fd0bf7ca9cdb49df8d7e244e669a);$vd82f268d5a82fc66260ad083d1a2e5b4->setValue('sending_time', $vab88bd4e7e44b5e05aab3f182f76db1f);$vf3a34c3ef6a7d824e6f9f5c76e36056f           = $this->formatMessage($va77b1053cb200e022574f213c7553d88, true);$v5e1cc51f1171dfa25c10bc755c1974d8 = new umiMail();$vc830175e9a27854693563be403a26413     = array('file', 'img_file', 'swf_file');$vb3d22b06afa2487fe5ed4f0f3919aa83     = $v69d8e0d7451cce623d8d6bc078646534->getType($vd82f268d5a82fc66260ad083d1a2e5b4->getTypeId())->getAllFields();$v2f50a6ae2fdb6f8575099bfa7de64edd = array();foreach($vb3d22b06afa2487fe5ed4f0f3919aa83 as $v2017d400f0721e7ec4bf10b008d381be) {$v784813455c14b4e16d7014624f797310   = $v2017d400f0721e7ec4bf10b008d381be->getFieldType();if(in_array($v784813455c14b4e16d7014624f797310->getDataType(), $vc830175e9a27854693563be403a26413)) {$v3b569bcd1bf089908a7a85ead9f9ab9a = new umiFile( $vd82f268d5a82fc66260ad083d1a2e5b4->getValue( $v2017d400f0721e7ec4bf10b008d381be->getName() ) );$v5e1cc51f1171dfa25c10bc755c1974d8->attachFile($v3b569bcd1bf089908a7a85ead9f9ab9a);}}$vc0eb583a465be93b83fdbaa43557f966 = 0;foreach($v7ab1518eadc49cb54957164a00f4ae29 as $vd6e41fc5d1bcfead1db3b6dc05774971) {foreach(explode(',', $vd6e41fc5d1bcfead1db3b6dc05774971['email']) as $v7b914989a934081f3a630ba4af0d2161) {if(strlen(trim($v7b914989a934081f3a630ba4af0d2161))) {$v5e1cc51f1171dfa25c10bc755c1974d8->addRecipient( trim($v7b914989a934081f3a630ba4af0d2161), $vd6e41fc5d1bcfead1db3b6dc05774971['name'] );$vc0eb583a465be93b83fdbaa43557f966++;}}}if(!$vc0eb583a465be93b83fdbaa43557f966) {$this->errorNewMessage(getLabel('error-no_recipients'));}$v5e1cc51f1171dfa25c10bc755c1974d8->setFrom($vf3a34c3ef6a7d824e6f9f5c76e36056f['from_email_template'], $vf3a34c3ef6a7d824e6f9f5c76e36056f['from_template']);$v5e1cc51f1171dfa25c10bc755c1974d8->setSubject($vf3a34c3ef6a7d824e6f9f5c76e36056f['subject_template']);$v5e1cc51f1171dfa25c10bc755c1974d8->setContent($vf3a34c3ef6a7d824e6f9f5c76e36056f['master_template']);$v5e1cc51f1171dfa25c10bc755c1974d8->commit();$v5e1cc51f1171dfa25c10bc755c1974d8->send();if(strlen($vf3a34c3ef6a7d824e6f9f5c76e36056f['autoreply_template'])) {$v664f9f73064bbd768dd88c82afc29c3d = new umiMail();$v664f9f73064bbd768dd88c82afc29c3d->addRecipient( $vf3a34c3ef6a7d824e6f9f5c76e36056f['from_email_template'], $vf3a34c3ef6a7d824e6f9f5c76e36056f['from_template'] );$v664f9f73064bbd768dd88c82afc29c3d->setFrom($vf3a34c3ef6a7d824e6f9f5c76e36056f['autoreply_from_email_template'], $vf3a34c3ef6a7d824e6f9f5c76e36056f['autoreply_from_template']);$v664f9f73064bbd768dd88c82afc29c3d->setSubject($vf3a34c3ef6a7d824e6f9f5c76e36056f['autoreply_subject_template']);$v664f9f73064bbd768dd88c82afc29c3d->setContent($vf3a34c3ef6a7d824e6f9f5c76e36056f['autoreply_template']);$v664f9f73064bbd768dd88c82afc29c3d->commit();$v664f9f73064bbd768dd88c82afc29c3d->send();}$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("webforms_post");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("after");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("email", $vf3a34c3ef6a7d824e6f9f5c76e36056f['from_email_template']);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("message_id", $va77b1053cb200e022574f213c7553d88);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("fio", $vf3a34c3ef6a7d824e6f9f5c76e36056f['from_template']);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$vf397b9d300233925e757b1e59d70c46c = getRequest('ref_onsuccess');if($vf397b9d300233925e757b1e59d70c46c) $this->redirect($vf397b9d300233925e757b1e59d70c46c);$v810c35d592ac94985316146b6b5a3be5 = getRequest('system_template');if($v810c35d592ac94985316146b6b5a3be5) {list($v6771a19d12b00d4da8eb7e7132ac88c9) = def_module::loadTemplates("tpls/data/reflection/".$v810c35d592ac94985316146b6b5a3be5.".tpl", "send_successed");if(strlen($v6771a19d12b00d4da8eb7e7132ac88c9)) return $v6771a19d12b00d4da8eb7e7132ac88c9;}if(isset($_SERVER['HTTP_REFERER'])) $this->redirect($_SERVER['HTTP_REFERER']);return '';}public function insert($v53d670af9bb16ea82e7ef41ee23ec6df = "", $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {$v53d670af9bb16ea82e7ef41ee23ec6df = trim($v53d670af9bb16ea82e7ef41ee23ec6df);if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c, $va78080c65278a5a17eb2064d639443c7, $vc44f37fcdfbfae8cfd86af3bee80dd74) = def_module::loadTemplates("tpls/webforms/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "webforms_block", "webforms_to_block", "webforms_to_line");if(!defined("DB_DRIVER") || DB_DRIVER != "xml") {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT * FROM cms_webforms";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v980da98409d058c365664ff7ea33dd6b = "";$v691d502cfd0e0626cd3b058e5682ad1c = Array();while($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($result)) {$vd98a07f84921b24ee30f86fd8cd85c3c = Array("%text%", "%id%");$v01b6e20344b68835c5ed1ddedf20d531 =   Array($vf1965a857bc285d26fe22023aa5ab50d['descr'], $vf1965a857bc285d26fe22023aa5ab50d['id']);$v980da98409d058c365664ff7ea33dd6b .= str_replace($vd98a07f84921b24ee30f86fd8cd85c3c, $v01b6e20344b68835c5ed1ddedf20d531, $vc44f37fcdfbfae8cfd86af3bee80dd74);$v14511f2f5564650d129ca7cabc333278 = Array();$v14511f2f5564650d129ca7cabc333278['attribute:id'] = $vf1965a857bc285d26fe22023aa5ab50d['id'];$v14511f2f5564650d129ca7cabc333278['node:descr'] = $vf1965a857bc285d26fe22023aa5ab50d['descr'];$v691d502cfd0e0626cd3b058e5682ad1c[] = $v14511f2f5564650d129ca7cabc333278;}}$vfc5ecff8bf18f57d6c531d097242e888   = umiObjectsCollection::getInstance();$v28bfcfa5817454e27c68c4c6165c6d1d = new umiSelection;$v28bfcfa5817454e27c68c4c6165c6d1d->addObjectType( umiObjectTypesCollection::getInstance()->getBaseType('webforms', 'address') );$v09dbbbbb33bce9accf8459a7a164ba44      = umiSelectionsParser::runSelection($v28bfcfa5817454e27c68c4c6165c6d1d);foreach($v09dbbbbb33bce9accf8459a7a164ba44 as $v41b5ebf97022261268985726508135e2) {$vb790175058e05911758cdaedd66fe5d9  = $vfc5ecff8bf18f57d6c531d097242e888->getObject($v41b5ebf97022261268985726508135e2)->getValue('address_description');$vd98a07f84921b24ee30f86fd8cd85c3c = Array("%text%", "%id%");$v01b6e20344b68835c5ed1ddedf20d531 =   Array($vb790175058e05911758cdaedd66fe5d9, $v41b5ebf97022261268985726508135e2);$v980da98409d058c365664ff7ea33dd6b .= str_replace($vd98a07f84921b24ee30f86fd8cd85c3c, $v01b6e20344b68835c5ed1ddedf20d531, $vc44f37fcdfbfae8cfd86af3bee80dd74);$v14511f2f5564650d129ca7cabc333278 = Array();$v14511f2f5564650d129ca7cabc333278['attribute:id'] = $v41b5ebf97022261268985726508135e2;$v14511f2f5564650d129ca7cabc333278['node:descr'] = $vb790175058e05911758cdaedd66fe5d9;$v691d502cfd0e0626cd3b058e5682ad1c[] = $v14511f2f5564650d129ca7cabc333278;}$v44ce7012d82f5249175b89460aff9a76 = str_replace("%lines%", $v980da98409d058c365664ff7ea33dd6b, $va78080c65278a5a17eb2064d639443c7);if($v53d670af9bb16ea82e7ef41ee23ec6df) {if(is_numeric($v53d670af9bb16ea82e7ef41ee23ec6df)) {$v44ce7012d82f5249175b89460aff9a76 = "<input type='hidden' name='email_to' value='" . $v53d670af9bb16ea82e7ef41ee23ec6df . "' />";}else {$v271c3407eb7f385a547b60da85d410d1 = $this->guessAddressId($v53d670af9bb16ea82e7ef41ee23ec6df);if(strval($v271c3407eb7f385a547b60da85d410d1) != $v53d670af9bb16ea82e7ef41ee23ec6df) {$v44ce7012d82f5249175b89460aff9a76 = "<input type='hidden' name='email_to' value='" . $v271c3407eb7f385a547b60da85d410d1 . "' />";}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms_webforms WHERE email='$v53d670af9bb16ea82e7ef41ee23ec6df'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($result)) {$v44ce7012d82f5249175b89460aff9a76 = "<input type='hidden' name='email_to' value='" . $vf1965a857bc285d26fe22023aa5ab50d['id'] . "' />";}else {$v44ce7012d82f5249175b89460aff9a76 = "<input type='hidden' name='email_to' value='" . $v53d670af9bb16ea82e7ef41ee23ec6df . "' />";}}}}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['to_block'] = $v44ce7012d82f5249175b89460aff9a76;$vfca1bff8ad8b3a8585abfb0ad523ba42['template'] = $v66f6181bcb4cff4cd38fbc804a036db6;$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = $v691d502cfd0e0626cd3b058e5682ad1c;return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function post() {global $_FILES;$v902e956a7804a1fa043e3fda9c0c687d = error_reporting(~E_ALL & ~E_STRICT);$v9b207167e5381c47682c6b4f58a623fb = "";$ve02619363a01764566a59db17ff071a9 = getRequest('email_to');$v78e731027d8fd50ed642340b7c9a63b3  = getRequest('message');$v8d777f385d3dfec8815d20f7496026dc     = getRequest('data');$vad5f82e879a9c5d6b5b442eb37e50551   = getRequest('domain');$vb5e3374e43f6544852f7751dfc529100 = cmsController::getInstance()->getCurrentDomain()->getHost();$v12b29cd4a546ab7c02774080f819f7dc = $_SERVER['HTTP_REFERER'];$this->errorRegisterFailPage($v12b29cd4a546ab7c02774080f819f7dc);if (isset($_REQUEST['captcha'])) {$_SESSION['user_captcha'] = md5((int) $_REQUEST['captcha']);}if (!umiCaptcha::checkCaptcha()) {$this->errorNewMessage("%errors_wrong_captcha%");$this->errorPanic();}$v4b5789f850e658bcfb56173ae0a5b7ca = "administrator";if(is_numeric($ve02619363a01764566a59db17ff071a9)) {$v01b6e20344b68835c5ed1ddedf20d531 = $this->guessAddressValue($ve02619363a01764566a59db17ff071a9);if(intval($v01b6e20344b68835c5ed1ddedf20d531) != $ve02619363a01764566a59db17ff071a9) {$v4b5789f850e658bcfb56173ae0a5b7ca = $this->guessAddressName($ve02619363a01764566a59db17ff071a9);}else {$v8e1ba02789d5bd508e7b2439ed1d1a26 = umiObjectTypesCollection::getInstance();$v963cecbdfa91757f2c7a4a9e794f3da7      = $v8e1ba02789d5bd508e7b2439ed1d1a26->getBaseType('webforms', 'address');$v784813455c14b4e16d7014624f797310        = $v8e1ba02789d5bd508e7b2439ed1d1a26->getType($v963cecbdfa91757f2c7a4a9e794f3da7);$v31da844434156cc6d6ee82b9fd2153c1     = $v784813455c14b4e16d7014624f797310->getFieldId('insert_id');$v28bfcfa5817454e27c68c4c6165c6d1d = new umiSelection();$v28bfcfa5817454e27c68c4c6165c6d1d->addObjectType($v963cecbdfa91757f2c7a4a9e794f3da7);$v28bfcfa5817454e27c68c4c6165c6d1d->addPropertyFilterEqual($v31da844434156cc6d6ee82b9fd2153c1, $ve02619363a01764566a59db17ff071a9);$v8f2586e754de1b0267c5c2f833ad50e8 = umiSelectionsParser::runSelection($v28bfcfa5817454e27c68c4c6165c6d1d);if(count($v8f2586e754de1b0267c5c2f833ad50e8)) {$vd82f268d5a82fc66260ad083d1a2e5b4   = umiObjectsCollection::getInstance()->getObject($v8f2586e754de1b0267c5c2f833ad50e8[0]);$v01b6e20344b68835c5ed1ddedf20d531        = $vd82f268d5a82fc66260ad083d1a2e5b4->getValue('address_list');$v4b5789f850e658bcfb56173ae0a5b7ca = $vd82f268d5a82fc66260ad083d1a2e5b4->getValue('address_description');}else {if(!defined("DB_DRIVER") || DB_DRIVER != "xml") {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT email, descr FROM cms_webforms WHERE id=$ve02619363a01764566a59db17ff071a9";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list($v01b6e20344b68835c5ed1ddedf20d531, $v4b5789f850e658bcfb56173ae0a5b7ca) = mysql_fetch_row($result);}else {$this->redirect($this->pre_lang . "/webforms/posted/?template=error_no_recipient");}}}}else {$this->checkAddressExistence($ve02619363a01764566a59db17ff071a9);$v01b6e20344b68835c5ed1ddedf20d531 = $ve02619363a01764566a59db17ff071a9;}if(!$v8d777f385d3dfec8815d20f7496026dc['email_from'] && isset($v8d777f385d3dfec8815d20f7496026dc['email'])) {$v8d777f385d3dfec8815d20f7496026dc['email_from'] = $v8d777f385d3dfec8815d20f7496026dc['email'];}$vac1db94df04db3fa46dbf716425be42f = new umiMail();$vf57ab864e36be3917c4c5303430932bd = explode(",", $v01b6e20344b68835c5ed1ddedf20d531);$vf57ab864e36be3917c4c5303430932bd = array_map("trim", $vf57ab864e36be3917c4c5303430932bd);foreach ($vf57ab864e36be3917c4c5303430932bd as $vebb65a721417d6418e5b6ea2de3b7f3d) {$vac1db94df04db3fa46dbf716425be42f->addRecipient($vebb65a721417d6418e5b6ea2de3b7f3d, $v4b5789f850e658bcfb56173ae0a5b7ca);}$vd98a07f84921b24ee30f86fd8cd85c3c = $v8d777f385d3dfec8815d20f7496026dc['fname']." ".$v8d777f385d3dfec8815d20f7496026dc['lname'];$vac1db94df04db3fa46dbf716425be42f->setFrom($v8d777f385d3dfec8815d20f7496026dc['email_from'], $vd98a07f84921b24ee30f86fd8cd85c3c);$vf664237e19ad7e814700e688b6016d6c = "";if(is_array($v8d777f385d3dfec8815d20f7496026dc)) {if(isset($v8d777f385d3dfec8815d20f7496026dc['subject']))    $vb5e3374e43f6544852f7751dfc529100 = $v8d777f385d3dfec8815d20f7496026dc['subject'];if(isset($v8d777f385d3dfec8815d20f7496026dc['fio']))    $vd98a07f84921b24ee30f86fd8cd85c3c = $v8d777f385d3dfec8815d20f7496026dc['fio'];if($v8d777f385d3dfec8815d20f7496026dc['fname'] || $v8d777f385d3dfec8815d20f7496026dc['lname'] || $v8d777f385d3dfec8815d20f7496026dc['mname'])    $vd98a07f84921b24ee30f86fd8cd85c3c = $v8d777f385d3dfec8815d20f7496026dc['lname'] . " " . $v8d777f385d3dfec8815d20f7496026dc['fname'] . " " . $v8d777f385d3dfec8815d20f7496026dc['mname'];if($v8d777f385d3dfec8815d20f7496026dc['fio_frm'])    $vd98a07f84921b24ee30f86fd8cd85c3c = $v8d777f385d3dfec8815d20f7496026dc['fio_frm'];if($v6fa2ba59a01c45393ecd8c38f23bbd8b = $v8d777f385d3dfec8815d20f7496026dc['email_from']) {$v6fa2ba59a01c45393ecd8c38f23bbd8b = $v8d777f385d3dfec8815d20f7496026dc['email_from'];}$vf664237e19ad7e814700e688b6016d6c = <<<END

<table border="0" width="100%">

END;   if(is_array($_FILES['data']['name'])) {$v8d777f385d3dfec8815d20f7496026dc = array_merge($v8d777f385d3dfec8815d20f7496026dc, $_FILES['data']['name']);}foreach($v8d777f385d3dfec8815d20f7496026dc as $v06e3d36fa30cea095545139854ad1fb9 => $v568d8e07bbe5575518d5005e559743c3) {if($v435ed7e9f07f740abf511a62c00eef6e = $_FILES['data']['name'][$v06e3d36fa30cea095545139854ad1fb9]) {$v91a0b591511113d85eaee7df602fbfee = $_FILES['data']['tmp_name'][$v06e3d36fa30cea095545139854ad1fb9];$v9024b204fb4c4ffdd07ee631ed791f75 = dirname($v91a0b591511113d85eaee7df602fbfee) . "/" . $v435ed7e9f07f740abf511a62c00eef6e;move_uploaded_file($v91a0b591511113d85eaee7df602fbfee, $v9024b204fb4c4ffdd07ee631ed791f75);$v8c7dd922ad47494fc02c388e12c00eac = new umiFile($v9024b204fb4c4ffdd07ee631ed791f75);$vac1db94df04db3fa46dbf716425be42f->attachFile($v8c7dd922ad47494fc02c388e12c00eac);}if(!is_array($v568d8e07bbe5575518d5005e559743c3)) {$v568d8e07bbe5575518d5005e559743c3 = str_replace("%", "&#37;", $v568d8e07bbe5575518d5005e559743c3);}if(!$v568d8e07bbe5575518d5005e559743c3) $v568d8e07bbe5575518d5005e559743c3 = "&mdash;";if(is_array($v568d8e07bbe5575518d5005e559743c3)) {foreach($v568d8e07bbe5575518d5005e559743c3 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v9e3669d19b675bd57058fd4664205d2a) {$v568d8e07bbe5575518d5005e559743c3[$v865c0c0b4ab0e063e5caa3387c1a8741] = str_replace("%", "&#37;", $v9e3669d19b675bd57058fd4664205d2a);}$v568d8e07bbe5575518d5005e559743c3 = implode(", ", $v568d8e07bbe5575518d5005e559743c3);}$vd304ba20e96d87411588eeabac850e34 = ($_REQUEST['labels'][$v06e3d36fa30cea095545139854ad1fb9]) ? $_REQUEST['labels'][$v06e3d36fa30cea095545139854ad1fb9] : ("%" . $v06e3d36fa30cea095545139854ad1fb9 . "%");$vf664237e19ad7e814700e688b6016d6c .= <<<END

	<tr>
		<td width="30%">
			{$vd304ba20e96d87411588eeabac850e34}:
		</td>

		<td>
			{$v568d8e07bbe5575518d5005e559743c3}
		</td>
	</tr>

END;   }$vf664237e19ad7e814700e688b6016d6c .= <<<END

</table>
<hr />

END;  }if($vd98a07f84921b24ee30f86fd8cd85c3c) {$vedb41feb9da4b1a7947643016c5563f3 = $vd98a07f84921b24ee30f86fd8cd85c3c;}$v78e731027d8fd50ed642340b7c9a63b3 = str_replace("%", "&#37;", $v78e731027d8fd50ed642340b7c9a63b3);$vf664237e19ad7e814700e688b6016d6c .= nl2br($v78e731027d8fd50ed642340b7c9a63b3);if(!$vd98a07f84921b24ee30f86fd8cd85c3c) {$vd98a07f84921b24ee30f86fd8cd85c3c = regedit::getInstance()->getVal("//settings/fio_from");}if(!$vf50bd8c48fbf37ddad59ee89ec4a0071) {$vf50bd8c48fbf37ddad59ee89ec4a0071 = regedit::getInstance()->getVal("//settings/email_from");}$vd98a07f84921b24ee30f86fd8cd85c3c = $vd98a07f84921b24ee30f86fd8cd85c3c . "<" . $vf50bd8c48fbf37ddad59ee89ec4a0071 . ">";$vac1db94df04db3fa46dbf716425be42f->setSubject($vb5e3374e43f6544852f7751dfc529100);$vac1db94df04db3fa46dbf716425be42f->setContent($vf664237e19ad7e814700e688b6016d6c);$vac1db94df04db3fa46dbf716425be42f->commit();$vac1db94df04db3fa46dbf716425be42f->send();if($v66f6181bcb4cff4cd38fbc804a036db6 = (string) $_REQUEST['template']) {$v8ce1a19060c7f3777242272261830ee1 = xslTemplater::getInstance();$va030a64929ba60f369cc7b3224863dc3 = $v8ce1a19060c7f3777242272261830ee1->setIsInited(false);list($v8b5f7e4b8a1abaf7bf783c0e8a17c994, $v8259dd59caa73f2978ea0faae5af1ac9) = def_module::loadTemplates("tpls/webforms/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "webforms_reply_mail", "webforms_reply_mail_subject");$v8ce1a19060c7f3777242272261830ee1->setIsInited($va030a64929ba60f369cc7b3224863dc3);$v068f969998c817628b1b0ca83b23f12a = false;if (!is_array($v8b5f7e4b8a1abaf7bf783c0e8a17c994)) {if ((bool) strlen($v8b5f7e4b8a1abaf7bf783c0e8a17c994)) $v068f969998c817628b1b0ca83b23f12a = true;}if ($v068f969998c817628b1b0ca83b23f12a) {$v6fa2ba59a01c45393ecd8c38f23bbd8b = regedit::getInstance()->getVal("//settings/email_from");$vf37ad7f8402a0da3486eda71efc5f9db = regedit::getInstance()->getVal("//settings/fio_from");$v6dd0d684efe6af1ec5b5e50bbf160236 = new umiMail();$v6dd0d684efe6af1ec5b5e50bbf160236->addRecipient($v8d777f385d3dfec8815d20f7496026dc['email_from'], $vd98a07f84921b24ee30f86fd8cd85c3c);$v6dd0d684efe6af1ec5b5e50bbf160236->setFrom($v6fa2ba59a01c45393ecd8c38f23bbd8b, $vf37ad7f8402a0da3486eda71efc5f9db);$v6dd0d684efe6af1ec5b5e50bbf160236->setSubject($v8259dd59caa73f2978ea0faae5af1ac9);$v6dd0d684efe6af1ec5b5e50bbf160236->setContent($v8b5f7e4b8a1abaf7bf783c0e8a17c994);$v6dd0d684efe6af1ec5b5e50bbf160236->commit();$v6dd0d684efe6af1ec5b5e50bbf160236->send();}}$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("webforms_post");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("after");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("email", $v8d777f385d3dfec8815d20f7496026dc['email_from']);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("fio", $vedb41feb9da4b1a7947643016c5563f3);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$v572d4e421e5e6b9bc11d815e8a027112 = getRequest('ref_onsuccess');if (!$v572d4e421e5e6b9bc11d815e8a027112) $v572d4e421e5e6b9bc11d815e8a027112 = $this->pre_lang . "/webforms/posted/";if ($v66f6181bcb4cff4cd38fbc804a036db6) {$v572d4e421e5e6b9bc11d815e8a027112 .= ((strpos($v572d4e421e5e6b9bc11d815e8a027112, '?') === false ? '?' : '&') . "template=" . $v66f6181bcb4cff4cd38fbc804a036db6);}error_reporting($v902e956a7804a1fa043e3fda9c0c687d);$this->redirect($v572d4e421e5e6b9bc11d815e8a027112);}public function posted($v66f6181bcb4cff4cd38fbc804a036db6 = false) {if ($this->breakMe()) return;$v66f6181bcb4cff4cd38fbc804a036db6 = $v66f6181bcb4cff4cd38fbc804a036db6 ? $v66f6181bcb4cff4cd38fbc804a036db6 : (string) getRequest('template');$v8ce1a19060c7f3777242272261830ee1 = xslTemplater::getInstance();if ($v66f6181bcb4cff4cd38fbc804a036db6) {try {$va030a64929ba60f369cc7b3224863dc3 = $v8ce1a19060c7f3777242272261830ee1->setIsInited(false);list($v66f6181bcb4cff4cd38fbc804a036db6) = $this->loadTemplates("./tpls/webforms/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "posted");$v8ce1a19060c7f3777242272261830ee1->setIsInited($va030a64929ba60f369cc7b3224863dc3);if($v66f6181bcb4cff4cd38fbc804a036db6) {if ($v8ce1a19060c7f3777242272261830ee1->getIsInited()) {$v66f6181bcb4cff4cd38fbc804a036db6 = array('text' => $v66f6181bcb4cff4cd38fbc804a036db6);}return $v66f6181bcb4cff4cd38fbc804a036db6;}}catch (publicException $ve1671797c52e15f763380b45e841ec32) {}}$v9b207167e5381c47682c6b4f58a623fb = "%webforms_thank_you%";if ($v8ce1a19060c7f3777242272261830ee1->getIsInited()) {$v9b207167e5381c47682c6b4f58a623fb = array('text' => $v9b207167e5381c47682c6b4f58a623fb);}return $v9b207167e5381c47682c6b4f58a623fb;}public function getUnbindedForms($v95ca2d829d03ecbda8a57275e55b1787 = false) {$v69ae498121c2d8e63f20c7144a0246d7 = umiObjectsCollection::getInstance();$vb3827f7111095f5ba1a9f49988fe9382   = umiObjectTypesCollection::getInstance();$vf6dc8d34a08356ab7293e6fe5f954634  = $vb3827f7111095f5ba1a9f49988fe9382->getBaseType("webforms", "form");$vac68b62abfd6a9fe26e8ac4236c8ce0c    = $vb3827f7111095f5ba1a9f49988fe9382->getSubTypesList($vf6dc8d34a08356ab7293e6fe5f954634);$v5f694956811487225d15e973ca38fbab    = $vb3827f7111095f5ba1a9f49988fe9382->getBaseType('webforms', 'template');$vef5714e0519bfaa645cdff7d28843b70 = new umiSelection;$vef5714e0519bfaa645cdff7d28843b70->addObjectType($v5f694956811487225d15e973ca38fbab);$result  = umiSelectionsParser::runSelection($vef5714e0519bfaa645cdff7d28843b70);$v18acedb191d664dc01b71835ae33caef = array();foreach($result as $v3200a31fc05da4e9d5a0465c36822e2f) {if($v3200a31fc05da4e9d5a0465c36822e2f == $v95ca2d829d03ecbda8a57275e55b1787) continue;$v66f6181bcb4cff4cd38fbc804a036db6 = $v69ae498121c2d8e63f20c7144a0246d7->getObject($v3200a31fc05da4e9d5a0465c36822e2f);if(!($v66f6181bcb4cff4cd38fbc804a036db6 instanceof umiObject)) continue;$v18acedb191d664dc01b71835ae33caef[] = $v66f6181bcb4cff4cd38fbc804a036db6->getValue('form_id');}$vac68b62abfd6a9fe26e8ac4236c8ce0c  = array_diff($vac68b62abfd6a9fe26e8ac4236c8ce0c, $v18acedb191d664dc01b71835ae33caef);$result = array();foreach($vac68b62abfd6a9fe26e8ac4236c8ce0c as $vb80bb7740288fda1f201890375a60c8f) {$ve253bed1357afcefc5fadfbc92f9eb97 = array();$ve253bed1357afcefc5fadfbc92f9eb97['attribute:id'] = $vb80bb7740288fda1f201890375a60c8f;$ve253bed1357afcefc5fadfbc92f9eb97['node:name']    = $vb3827f7111095f5ba1a9f49988fe9382->getType($vb80bb7740288fda1f201890375a60c8f)->getName();$result[] = $ve253bed1357afcefc5fadfbc92f9eb97;}return array("items" => array("nodes:item" => $result));}public function getObjectEditLink($v16b2b26000987faccb260b9d39df1269, $v599dcce2998a6b40b1e38e8c6006cb0a) {$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()->getObject($v16b2b26000987faccb260b9d39df1269);$v784813455c14b4e16d7014624f797310   = umiObjectTypesCollection::getInstance()->getType($va8cfde6331bd59eb2ac96f8911c4b666->getTypeId());if($v784813455c14b4e16d7014624f797310->getParentId() == umiObjectTypesCollection::getInstance()->getBaseType("webforms", "form")) $v599dcce2998a6b40b1e38e8c6006cb0a = "message";switch($v599dcce2998a6b40b1e38e8c6006cb0a) {case 'form'     :   case 'message'  : return $this->pre_lang . "/admin/webforms/message/"      . $v16b2b26000987faccb260b9d39df1269 . "/";case 'template' : return $this->pre_lang . "/admin/webforms/template_edit/" . $v16b2b26000987faccb260b9d39df1269 . "/";default   : return $this->pre_lang . "/admin/webforms/address_edit/"  . $v16b2b26000987faccb260b9d39df1269 . "/";}}public function getObjectTypeEditLink($v5f694956811487225d15e973ca38fbab) {return Array(   'create-link' => $this->pre_lang . "/admin/webforms/form_add/",   'edit-link'   => $this->pre_lang . "/admin/webforms/form_edit/" . $v5f694956811487225d15e973ca38fbab . "/"  );}};?>