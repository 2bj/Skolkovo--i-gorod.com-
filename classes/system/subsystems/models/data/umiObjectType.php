<?php
 class umiObjectType extends umiEntinty implements iUmiEntinty, iUmiObjectType {private $name, $parent_id, $is_locked = false;private $field_groups = Array(), $field_all_groups = Array();private $is_guidable = false, $is_public = false, $hierarchy_type_id;private $sortable = false;protected $store_type = "object_type";public function getName() {return $this->translateLabel($this->name);}public function setName($vb068931cc450442b63f5b3d276ea4297) {$vb068931cc450442b63f5b3d276ea4297 = $this->translateI18n($vb068931cc450442b63f5b3d276ea4297, "object-type-");$this->name = $vb068931cc450442b63f5b3d276ea4297;$this->setIsUpdated();}public function getIsLocked() {return $this->is_locked;}public function setIsLocked($v1945c9a2a5e2ba6133f1db6757a35fcb) {$this->is_locked = (bool) $v1945c9a2a5e2ba6133f1db6757a35fcb;$this->setIsUpdated();}public function getParentId() {return $this->parent_id;}public function getIsGuidable() {return $this->is_guidable;}public function setIsGuidable($v7617e8d03bb811f5c37135234006b114) {$this->is_guidable = (bool) $v7617e8d03bb811f5c37135234006b114;$this->setIsUpdated();}public function getIsPublic() {return $this->is_public;}public function setIsPublic($v117256556af3bd1a0c9710a593d93814) {$this->is_public = (bool) $v117256556af3bd1a0c9710a593d93814;$this->setIsUpdated();}public function getHierarchyTypeId() {return $this->hierarchy_type_id;}public function getIsSortable() {return $this->sortable;}public function setIsSortable($v23aec26e2b521c0e5f1061b3d04983a5 = false) {$this->sortable = (bool) $v23aec26e2b521c0e5f1061b3d04983a5;}public function setHierarchyTypeId($v0715f6d9497f93911417c9c324265771) {$this->hierarchy_type_id = (int) $v0715f6d9497f93911417c9c324265771;$this->setIsUpdated();}public function addFieldsGroup($vb068931cc450442b63f5b3d276ea4297, $vd5d3db1765287eef77d7927cc956f50a, $v4264c638e0098acb172519b0436db099 = true, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = true) {if($vdb0f6f37ebeb6ea09489124345af2a45 = $this->getFieldsGroupByName($vb068931cc450442b63f5b3d276ea4297)) {return $vdb0f6f37ebeb6ea09489124345af2a45->getId();}$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT MAX(ord) FROM cms3_object_field_groups WHERE type_id = '{$this->id}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}if(list($v8bef1cc20ada3bef55fdf132cb2a1cb9) = mysql_fetch_row($result)) {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = ((int) $v8bef1cc20ada3bef55fdf132cb2a1cb9) + 5;}else {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = 1;}$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_object_field_groups (type_id, ord) VALUES('{$this->id}', '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$v6c26c1979a522c2dd7e76e527aa69ca5 = mysql_insert_id();$v38f582e54454005ec0664831734e1152 = new umiFieldsGroup($v6c26c1979a522c2dd7e76e527aa69ca5);$v38f582e54454005ec0664831734e1152->setName($vb068931cc450442b63f5b3d276ea4297);$v38f582e54454005ec0664831734e1152->setTitle($vd5d3db1765287eef77d7927cc956f50a);$v38f582e54454005ec0664831734e1152->setIsActive($v4264c638e0098acb172519b0436db099);$v38f582e54454005ec0664831734e1152->setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4);$v38f582e54454005ec0664831734e1152->commit();$this->field_groups[$v6c26c1979a522c2dd7e76e527aa69ca5] = $v38f582e54454005ec0664831734e1152;$this->field_all_groups[$v6c26c1979a522c2dd7e76e527aa69ca5] = $v38f582e54454005ec0664831734e1152;$v2af1d1812273df0bd0f720da7068f8a6 = umiObjectTypesCollection::getInstance()->getSubTypesList($this->id);$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($v2af1d1812273df0bd0f720da7068f8a6);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vd4fd255f51559df00de5424b64292413 = $v2af1d1812273df0bd0f720da7068f8a6[$v865c0c0b4ab0e063e5caa3387c1a8741];if($v599dcce2998a6b40b1e38e8c6006cb0a = umiObjectTypesCollection::getInstance()->getType($vd4fd255f51559df00de5424b64292413)) {$v599dcce2998a6b40b1e38e8c6006cb0a->addFieldsGroup($vb068931cc450442b63f5b3d276ea4297, $vd5d3db1765287eef77d7927cc956f50a, $v4264c638e0098acb172519b0436db099, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4);}else {throw new coreException("Can't load object type #{$vd4fd255f51559df00de5424b64292413}");}}cacheFrontend::getInstance()->flush();return $v6c26c1979a522c2dd7e76e527aa69ca5;}public function delFieldsGroup($v6c26c1979a522c2dd7e76e527aa69ca5) {if($this->isFieldsGroupExists($v6c26c1979a522c2dd7e76e527aa69ca5)) {$v6c26c1979a522c2dd7e76e527aa69ca5 = (int) $v6c26c1979a522c2dd7e76e527aa69ca5;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_object_field_groups WHERE id = '{$v6c26c1979a522c2dd7e76e527aa69ca5}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}unset($this->field_groups[$v6c26c1979a522c2dd7e76e527aa69ca5]);cacheFrontend::getInstance()->flush();return true;}else {return false;}}public function getFieldsGroupByName($v669198bb876eff07758f68a34b5d21fb, $v561794c6605aeeac613e23c20f9ce1c3 = false) {$v1471e4e05a4db95d353cc867fe317314 = $this->getFieldsGroupsList($v561794c6605aeeac613e23c20f9ce1c3);foreach($v1471e4e05a4db95d353cc867fe317314 as $v0e939a4ffd3aacd724dd3b50147b4353 => $vdb0f6f37ebeb6ea09489124345af2a45) {if($vdb0f6f37ebeb6ea09489124345af2a45->getName()  == $v669198bb876eff07758f68a34b5d21fb) {return $vdb0f6f37ebeb6ea09489124345af2a45;}}return false;}public function getFieldsGroup($v6c26c1979a522c2dd7e76e527aa69ca5) {if($this->isFieldsGroupExists($v6c26c1979a522c2dd7e76e527aa69ca5)) {return $this->field_groups[$v6c26c1979a522c2dd7e76e527aa69ca5];}else {return false;}}public function getFieldsGroupsList($v370a5fabf1a6ce8eea9597760df7de41 = false) {return $v370a5fabf1a6ce8eea9597760df7de41 ? $this->field_all_groups : $this->field_groups;}private function isFieldsGroupExists($v6c26c1979a522c2dd7e76e527aa69ca5) {if(!$v6c26c1979a522c2dd7e76e527aa69ca5) {return false;}else {return (bool) array_key_exists($v6c26c1979a522c2dd7e76e527aa69ca5, $this->field_all_groups);}}protected function loadInfo() {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE name, parent_id, is_locked, is_guidable, is_public, hierarchy_type_id, sortable FROM cms3_object_types WHERE id = '{$this->id}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(list($vb068931cc450442b63f5b3d276ea4297, $v6be379826b20cc58475f636e33f4606b, $v1945c9a2a5e2ba6133f1db6757a35fcb, $v7617e8d03bb811f5c37135234006b114, $v117256556af3bd1a0c9710a593d93814, $v0715f6d9497f93911417c9c324265771, $v23aec26e2b521c0e5f1061b3d04983a5) = mysql_fetch_row($result)) {$this->name = $vb068931cc450442b63f5b3d276ea4297;$this->parent_id = (int) $v6be379826b20cc58475f636e33f4606b;$this->is_locked = (bool) $v1945c9a2a5e2ba6133f1db6757a35fcb;$this->is_guidable = (bool) $v7617e8d03bb811f5c37135234006b114;$this->is_public = (bool) $v117256556af3bd1a0c9710a593d93814;$this->hierarchy_type_id = (int) $v0715f6d9497f93911417c9c324265771;$this->sortable = (bool) $v23aec26e2b521c0e5f1061b3d04983a5;return $this->loadFieldsGroups();}else {return false;}}private function loadFieldsGroups() {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT SQL_CACHE 
   ofg.id as groupId, cof.id, cof.name, cof.title, cof.is_locked, cof.is_inheritable, cof.is_visible, cof.field_type_id, cof.guide_id, cof.in_search, cof.in_filter, cof.tip, cof.is_required, cof.sortable, cof.is_system, cof.restriction_id 
      FROM cms3_object_field_groups ofg, cms3_fields_controller cfc, cms3_object_fields cof 
         WHERE ofg.type_id = '{$this->id}' AND cfc.group_id = ofg.id AND cof.id = cfc.field_id 
            ORDER BY ofg.ord ASC, cfc.ord ASC
SQL;   $result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vd05b6ed7d2345020440df396d6da7f73 = Array();while(list($v0e939a4ffd3aacd724dd3b50147b4353, $vb80bb7740288fda1f201890375a60c8f, $vb068931cc450442b63f5b3d276ea4297, $vd5d3db1765287eef77d7927cc956f50a, $v1945c9a2a5e2ba6133f1db6757a35fcb, $vd5752333adc3a004f826f2ea2a41273a, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4, $v1e3f04102267eaf5e8d0ca424fd5c561, $v051369818a8073bba5feeb0e957eb308, $v5fa2ecd1dc485ead330e65903d19650a, $ve4a2ed2dde6e8354ae6f321744843084, $v6a2139364f96787c8ce1bbb0070b898c, $v0d2ac6f3b02c0de484369013b31f2ed7, $vc9409711ebff9250bd075037d3d18263, $v23aec26e2b521c0e5f1061b3d04983a5, $v228c63e369a5906eb7f0500a13729edc) = mysql_fetch_row($result)) {if(!isset($vd05b6ed7d2345020440df396d6da7f73[$v0e939a4ffd3aacd724dd3b50147b4353]) || !is_array($vd05b6ed7d2345020440df396d6da7f73[$v0e939a4ffd3aacd724dd3b50147b4353])) {$vd05b6ed7d2345020440df396d6da7f73[$v0e939a4ffd3aacd724dd3b50147b4353] = Array();}$vd05b6ed7d2345020440df396d6da7f73[$v0e939a4ffd3aacd724dd3b50147b4353][] = Array($vb80bb7740288fda1f201890375a60c8f, $vb068931cc450442b63f5b3d276ea4297, $vd5d3db1765287eef77d7927cc956f50a, $v1945c9a2a5e2ba6133f1db6757a35fcb, $vd5752333adc3a004f826f2ea2a41273a, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4, $v1e3f04102267eaf5e8d0ca424fd5c561, $v051369818a8073bba5feeb0e957eb308, $v5fa2ecd1dc485ead330e65903d19650a, $ve4a2ed2dde6e8354ae6f321744843084, $v6a2139364f96787c8ce1bbb0070b898c, $v0d2ac6f3b02c0de484369013b31f2ed7, $vc9409711ebff9250bd075037d3d18263, $v23aec26e2b521c0e5f1061b3d04983a5, $v228c63e369a5906eb7f0500a13729edc);}$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id, name, title, type_id, is_active, is_visible, is_locked, ord FROM cms3_object_field_groups WHERE type_id = '{$this->id}' ORDER BY ord ASC";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v6c26c1979a522c2dd7e76e527aa69ca5,,,,$v367e854225a0810977297b3bedb2f309) = $vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result)) {$v38f582e54454005ec0664831734e1152 = new umiFieldsGroup($v6c26c1979a522c2dd7e76e527aa69ca5, $vf1965a857bc285d26fe22023aa5ab50d);if(!isset($vd05b6ed7d2345020440df396d6da7f73[$v6c26c1979a522c2dd7e76e527aa69ca5])) {$vd05b6ed7d2345020440df396d6da7f73[$v6c26c1979a522c2dd7e76e527aa69ca5] = Array();}$v38f582e54454005ec0664831734e1152->loadFields($vd05b6ed7d2345020440df396d6da7f73[$v6c26c1979a522c2dd7e76e527aa69ca5]);$this->field_all_groups[$v6c26c1979a522c2dd7e76e527aa69ca5] = $v38f582e54454005ec0664831734e1152;if($v367e854225a0810977297b3bedb2f309) {$this->field_groups[$v6c26c1979a522c2dd7e76e527aa69ca5] = $v38f582e54454005ec0664831734e1152;}}return true;}protected function save() {$vb068931cc450442b63f5b3d276ea4297 = umiObjectProperty::filterInputString($this->name);$v6be379826b20cc58475f636e33f4606b = (int) $this->parent_id;$v1945c9a2a5e2ba6133f1db6757a35fcb = (int) $this->is_locked;$v7617e8d03bb811f5c37135234006b114 = (int) $this->is_guidable;$v117256556af3bd1a0c9710a593d93814 = (int) $this->is_public;$v0715f6d9497f93911417c9c324265771 = (int) $this->hierarchy_type_id;$v23aec26e2b521c0e5f1061b3d04983a5 = (int) $this->sortable;$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_object_types SET name = '{$vb068931cc450442b63f5b3d276ea4297}', parent_id = '{$v6be379826b20cc58475f636e33f4606b}', is_locked = '{$v1945c9a2a5e2ba6133f1db6757a35fcb}', is_guidable = '{$v7617e8d03bb811f5c37135234006b114}', is_public = '{$v117256556af3bd1a0c9710a593d93814}', hierarchy_type_id = '{$v0715f6d9497f93911417c9c324265771}', sortable = '{$v23aec26e2b521c0e5f1061b3d04983a5}' WHERE id = '{$this->id}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);cacheFrontend::getInstance()->flush();if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}else {return false;}}public function setFieldGroupOrd($v0e939a4ffd3aacd724dd3b50147b4353, $vf2400bf3c8b70283e04af07d6d67fe6a, $v3f84b203eef48e9862ac1ffbe344dffe) {$vf2400bf3c8b70283e04af07d6d67fe6a = (int) $vf2400bf3c8b70283e04af07d6d67fe6a;$v0e939a4ffd3aacd724dd3b50147b4353 = (int) $v0e939a4ffd3aacd724dd3b50147b4353;if(!$v3f84b203eef48e9862ac1ffbe344dffe) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT type_id FROM cms3_object_field_groups WHERE id = '{$v0e939a4ffd3aacd724dd3b50147b4353}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}if(!(list($v94757cae63fd3e398c0811a976dd6bbe) = mysql_fetch_row($result))) {return false;}$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_object_field_groups SET ord = (ord + 1) WHERE type_id = '{$v94757cae63fd3e398c0811a976dd6bbe}' AND ord >= '{$vf2400bf3c8b70283e04af07d6d67fe6a}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}}$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_object_field_groups SET ord = '{$vf2400bf3c8b70283e04af07d6d67fe6a}' WHERE id = '{$v0e939a4ffd3aacd724dd3b50147b4353}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);cacheFrontend::getInstance()->flush();if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}return true;}public function getAllFields($v33a8421fb9f5a2636cefaed92ae056c3 = false) {$vd05b6ed7d2345020440df396d6da7f73 = Array();$v1471e4e05a4db95d353cc867fe317314 = $this->getFieldsGroupsList();foreach($v1471e4e05a4db95d353cc867fe317314 as $vdb0f6f37ebeb6ea09489124345af2a45) {if($v33a8421fb9f5a2636cefaed92ae056c3) {if(!$vdb0f6f37ebeb6ea09489124345af2a45->getIsVisible()) {continue;}}$vd05b6ed7d2345020440df396d6da7f73 = array_merge($vd05b6ed7d2345020440df396d6da7f73, $vdb0f6f37ebeb6ea09489124345af2a45->getFields());}return $vd05b6ed7d2345020440df396d6da7f73;}public function getFieldId($v73f329f154a663bfda020aadcdd0b775) {$v1471e4e05a4db95d353cc867fe317314 = $this->getFieldsGroupsList();foreach($v1471e4e05a4db95d353cc867fe317314 as $v0e939a4ffd3aacd724dd3b50147b4353 => $vdb0f6f37ebeb6ea09489124345af2a45) {if(!$vdb0f6f37ebeb6ea09489124345af2a45->getIsActive()) continue;$vd05b6ed7d2345020440df396d6da7f73 = $vdb0f6f37ebeb6ea09489124345af2a45->getFields();foreach($vd05b6ed7d2345020440df396d6da7f73 as $v3aabf39f2d943fa886d86dcbbee4d910 => $v06e3d36fa30cea095545139854ad1fb9) {if($v06e3d36fa30cea095545139854ad1fb9->getName() == $v73f329f154a663bfda020aadcdd0b775) {return $v06e3d36fa30cea095545139854ad1fb9->getId();}}}return false;}public function getModule() {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = $this->getHierarchyTypeId();$v89b0b9deff65f8b9cd1f71bc74ce36ba = umiHierarchyTypesCollection::getInstance()->getType($vacf567c9c3d6cf7c6e2cc0ce108e0631);if($v89b0b9deff65f8b9cd1f71bc74ce36ba instanceof umiHierarchyType) {return $v89b0b9deff65f8b9cd1f71bc74ce36ba->getName();}else {return false;}}public function getMethod() {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = $this->getHierarchyTypeId();$v89b0b9deff65f8b9cd1f71bc74ce36ba = umiHierarchyTypesCollection::getInstance()->getType($vacf567c9c3d6cf7c6e2cc0ce108e0631);if($v89b0b9deff65f8b9cd1f71bc74ce36ba instanceof umiHierarchyType) {return $v89b0b9deff65f8b9cd1f71bc74ce36ba->getExt();}else {return false;}}};?>