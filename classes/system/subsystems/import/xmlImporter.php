<?php
 class xmlImporter implements iXmlImporter {const VERSION = "2.0";const ROOT_PAGE_TYPE_ID = 3;protected $doc, $parser;protected $relations, $source_id;protected $destination_element_id = 0;protected $meta = array();public  $updated_types = 0, $created_types = 0,     $updated_objects = 0, $created_objects = 0, $deleted_objects = 0,     $updated_elements = 0, $created_elements = 0, $deleted_elements = 0,     $import_errors = 0;protected $import_log = array();public function __construct($vaf721e88e6c0a612be51c329cb2bc12a = false) {if ($vaf721e88e6c0a612be51c329cb2bc12a) $this->meta['source-name'] = $v0afd9202ba86aa11ce63ad7007e7990b;umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = true;$this->doc = new DomDocument("1.0", "utf-8");$this->relations = umiImportRelations::getInstance();}public function loadXmlString($v2d04a630b197c6991c3e00e003f88be4) {return $this->doc->loadXML($v2d04a630b197c6991c3e00e003f88be4);}public function loadXmlFile($va30c2e8bafac20e81c697b2396c8a3b0) {if(!is_file($va30c2e8bafac20e81c697b2396c8a3b0)) {throw new publicException("Can't read file {$va30c2e8bafac20e81c697b2396c8a3b0}");}return $this->doc->load($va30c2e8bafac20e81c697b2396c8a3b0);}public function loadXmlDocument(DOMDocument $v9a09b4dfda82e3e665e31092d1c3ec8d) {$this->doc = $v9a09b4dfda82e3e665e31092d1c3ec8d;}public function setDestinationElement($v8e2dcfd7e7e24b1ca76c1193f645902b) {if ($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement) {$this->destination_element_id = $v8e2dcfd7e7e24b1ca76c1193f645902b->getId();return true;}if (umiHierarchy::getInstance()->getElement($v8e2dcfd7e7e24b1ca76c1193f645902b) instanceof umiHierarchyElement) {$this->destination_element_id = $v8e2dcfd7e7e24b1ca76c1193f645902b;return true;}return false;}public function execute() {$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();if(!$v2245023265ae4cf87d02c8b6ba991139->get('kernel', 'import-auto-index')) {if(!defined('DISABLE_SEARCH_REINDEX')) {define('DISABLE_SEARCH_REINDEX', 1);}}$this->parser = new DOMXPath($this->doc);$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/@version");$v2af72f100c356273d46284f6fd1dfc08 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : "";if ($v2af72f100c356273d46284f6fd1dfc08 != self::VERSION) {throw new publicException("Unknown UmiDump version.");}$this->parseMetaData();$this->source_id = $this->relations->getSourceId($this->meta['source-name']);if (!$this->source_id) {$this->source_id = $this->relations->addNewSource($this->meta['source-name']);}$this->importTypes();$this->importObjects();$this->importElements();}protected function reportError($vcb5e100e5a9a3e7f6d1fd97512215282) {$this->import_errors++;$this->import_log[] = "<font style='color:red''>" . $vcb5e100e5a9a3e7f6d1fd97512215282 . "</font>";}protected function writeLog($v78e731027d8fd50ed642340b7c9a63b3) {$this->import_log[] = $v78e731027d8fd50ed642340b7c9a63b3;}public function getImportLog() {return $this->import_log;}protected function parseMetaData() {$v6f8f57715090da2632453988d9a1501b = $this->meta;$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/meta/site-name");$v6f8f57715090da2632453988d9a1501b['site-name'] =  $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : "";$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/meta/domain");$v6f8f57715090da2632453988d9a1501b['domain'] =  $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : "";$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/meta/lang");$v6f8f57715090da2632453988d9a1501b['lang'] =  $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : "";if (!isset($v6f8f57715090da2632453988d9a1501b['source-name'])) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/meta/source-name");$v6f8f57715090da2632453988d9a1501b['source-name'] =  $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : md5($v6f8f57715090da2632453988d9a1501b['domain']);}$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/meta/generate-time/timestamp");$v6f8f57715090da2632453988d9a1501b['generated'] =  $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : "";$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/meta/branches/id");$v6f8f57715090da2632453988d9a1501b['branches'] = array();foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $v36c4536996ca5615dcf9911f068786dc) {$v6f8f57715090da2632453988d9a1501b['branches'][] = $v36c4536996ca5615dcf9911f068786dc->nodeValue;}$this->meta = $v6f8f57715090da2632453988d9a1501b;}protected function importHierarchyType($v568e2307c59466ef505aab734d74f1f9, $va85c62c99bf80aeffb74914fb56a1942, $v42c20047918d7af7031377b1461d197a) {$vdb6d9b451b818ccc9a449383f2f0c450 = umiHierarchyTypesCollection::getInstance();$v89b0b9deff65f8b9cd1f71bc74ce36ba = $vdb6d9b451b818ccc9a449383f2f0c450->getTypeByName($v568e2307c59466ef505aab734d74f1f9, $va85c62c99bf80aeffb74914fb56a1942);if (!$v89b0b9deff65f8b9cd1f71bc74ce36ba instanceof umiHierarchyType) {$vb80bb7740288fda1f201890375a60c8f = $vdb6d9b451b818ccc9a449383f2f0c450->addType($v568e2307c59466ef505aab734d74f1f9, $v42c20047918d7af7031377b1461d197a, $va85c62c99bf80aeffb74914fb56a1942);$v89b0b9deff65f8b9cd1f71bc74ce36ba = $vdb6d9b451b818ccc9a449383f2f0c450->getTypeByName($v568e2307c59466ef505aab734d74f1f9, $va85c62c99bf80aeffb74914fb56a1942);}if (!$v89b0b9deff65f8b9cd1f71bc74ce36ba instanceof umiHierarchyType) {throw new publicException("Can't create hierarchy type {$v568e2307c59466ef505aab734d74f1f9}/{$va85c62c99bf80aeffb74914fb56a1942} ({$v42c20047918d7af7031377b1461d197a})");}return $v89b0b9deff65f8b9cd1f71bc74ce36ba;}protected function importTypes() {$va3032d293cbe70eef8203ae3c3ecc30c = $this->parser->evaluate("/umidump/types/type");foreach ($va3032d293cbe70eef8203ae3c3ecc30c as $veea7dc04e9c0c2c050fea3f8340c661b) {$this->importType($veea7dc04e9c0c2c050fea3f8340c661b);}}protected function importType(DOMElement $veea7dc04e9c0c2c050fea3f8340c661b) {$v61ce6a78cb3c8547fed20990c92edfe3 = $veea7dc04e9c0c2c050fea3f8340c661b->getAttribute('id');$vd33d1e928d54a353100641ff7d704306 = $veea7dc04e9c0c2c050fea3f8340c661b->getAttribute('parent-id');if (!strlen($v61ce6a78cb3c8547fed20990c92edfe3)) {$this->reportError("Can't create type with empty id");return false;}$v7617e8d03bb811f5c37135234006b114 = $veea7dc04e9c0c2c050fea3f8340c661b->hasAttribute('guide') ? $veea7dc04e9c0c2c050fea3f8340c661b->getAttribute('guide') : null;$v117256556af3bd1a0c9710a593d93814 = $veea7dc04e9c0c2c050fea3f8340c661b->hasAttribute('public') ? $veea7dc04e9c0c2c050fea3f8340c661b->getAttribute('public') : null;$v1945c9a2a5e2ba6133f1db6757a35fcb = $veea7dc04e9c0c2c050fea3f8340c661b->hasAttribute('locked') ? $veea7dc04e9c0c2c050fea3f8340c661b->getAttribute('locked') : null;$v22178d66649d30b18a7e4e331dc778ce = $veea7dc04e9c0c2c050fea3f8340c661b->hasAttribute('title') ? $veea7dc04e9c0c2c050fea3f8340c661b->getAttribute('title') : null;$v69203671ddb68b3848f87700fe06de55 = $this->relations->getNewTypeIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3);$vbb05d2aa96d31d1d44eb6ef550686607 = (trim($vd33d1e928d54a353100641ff7d704306, "{}") == 'root-pages-type') ? self::ROOT_PAGE_TYPE_ID : $this->relations->getNewTypeIdRelation($this->source_id, $vd33d1e928d54a353100641ff7d704306);if (!$v69203671ddb68b3848f87700fe06de55 && trim($v61ce6a78cb3c8547fed20990c92edfe3, "{}") == 'root-pages-type') {$this->relations->setTypeIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3, self::ROOT_PAGE_TYPE_ID);$v69203671ddb68b3848f87700fe06de55 = $v61ce6a78cb3c8547fed20990c92edfe3;}$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectTypesCollection::getInstance();$ve2fa538867c3830a859a5b17ab24644b = false;if (!$v69203671ddb68b3848f87700fe06de55) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("base", $veea7dc04e9c0c2c050fea3f8340c661b);$v593616de15330c0fb2d55e55410bf994 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0) : false;if (!$v593616de15330c0fb2d55e55410bf994 instanceof DOMElement) {$this->reportError("Can't create type. Undefined base type.");return false;}$v568e2307c59466ef505aab734d74f1f9 = $v593616de15330c0fb2d55e55410bf994->getAttribute('module');$va85c62c99bf80aeffb74914fb56a1942 = $v593616de15330c0fb2d55e55410bf994->getAttribute('method');$v42c20047918d7af7031377b1461d197a = $v593616de15330c0fb2d55e55410bf994->nodeValue;$v89b0b9deff65f8b9cd1f71bc74ce36ba = $this->importHierarchyType($v568e2307c59466ef505aab734d74f1f9, $va85c62c99bf80aeffb74914fb56a1942, $v42c20047918d7af7031377b1461d197a);$v75b212f033271dc4a7b372cebf3f0e9f = $vdb6d9b451b818ccc9a449383f2f0c450->getTypeByHierarchyTypeId($v89b0b9deff65f8b9cd1f71bc74ce36ba->getId());$v152163c4320bc49594f3ac21600886b1 = $vdb6d9b451b818ccc9a449383f2f0c450->getType($v75b212f033271dc4a7b372cebf3f0e9f);if (trim($vd33d1e928d54a353100641ff7d704306, "{}") == 'root-pages-type' && $v152163c4320bc49594f3ac21600886b1 instanceof umiObjectType) {$v69203671ddb68b3848f87700fe06de55 = $v152163c4320bc49594f3ac21600886b1->getId();}else {if (!$vbb05d2aa96d31d1d44eb6ef550686607 && $v152163c4320bc49594f3ac21600886b1 instanceof umiObjectType) {$vbb05d2aa96d31d1d44eb6ef550686607 = $v152163c4320bc49594f3ac21600886b1->getId();}if (is_null($v22178d66649d30b18a7e4e331dc778ce)) {$v22178d66649d30b18a7e4e331dc778ce = "Type #" . $v61ce6a78cb3c8547fed20990c92edfe3;}$v69203671ddb68b3848f87700fe06de55 = $vdb6d9b451b818ccc9a449383f2f0c450->addType($vbb05d2aa96d31d1d44eb6ef550686607, trim($v22178d66649d30b18a7e4e331dc778ce));$v599dcce2998a6b40b1e38e8c6006cb0a = $vdb6d9b451b818ccc9a449383f2f0c450->getType($v69203671ddb68b3848f87700fe06de55);$v599dcce2998a6b40b1e38e8c6006cb0a->setHierarchyTypeId($v89b0b9deff65f8b9cd1f71bc74ce36ba->getId());$ve2fa538867c3830a859a5b17ab24644b = true;}$this->relations->setTypeIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3, $v69203671ddb68b3848f87700fe06de55);}$v599dcce2998a6b40b1e38e8c6006cb0a = $vdb6d9b451b818ccc9a449383f2f0c450->getType($v69203671ddb68b3848f87700fe06de55);if (!$v599dcce2998a6b40b1e38e8c6006cb0a instanceof umiObjectType) return false;if (!is_null($v22178d66649d30b18a7e4e331dc778ce)) $v599dcce2998a6b40b1e38e8c6006cb0a->setName(trim($v22178d66649d30b18a7e4e331dc778ce));if (!is_null($v117256556af3bd1a0c9710a593d93814)) $v599dcce2998a6b40b1e38e8c6006cb0a->setIsPublic($v117256556af3bd1a0c9710a593d93814 == 'public' || $v117256556af3bd1a0c9710a593d93814 == "1");if (!is_null($v7617e8d03bb811f5c37135234006b114)) $v599dcce2998a6b40b1e38e8c6006cb0a->setIsGuidable($v7617e8d03bb811f5c37135234006b114 == 'guide' || $v7617e8d03bb811f5c37135234006b114 == "1");if (!is_null($v1945c9a2a5e2ba6133f1db6757a35fcb)) $v599dcce2998a6b40b1e38e8c6006cb0a->setIsLocked($v1945c9a2a5e2ba6133f1db6757a35fcb == 'locked' || $v1945c9a2a5e2ba6133f1db6757a35fcb == "1");$v599dcce2998a6b40b1e38e8c6006cb0a->commit();if ($ve2fa538867c3830a859a5b17ab24644b) {$this->created_types++;$this->writeLog("Type \"" . $v22178d66649d30b18a7e4e331dc778ce . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been created");}else {$this->updated_types++;$this->writeLog("Type \"" . $v22178d66649d30b18a7e4e331dc778ce . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been updated");}$this->importTypeGroups($v599dcce2998a6b40b1e38e8c6006cb0a, $veea7dc04e9c0c2c050fea3f8340c661b);return $v599dcce2998a6b40b1e38e8c6006cb0a;}protected function importTypeGroups(umiObjectType $v599dcce2998a6b40b1e38e8c6006cb0a, DOMElement $veea7dc04e9c0c2c050fea3f8340c661b) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("fieldgroups/group", $veea7dc04e9c0c2c050fea3f8340c661b);foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $v562feb4548b66febf02774b4f339552e) {$this->importTypeGroup($v599dcce2998a6b40b1e38e8c6006cb0a, $v562feb4548b66febf02774b4f339552e);}}protected function importTypeGroup(umiObjectType $v599dcce2998a6b40b1e38e8c6006cb0a, DOMElement $v562feb4548b66febf02774b4f339552e, $v329edef3a633f06f22708df738e30eb2 = true) {$veeeb23fbd23e52a6a6ff78b9f18cbc4e = self::translateName($v562feb4548b66febf02774b4f339552e->getAttribute('name'));if (!strlen($veeeb23fbd23e52a6a6ff78b9f18cbc4e)) return false;$vd5d3db1765287eef77d7927cc956f50a = $v562feb4548b66febf02774b4f339552e->hasAttribute('title') ? $v562feb4548b66febf02774b4f339552e->getAttribute('title') : null;$ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = $v562feb4548b66febf02774b4f339552e->hasAttribute('visible') ? $v562feb4548b66febf02774b4f339552e->getAttribute('visible') : null;$v1945c9a2a5e2ba6133f1db6757a35fcb = $v562feb4548b66febf02774b4f339552e->hasAttribute('locked') ? $v562feb4548b66febf02774b4f339552e->getAttribute('locked') : null;$vdb0f6f37ebeb6ea09489124345af2a45 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldsGroupByName($veeeb23fbd23e52a6a6ff78b9f18cbc4e, true);if (!$vdb0f6f37ebeb6ea09489124345af2a45 instanceof umiFieldsGroup) {if (is_null($vd5d3db1765287eef77d7927cc956f50a)) {$vd5d3db1765287eef77d7927cc956f50a = "Group #" . $veeeb23fbd23e52a6a6ff78b9f18cbc4e;}$v0e939a4ffd3aacd724dd3b50147b4353 = $v599dcce2998a6b40b1e38e8c6006cb0a->addFieldsGroup($veeeb23fbd23e52a6a6ff78b9f18cbc4e, trim($vd5d3db1765287eef77d7927cc956f50a), true, false);$vdb0f6f37ebeb6ea09489124345af2a45 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldsGroup($v0e939a4ffd3aacd724dd3b50147b4353);}if (!$vdb0f6f37ebeb6ea09489124345af2a45 instanceof umiFieldsGroup) return false;if (!is_null($vd5d3db1765287eef77d7927cc956f50a)) $vdb0f6f37ebeb6ea09489124345af2a45->setTitle(trim($vd5d3db1765287eef77d7927cc956f50a));if (!is_null($ve1c6c9ef2fcbe75f26f815c4ef2e60b4)) $vdb0f6f37ebeb6ea09489124345af2a45->setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4 == 'visible' || $ve1c6c9ef2fcbe75f26f815c4ef2e60b4 == '1');if (!is_null($v1945c9a2a5e2ba6133f1db6757a35fcb)) $vdb0f6f37ebeb6ea09489124345af2a45->setIsLocked($v1945c9a2a5e2ba6133f1db6757a35fcb == 'locked' || $v1945c9a2a5e2ba6133f1db6757a35fcb == '1');$vdb0f6f37ebeb6ea09489124345af2a45->commit();if ($v329edef3a633f06f22708df738e30eb2) $this->importGroupFields($vdb0f6f37ebeb6ea09489124345af2a45, $v562feb4548b66febf02774b4f339552e);return $vdb0f6f37ebeb6ea09489124345af2a45;}protected function importGroupFields(umiFieldsGroup $vdb0f6f37ebeb6ea09489124345af2a45, DOMElement $v562feb4548b66febf02774b4f339552e) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("field", $v562feb4548b66febf02774b4f339552e);foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $v3906452ac57c71c3f053666f9c0e8355) {$this->importField($vdb0f6f37ebeb6ea09489124345af2a45, $v3906452ac57c71c3f053666f9c0e8355);}}protected function getFieldByName(umiFieldsGroup $vdb0f6f37ebeb6ea09489124345af2a45, $vb068931cc450442b63f5b3d276ea4297) {$vd05b6ed7d2345020440df396d6da7f73 = $vdb0f6f37ebeb6ea09489124345af2a45->getFields();foreach ($vd05b6ed7d2345020440df396d6da7f73 as $v06e3d36fa30cea095545139854ad1fb9) {if ($v06e3d36fa30cea095545139854ad1fb9->getName() == $vb068931cc450442b63f5b3d276ea4297) return $v06e3d36fa30cea095545139854ad1fb9;}return false;}protected function importFieldType($vfaf701ce237284ac6be752513db01dcd) {$vb068931cc450442b63f5b3d276ea4297 = $vfaf701ce237284ac6be752513db01dcd->getAttribute('name');$v17f71d965fe9589ddbd11caf7182243e = $vfaf701ce237284ac6be752513db01dcd->getAttribute('data-type');if (!strlen($v17f71d965fe9589ddbd11caf7182243e)) return false;$vdb6d9b451b818ccc9a449383f2f0c450 = umiFieldTypesCollection::getInstance();$v3fa9d6639f24f9bb4bf81ac6bdbdbc8c = $vdb6d9b451b818ccc9a449383f2f0c450->getFieldTypesList();$v519504d7d4beb745dac24ccfb6c1d7c9 = false;foreach($v3fa9d6639f24f9bb4bf81ac6bdbdbc8c as $v39bb421562d6f6128a957f3d162538d2) {if ($v39bb421562d6f6128a957f3d162538d2->getDataType() == $v17f71d965fe9589ddbd11caf7182243e) {$v519504d7d4beb745dac24ccfb6c1d7c9 = $v39bb421562d6f6128a957f3d162538d2;break;}}if (!$v519504d7d4beb745dac24ccfb6c1d7c9 instanceof  umiFieldType) {$v1e3f04102267eaf5e8d0ca424fd5c561 = $vdb6d9b451b818ccc9a449383f2f0c450->addFieldType($vb068931cc450442b63f5b3d276ea4297, $v17f71d965fe9589ddbd11caf7182243e);$v519504d7d4beb745dac24ccfb6c1d7c9 = $vdb6d9b451b818ccc9a449383f2f0c450->getFieldType($v1e3f04102267eaf5e8d0ca424fd5c561);}return $v519504d7d4beb745dac24ccfb6c1d7c9;}public function getAutoGuideId($vd5d3db1765287eef77d7927cc956f50a) {$vcf4313ee98665bb3d4b717b344ba6999 = "Справочник для поля \"{$vd5d3db1765287eef77d7927cc956f50a}\"";$v2af1d1812273df0bd0f720da7068f8a6 = umiObjectTypesCollection::getInstance()->getChildClasses(7);foreach($v2af1d1812273df0bd0f720da7068f8a6 as $vd4fd255f51559df00de5424b64292413) {$v793536b8480511c5e2975eba32738d1d = umiObjectTypesCollection::getInstance()->getType($vd4fd255f51559df00de5424b64292413);$vfd297f4a9a622aec6f6fb2589b9cda82 = $v793536b8480511c5e2975eba32738d1d->getName();if($vfd297f4a9a622aec6f6fb2589b9cda82 == $vcf4313ee98665bb3d4b717b344ba6999) {$v793536b8480511c5e2975eba32738d1d->setIsGuidable(true);return $vd4fd255f51559df00de5424b64292413;}}$v051369818a8073bba5feeb0e957eb308 = umiObjectTypesCollection::getInstance()->addType(7, $vcf4313ee98665bb3d4b717b344ba6999);$va0c391dc49c440fc9962168353cedde3 = umiObjectTypesCollection::getInstance()->getType($v051369818a8073bba5feeb0e957eb308);$va0c391dc49c440fc9962168353cedde3->setIsGuidable(true);$va0c391dc49c440fc9962168353cedde3->setIsPublic(true);$va0c391dc49c440fc9962168353cedde3->commit();return $v051369818a8073bba5feeb0e957eb308;}protected function importField(umiFieldsGroup $vdb0f6f37ebeb6ea09489124345af2a45, DOMElement $v3906452ac57c71c3f053666f9c0e8355) {$v73f329f154a663bfda020aadcdd0b775 = self::translateName($v3906452ac57c71c3f053666f9c0e8355->getAttribute('name'));if (!strlen($v73f329f154a663bfda020aadcdd0b775)) return false;$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("type", $v3906452ac57c71c3f053666f9c0e8355);$vfaf701ce237284ac6be752513db01dcd = $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0): false;if (!$vfaf701ce237284ac6be752513db01dcd) return false;$v519504d7d4beb745dac24ccfb6c1d7c9 = $this->importFieldType($vfaf701ce237284ac6be752513db01dcd);if (!$v519504d7d4beb745dac24ccfb6c1d7c9 instanceof umiFieldType)  return false;$vd5d3db1765287eef77d7927cc956f50a = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('title') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('title') : null;$v6a2139364f96787c8ce1bbb0070b898c = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('tip') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('tip') : null;$ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('visible') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('visible') : null;$v1945c9a2a5e2ba6133f1db6757a35fcb = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('locked') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('locked') : null;$vd5752333adc3a004f826f2ea2a41273a = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('inheritable') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('inheritable') : null;$ved5d0cbca24ec1fe6d0ab89a566dc9c1 = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('indexable') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('indexable') : null;$va0b3cf76e59b5c67b3ea226dd76adf9b = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('filterable') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('filterable') : null;$v0d2ac6f3b02c0de484369013b31f2ed7 = $v3906452ac57c71c3f053666f9c0e8355->hasAttribute('required') ? $v3906452ac57c71c3f053666f9c0e8355->getAttribute('required') : null;$v06e3d36fa30cea095545139854ad1fb9 = $this->getFieldByName($vdb0f6f37ebeb6ea09489124345af2a45, $v73f329f154a663bfda020aadcdd0b775);$vdb6d9b451b818ccc9a449383f2f0c450 = umiFieldsCollection::getInstance();if (!$v06e3d36fa30cea095545139854ad1fb9 instanceof umiField) {if (is_null($vd5d3db1765287eef77d7927cc956f50a)) {$vd5d3db1765287eef77d7927cc956f50a = $v73f329f154a663bfda020aadcdd0b775;}$v3aabf39f2d943fa886d86dcbbee4d910 = $vdb6d9b451b818ccc9a449383f2f0c450->addField($v73f329f154a663bfda020aadcdd0b775, trim($vd5d3db1765287eef77d7927cc956f50a), $v519504d7d4beb745dac24ccfb6c1d7c9->getId(), false, false, false);$vdb0f6f37ebeb6ea09489124345af2a45->attachField($v3aabf39f2d943fa886d86dcbbee4d910);$v06e3d36fa30cea095545139854ad1fb9 = $vdb6d9b451b818ccc9a449383f2f0c450->getField($v3aabf39f2d943fa886d86dcbbee4d910);if ($v519504d7d4beb745dac24ccfb6c1d7c9->getDataType() == 'relation') {$v06e3d36fa30cea095545139854ad1fb9->setGuideId($this->getAutoGuideId($vd5d3db1765287eef77d7927cc956f50a));}}if (!is_null($vd5d3db1765287eef77d7927cc956f50a)) $v06e3d36fa30cea095545139854ad1fb9->setTitle(trim($vd5d3db1765287eef77d7927cc956f50a));if (!is_null($ve1c6c9ef2fcbe75f26f815c4ef2e60b4)) $v06e3d36fa30cea095545139854ad1fb9->setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4 == 'visible' || $ve1c6c9ef2fcbe75f26f815c4ef2e60b4 == "1");if (!is_null($ved5d0cbca24ec1fe6d0ab89a566dc9c1)) $v06e3d36fa30cea095545139854ad1fb9->setIsInSearch($ved5d0cbca24ec1fe6d0ab89a566dc9c1 == 'indexable' || $ved5d0cbca24ec1fe6d0ab89a566dc9c1 == "1");if (!is_null($va0b3cf76e59b5c67b3ea226dd76adf9b)) $v06e3d36fa30cea095545139854ad1fb9->setIsInFilter($va0b3cf76e59b5c67b3ea226dd76adf9b == 'filterable' || $va0b3cf76e59b5c67b3ea226dd76adf9b == "1");if (!is_null($v0d2ac6f3b02c0de484369013b31f2ed7)) $v06e3d36fa30cea095545139854ad1fb9->setIsRequired($v0d2ac6f3b02c0de484369013b31f2ed7 == 'required' || $v0d2ac6f3b02c0de484369013b31f2ed7 == "1");if (!is_null($v6a2139364f96787c8ce1bbb0070b898c)) $v06e3d36fa30cea095545139854ad1fb9->setTip(trim($v6a2139364f96787c8ce1bbb0070b898c));if (!is_null($v1945c9a2a5e2ba6133f1db6757a35fcb)) $v06e3d36fa30cea095545139854ad1fb9->setIsLocked($v1945c9a2a5e2ba6133f1db6757a35fcb == 'locked' || $v1945c9a2a5e2ba6133f1db6757a35fcb == "1");$v06e3d36fa30cea095545139854ad1fb9->commit();return $v06e3d36fa30cea095545139854ad1fb9;}protected function importBranches() {foreach ($this->meta['branches'] as $vb80bb7740288fda1f201890375a60c8f) {$this->importBranch($vb80bb7740288fda1f201890375a60c8f);}}protected function importElements() {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/pages/page");foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $vcaf9b6b99962bf5c2264824231d7a40c) {$this->importElement($vcaf9b6b99962bf5c2264824231d7a40c);}}protected function importBranch($vb80bb7740288fda1f201890375a60c8f) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/pages/page[@id = '" . $vb80bb7740288fda1f201890375a60c8f . "']");if (!$v1a13105b7e4eb5fb2e7c9515ac06aa48->length) return false;$this->importElement($v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0));$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/pages/page[@parentId = '" . $vb80bb7740288fda1f201890375a60c8f . "']");foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $vcaf9b6b99962bf5c2264824231d7a40c) {$vf36263a38d7de5cdaa953c1e2b2f79b5 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('id');if ($vf36263a38d7de5cdaa953c1e2b2f79b5) $this->importBranch($vf36263a38d7de5cdaa953c1e2b2f79b5);}}protected function detectBetterTemplateId($v6a2a431fe8b621037ea949531c28551d) {if($v6a2a431fe8b621037ea949531c28551d) {$v662cbf1253ac7d8750ed9190c52163e5 = cmsController::getInstance()->getCurrentDomain()->getId();$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();$vfed36e93a0509e20f2dc96cbbd85b678 = templatesCollection::getInstance()->getTemplatesList($v662cbf1253ac7d8750ed9190c52163e5, $v78e6dd7a49f5b0cb2106a3a434dd5c86);foreach($vfed36e93a0509e20f2dc96cbbd85b678 as $v4f96c7bc828b57b4a3b2b327a7a183c6) {if($v4f96c7bc828b57b4a3b2b327a7a183c6->getFilename() == $v6a2a431fe8b621037ea949531c28551d) {return $v4f96c7bc828b57b4a3b2b327a7a183c6->getId();}}}return templatesCollection::getInstance()->getDefaultTemplate()->getId();}protected function importElement(DOMElement $vcaf9b6b99962bf5c2264824231d7a40c) {$v61ce6a78cb3c8547fed20990c92edfe3 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('id');$v5f6492d9717ccf1b8566bd4bc64110b6 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('type-id');$vd33d1e928d54a353100641ff7d704306 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('parentId');$vdff819de3d610895b1bdf4168281488c = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('update-only') == '1';$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $vcaf9b6b99962bf5c2264824231d7a40c->getElementsByTagName('name');$vb068931cc450442b63f5b3d276ea4297 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : false;$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $vcaf9b6b99962bf5c2264824231d7a40c->getElementsByTagName('template');$v66f6181bcb4cff4cd38fbc804a036db6 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->length ? $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue : null;if (!strlen($v61ce6a78cb3c8547fed20990c92edfe3)) {$this->reportError("Can't create element \"{$vb068931cc450442b63f5b3d276ea4297}\" with empty id");return false;}$vd84ff935144e00c3e1d395c2379aca47 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('alt-name');if (!strlen($vd84ff935144e00c3e1d395c2379aca47)) $vd84ff935144e00c3e1d395c2379aca47 = $vb068931cc450442b63f5b3d276ea4297;$v4264c638e0098acb172519b0436db099 = $vcaf9b6b99962bf5c2264824231d7a40c->hasAttribute('is-active') ? $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('is-active') : null;$ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = $vcaf9b6b99962bf5c2264824231d7a40c->hasAttribute('is-visible') ? $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('is-visible') : null;$vf49e2553045b3240a95c36854d36dddc = $vcaf9b6b99962bf5c2264824231d7a40c->hasAttribute('is-deleted') ? $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('is-deleted') : null;$vdb6d9b451b818ccc9a449383f2f0c450 = umiHierarchy::getInstance();$v953e1ee8066af1b7e55300750533ddc8 = umiObjectTypesCollection::getInstance();$ve2fa538867c3830a859a5b17ab24644b = false;$v7057e8409c7c531a1a6e9ac3df4ed549 = $this->relations->getNewIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3);if (!$v7057e8409c7c531a1a6e9ac3df4ed549) {if ($vdff819de3d610895b1bdf4168281488c) {return false;}if (!$vb068931cc450442b63f5b3d276ea4297) $vb068931cc450442b63f5b3d276ea4297 = $v61ce6a78cb3c8547fed20990c92edfe3;if (!strlen($v5f6492d9717ccf1b8566bd4bc64110b6)) {$this->reportError("Can't create element: Undefined type-id for element \"{$vb068931cc450442b63f5b3d276ea4297}\" (#{$v61ce6a78cb3c8547fed20990c92edfe3})");return false;}$v94757cae63fd3e398c0811a976dd6bbe = $this->relations->getNewTypeIdRelation($this->source_id, $v5f6492d9717ccf1b8566bd4bc64110b6);$v599dcce2998a6b40b1e38e8c6006cb0a = $v953e1ee8066af1b7e55300750533ddc8->getType($v94757cae63fd3e398c0811a976dd6bbe);if (!$v599dcce2998a6b40b1e38e8c6006cb0a instanceof umiObjectType) {$this->reportError("Can't create element \"{$vb068931cc450442b63f5b3d276ea4297}\" ($v61ce6a78cb3c8547fed20990c92edfe3): Type {#$v5f6492d9717ccf1b8566bd4bc64110b6} for element not found.");return false;}$v6be379826b20cc58475f636e33f4606b = $this->relations->getNewIdRelation($this->source_id, $vd33d1e928d54a353100641ff7d704306);if ($v6be379826b20cc58475f636e33f4606b === false) $v6be379826b20cc58475f636e33f4606b = $this->destination_element_id;$v7057e8409c7c531a1a6e9ac3df4ed549 = $vdb6d9b451b818ccc9a449383f2f0c450->addElement($v6be379826b20cc58475f636e33f4606b, $v599dcce2998a6b40b1e38e8c6006cb0a->getHierarchyTypeId(), $vb068931cc450442b63f5b3d276ea4297, $vd84ff935144e00c3e1d395c2379aca47, $v599dcce2998a6b40b1e38e8c6006cb0a->getId());permissionsCollection::getInstance()->setDefaultPermissions($v7057e8409c7c531a1a6e9ac3df4ed549);$this->relations->setIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3, $v7057e8409c7c531a1a6e9ac3df4ed549);if (is_null($v4264c638e0098acb172519b0436db099)) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $vcaf9b6b99962bf5c2264824231d7a40c->getElementsByTagName('default-active');if ($v1a13105b7e4eb5fb2e7c9515ac06aa48->length) $v4264c638e0098acb172519b0436db099 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue;}if (is_null($ve1c6c9ef2fcbe75f26f815c4ef2e60b4)) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $vcaf9b6b99962bf5c2264824231d7a40c->getElementsByTagName('default-visible');if ($v1a13105b7e4eb5fb2e7c9515ac06aa48->length) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue;}if (is_null($v66f6181bcb4cff4cd38fbc804a036db6)) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $vcaf9b6b99962bf5c2264824231d7a40c->getElementsByTagName('default-template');if ($v1a13105b7e4eb5fb2e7c9515ac06aa48->length) $v66f6181bcb4cff4cd38fbc804a036db6 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0)->nodeValue;}$ve2fa538867c3830a859a5b17ab24644b = true;}$v8e2dcfd7e7e24b1ca76c1193f645902b = $vdb6d9b451b818ccc9a449383f2f0c450->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);if (!$v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement) return false;if ($vb068931cc450442b63f5b3d276ea4297) $v8e2dcfd7e7e24b1ca76c1193f645902b->setName($vb068931cc450442b63f5b3d276ea4297);if (!is_null($v4264c638e0098acb172519b0436db099)) $v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive($v4264c638e0098acb172519b0436db099 == 'active' || $v4264c638e0098acb172519b0436db099 == '1');if (!is_null($ve1c6c9ef2fcbe75f26f815c4ef2e60b4)) $v8e2dcfd7e7e24b1ca76c1193f645902b->setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4 == 'visible' || $ve1c6c9ef2fcbe75f26f815c4ef2e60b4 == '1');if (!is_null($v66f6181bcb4cff4cd38fbc804a036db6)) {$vd02e12eb6d6c3f6ebd763197df01e211 = $this->detectBetterTemplateId($v66f6181bcb4cff4cd38fbc804a036db6);$v8e2dcfd7e7e24b1ca76c1193f645902b->setTplId($vd02e12eb6d6c3f6ebd763197df01e211);}if ($vf49e2553045b3240a95c36854d36dddc == 'deleted' || $vf49e2553045b3240a95c36854d36dddc == '1') $v8e2dcfd7e7e24b1ca76c1193f645902b->setIsDeleted(true);$this->importPropValues($v8e2dcfd7e7e24b1ca76c1193f645902b, $vcaf9b6b99962bf5c2264824231d7a40c, $ve2fa538867c3830a859a5b17ab24644b);if ($vf49e2553045b3240a95c36854d36dddc && ($vf49e2553045b3240a95c36854d36dddc == 'deleted' || $vf49e2553045b3240a95c36854d36dddc == '1')) {$this->deleted_elements++;$this->writeLog("Element \"" . $v8e2dcfd7e7e24b1ca76c1193f645902b->getName() . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been deleted");}elseif ($ve2fa538867c3830a859a5b17ab24644b) {$this->created_elements++;$this->writeLog("Element \"" . $v8e2dcfd7e7e24b1ca76c1193f645902b->getName() . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been created");}elseif($v8e2dcfd7e7e24b1ca76c1193f645902b->getIsUpdated()) {$this->updated_elements++;$this->writeLog("Element \"" . $v8e2dcfd7e7e24b1ca76c1193f645902b->getName() . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been updated");}$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$vdb6d9b451b818ccc9a449383f2f0c450->unloadElement($v7057e8409c7c531a1a6e9ac3df4ed549);return $v8e2dcfd7e7e24b1ca76c1193f645902b;}protected function importObject(DOMElement $vcaf9b6b99962bf5c2264824231d7a40c) {$v61ce6a78cb3c8547fed20990c92edfe3 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('id');$v5f6492d9717ccf1b8566bd4bc64110b6 = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('type-id');$vdff819de3d610895b1bdf4168281488c = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('update-only') == '1';$vb068931cc450442b63f5b3d276ea4297 = $vcaf9b6b99962bf5c2264824231d7a40c->hasAttribute('name') ? $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('name') : null;if (!strlen($v61ce6a78cb3c8547fed20990c92edfe3)) {$this->reportError("Can't create object {$vb068931cc450442b63f5b3d276ea4297} with empty id");return false;}$v1945c9a2a5e2ba6133f1db6757a35fcb = $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('locked');$vaf31437ce61345f416579830a98c91e5 = $this->relations->getNewObjectIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3);$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectsCollection::getInstance();$v953e1ee8066af1b7e55300750533ddc8 = umiObjectTypesCollection::getInstance();$ve2fa538867c3830a859a5b17ab24644b = false;if (!$vaf31437ce61345f416579830a98c91e5) {if ($vdff819de3d610895b1bdf4168281488c) {return false;}if (!$vb068931cc450442b63f5b3d276ea4297) $vb068931cc450442b63f5b3d276ea4297 = $v61ce6a78cb3c8547fed20990c92edfe3;if (!strlen($v5f6492d9717ccf1b8566bd4bc64110b6)) {$this->reportError("Can't create object: Undefined type-id for object \"{$vb068931cc450442b63f5b3d276ea4297}\" (#{$v61ce6a78cb3c8547fed20990c92edfe3})");return false;}$v94757cae63fd3e398c0811a976dd6bbe = $this->relations->getNewTypeIdRelation($this->source_id, $v5f6492d9717ccf1b8566bd4bc64110b6);$v599dcce2998a6b40b1e38e8c6006cb0a = $v953e1ee8066af1b7e55300750533ddc8->getType($v94757cae63fd3e398c0811a976dd6bbe);if (!$v599dcce2998a6b40b1e38e8c6006cb0a instanceof umiObjectType) {$this->reportError("Can't create object: Type {#$v5f6492d9717ccf1b8566bd4bc64110b6} for object \"{$vb068931cc450442b63f5b3d276ea4297}\" not found.");return false;}$vaf31437ce61345f416579830a98c91e5 = $vdb6d9b451b818ccc9a449383f2f0c450->addObject($vb068931cc450442b63f5b3d276ea4297, $v94757cae63fd3e398c0811a976dd6bbe, ($v1945c9a2a5e2ba6133f1db6757a35fcb == 'locked' || $v1945c9a2a5e2ba6133f1db6757a35fcb == '1'));$this->relations->setObjectIdRelation($this->source_id, $v61ce6a78cb3c8547fed20990c92edfe3, $vaf31437ce61345f416579830a98c91e5);$ve2fa538867c3830a859a5b17ab24644b = true;}$va8cfde6331bd59eb2ac96f8911c4b666 = $vdb6d9b451b818ccc9a449383f2f0c450->getObject($vaf31437ce61345f416579830a98c91e5);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject) return false;if (!is_null($vb068931cc450442b63f5b3d276ea4297)) $va8cfde6331bd59eb2ac96f8911c4b666->setName($vb068931cc450442b63f5b3d276ea4297);$this->importPropValues($va8cfde6331bd59eb2ac96f8911c4b666, $vcaf9b6b99962bf5c2264824231d7a40c, $ve2fa538867c3830a859a5b17ab24644b);if ($ve2fa538867c3830a859a5b17ab24644b) {$this->created_objects++;$this->writeLog("Object \"" . $va8cfde6331bd59eb2ac96f8911c4b666->getName() . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been created");}elseif($va8cfde6331bd59eb2ac96f8911c4b666->getIsUpdated()) {$this->updated_objects++;$this->writeLog("Object \"" . $va8cfde6331bd59eb2ac96f8911c4b666->getName() . "\" (" . $v61ce6a78cb3c8547fed20990c92edfe3 . ") has been updated");}$va8cfde6331bd59eb2ac96f8911c4b666->commit();return $va8cfde6331bd59eb2ac96f8911c4b666;}protected function importPropValues(umiEntinty $vf5e638cc78dd325906c1298a0c21fb6b, DOMElement $vcaf9b6b99962bf5c2264824231d7a40c, $vd08e820fd4eb48eede47aa5985d10cc8 = false) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("properties/group/property", $vcaf9b6b99962bf5c2264824231d7a40c);foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $v410e0a26c217dfabf8a5653e8f9e68ef) {$this->importPropValue($vf5e638cc78dd325906c1298a0c21fb6b, $v410e0a26c217dfabf8a5653e8f9e68ef, $vd08e820fd4eb48eede47aa5985d10cc8);}}protected static function translateName($vb068931cc450442b63f5b3d276ea4297) {$vb068931cc450442b63f5b3d276ea4297 = str_replace("-", "_", $vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 = umiHierarchy::convertAltName($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 = umiObjectProperty::filterInputString($vb068931cc450442b63f5b3d276ea4297);if(!strlen($vb068931cc450442b63f5b3d276ea4297)) $vb068931cc450442b63f5b3d276ea4297 = '_';return $vb068931cc450442b63f5b3d276ea4297;}protected function importPropValue(umiEntinty $vf5e638cc78dd325906c1298a0c21fb6b, DOMElement $vcaf9b6b99962bf5c2264824231d7a40c, $vd08e820fd4eb48eede47aa5985d10cc8 = false) {$vb068931cc450442b63f5b3d276ea4297 = self::translateName($vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('name'));$v1a13105b7e4eb5fb2e7c9515ac06aa48 =  $this->parser->evaluate("value", $vcaf9b6b99962bf5c2264824231d7a40c);if (!$v1a13105b7e4eb5fb2e7c9515ac06aa48->length && $vd08e820fd4eb48eede47aa5985d10cc8) {$v1a13105b7e4eb5fb2e7c9515ac06aa48 =  $this->parser->evaluate("default-value", $vcaf9b6b99962bf5c2264824231d7a40c);}if (!$v1a13105b7e4eb5fb2e7c9515ac06aa48->length) {return false;}$v67236e502346412a98a0bb965b7a59e6 = $v1a13105b7e4eb5fb2e7c9515ac06aa48->item(0);$v94757cae63fd3e398c0811a976dd6bbe = ($vf5e638cc78dd325906c1298a0c21fb6b instanceof umiHierarchyElement) ? $vf5e638cc78dd325906c1298a0c21fb6b->getObjectTypeId() : $vf5e638cc78dd325906c1298a0c21fb6b->getTypeId();$v599dcce2998a6b40b1e38e8c6006cb0a = umiObjectTypesCollection::getInstance()->getType($v94757cae63fd3e398c0811a976dd6bbe);$v3aabf39f2d943fa886d86dcbbee4d910 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId($vb068931cc450442b63f5b3d276ea4297);$v06e3d36fa30cea095545139854ad1fb9 = umiFieldsCollection::getInstance()->getField($v3aabf39f2d943fa886d86dcbbee4d910);if (!$v06e3d36fa30cea095545139854ad1fb9 instanceof umiField && $vcaf9b6b99962bf5c2264824231d7a40c->getAttribute('allow-runtime-add') == '1')  {$v562feb4548b66febf02774b4f339552e = $vcaf9b6b99962bf5c2264824231d7a40c->parentNode;$vdb0f6f37ebeb6ea09489124345af2a45 = $this->importTypeGroup($v599dcce2998a6b40b1e38e8c6006cb0a, $v562feb4548b66febf02774b4f339552e, false);if (!$vdb0f6f37ebeb6ea09489124345af2a45 instanceof umiFieldsGroup) return false;$v06e3d36fa30cea095545139854ad1fb9 = $this->importField($vdb0f6f37ebeb6ea09489124345af2a45, $vcaf9b6b99962bf5c2264824231d7a40c);($vf5e638cc78dd325906c1298a0c21fb6b instanceof umiHierarchyElement) ? $vf5e638cc78dd325906c1298a0c21fb6b->getObject()->update() : $vf5e638cc78dd325906c1298a0c21fb6b->update();}if (!$v06e3d36fa30cea095545139854ad1fb9 instanceof umiField) return false;switch($v06e3d36fa30cea095545139854ad1fb9->getDataType()) {case "optioned":    case "symlink": case "password": {return false;}case "date": {$vd7e6d55ba379a13d08c25d15faf2a23b = intval($v67236e502346412a98a0bb965b7a59e6->getAttribute('unix-timestamp'));$v8059f160e1aa1f9d3921049ce93b00e1 = new umiDate();if ($vd7e6d55ba379a13d08c25d15faf2a23b) {$v8059f160e1aa1f9d3921049ce93b00e1->setDateByTimeStamp($vd7e6d55ba379a13d08c25d15faf2a23b);}else {$v8059f160e1aa1f9d3921049ce93b00e1->setDateByString($v67236e502346412a98a0bb965b7a59e6->nodeValue);}$vf5e638cc78dd325906c1298a0c21fb6b->setValue($vb068931cc450442b63f5b3d276ea4297, $v8059f160e1aa1f9d3921049ce93b00e1);break;}case "price": {$vfcaea7edd270964cc145ea48e4367d43 = cmsController::getInstance()->getModule('emarket');$v78a5eb43deef9a7b5b9ce157b9d52ac4 = floatval($v67236e502346412a98a0bb965b7a59e6->nodeValue);$v52e3817fff5250b5391ef85b1ce23bdb = $v67236e502346412a98a0bb965b7a59e6->hasAttribute('currency-code') ? $v67236e502346412a98a0bb965b7a59e6->getAttribute('currency-code') : $v67236e502346412a98a0bb965b7a59e6->getAttribute('currency_code');if (strlen($v52e3817fff5250b5391ef85b1ce23bdb) && $vfcaea7edd270964cc145ea48e4367d43) {$v1af0389838508d7016a9841eb6273962 = $vfcaea7edd270964cc145ea48e4367d43->getCurrency($v52e3817fff5250b5391ef85b1ce23bdb);if ($v1af0389838508d7016a9841eb6273962) {$result = $vfcaea7edd270964cc145ea48e4367d43->formatCurrencyPrice(array($v78a5eb43deef9a7b5b9ce157b9d52ac4), $vfcaea7edd270964cc145ea48e4367d43->getDefaultCurrency(), $v1af0389838508d7016a9841eb6273962);$v78a5eb43deef9a7b5b9ce157b9d52ac4 = $result[0];}}$vf5e638cc78dd325906c1298a0c21fb6b->setValue($vb068931cc450442b63f5b3d276ea4297, $v78a5eb43deef9a7b5b9ce157b9d52ac4);break;}case "file":    case "img_file":    case "swf_file": {$vd6fe1d0be6347b8ef2427fa629c04485 = $v67236e502346412a98a0bb965b7a59e6->getAttribute('path');if (!$vd6fe1d0be6347b8ef2427fa629c04485) $vd6fe1d0be6347b8ef2427fa629c04485 = $v67236e502346412a98a0bb965b7a59e6->nodeValue;$vf5e638cc78dd325906c1298a0c21fb6b->setValue($vb068931cc450442b63f5b3d276ea4297, $vd6fe1d0be6347b8ef2427fa629c04485);break;}case "relation": {if ($vb068931cc450442b63f5b3d276ea4297 == 'payment_status_id' && $v599dcce2998a6b40b1e38e8c6006cb0a->getMethod() == 'order') {$vfcaea7edd270964cc145ea48e4367d43 = cmsController::getInstance()->getModule('emarket');if ($vfcaea7edd270964cc145ea48e4367d43) {$v903931b3a9d25a70683f51ab9d363d2e = $v67236e502346412a98a0bb965b7a59e6->nodeValue;$v70a17ffa722a3985b86d30b034ad06d7 = order::get($vf5e638cc78dd325906c1298a0c21fb6b->id);umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = false;$v70a17ffa722a3985b86d30b034ad06d7->setPaymentStatus($v903931b3a9d25a70683f51ab9d363d2e);$v70a17ffa722a3985b86d30b034ad06d7->commit();umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = true;}}elseif ($vb068931cc450442b63f5b3d276ea4297 == 'status_id' && $v599dcce2998a6b40b1e38e8c6006cb0a->getMethod() == 'order') {$vfcaea7edd270964cc145ea48e4367d43 = cmsController::getInstance()->getModule('emarket');if ($vfcaea7edd270964cc145ea48e4367d43) {$v903931b3a9d25a70683f51ab9d363d2e = $v67236e502346412a98a0bb965b7a59e6->nodeValue;$v70a17ffa722a3985b86d30b034ad06d7 = order::get($vf5e638cc78dd325906c1298a0c21fb6b->id);$vc8db1069270b4aad8a8d03a1d939bc26 = $v70a17ffa722a3985b86d30b034ad06d7->getOrderStatus();$vf48da84a2621e8cad36af3c0af958502 = $v70a17ffa722a3985b86d30b034ad06d7->getCodeByStatus($vc8db1069270b4aad8a8d03a1d939bc26);if (!in_array($vf48da84a2621e8cad36af3c0af958502, array('ready', 'canceled', 'rejected'))) {umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = false;$v70a17ffa722a3985b86d30b034ad06d7->setOrderStatus($v903931b3a9d25a70683f51ab9d363d2e);$v70a17ffa722a3985b86d30b034ad06d7->commit();umiObjectProperty::$USE_FORCE_OBJECTS_CREATION = true;}}}else {$v691d502cfd0e0626cd3b058e5682ad1c = array();$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $v67236e502346412a98a0bb965b7a59e6->getElementsByTagName("item");foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $ve795119eccc6565f098fca8454bad366) {$v691d502cfd0e0626cd3b058e5682ad1c[] = $ve795119eccc6565f098fca8454bad366->getAttribute('name');}$vf5e638cc78dd325906c1298a0c21fb6b->setValue($vb068931cc450442b63f5b3d276ea4297, $v691d502cfd0e0626cd3b058e5682ad1c);}break;}case "string":    case "text":    case "wysiwyg":    case "boolean":    case "counter":    case "float":    case "int":    case "tags":    default: {$vf5e638cc78dd325906c1298a0c21fb6b->setValue($vb068931cc450442b63f5b3d276ea4297, $v67236e502346412a98a0bb965b7a59e6->nodeValue);break;}}}protected function importObjects() {$v1a13105b7e4eb5fb2e7c9515ac06aa48 = $this->parser->evaluate("/umidump/objects/object");foreach ($v1a13105b7e4eb5fb2e7c9515ac06aa48 as $vcaf9b6b99962bf5c2264824231d7a40c) {$this->importObject($vcaf9b6b99962bf5c2264824231d7a40c);}}};?>