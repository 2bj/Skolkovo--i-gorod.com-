<?php
 abstract class __emarket_admin_discounts extends baseModuleAdmin {public function discounts () {$this->setDataType("list");$this->setActionType("view");if($this->ifNotXmlMode()) return $this->doData();$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();$v94757cae63fd3e398c0811a976dd6bbe = $v0e8133eb006c0f85ed9444ae07a60842->getBaseType("emarket", "discount");$vaa9f73eea60a006820d0f8768bc8a3fc = 20;$ve1ba980ce14a8c0d7e2779f895ab8695 = (int) getRequest('p');$v7a86c157ee9713c34fbd7a1ee40f0c5a = $vaa9f73eea60a006820d0f8768bc8a3fc * $ve1ba980ce14a8c0d7e2779f895ab8695;$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('emarket', 'discount');$v8be74552df93e31bbdd6b36ed74bdb6a->limit($v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc);selectorHelper::detectFilters($v8be74552df93e31bbdd6b36ed74bdb6a);$this->setDataRange($vaa9f73eea60a006820d0f8768bc8a3fc, $v7a86c157ee9713c34fbd7a1ee40f0c5a);$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($v8be74552df93e31bbdd6b36ed74bdb6a->result, "objects");$this->setData($v8d777f385d3dfec8815d20f7496026dc, $v8be74552df93e31bbdd6b36ed74bdb6a->length);return $this->doData();}public function discount_add() {$ve62e4d22f2d8630f6e44e2b7c3f70ddc = Array("type" => "discount");$v15d61712450a686a7f365adf4fef581f = (string) getRequest('param0');if($v15d61712450a686a7f365adf4fef581f == "do") {$v8d777f385d3dfec8815d20f7496026dc = getArrayKey(getRequest('data'), 'new');$v9a79c462c3c07cbf915ce11837e9d3c9 = getRequest('name');$v65b6e2aac2f682a632ccd61650e47085 = getArrayKey($v8d777f385d3dfec8815d20f7496026dc, 'discount_type_id');try {$ve2dc6c48c56de466f6d13781796abf3d = discount::add($v9a79c462c3c07cbf915ce11837e9d3c9, $v65b6e2aac2f682a632ccd61650e47085);$v0858acc363f25bb7ca4fd2bf48d53592 = getArrayKey($v8d777f385d3dfec8815d20f7496026dc, 'discount_modificator_id');try {$v5957d6438a1e76d5867d0a0f3e454c3c = $this->expectObject($v0858acc363f25bb7ca4fd2bf48d53592, true, true);}catch (publicAdminException $ve1671797c52e15f763380b45e841ec32) {$ve2dc6c48c56de466f6d13781796abf3d->delete();$this->errorNewMessage(getLabel('error-modificator-required'));$this->errorPanic();}$vda2dc92ee83a9f229a35eee412144e40 = discountModificator::create($ve2dc6c48c56de466f6d13781796abf3d, $v5957d6438a1e76d5867d0a0f3e454c3c);$ve2dc6c48c56de466f6d13781796abf3d->setDiscountModificator($vda2dc92ee83a9f229a35eee412144e40);$v3ef0a3878d2d61be1c64e809f3f35427 = getArrayKey($v8d777f385d3dfec8815d20f7496026dc, 'discount_rules_id');foreach($v3ef0a3878d2d61be1c64e809f3f35427 as $vd518fb001991da3cf0287dbd4d7bab6e) {$v5bb8d90052e0538eb38d425636bc171e = $this->expectObject($vd518fb001991da3cf0287dbd4d7bab6e, true, true);$va146e6c9ae9b1e2408b0aa845011d529 = discountRule::create($ve2dc6c48c56de466f6d13781796abf3d, $v5bb8d90052e0538eb38d425636bc171e);if($va146e6c9ae9b1e2408b0aa845011d529 instanceof discountRule == false ) {$ve2dc6c48c56de466f6d13781796abf3d->delete();throw new publicAdminException("discountRule #{$vd518fb001991da3cf0287dbd4d7bab6e} \"{$v5bb8d90052e0538eb38d425636bc171e->name}\" class not found");}$ve2dc6c48c56de466f6d13781796abf3d->appendDiscountRule($va146e6c9ae9b1e2408b0aa845011d529);}$ve2dc6c48c56de466f6d13781796abf3d->commit();}catch (valueRequiredException $ve1671797c52e15f763380b45e841ec32) {$this->errorNewMessage($ve1671797c52e15f763380b45e841ec32->getMessage());$this->errorPanic();}$this->chooseRedirect($this->pre_lang . "/admin/emarket/discount_edit/" . $ve2dc6c48c56de466f6d13781796abf3d->getId() . "/");}$this->setDataType("form");$this->setActionType("create");$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($ve62e4d22f2d8630f6e44e2b7c3f70ddc, "object");$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}public function discount_edit() {$va8cfde6331bd59eb2ac96f8911c4b666 = $this->expectObject("param0");$v15d61712450a686a7f365adf4fef581f = (string) getRequest('param1');if($v15d61712450a686a7f365adf4fef581f == "do") {$this->saveEditedObjectData($va8cfde6331bd59eb2ac96f8911c4b666);unset($_REQUEST['type-id']);unset($_REQUEST['name']);$v49a1b4ee02e7e03a338c414ba1804d17 = Array();if($va8cfde6331bd59eb2ac96f8911c4b666->discount_modificator_id) {$v49a1b4ee02e7e03a338c414ba1804d17[] = $va8cfde6331bd59eb2ac96f8911c4b666->discount_modificator_id;}if($va8cfde6331bd59eb2ac96f8911c4b666->discount_rules_id) {$v49a1b4ee02e7e03a338c414ba1804d17 = array_merge($v49a1b4ee02e7e03a338c414ba1804d17, $va8cfde6331bd59eb2ac96f8911c4b666->discount_rules_id);}foreach($v49a1b4ee02e7e03a338c414ba1804d17 as $v49a1b4ee02e7e03a338c414ba1804d17) {$vab39f5e3b812c7a1f6d8a41e527531ed = $this->expectObject($v49a1b4ee02e7e03a338c414ba1804d17, true, true);$this->saveEditedObjectData($vab39f5e3b812c7a1f6d8a41e527531ed);}$this->chooseRedirect();}$this->setDataType("form");$this->setActionType("modify");$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($va8cfde6331bd59eb2ac96f8911c4b666, "object");$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}public function getModificators($v65b6e2aac2f682a632ccd61650e47085 = false, $ve1f1eeb708e15555efc136c5aee1f9bb = false) {$v691d502cfd0e0626cd3b058e5682ad1c = discountModificator::getList($v65b6e2aac2f682a632ccd61650e47085);if($ve1f1eeb708e15555efc136c5aee1f9bb) {$ve2dc6c48c56de466f6d13781796abf3d = discount::get($ve1f1eeb708e15555efc136c5aee1f9bb);$v1321f5a9b9ee84f3cbb543e83fbbe9c0 = $ve2dc6c48c56de466f6d13781796abf3d->getDiscountModificator()->getObject()->modificator_type_id;foreach($v691d502cfd0e0626cd3b058e5682ad1c as $v865c0c0b4ab0e063e5caa3387c1a8741 => $vad148a3ca8bd0ef3b48c52454c493ec5) {$v691d502cfd0e0626cd3b058e5682ad1c[$v865c0c0b4ab0e063e5caa3387c1a8741] = array(      'attribute:id' => $vad148a3ca8bd0ef3b48c52454c493ec5->id,      'attribute:name' => $vad148a3ca8bd0ef3b48c52454c493ec5->name     );if($vad148a3ca8bd0ef3b48c52454c493ec5->id == $v1321f5a9b9ee84f3cbb543e83fbbe9c0) {$v691d502cfd0e0626cd3b058e5682ad1c[$v865c0c0b4ab0e063e5caa3387c1a8741]['attribute:selected'] = 'selected';}}}return array(    'items' => array('nodes:item' => $v691d502cfd0e0626cd3b058e5682ad1c)   );}public function getRules($v65b6e2aac2f682a632ccd61650e47085 = false, $ve1f1eeb708e15555efc136c5aee1f9bb = false) {$v691d502cfd0e0626cd3b058e5682ad1c = discountRule::getList($v65b6e2aac2f682a632ccd61650e47085);if($ve1f1eeb708e15555efc136c5aee1f9bb) {$ve2dc6c48c56de466f6d13781796abf3d = discount::get($ve1f1eeb708e15555efc136c5aee1f9bb);$vd5a1e52263eb12172f7657376d7622c8 = $ve2dc6c48c56de466f6d13781796abf3d->getDiscountRules();$vac11209b8ea5977411be9490ec7007e5 = array();foreach($vd5a1e52263eb12172f7657376d7622c8 as $v981c1e7b3795da18687613fbd66d4954) {$vac11209b8ea5977411be9490ec7007e5[] = $v981c1e7b3795da18687613fbd66d4954->getObject()->rule_type_id;}foreach($v691d502cfd0e0626cd3b058e5682ad1c as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v981c1e7b3795da18687613fbd66d4954) {$v691d502cfd0e0626cd3b058e5682ad1c[$v865c0c0b4ab0e063e5caa3387c1a8741] = array(      'attribute:id' => $v981c1e7b3795da18687613fbd66d4954->id,      'attribute:name' => $v981c1e7b3795da18687613fbd66d4954->name     );if(in_array($v981c1e7b3795da18687613fbd66d4954->id, $vac11209b8ea5977411be9490ec7007e5)) {$v691d502cfd0e0626cd3b058e5682ad1c[$v865c0c0b4ab0e063e5caa3387c1a8741]['attribute:selected'] = 'selected';}}}return array(    'items' => array('nodes:item' => $v691d502cfd0e0626cd3b058e5682ad1c)   );}};?>