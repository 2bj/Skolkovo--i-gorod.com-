<?php
 abstract class __emarket_currency {public function applyPriceCurrency($v78a5eb43deef9a7b5b9ce157b9d52ac4 = 0, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {list($v31912934b8f34be4364cc043cd8a0176) = def_module::loadTemplates("./tpls/emarket/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", 'price_block');$result = array(    'price' => array(     'actual' => $v78a5eb43deef9a7b5b9ce157b9d52ac4    )   );$result['price'] = $this->formatCurrencyPrice($result['price']);if($v31912934b8f34be4364cc043cd8a0176) {$result['price'] = $this->parsePriceTpl($v66f6181bcb4cff4cd38fbc804a036db6, $result['price']);$result['void:price-original'] = getArrayKey($result['price'], 'original');$result['void:price-actual'] = getArrayKey($result['price'], 'actual');return def_module::parseTemplate($v31912934b8f34be4364cc043cd8a0176, $result);}else {return $result;}}public function currencySelector($v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {list($v31912934b8f34be4364cc043cd8a0176, $v5ad10ccde9b1728f3d06c1eb0b05ab0f, $v5499ddd845fc4355a16a16559fa94a0c) = def_module::loadTemplates("./tpls/emarket/currency/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl",    'currency_block', 'currency_item', 'currency_item_a');$ve7f82a9e3265341d89499a8a0efaa995 = $this->getDefaultCurrency();$v5a045cb6d112451dfef1f1d4c97978aa = $this->getCurrentCurrency();$vf1386a17eed513dff70798b0551dc170 = array();foreach($this->getCurrencyList() as $v1af0389838508d7016a9841eb6273962) {$ve253bed1357afcefc5fadfbc92f9eb97 = array(     'attribute:id'   => $v1af0389838508d7016a9841eb6273962->id,     'attribute:name'  => $v1af0389838508d7016a9841eb6273962->name,     'attribute:codename' => $v1af0389838508d7016a9841eb6273962->codename,     'attribute:rate' => $v1af0389838508d7016a9841eb6273962->rate,     'xlink:href'   => $v1af0389838508d7016a9841eb6273962->xlink,    );if($v1af0389838508d7016a9841eb6273962->codename == $ve7f82a9e3265341d89499a8a0efaa995->codename) {$ve253bed1357afcefc5fadfbc92f9eb97['attribute:default'] = 'default';}$v4f2afc9c4099ee1f39c9f551123e54bd = ($v5a045cb6d112451dfef1f1d4c97978aa->id == $v1af0389838508d7016a9841eb6273962->id) ? $v5499ddd845fc4355a16a16559fa94a0c : $v5ad10ccde9b1728f3d06c1eb0b05ab0f;$vf1386a17eed513dff70798b0551dc170[] = def_module::parseTemplate($v4f2afc9c4099ee1f39c9f551123e54bd, $ve253bed1357afcefc5fadfbc92f9eb97, false, $v1af0389838508d7016a9841eb6273962->id);}$vfca1bff8ad8b3a8585abfb0ad523ba42 = array(    'subnodes:items' => $vf1386a17eed513dff70798b0551dc170   );return def_module::parseTemplate($v31912934b8f34be4364cc043cd8a0176, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function selectCurrency() {$v3f4d9ac950dfb473bc6a0bb61b5d51ec = getRequest('currency-codename');$vdf5c1061fe1d17a8e40851089da114ec = $this->getCurrency($v3f4d9ac950dfb473bc6a0bb61b5d51ec);if($v3f4d9ac950dfb473bc6a0bb61b5d51ec && $vdf5c1061fe1d17a8e40851089da114ec) {$ve7f82a9e3265341d89499a8a0efaa995 = $this->getDefaultCurrency();$v91ec1f9324753048c0096d036a694f86 = customer::get();if($v91ec1f9324753048c0096d036a694f86->preffered_currency != $vdf5c1061fe1d17a8e40851089da114ec->id) {if($vdf5c1061fe1d17a8e40851089da114ec->id == $ve7f82a9e3265341d89499a8a0efaa995->id) {$v91ec1f9324753048c0096d036a694f86->preffered_currency = null;}else {$v91ec1f9324753048c0096d036a694f86->preffered_currency = $vdf5c1061fe1d17a8e40851089da114ec->id;}$v91ec1f9324753048c0096d036a694f86->commit();}}if($v75e25c507b3048beaab01a12e7624ba2 = getRequest('redirect-uri')) {$this->redirect($v75e25c507b3048beaab01a12e7624ba2);}else {$this->redirect(getServer('HTTP_REFERER'));}}public function formatCurrencyPrices($vafae32efe0f84fece3f96b377b768b33, iUmiObject $ve7f82a9e3265341d89499a8a0efaa995 = null) {$vd142117a95a6d3973d7db75cfb3c9f97 = $this->getCurrencyList();$result = array();foreach($vd142117a95a6d3973d7db75cfb3c9f97 as $v1af0389838508d7016a9841eb6273962) {$vcaf9b6b99962bf5c2264824231d7a40c = $this->formatCurrencyPrice($vafae32efe0f84fece3f96b377b768b33, $v1af0389838508d7016a9841eb6273962, $ve7f82a9e3265341d89499a8a0efaa995);if(is_array($vcaf9b6b99962bf5c2264824231d7a40c)) {$result[] = $vcaf9b6b99962bf5c2264824231d7a40c;}}return array('nodes:price' => $result);}public function parseCurrencyPricesTpl($v66f6181bcb4cff4cd38fbc804a036db6 = 'default', $vbd3a5948e5408c23d4051f320c3ada60 = array(), iUmiObject $v5a045cb6d112451dfef1f1d4c97978aa = null) {if(xslTemplater::getInstance()->getIsInited()) return null;list($v31912934b8f34be4364cc043cd8a0176, $v5ad10ccde9b1728f3d06c1eb0b05ab0f) = def_module::loadTemplates("./tpls/emarket/currency/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl",    'currency_prices_block', 'currency_prices_item');if(is_null($v5a045cb6d112451dfef1f1d4c97978aa)) {$v5a045cb6d112451dfef1f1d4c97978aa = $this->getCurrentCurrency();}$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();$vd142117a95a6d3973d7db75cfb3c9f97 = $this->getCurrencyList();foreach($vd142117a95a6d3973d7db75cfb3c9f97 as $v1af0389838508d7016a9841eb6273962) {if($vcaf9b6b99962bf5c2264824231d7a40c = $this->formatCurrencyPrice($vbd3a5948e5408c23d4051f320c3ada60, $v1af0389838508d7016a9841eb6273962, $v5a045cb6d112451dfef1f1d4c97978aa)) {$vcaf9b6b99962bf5c2264824231d7a40c['price-original'] = $vcaf9b6b99962bf5c2264824231d7a40c['original'];$vcaf9b6b99962bf5c2264824231d7a40c['price-actual'] = $vcaf9b6b99962bf5c2264824231d7a40c['actual'];$vf1386a17eed513dff70798b0551dc170[] = def_module::parseTemplate($v5ad10ccde9b1728f3d06c1eb0b05ab0f, $vcaf9b6b99962bf5c2264824231d7a40c);}}$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = $vf1386a17eed513dff70798b0551dc170;return def_module::parseTemplate($v31912934b8f34be4364cc043cd8a0176, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function formatCurrencyPrice($vafae32efe0f84fece3f96b377b768b33, iUmiObject $v1af0389838508d7016a9841eb6273962 = null, iUmiObject $ve7f82a9e3265341d89499a8a0efaa995 = null) {if(is_null($ve7f82a9e3265341d89499a8a0efaa995)) {$ve7f82a9e3265341d89499a8a0efaa995 = $this->getDefaultCurrency();}$v5a045cb6d112451dfef1f1d4c97978aa = $this->getCurrentCurrency();if(is_null($v1af0389838508d7016a9841eb6273962)) {$v1af0389838508d7016a9841eb6273962 = $v5a045cb6d112451dfef1f1d4c97978aa;}else {if(($v1af0389838508d7016a9841eb6273962->getId() == $v5a045cb6d112451dfef1f1d4c97978aa->id) && ($ve7f82a9e3265341d89499a8a0efaa995 == $this->getDefaultCurrency())) {return $vafae32efe0f84fece3f96b377b768b33;}}$result = array(    'attribute:name'  => $v1af0389838508d7016a9841eb6273962->name,    'attribute:rate'  => $v1af0389838508d7016a9841eb6273962->rate,    'attribute:nominal'  => $v1af0389838508d7016a9841eb6273962->nominal,    'void:currency_name' => $v1af0389838508d7016a9841eb6273962->name   );if($v1af0389838508d7016a9841eb6273962->prefix) $result['attribute:prefix'] = $v1af0389838508d7016a9841eb6273962->prefix;else $result['void:prefix'] = false;if($v1af0389838508d7016a9841eb6273962->suffix) $result['attribute:suffix'] = $v1af0389838508d7016a9841eb6273962->suffix;else $result['void:suffix'] = false;foreach($vafae32efe0f84fece3f96b377b768b33 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v78a5eb43deef9a7b5b9ce157b9d52ac4) {if($v78a5eb43deef9a7b5b9ce157b9d52ac4 == null) {$result[$v3c6e0b8a9c15224a8228b9a98ca1531d] = null;continue;}$v78a5eb43deef9a7b5b9ce157b9d52ac4 = $v78a5eb43deef9a7b5b9ce157b9d52ac4 * $ve7f82a9e3265341d89499a8a0efaa995->nominal * $ve7f82a9e3265341d89499a8a0efaa995->rate;$v78a5eb43deef9a7b5b9ce157b9d52ac4 = $v78a5eb43deef9a7b5b9ce157b9d52ac4  / $v1af0389838508d7016a9841eb6273962->rate / $v1af0389838508d7016a9841eb6273962->nominal;$result[$v3c6e0b8a9c15224a8228b9a98ca1531d] = round($v78a5eb43deef9a7b5b9ce157b9d52ac4, 2);}return $result;}public function getDefaultCurrency() {$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();$vd7ba92827bb4469e316728c16201e1b9 = $v2245023265ae4cf87d02c8b6ba991139->get('system', 'default-currency');if(!$vd7ba92827bb4469e316728c16201e1b9) {throw new coreException("Default currency is not defined (system.default-currency)");}return $this->getCurrency($vd7ba92827bb4469e316728c16201e1b9);}public function getCurrentCurrency() {static $v1af0389838508d7016a9841eb6273962 = null;if(!is_null($v1af0389838508d7016a9841eb6273962)) {return $v1af0389838508d7016a9841eb6273962;}$v91ec1f9324753048c0096d036a694f86 = customer::get();if($v91ec1f9324753048c0096d036a694f86->preffered_currency) {return $v1af0389838508d7016a9841eb6273962 = selector::get('object')->id($v91ec1f9324753048c0096d036a694f86->preffered_currency);}return $v1af0389838508d7016a9841eb6273962 = $this->getDefaultCurrency();}public function getCurrency($vadceddddb69e6187bceace83aa4ab0f6) {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('emarket', 'currency');$v8be74552df93e31bbdd6b36ed74bdb6a->where('codename')->equals($vadceddddb69e6187bceace83aa4ab0f6);if($v8be74552df93e31bbdd6b36ed74bdb6a->first) {return $v8be74552df93e31bbdd6b36ed74bdb6a->first;}else throw new privateException("Currency \"{$vadceddddb69e6187bceace83aa4ab0f6}\" not found");}public function getCurrencyList() {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('emarket', 'currency');return $v8be74552df93e31bbdd6b36ed74bdb6a->result;}};?>