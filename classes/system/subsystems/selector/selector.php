<?php
 class selector implements IteratorAggregate {protected   $mode, $permissions = null, $limit, $offset,   $types = array(), $hierarchy = null,   $whereFieldProps = array(), $whereSysProps = array(),   $orderSysProps = array(), $orderFieldProps = array(),   $executor, $result = null, $length = null,   $options = array();protected static   $modes = array('objects', 'pages'),   $sysPagesWhereFields = array('name', 'owner', 'domain', 'lang', 'is_deleted',    'is_active', 'is_visible', 'updatetime', 'is_default', 'template_id', '*'),   $sysObjectsWhereFields = array('name', 'owner', '*'),   $sysOrderFields = array('name', 'ord', 'rand', 'updatetime', 'id');public static function get($v9c32b08fe4f1100357be3cefc37fb591) {return new selectorGetter($v9c32b08fe4f1100357be3cefc37fb591);}public function __construct($v15d61712450a686a7f365adf4fef581f) {$this->setMode($v15d61712450a686a7f365adf4fef581f);}public function types($v2dda916891cbd0bf046213df34800783 = false) {$this->checkExecuted();if($v2dda916891cbd0bf046213df34800783 === false)    return $this->types;else    return $this->types[] = new selectorType($v2dda916891cbd0bf046213df34800783, $this);}public function where($v972bf3f05d14ffbdb817bef60638ff00) {$this->checkExecuted();if($v972bf3f05d14ffbdb817bef60638ff00 == 'hierarchy') {if($this->mode == 'objects')     throw new selectorException("Hierarchy filter is not suitable for \"objects\" selector mode");return $this->hierarchy = new selectorWhereHierarchy;}if($v972bf3f05d14ffbdb817bef60638ff00 == 'permissions') {if($this->mode == 'objects')     throw new selectorException("Permissions filter is not suitable for \"objects\" selector mode");if(is_null($this->permissions)) $this->permissions = new selectorWherePermissions;return $this->permissions;}if(in_array($v972bf3f05d14ffbdb817bef60638ff00, ($this->mode == 'pages') ? self::$sysPagesWhereFields : self::$sysObjectsWhereFields)) {return $this->whereSysProps[$v972bf3f05d14ffbdb817bef60638ff00] = new selectorWhereSysProp($v972bf3f05d14ffbdb817bef60638ff00);}else {$v945100186b119048837b9859c2c46410 = $this->searchField($v972bf3f05d14ffbdb817bef60638ff00);if($v945100186b119048837b9859c2c46410) {return $this->whereFieldProps[] = new selectorWhereFieldProp($v945100186b119048837b9859c2c46410);}else {throw new selectorException("Field \"{$v972bf3f05d14ffbdb817bef60638ff00}\" is not presented in selected object types");}}}public function order($v972bf3f05d14ffbdb817bef60638ff00) {$this->checkExecuted();if(in_array($v972bf3f05d14ffbdb817bef60638ff00, self::$sysOrderFields)) {return $this->orderSysProps[] = new selectorOrderSysProp($v972bf3f05d14ffbdb817bef60638ff00);}else {$v945100186b119048837b9859c2c46410 = $this->searchField($v972bf3f05d14ffbdb817bef60638ff00);if($v945100186b119048837b9859c2c46410) {return $this->orderFieldProps[] = new selectorOrderFieldProp($v945100186b119048837b9859c2c46410);}else {throw new selectorException("Field \"{$v972bf3f05d14ffbdb817bef60638ff00}\" is not presented in selected object types");}}}public function limit($vaa9f73eea60a006820d0f8768bc8a3fc, $v7a86c157ee9713c34fbd7a1ee40f0c5a = 0) {$this->checkExecuted();$this->limit = (int) $vaa9f73eea60a006820d0f8768bc8a3fc;$this->offset = (int) $v7a86c157ee9713c34fbd7a1ee40f0c5a;}public function result() {if(is_null($this->result)) {if($this->mode == 'pages') {if(sizeof($this->orderSysProps) == 0) $this->order('ord')->asc();if(is_null($this->permissions)) $this->where('permissions');}$this->result = $this->executor()->result();$this->length = $this->executor()->length();}$this->unloadExecutor();return $this->result;}public function length() {if(is_null($this->length)) {if($this->mode == 'pages' && is_null($this->permissions)) {$this->where('permissions');}$this->result = $this->executor()->result();$this->length = $this->executor()->length();}$this->unloadExecutor();return $this->length;}public function option($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804 = null) {$this->checkExecuted();$v1558595e0197d7bbd53e1ee6cae810af = array('root', 'exclude-nested');if(in_array($vb068931cc450442b63f5b3d276ea4297, $v1558595e0197d7bbd53e1ee6cae810af)) {if(is_null($v2063c1608d6e0baf80249c42e2be5804) == false) {$this->options[$vb068931cc450442b63f5b3d276ea4297] = $v2063c1608d6e0baf80249c42e2be5804;}return isset($this->options[$vb068931cc450442b63f5b3d276ea4297]) ? $this->options[$vb068931cc450442b63f5b3d276ea4297] : null;}else throw new selectorException("Unkown option \"{$vb068931cc450442b63f5b3d276ea4297}\"");}public function flush() {$this->result = null;$this->length = null;}public function __get($v23a5b8ab834cb5140fa6665622eb6417) {switch($v23a5b8ab834cb5140fa6665622eb6417) {case 'length':    case 'total':     return $this->length();case 'result':     return $this->result();case 'first':     return (sizeof($this->result())) ? $this->result[0] : null;case 'last':     return (sizeof($this->result())) ? $this->result[sizeof($this->result) - 1] : null;}$v48f492cfc4344663d5a15ab0d2025226 = array('mode', 'offset', 'limit', 'whereFieldProps', 'orderFieldProps',     'whereSysProps', 'orderSysProps', 'types', 'permissions', 'hierarchy');if(in_array($v23a5b8ab834cb5140fa6665622eb6417, $v48f492cfc4344663d5a15ab0d2025226)) {return $this->$v23a5b8ab834cb5140fa6665622eb6417;}}public function getIterator() {$this->result();return new ArrayIterator($this->result);}public function query() {if($this->mode == 'pages') {if(sizeof($this->orderSysProps) == 0) $this->order('ord')->asc();if(is_null($this->permissions)) $this->where('permissions');}return $this->executor()->query();}public function searchField($v972bf3f05d14ffbdb817bef60638ff00) {foreach($this->types as $v599dcce2998a6b40b1e38e8c6006cb0a) {$v945100186b119048837b9859c2c46410 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId($v972bf3f05d14ffbdb817bef60638ff00);if($v945100186b119048837b9859c2c46410) return $v945100186b119048837b9859c2c46410;}if($this->mode == 'pages') {$vd14a8022b085f9ef19d479cbdd581127 = umiObjectTypesCollection::getInstance();$v599dcce2998a6b40b1e38e8c6006cb0a = $vd14a8022b085f9ef19d479cbdd581127->getType(3);$v945100186b119048837b9859c2c46410 = $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId($v972bf3f05d14ffbdb817bef60638ff00);if($v945100186b119048837b9859c2c46410) return $v945100186b119048837b9859c2c46410;}}protected function checkExecuted() {if(!is_null($this->result) || !is_null($this->length)) {throw new selectorException("Selector has been already executed. You should create new one or use selector::flush() method instead.");}}protected function executor() {if(!$this->executor) $this->executor = new selectorExecutor($this);return $this->executor;}protected function unloadExecutor() {if(!is_null($this->length) && !is_null($this->result)) {unset($this->executor);}}protected function setMode($v15d61712450a686a7f365adf4fef581f) {if(in_array($v15d61712450a686a7f365adf4fef581f, self::$modes)) {$this->mode = $v15d61712450a686a7f365adf4fef581f;if($v15d61712450a686a7f365adf4fef581f == 'pages') {$this->setDefaultPagesWhere();}}else {throw new selectorException(     "This mode \"{$v15d61712450a686a7f365adf4fef581f}\" is not supported, choose one of these: " . implode(', ', self::$modes)    );}}protected function setDefaultPagesWhere () {$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();$this->where('domain')->equals($v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain());$this->where('lang')->equals($v8b1dc169bf460ee884fceef66c6607d6->getCurrentLang());$this->where('is_deleted')->equals(0);if($v8b1dc169bf460ee884fceef66c6607d6->getCurrentMode() != 'admin') {$this->where('is_active')->equals(1);}}};?>