<?php
 abstract class __content_events {public function cronSendNotification($v08f45f9db776a9ce1d42a07c69f03946){$v94757cae63fd3e398c0811a976dd6bbe = 3;$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v94757cae63fd3e398c0811a976dd6bbe);$v3aabf39f2d943fa886d86dcbbee4d910 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId("notification_date");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterLess($v3aabf39f2d943fa886d86dcbbee4d910, time());$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterNotEqual($v3aabf39f2d943fa886d86dcbbee4d910, 0);$v8be74552df93e31bbdd6b36ed74bdb6a->addActiveFilter(true);$v8be74552df93e31bbdd6b36ed74bdb6a->forceHierarchyTable(true);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);foreach ($result as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v1a63c8004d716c8b91f5b7af780555b9){$v8a5bf3fcd88f3eb1320cfce519c8b68b = umiHierarchy::getInstance()->getElement($v1a63c8004d716c8b91f5b7af780555b9, true, true);if($v8a5bf3fcd88f3eb1320cfce519c8b68b instanceof umiHierarchyElement == false) {continue;}$v8a2c76c90da3802fc2f3d7b0b1f2a77a = $v8a5bf3fcd88f3eb1320cfce519c8b68b->getObject();$v8a2c76c90da3802fc2f3d7b0b1f2a77a->setValue("publish_status", $this->getPageStatusIdByStatusSid("page_status_preunpublish"));$v69002281deffb2af9c86eb47f6b1d742 = $v8a2c76c90da3802fc2f3d7b0b1f2a77a->getValue("publish_comments");$ve8701ad48ba05a91604e480dd60899a3 = $v8a2c76c90da3802fc2f3d7b0b1f2a77a->getOwnerId();$v9fe0bb93b257b012f0c9427fb1d48ffd = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);if ($v9fe0bb93b257b012f0c9427fb1d48ffd instanceof umiObject && $v40c27bdce4fa810f3b476676ff654f3c = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue("e-mail")){$vb41a92585c81dbf30d1901f98c3c6266 = new umiMail();$vd98a07f84921b24ee30f86fd8cd85c3c = regedit::getInstance()->getVal("//settings/email_from");$vb41a92585c81dbf30d1901f98c3c6266->setFrom($vd98a07f84921b24ee30f86fd8cd85c3c);$vb41a92585c81dbf30d1901f98c3c6266->setPriorityLevel("high");$vb41a92585c81dbf30d1901f98c3c6266->setSubject(getLabel('label-notification-mail-header'));list ($v841a2d689ad86bd1611447453c22c6fc) = def_module::loadTemplates("tpls/mail/notify.tpl", "body");$v14511f2f5564650d129ca7cabc333278['notify_header'] = getLabel('label-notification-mail-header');$v14511f2f5564650d129ca7cabc333278['page_header'] =  $v8a5bf3fcd88f3eb1320cfce519c8b68b->getName();$v14511f2f5564650d129ca7cabc333278['publish_comments'] = $v69002281deffb2af9c86eb47f6b1d742;$vad5f82e879a9c5d6b5b442eb37e50551 = domainsCollection::getInstance()->getDomain($v8a5bf3fcd88f3eb1320cfce519c8b68b->getDomainId());$vafb912be1c456c2109aefb25ce9edb91 = "http://".$vad5f82e879a9c5d6b5b442eb37e50551->getHost().umiHierarchy::getInstance()->getPathById($v1a63c8004d716c8b91f5b7af780555b9);$v14511f2f5564650d129ca7cabc333278['page_link'] = $vafb912be1c456c2109aefb25ce9edb91;$vf1f0b683a10767614f406f24e012fd1d = def_module::parseTemplate($v841a2d689ad86bd1611447453c22c6fc, $v14511f2f5564650d129ca7cabc333278, $v1a63c8004d716c8b91f5b7af780555b9);$vb41a92585c81dbf30d1901f98c3c6266->addRecipient($v40c27bdce4fa810f3b476676ff654f3c);$vb41a92585c81dbf30d1901f98c3c6266->setContent($vf1f0b683a10767614f406f24e012fd1d);$vb41a92585c81dbf30d1901f98c3c6266->commit();$vb41a92585c81dbf30d1901f98c3c6266->send();}$v8a2c76c90da3802fc2f3d7b0b1f2a77a->commit();$v8a5bf3fcd88f3eb1320cfce519c8b68b->commit();}}public function cronUnpublishPage($v08f45f9db776a9ce1d42a07c69f03946){$v94757cae63fd3e398c0811a976dd6bbe = 3;$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v94757cae63fd3e398c0811a976dd6bbe);$v3aabf39f2d943fa886d86dcbbee4d910 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId("expiration_date");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterLess($v3aabf39f2d943fa886d86dcbbee4d910, time());$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterNotEqual($v3aabf39f2d943fa886d86dcbbee4d910, 0);$v8be74552df93e31bbdd6b36ed74bdb6a->addActiveFilter(true);$v8be74552df93e31bbdd6b36ed74bdb6a->forceHierarchyTable(true);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$v9b207167e5381c47682c6b4f58a623fb = Array();foreach ($result as $v3c6e0b8a9c15224a8228b9a98ca1531d=>$v1a63c8004d716c8b91f5b7af780555b9){$v8a5bf3fcd88f3eb1320cfce519c8b68b = umiHierarchy::getInstance()->getElement($v1a63c8004d716c8b91f5b7af780555b9);$v8a5bf3fcd88f3eb1320cfce519c8b68b->setIsActive(false);$v727b3bbb6592a51f98907dbc49f0606b = $v8a5bf3fcd88f3eb1320cfce519c8b68b->getObject();$v727b3bbb6592a51f98907dbc49f0606b->setValue("publish_status", $this->getPageStatusIdByStatusSid("page_status_unpublish"));$v727b3bbb6592a51f98907dbc49f0606b->commit();$v8a5bf3fcd88f3eb1320cfce519c8b68b->commit();$ve8701ad48ba05a91604e480dd60899a3 = $v8a5bf3fcd88f3eb1320cfce519c8b68b->getObject()->getOwnerId();$v9fe0bb93b257b012f0c9427fb1d48ffd = umiObjectsCollection::getInstance()->getObject($ve8701ad48ba05a91604e480dd60899a3);if ($v9fe0bb93b257b012f0c9427fb1d48ffd instanceof umiObject && $v40c27bdce4fa810f3b476676ff654f3c = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue("e-mail")){$vb41a92585c81dbf30d1901f98c3c6266 = new umiMail();$vd98a07f84921b24ee30f86fd8cd85c3c = regedit::getInstance()->getVal("//settings/email_from");$vb41a92585c81dbf30d1901f98c3c6266->setFrom($vd98a07f84921b24ee30f86fd8cd85c3c);$vb41a92585c81dbf30d1901f98c3c6266->setPriorityLevel("high");$vb41a92585c81dbf30d1901f98c3c6266->setSubject(getLabel('label-notification-expired-mail-header'));list ($v841a2d689ad86bd1611447453c22c6fc) = def_module::loadTemplates("tpls/mail/expired.tpl", "body");$v14511f2f5564650d129ca7cabc333278['notify_header'] = getLabel('label-notification-expired-mail-header');$v14511f2f5564650d129ca7cabc333278['page_header'] =  $v8a5bf3fcd88f3eb1320cfce519c8b68b->getName();$v14511f2f5564650d129ca7cabc333278['publish_comments'] = $v69002281deffb2af9c86eb47f6b1d742;$vad5f82e879a9c5d6b5b442eb37e50551 = domainsCollection::getInstance()->getDomain($v8a5bf3fcd88f3eb1320cfce519c8b68b->getDomainId());$vafb912be1c456c2109aefb25ce9edb91 = "http://".$vad5f82e879a9c5d6b5b442eb37e50551->getHost().umiHierarchy::getInstance()->getPathById($v1a63c8004d716c8b91f5b7af780555b9);$v14511f2f5564650d129ca7cabc333278['page_link'] = $vafb912be1c456c2109aefb25ce9edb91;$vf1f0b683a10767614f406f24e012fd1d = self::parseTemplate($v841a2d689ad86bd1611447453c22c6fc, $v14511f2f5564650d129ca7cabc333278, $v1a63c8004d716c8b91f5b7af780555b9);$vb41a92585c81dbf30d1901f98c3c6266->addRecipient($v40c27bdce4fa810f3b476676ff654f3c);$vb41a92585c81dbf30d1901f98c3c6266->setContent($vf1f0b683a10767614f406f24e012fd1d);$vb41a92585c81dbf30d1901f98c3c6266->commit();$vb41a92585c81dbf30d1901f98c3c6266->send();}}}public function pageCheckExpiration($v4119639092e62c55ea8be348e4d9260d) {if ($ve62e4d22f2d8630f6e44e2b7c3f70ddc = $v4119639092e62c55ea8be348e4d9260d->getRef("inputData")) {$v71860c77c6745379b0d44304d66b6a13 = getArrayKey($ve62e4d22f2d8630f6e44e2b7c3f70ddc, "element");$this->saveExpiration($v71860c77c6745379b0d44304d66b6a13);}}public function pageCheckExpirationAdd($v4119639092e62c55ea8be348e4d9260d) {if ($v71860c77c6745379b0d44304d66b6a13 = $v4119639092e62c55ea8be348e4d9260d->getRef("element")) {$this->saveExpiration($v71860c77c6745379b0d44304d66b6a13);}}public function saveExpiration ($v71860c77c6745379b0d44304d66b6a13) {$v727b3bbb6592a51f98907dbc49f0606b = $v71860c77c6745379b0d44304d66b6a13->getObject();$vac89cc3bb8407b8f6f24df3d2f088752 = $v727b3bbb6592a51f98907dbc49f0606b->expiration_date;if ($vac89cc3bb8407b8f6f24df3d2f088752 instanceof umiDate) {if ($vac89cc3bb8407b8f6f24df3d2f088752->timestamp > time()) {$v727b3bbb6592a51f98907dbc49f0606b->publish_status = $this->getPageStatusIdByStatusSid("page_status_publish");$v71860c77c6745379b0d44304d66b6a13->setIsActive(true);}elseif ($vac89cc3bb8407b8f6f24df3d2f088752->timestamp < time() && $vac89cc3bb8407b8f6f24df3d2f088752->timestamp != NULL ) {$v727b3bbb6592a51f98907dbc49f0606b->publish_status = $this->getPageStatusIdByStatusSid("page_status_unpublish");$v71860c77c6745379b0d44304d66b6a13->setIsActive(false);}$v727b3bbb6592a51f98907dbc49f0606b->commit();$v71860c77c6745379b0d44304d66b6a13->commit();}}public function onModifyPoropertyAntispam(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {$vf5e638cc78dd325906c1298a0c21fb6b = $v4119639092e62c55ea8be348e4d9260d->getRef("entity");if(($vf5e638cc78dd325906c1298a0c21fb6b instanceof iUmiHierarchyElement) && ($v4119639092e62c55ea8be348e4d9260d->getParam("property") == "is_spam")) {$v599dcce2998a6b40b1e38e8c6006cb0a = umiHierarchyTypesCollection::getInstance()->getTypeByName("faq", "question");$v5180805afcdc53d067cf7c6b96c68c9d = ($v599dcce2998a6b40b1e38e8c6006cb0a->getId() == $vf5e638cc78dd325906c1298a0c21fb6b->getTypeId()) ? 'question' : 'content';antiSpamHelper::report($vf5e638cc78dd325906c1298a0c21fb6b->getId(), $v5180805afcdc53d067cf7c6b96c68c9d);}}public function onModifyElementAntispam(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();$v8e2dcfd7e7e24b1ca76c1193f645902b  = $v4119639092e62c55ea8be348e4d9260d->getRef("element");if(!$v8e2dcfd7e7e24b1ca76c1193f645902b) return;if($v4119639092e62c55ea8be348e4d9260d->getMode() == "before") {$v8d777f385d3dfec8815d20f7496026dc = getRequest("data");if(isset($v8d777f385d3dfec8815d20f7496026dc[ $v8e2dcfd7e7e24b1ca76c1193f645902b->getId() ])) {$v0382b9fd9ef50b6a335f35e0aaaebf99 = getArrayKey($v8d777f385d3dfec8815d20f7496026dc[ $v8e2dcfd7e7e24b1ca76c1193f645902b->getId() ], 'is_spam');if($v0382b9fd9ef50b6a335f35e0aaaebf99 != $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("is_spam")) {$v0fea6a13c52b4d4725368f24b045ca84[ $v8e2dcfd7e7e24b1ca76c1193f645902b->getId() ] = true;}}}else if(isset($v0fea6a13c52b4d4725368f24b045ca84[ $v8e2dcfd7e7e24b1ca76c1193f645902b->getId() ])) {$v599dcce2998a6b40b1e38e8c6006cb0a = umiHierarchyTypesCollection::getInstance()->getTypeByName("faq", "question");$v5180805afcdc53d067cf7c6b96c68c9d = ($v599dcce2998a6b40b1e38e8c6006cb0a->getId() == $v8e2dcfd7e7e24b1ca76c1193f645902b->getTypeId()) ? 'question' : 'content';antiSpamHelper::report($v8e2dcfd7e7e24b1ca76c1193f645902b->getId(), $v5180805afcdc53d067cf7c6b96c68c9d);}}};?>