<?php
 abstract class __emarket_delivery {public static $steps = array('address', 'choose');public function delivery(order $v70a17ffa722a3985b86d30b034ad06d7, $v2764ca9d34e90313978d044f27ae433b, $v15d61712450a686a7f365adf4fef581f, $v66f6181bcb4cff4cd38fbc804a036db6) {switch($v2764ca9d34e90313978d044f27ae433b) {case 'address' : {return ($v15d61712450a686a7f365adf4fef581f == 'do') ? $this->chooseDeliveryAddress($v70a17ffa722a3985b86d30b034ad06d7) : $this->renderDeliveryAddressesList($v70a17ffa722a3985b86d30b034ad06d7, $v66f6181bcb4cff4cd38fbc804a036db6);}case 'choose': {return ($v15d61712450a686a7f365adf4fef581f == 'do') ? $this->chooseDelivery($v70a17ffa722a3985b86d30b034ad06d7) : $this->renderDeliveryList($v70a17ffa722a3985b86d30b034ad06d7, $v66f6181bcb4cff4cd38fbc804a036db6);}}}public function deliveryCheckStep(order $v70a17ffa722a3985b86d30b034ad06d7, $v2764ca9d34e90313978d044f27ae433b) {if(!$v2764ca9d34e90313978d044f27ae433b) return self::$steps[0];if(in_array($v2764ca9d34e90313978d044f27ae433b, self::$steps)) {return $v2764ca9d34e90313978d044f27ae433b;}else {throw new privateException("Unkown order delivery step \"{$v2764ca9d34e90313978d044f27ae433b}\"");}}public function renderDeliveryAddressesList(order $v70a17ffa722a3985b86d30b034ad06d7, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {list($v31912934b8f34be4364cc043cd8a0176, $v5ad10ccde9b1728f3d06c1eb0b05ab0f) = def_module::loadTemplates("./tpls/emarket/delivery/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl",    'delivery_address_block', 'delivery_address_item');$v91ec1f9324753048c0096d036a694f86  = customer::get();$v963e3a2fe559e393bad631f3dc686f69 = $v91ec1f9324753048c0096d036a694f86->delivery_addresses;$vf1386a17eed513dff70798b0551dc170 = array();$vfa0c15aea009ba919e47915c4d1cfa67 = $v70a17ffa722a3985b86d30b034ad06d7->getValue('delivery_address');$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectsCollection::getInstance();if(is_array($v963e3a2fe559e393bad631f3dc686f69)) foreach($v963e3a2fe559e393bad631f3dc686f69 as $v884d9804999fc47a3c2694e49ad2536a) {$v4310a93b43756945b592a0bab9cd5704 = $vdb6d9b451b818ccc9a449383f2f0c450->getObject($v884d9804999fc47a3c2694e49ad2536a);$ve253bed1357afcefc5fadfbc92f9eb97 = array(     'attribute:id'  => $v884d9804999fc47a3c2694e49ad2536a,     'attribute:name' => $v4310a93b43756945b592a0bab9cd5704->name    );if($v884d9804999fc47a3c2694e49ad2536a == $vfa0c15aea009ba919e47915c4d1cfa67) $ve253bed1357afcefc5fadfbc92f9eb97['attribute:active'] = 'active';$vf1386a17eed513dff70798b0551dc170[] = def_module::parseTemplate($v5ad10ccde9b1728f3d06c1eb0b05ab0f, $ve253bed1357afcefc5fadfbc92f9eb97, false, $v884d9804999fc47a3c2694e49ad2536a);}$vd14a8022b085f9ef19d479cbdd581127  = umiObjectTypesCollection::getInstance();$v5f694956811487225d15e973ca38fbab = $vd14a8022b085f9ef19d479cbdd581127->getBaseType("emarket", "delivery_address");if($v31912934b8f34be4364cc043cd8a0176) {return def_module::parseTemplate($v31912934b8f34be4364cc043cd8a0176, array('items' => $vf1386a17eed513dff70798b0551dc170, 'type_id' => $v5f694956811487225d15e973ca38fbab));}else {return array(     'attribute:type-id' => $v5f694956811487225d15e973ca38fbab,     'xlink:href'  => 'udata://data/getCreateForm/' . $v5f694956811487225d15e973ca38fbab,     'items'    => array('nodes:item' => $vf1386a17eed513dff70798b0551dc170)    );}}public function chooseDeliveryAddress(order $v70a17ffa722a3985b86d30b034ad06d7) {$v88b168e5b6481933731065d1a1ce0d11 = getRequest('delivery-address');if($v88b168e5b6481933731065d1a1ce0d11 == 'new') {$v594c103f2c6e04c3d8ab059f031e0c1a = cmsController::getInstance();$vdb6d9b451b818ccc9a449383f2f0c450 = umiObjectsCollection::getInstance();$vd14a8022b085f9ef19d479cbdd581127      = umiObjectTypesCollection::getInstance();$v5f694956811487225d15e973ca38fbab     = $vd14a8022b085f9ef19d479cbdd581127->getBaseType("emarket", "delivery_address");$v91ec1f9324753048c0096d036a694f86   = customer::get();$v88b168e5b6481933731065d1a1ce0d11  = $vdb6d9b451b818ccc9a449383f2f0c450->addObject("Address for customer #".$v91ec1f9324753048c0096d036a694f86->id, $v5f694956811487225d15e973ca38fbab);$v89e96bd1c461a4b70d8aaaba636b0f85 = $v594c103f2c6e04c3d8ab059f031e0c1a->getModule("data");if($v89e96bd1c461a4b70d8aaaba636b0f85) {$v89e96bd1c461a4b70d8aaaba636b0f85->saveEditedObject($v88b168e5b6481933731065d1a1ce0d11, true, true);}$v91ec1f9324753048c0096d036a694f86->delivery_addresses = array_merge( $v91ec1f9324753048c0096d036a694f86->delivery_addresses, array($v88b168e5b6481933731065d1a1ce0d11) );}$v70a17ffa722a3985b86d30b034ad06d7->delivery_address = $v88b168e5b6481933731065d1a1ce0d11;$v70a17ffa722a3985b86d30b034ad06d7->commit();$this->redirect($this->pre_lang . '/emarket/purchase/delivery/choose/');}public function renderDeliveryList(order $v70a17ffa722a3985b86d30b034ad06d7, $v66f6181bcb4cff4cd38fbc804a036db6) {list($v31912934b8f34be4364cc043cd8a0176, $v187e43642f57d32b5a9a61a37d7264c5, $v301665b364e06e5d6e1f5b251e6d7319) = def_module::loadTemplates("./tpls/emarket/delivery/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl",    'delivery_block', 'delivery_item_free', 'delivery_item_priced');if(!isset($_SESSION['emarket'])) $_SESSION['emarket'] = array();if(!isset($_SESSION['emarket']['delivery'])) $_SESSION['emarket']['delivery'] = array();$vcd310e1667e5b8d7e77ea85eb19eaacb = delivery::getList();$vf1386a17eed513dff70798b0551dc170 = array();$vfa0c15aea009ba919e47915c4d1cfa67 = $v70a17ffa722a3985b86d30b034ad06d7->getValue('delivery_id');foreach($vcd310e1667e5b8d7e77ea85eb19eaacb as $v7108537956afa2a526f96cc9da7b0c36) {$v7108537956afa2a526f96cc9da7b0c36 = delivery::get($v7108537956afa2a526f96cc9da7b0c36);if($v7108537956afa2a526f96cc9da7b0c36->validate($v70a17ffa722a3985b86d30b034ad06d7) == false) {continue;}$v718be625fbe2211b3ba4ac656ff290e3 = $v7108537956afa2a526f96cc9da7b0c36->getObject();$v6bcea55d951e611b908a7f464d99c0f9  = $v7108537956afa2a526f96cc9da7b0c36->getDeliveryPrice($v70a17ffa722a3985b86d30b034ad06d7);$_SESSION['emarket']['delivery'][$v7108537956afa2a526f96cc9da7b0c36->id] = (float)$v6bcea55d951e611b908a7f464d99c0f9;$ve253bed1357afcefc5fadfbc92f9eb97 = array(     'attribute:id'  => $v718be625fbe2211b3ba4ac656ff290e3->id,     'attribute:name' => $v718be625fbe2211b3ba4ac656ff290e3->name,     'attribute:price' => $v6bcea55d951e611b908a7f464d99c0f9,     'xlink:href'  => $v718be625fbe2211b3ba4ac656ff290e3->xlink    );if($v7108537956afa2a526f96cc9da7b0c36->id == $vfa0c15aea009ba919e47915c4d1cfa67) $ve253bed1357afcefc5fadfbc92f9eb97['attribute:active'] = 'active';$v5ad10ccde9b1728f3d06c1eb0b05ab0f = $v6bcea55d951e611b908a7f464d99c0f9 ? $v301665b364e06e5d6e1f5b251e6d7319 : $v187e43642f57d32b5a9a61a37d7264c5;$vf1386a17eed513dff70798b0551dc170[] = def_module::parseTemplate($v5ad10ccde9b1728f3d06c1eb0b05ab0f, $ve253bed1357afcefc5fadfbc92f9eb97, false, $v718be625fbe2211b3ba4ac656ff290e3->id);}if($v31912934b8f34be4364cc043cd8a0176) {return def_module::parseTemplate($v31912934b8f34be4364cc043cd8a0176, array('items' => $vf1386a17eed513dff70798b0551dc170));}else {return array('items' => array('nodes:item' => $vf1386a17eed513dff70798b0551dc170));}}public function chooseDelivery(order $v70a17ffa722a3985b86d30b034ad06d7) {$v3317ac4eddf5f6546633a96f4e19c85b = getRequest('delivery-id');if(!$v3317ac4eddf5f6546633a96f4e19c85b) {$this->redirect($this->pre_lang . '/emarket/purchase/delivery/choose/');}if(@isset($_SESSION['emarket']['delivery'][$v3317ac4eddf5f6546633a96f4e19c85b])) {$v6bcea55d951e611b908a7f464d99c0f9 = (float) $_SESSION['emarket']['delivery'][$v3317ac4eddf5f6546633a96f4e19c85b];}else {$v7108537956afa2a526f96cc9da7b0c36 = delivery::get($v3317ac4eddf5f6546633a96f4e19c85b);$v6bcea55d951e611b908a7f464d99c0f9 = (float) $v7108537956afa2a526f96cc9da7b0c36->getDeliveryPrice($v70a17ffa722a3985b86d30b034ad06d7);}$v70a17ffa722a3985b86d30b034ad06d7->setValue('delivery_id', $v3317ac4eddf5f6546633a96f4e19c85b);$v70a17ffa722a3985b86d30b034ad06d7->setValue('delivery_price', $v6bcea55d951e611b908a7f464d99c0f9);$v70a17ffa722a3985b86d30b034ad06d7->refresh();$v70a17ffa722a3985b86d30b034ad06d7->commit();$this->redirect($this->pre_lang . '/emarket/purchase/payment/choose/');}};?>