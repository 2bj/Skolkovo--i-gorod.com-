<?php
 class rbkPayment extends payment {const STATUS_INPROCESS = 3;const STATUS_ACCEPTED  = 5;public function validate() {return true;}public function process($v66f6181bcb4cff4cd38fbc804a036db6 = null) {$v1af0389838508d7016a9841eb6273962 = strtoupper( mainConfiguration::getInstance()->get('system', 'default-currency') );$ve9f40e1f1d1658681dad2dac4ae0971e = number_format($this->order->getActualPrice(), 2, '.', '');$veca07335a33c5aeb5e1bc7c98b4b9d80 = array();$veca07335a33c5aeb5e1bc7c98b4b9d80["formAction"] = "https://rbkmoney.ru/acceptpurchase.aspx";$veca07335a33c5aeb5e1bc7c98b4b9d80["eshopId"] = $this->object->eshopId;$veca07335a33c5aeb5e1bc7c98b4b9d80["orderId"] = $this->order->id;$veca07335a33c5aeb5e1bc7c98b4b9d80["recipientAmount"] = $ve9f40e1f1d1658681dad2dac4ae0971e;$veca07335a33c5aeb5e1bc7c98b4b9d80["recipientCurrency"] = $v1af0389838508d7016a9841eb6273962;$veca07335a33c5aeb5e1bc7c98b4b9d80["version"] = "2";$this->order->setPaymentStatus('initialized');list($v78325ef2910aaa327bba1fde7d68bbf9) = def_module::loadTemplates("tpls/emarket/payment/rbk/".$v66f6181bcb4cff4cd38fbc804a036db6.".tpl", "form_block");return def_module::parseTemplate($v78325ef2910aaa327bba1fde7d68bbf9, $veca07335a33c5aeb5e1bc7c98b4b9d80);}public function poll() {$v7f2db423a49b305459147332fb01cf87 = outputBuffer::current();$v7f2db423a49b305459147332fb01cf87->clear();$v7f2db423a49b305459147332fb01cf87->contentType("text/plain");if($this->checkSignature()) {$v9acb44549b41563697bb490144ec6258 = getRequest("paymentStatus");switch($v9acb44549b41563697bb490144ec6258) {case rbkPayment::STATUS_INPROCESS : {$vb05efb52eac73c7187a9c2b105c0e774 = (float) getRequest("recipientAmount");$v0051ba7cacc8474949ffa644028ed977 = (float) $this->order->getActualPrice();if(($vb05efb52eac73c7187a9c2b105c0e774 - $v0051ba7cacc8474949ffa644028ed977) < (float)0.001) {$this->order->setPaymentStatus('validated');$v7f2db423a49b305459147332fb01cf87->push("OK");}else {$this->order->setPaymentStatus('declined');$v7f2db423a49b305459147332fb01cf87->push("failed");}break;}case rbkPayment::STATUS_ACCEPTED  : {$this->order->setPaymentStatus('accepted');break;}}}else {$v7f2db423a49b305459147332fb01cf87->push("failed");}$v7f2db423a49b305459147332fb01cf87->end();}private function checkSignature() {$vcb59de8aec8a31e98c3ecc9f32786195 = getRequest(eshopId);$v61e9abeaa2ba0e1296555c135d818e6e = getRequest(orderId);$v0f096338b64a1d1b348b86df38313c01 = getRequest(serviceName);$v9881f861bbd17d6976aa464434d48fe6 = getRequest(eshopAccount);$vb05efb52eac73c7187a9c2b105c0e774 = getRequest(recipientAmount);$v74810613393080dc661aa97e2e23b6d6 = getRequest(recipientCurrency);$vb566652f43edab8a3e305f16a9428123 = getRequest(paymentStatus);$v435e0648d634175c46bd40ac366545a8 = getRequest(userName);$v532902f2815d229ecd121a3a28f37533 = getRequest(userEmail);$vc5e16399a807e75f59666f2f60ef0565 = getRequest(paymentData);$vce656850400574e9f9cffb285ee8abc0 = $this->object->secretKey;$v0800fc577294c34e0b28ad2839435945  = getRequest("hash");$v0ba4439ee9a46d9d9f14c60f88f45f87 = md5("{$vcb59de8aec8a31e98c3ecc9f32786195}::{$v61e9abeaa2ba0e1296555c135d818e6e}::{$v0f096338b64a1d1b348b86df38313c01}::{$v9881f861bbd17d6976aa464434d48fe6}::{$vb05efb52eac73c7187a9c2b105c0e774}::{$v74810613393080dc661aa97e2e23b6d6}::{$vb566652f43edab8a3e305f16a9428123}::{$v435e0648d634175c46bd40ac366545a8}::{$v532902f2815d229ecd121a3a28f37533}::{$vc5e16399a807e75f59666f2f60ef0565}::{$vce656850400574e9f9cffb285ee8abc0}");return (bool)(strcasecmp($v0800fc577294c34e0b28ad2839435945, $v0ba4439ee9a46d9d9f14c60f88f45f87) == 0);}};?>
