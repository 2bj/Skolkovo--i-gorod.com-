<?php
 class umiFile implements iUmiFile {protected $filepath,    $size, $ext, $name, $dirname, $modify_time,    $is_broken = false;public static $mask = 0777;protected static $class_name = 'umiFile';protected static $allowedFileTypes = array(   'txt', 'doc', 'docx', 'xsl', 'xslx', 'pdf',   'html', 'js', 'tpl', 'xsl', 'xml', 'css',   'zip', 'rar', '7z', 'tar', 'gz', 'tar.gz', 'exe', 'msi',   'rtf', 'chm', 'ico', 'jpg', 'jpeg', 'gif', 'png', 'bmp',    'psd', 'flv', 'mp4'  );public function __construct($v6a2a431fe8b621037ea949531c28551d) {$v6a2a431fe8b621037ea949531c28551d = str_replace("//", "/", $v6a2a431fe8b621037ea949531c28551d);$v6a2a431fe8b621037ea949531c28551d = str_replace("\\\\", "\\", $v6a2a431fe8b621037ea949531c28551d);if(!@is_file($v6a2a431fe8b621037ea949531c28551d)) {$this->is_broken = true;return false;}$this->filepath = $v6a2a431fe8b621037ea949531c28551d;$this->filepath = str_replace("\\", "/", $v6a2a431fe8b621037ea949531c28551d);$this->loadInfo();}public function delete() {if(is_writable($this->filepath)) {return unlink($this->filepath);}else {return false;}}public function download($v789726e10bf01b1777c5d2ae06bede3e = false) {while (@ob_end_clean());header('HTTP/1.1 200 OK');header("Cache-Control: public, must-revalidate");header("Pragma: no-cache");header("Content-type: application/force-download");header("Content-Length: " . $this->getSize());header('Accept-Ranges: bytes');header("Content-Encoding: None");header("Vary:");header('Content-Transfer-Encoding: Binary');header("Content-Disposition: attachment; filename=" . $this->getFileName());readfile(realpath($this->getFilePath()));if($v789726e10bf01b1777c5d2ae06bede3e) {$this->delete();}exit();}public static function manualUpload($vb068931cc450442b63f5b3d276ea4297, $ve440be6a92dba11caa790215081671ae, $vf7bd60b75b29d79b660a2859395c1a24, $vb2ed5fc91c9760886b14c955ac6c82d7) {if(!$vf7bd60b75b29d79b660a2859395c1a24 || !$vb068931cc450442b63f5b3d276ea4297 || $vb068931cc450442b63f5b3d276ea4297 == ".htaccess" || !is_uploaded_file($ve440be6a92dba11caa790215081671ae)) return 1;if( !in_array(substr($vb068931cc450442b63f5b3d276ea4297, strrpos($vb068931cc450442b63f5b3d276ea4297, '.')), self::$allowedFileTypes) ) return 2;list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(pathinfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 .= "." . strtolower($v566bbee0f961ad71b54c3c2fd36db053);$v9024b204fb4c4ffdd07ee631ed791f75 = $vb2ed5fc91c9760886b14c955ac6c82d7 . "/" . $vb068931cc450442b63f5b3d276ea4297;if($vb068931cc450442b63f5b3d276ea4297 == ".htaccess") {return 3;}$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($v566bbee0f961ad71b54c3c2fd36db053);if(is_uploaded_file($ve440be6a92dba11caa790215081671ae)) {$v9024b204fb4c4ffdd07ee631ed791f75 = umiFile::getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75);if(move_uploaded_file($ve440be6a92dba11caa790215081671ae, $v9024b204fb4c4ffdd07ee631ed791f75)) {chmod($v9024b204fb4c4ffdd07ee631ed791f75, self::$mask);$v9024b204fb4c4ffdd07ee631ed791f75 = self::getRelPath($v9024b204fb4c4ffdd07ee631ed791f75);return new self::$class_name($v9024b204fb4c4ffdd07ee631ed791f75);}else {return 5;}}else {return 6;}}public static function upload($veeeb23fbd23e52a6a6ff78b9f18cbc4e, $v86536e21993c5a96a4d4c9c9afcc9b17, $vb2ed5fc91c9760886b14c955ac6c82d7, $vb80bb7740288fda1f201890375a60c8f = false) {global $_FILES;$ve067156fc3a90cfa942be4efa6f5bc7e = &$_FILES;$va1b423d9a2738b47df059a8a38abbd27 = $vb2ed5fc91c9760886b14c955ac6c82d7;if(substr($va1b423d9a2738b47df059a8a38abbd27, strlen($va1b423d9a2738b47df059a8a38abbd27) - 1, 1) != "/") $va1b423d9a2738b47df059a8a38abbd27 .= "/";$vb2ed5fc91c9760886b14c955ac6c82d7 = realpath($vb2ed5fc91c9760886b14c955ac6c82d7);if(!is_dir($vb2ed5fc91c9760886b14c955ac6c82d7)) {return false;}if(!is_writable($vb2ed5fc91c9760886b14c955ac6c82d7)) {return false;}if(!is_array($ve067156fc3a90cfa942be4efa6f5bc7e)) {return false;}if(!isset($ve067156fc3a90cfa942be4efa6f5bc7e[$veeeb23fbd23e52a6a6ff78b9f18cbc4e]) && isset($ve067156fc3a90cfa942be4efa6f5bc7e['pics'])) {$ve067156fc3a90cfa942be4efa6f5bc7e[$veeeb23fbd23e52a6a6ff78b9f18cbc4e] = $ve067156fc3a90cfa942be4efa6f5bc7e['pics'];$veeeb23fbd23e52a6a6ff78b9f18cbc4e = "pics";}if(array_key_exists($veeeb23fbd23e52a6a6ff78b9f18cbc4e, $ve067156fc3a90cfa942be4efa6f5bc7e)) {$v080505fba0c91df9d7cff41d972acaf1 = $ve067156fc3a90cfa942be4efa6f5bc7e[$veeeb23fbd23e52a6a6ff78b9f18cbc4e];if(isset($v080505fba0c91df9d7cff41d972acaf1['size'][$v86536e21993c5a96a4d4c9c9afcc9b17])) {$vb80bb7740288fda1f201890375a60c8f = false;}$vf7bd60b75b29d79b660a2859395c1a24 = ($vb80bb7740288fda1f201890375a60c8f === false) ?                                     (isset($v080505fba0c91df9d7cff41d972acaf1['size'][$v86536e21993c5a96a4d4c9c9afcc9b17])? $v080505fba0c91df9d7cff41d972acaf1['size'][$v86536e21993c5a96a4d4c9c9afcc9b17] : 0)                                        :                                     (isset($v080505fba0c91df9d7cff41d972acaf1['size'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17])? $v080505fba0c91df9d7cff41d972acaf1['size'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17] : 0);if($vf7bd60b75b29d79b660a2859395c1a24 == 0) {return false;}else {$ve440be6a92dba11caa790215081671ae = ($vb80bb7740288fda1f201890375a60c8f === false) ? $v080505fba0c91df9d7cff41d972acaf1['tmp_name'][$v86536e21993c5a96a4d4c9c9afcc9b17] : $v080505fba0c91df9d7cff41d972acaf1['tmp_name'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17];$vb068931cc450442b63f5b3d276ea4297 = ($vb80bb7740288fda1f201890375a60c8f === false) ? $v080505fba0c91df9d7cff41d972acaf1['name'][$v86536e21993c5a96a4d4c9c9afcc9b17] : $v080505fba0c91df9d7cff41d972acaf1['name'][$vb80bb7740288fda1f201890375a60c8f][$v86536e21993c5a96a4d4c9c9afcc9b17];$v694fbbfc143481cbc48ab8ddeadb00f1 = array("php", "php3", "php4", "php5", "phtml");if( in_array(substr($vb068931cc450442b63f5b3d276ea4297, strrpos($vb068931cc450442b63f5b3d276ea4297, '.')), $v694fbbfc143481cbc48ab8ddeadb00f1) ) return false;list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(pathinfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 .= "." . strtolower($v566bbee0f961ad71b54c3c2fd36db053);$v9024b204fb4c4ffdd07ee631ed791f75 = $vb2ed5fc91c9760886b14c955ac6c82d7 . "/" . $vb068931cc450442b63f5b3d276ea4297;if($vb068931cc450442b63f5b3d276ea4297 == ".htaccess") {return false;}$v566bbee0f961ad71b54c3c2fd36db053 = strtolower($v566bbee0f961ad71b54c3c2fd36db053);if( !in_array( $v566bbee0f961ad71b54c3c2fd36db053, self::$allowedFileTypes ) ) {return false;}if(is_uploaded_file($ve440be6a92dba11caa790215081671ae)) {$v9024b204fb4c4ffdd07ee631ed791f75 = umiFile::getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75);if(move_uploaded_file($ve440be6a92dba11caa790215081671ae, $v9024b204fb4c4ffdd07ee631ed791f75)) {chmod($v9024b204fb4c4ffdd07ee631ed791f75, self::$mask);$v9024b204fb4c4ffdd07ee631ed791f75 = self::getRelPath($v9024b204fb4c4ffdd07ee631ed791f75);return new self::$class_name($v9024b204fb4c4ffdd07ee631ed791f75);}else {return false;}}else {return false;}}}else {return false;}}public static function upload_zip ($v86536e21993c5a96a4d4c9c9afcc9b17, $v8c7dd922ad47494fc02c388e12c00eac = "", $v851148b4fd8fd7ae74bd9100c5c0c898 = "./images/cms/data/")  {if ($v8c7dd922ad47494fc02c388e12c00eac == "") {$ve440be6a92dba11caa790215081671ae = $v86536e21993c5a96a4d4c9c9afcc9b17['tmp_name'];$vb068931cc450442b63f5b3d276ea4297 = $v86536e21993c5a96a4d4c9c9afcc9b17['name'];list(,, $v566bbee0f961ad71b54c3c2fd36db053) = array_values(pathinfo($vb068931cc450442b63f5b3d276ea4297));$vb068931cc450442b63f5b3d276ea4297 = substr($vb068931cc450442b63f5b3d276ea4297, 0, strlen($vb068931cc450442b63f5b3d276ea4297) - strlen($v566bbee0f961ad71b54c3c2fd36db053));$vb068931cc450442b63f5b3d276ea4297 = translit::convert($vb068931cc450442b63f5b3d276ea4297);$vb068931cc450442b63f5b3d276ea4297 .= "." . $v566bbee0f961ad71b54c3c2fd36db053;$v9024b204fb4c4ffdd07ee631ed791f75 = $v851148b4fd8fd7ae74bd9100c5c0c898.$vb068931cc450442b63f5b3d276ea4297;$v51b7b5d0a5d6f26dc31ce613f4966356 = CURRENT_WORKING_DIR . "/sys-temp/uploads";if(!is_dir($v51b7b5d0a5d6f26dc31ce613f4966356)) {mkdir($v51b7b5d0a5d6f26dc31ce613f4966356);}$v3cc7992a6d5b20ce784f6169f4423048 = $v51b7b5d0a5d6f26dc31ce613f4966356.'/'.$vb068931cc450442b63f5b3d276ea4297;if ($v86536e21993c5a96a4d4c9c9afcc9b17['size'] == 0) {return false;}if(is_uploaded_file($ve440be6a92dba11caa790215081671ae)) {$v9024b204fb4c4ffdd07ee631ed791f75 = umiFile::getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75);if(move_uploaded_file($ve440be6a92dba11caa790215081671ae, $v3cc7992a6d5b20ce784f6169f4423048)) {chmod($v3cc7992a6d5b20ce784f6169f4423048, self::$mask);}else {return false;}}else {return false;}}else {$v8c7dd922ad47494fc02c388e12c00eac = CURRENT_WORKING_DIR . "/" . $v8c7dd922ad47494fc02c388e12c00eac;if (!file_exists ($v8c7dd922ad47494fc02c388e12c00eac) || !is_writable($v8c7dd922ad47494fc02c388e12c00eac)) return "File not exists!";$ve6223bee17b330d9aed62e68463e0515 = pathinfo ($v8c7dd922ad47494fc02c388e12c00eac);if ($ve6223bee17b330d9aed62e68463e0515['extension'] != "zip") {return "It's not zip-file!";}$v9024b204fb4c4ffdd07ee631ed791f75 = $v8c7dd922ad47494fc02c388e12c00eac;$v3cc7992a6d5b20ce784f6169f4423048 = $v8c7dd922ad47494fc02c388e12c00eac;}$v888d0ee361af3603736f32131e7b20a2 = new PclZip($v3cc7992a6d5b20ce784f6169f4423048);$v10ae9fc7d453b0dd525d0edf2ede7961 = $v888d0ee361af3603736f32131e7b20a2->extract(PCLZIP_OPT_PATH, $v851148b4fd8fd7ae74bd9100c5c0c898,    PCLZIP_CB_PRE_EXTRACT, "callbackPreExtract",    PCLZIP_CB_POST_EXTRACT, "callbackPostExtract",    PCLZIP_OPT_REMOVE_ALL_PATH);if (!is_array ($v10ae9fc7d453b0dd525d0edf2ede7961)) {throw new coreException ("Zip extracting error: ".$v888d0ee361af3603736f32131e7b20a2->errorInfo(true));}if(is_writable($v3cc7992a6d5b20ce784f6169f4423048)) {unlink($v3cc7992a6d5b20ce784f6169f4423048);}return $v10ae9fc7d453b0dd525d0edf2ede7961;}public function getFileName() {return $this->name;}public function getDirName() {return $this->dirname;}public function getModifyTime() {return $this->modify_time;}public function getExt() {return $this->ext;}public function getSize() {return $this->size;}public function getFilePath($v335fe1286880112c216697dceb9e2bd3 = false) {if($v335fe1286880112c216697dceb9e2bd3) {$vbf7be97451be760d000d8fd7b26c5a3d = ini_get("include_path");if (substr($this->filepath, 0, strlen($vbf7be97451be760d000d8fd7b26c5a3d)) === $vbf7be97451be760d000d8fd7b26c5a3d) {return "/" . substr($this->filepath, strlen($vbf7be97451be760d000d8fd7b26c5a3d));}$vbf7be97451be760d000d8fd7b26c5a3d = CURRENT_WORKING_DIR;if (substr($this->filepath, 0, strlen($vbf7be97451be760d000d8fd7b26c5a3d)) === $vbf7be97451be760d000d8fd7b26c5a3d) {return substr($this->filepath, strlen($vbf7be97451be760d000d8fd7b26c5a3d));}return (substr($this->filepath, 0, 2) == "./") ? ("/" . substr($this->filepath, 2, strlen($this->filepath) - 2)) : $this->filepath;}else {return $this->filepath;}}private function loadInfo() {if(!is_file($this->filepath)) {$this->is_broken = true;return false;}if(!is_readable($this->filepath)) {$this->is_broken = true;return false;}$va93b85dcfbb9969f5bb3c6be71737ed5 = pathinfo($this->filepath);$this->modify_time = filemtime($this->filepath);$this->size = filesize($this->filepath);$this->dirname = $va93b85dcfbb9969f5bb3c6be71737ed5['dirname'];$this->name = $va93b85dcfbb9969f5bb3c6be71737ed5['basename'];$this->ext = strtolower(getArrayKey($va93b85dcfbb9969f5bb3c6be71737ed5, 'extension'));if($this->ext == "php" || $this->ext == "php5" || $this->ext == "phtml") {$this->is_broken = true;}if($this->name == ".htaccess") {$this->is_broken = true;}}public function __toString() {$v6a2a431fe8b621037ea949531c28551d = $this->getFilePath(true);return is_null($v6a2a431fe8b621037ea949531c28551d) ? "" : $v6a2a431fe8b621037ea949531c28551d;}public function getIsBroken() {return (bool) $this->is_broken;}public static function getUnconflictPath($v9024b204fb4c4ffdd07ee631ed791f75) {if(!file_exists($v9024b204fb4c4ffdd07ee631ed791f75)) {return $v9024b204fb4c4ffdd07ee631ed791f75;}else {$vcaf9b6b99962bf5c2264824231d7a40c = pathinfo($v9024b204fb4c4ffdd07ee631ed791f75);$v954eef6d6eac59aca304b6d7abb4fb3e = $vcaf9b6b99962bf5c2264824231d7a40c['dirname'];$v435ed7e9f07f740abf511a62c00eef6e = $vcaf9b6b99962bf5c2264824231d7a40c['filename'];$vabf77184f55403d75b9d51d79162a7ca = $vcaf9b6b99962bf5c2264824231d7a40c['extension'];for($v865c0c0b4ab0e063e5caa3387c1a8741 = 1;$v865c0c0b4ab0e063e5caa3387c1a8741 < 257;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v9024b204fb4c4ffdd07ee631ed791f75 = $v954eef6d6eac59aca304b6d7abb4fb3e . "/" . $v435ed7e9f07f740abf511a62c00eef6e . $v865c0c0b4ab0e063e5caa3387c1a8741 . "." . $vabf77184f55403d75b9d51d79162a7ca;if(!file_exists($v9024b204fb4c4ffdd07ee631ed791f75)) {return $v9024b204fb4c4ffdd07ee631ed791f75;}}throw new coreException("This is really hard to happen");}}protected static function getRelPath($vd6fe1d0be6347b8ef2427fa629c04485) {$v109633366fd0d46d371ede589998abaa = realpath(getcwd());return "." . substr(realpath($vd6fe1d0be6347b8ef2427fa629c04485), strlen($v109633366fd0d46d371ede589998abaa));}};function callbackPreExtract ($v50cd20d6ab1f950f5f7cd9594d824078, &$v346210869c15b12ae6d906bb9e095aac) {$vcaf9b6b99962bf5c2264824231d7a40c = pathinfo($v346210869c15b12ae6d906bb9e095aac['filename']);$v954eb83bca864c64ee1e669dfab01c95 = substr($vcaf9b6b99962bf5c2264824231d7a40c['basename'], 0, (strlen($vcaf9b6b99962bf5c2264824231d7a40c['basename']) - strlen($vcaf9b6b99962bf5c2264824231d7a40c['extension']))-1);$v954eb83bca864c64ee1e669dfab01c95 = translit::convert($v954eb83bca864c64ee1e669dfab01c95);$v346210869c15b12ae6d906bb9e095aac['filename'] = $vcaf9b6b99962bf5c2264824231d7a40c['dirname']."/".$v954eb83bca864c64ee1e669dfab01c95.".".$vcaf9b6b99962bf5c2264824231d7a40c['extension'];$v346210869c15b12ae6d906bb9e095aac['filename'] = umiFile::getUnconflictPath($v346210869c15b12ae6d906bb9e095aac['filename']);return 1;}function callbackPostExtract ($v50cd20d6ab1f950f5f7cd9594d824078, &$v346210869c15b12ae6d906bb9e095aac) {$vcaf9b6b99962bf5c2264824231d7a40c = pathinfo($v346210869c15b12ae6d906bb9e095aac['stored_filename']);$v7fee4f7b906c49d382375b9db2541387 = array ("jpg","jpeg","gif","bmp","png");if ( !in_array ($vcaf9b6b99962bf5c2264824231d7a40c['extension'], $v7fee4f7b906c49d382375b9db2541387)) {unlink ($v346210869c15b12ae6d906bb9e095aac['filename']);}return 1;}?>