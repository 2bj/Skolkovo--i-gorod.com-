<?php
class paths extends simpleStat{protected $params = array('path' => '');public function get()    {return array('detail' => $this->getDetail(), 'path' => $this->getPath());}public function getDetail()    {$vd6fe1d0be6347b8ef2427fa629c04485 = explode('/', $this->params['path']);if (!isset($vd6fe1d0be6347b8ef2427fa629c04485[0]) || !$vd6fe1d0be6347b8ef2427fa629c04485[0]) {l_mysql_query("SET @all = (SELECT COUNT(*) FROM `cms_stat_paths`
                          WHERE `date` BETWEEN " . $this->getQueryInterval() . " AND `host_id` = " . $this->host_id  . $this->getUserFilterWhere() . ")");return $this->simpleQuery("SELECT COUNT(*) AS `abs`, COUNT(*) / @all * 100 AS `rel`, `p`.`uri`, `p`.`id` FROM `cms_stat_hits` `h`
                                         INNER JOIN `cms_stat_pages` `p` ON `p`.`id` = `h`.`page_id`
                                          WHERE `h`.`date` BETWEEN " . $this->getQueryInterval() . " AND `h`.`number_in_path` = 1 " . $this->getHostSQL("p") . "
                                           GROUP BY `h`.`page_id`
                                            ORDER BY `abs` DESC
                                             LIMIT " . $this->offset . ", " . $this->limit);}else {$vc9e9a848920877e76685b2e4e76de38d = sizeof($vd6fe1d0be6347b8ef2427fa629c04485);$v36f75e2036c54462c47b965f4a581cff = "SELECT COUNT(*) AS `abs`, COUNT(*) / @all * 100 AS `rel`, IFNULL(`p`.`uri`, '<exit>') AS `uri`, `p`.`id`";$v9efab2399c7c560b34de477b9aa0a465 = " FROM `cms_stat_hits` `h" . $vc9e9a848920877e76685b2e4e76de38d . "`";$v98bd1c45684cf587ac2347a92dd7bb51 = array_pop($vd6fe1d0be6347b8ef2427fa629c04485);$v3c6e0b8a9c15224a8228b9a98ca1531d = 0;foreach ($vd6fe1d0be6347b8ef2427fa629c04485 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$v43b5c9175984c071f30b873fdce0a000 = $vc9e9a848920877e76685b2e4e76de38d - $v3c6e0b8a9c15224a8228b9a98ca1531d - 1;$v9efab2399c7c560b34de477b9aa0a465 .= " INNER JOIN `cms_stat_hits` `h" . $v43b5c9175984c071f30b873fdce0a000 . "` ON `h" . $v43b5c9175984c071f30b873fdce0a000 . "`.`path_id` = `h" . $vc9e9a848920877e76685b2e4e76de38d . "`.`path_id` AND `h" . $v43b5c9175984c071f30b873fdce0a000 . "`.`page_id` = " . (int)$v3a6d0284e743dc4a9b86f97d6dd1a3bf . " AND `h" . $v43b5c9175984c071f30b873fdce0a000 . "`.`number_in_path` = " . ($v3c6e0b8a9c15224a8228b9a98ca1531d + 1);}$v9efab2399c7c560b34de477b9aa0a465 .= " LEFT JOIN `cms_stat_hits` `n` ON `n`.`path_id` = `h" . $vc9e9a848920877e76685b2e4e76de38d . "`.`path_id` AND `n`.`prev_page_id` = `h" . $vc9e9a848920877e76685b2e4e76de38d . "`.`page_id` AND `n`.`number_in_path` = " . ($vc9e9a848920877e76685b2e4e76de38d + 1) . "
                       LEFT JOIN `cms_stat_pages` `p` ON `n`.`page_id` = `p`.`id`
                        WHERE `h" . ($v3c6e0b8a9c15224a8228b9a98ca1531d + 1) . "`.`date` BETWEEN " . $this->getQueryInterval() . " AND `h" . $vc9e9a848920877e76685b2e4e76de38d . "`.`page_id` = " . (int)$v98bd1c45684cf587ac2347a92dd7bb51 . " AND `h" . $vc9e9a848920877e76685b2e4e76de38d . "`.`number_in_path` = " . $vc9e9a848920877e76685b2e4e76de38d;$v36f75e2036c54462c47b965f4a581cff = $v36f75e2036c54462c47b965f4a581cff . $v9efab2399c7c560b34de477b9aa0a465 . " GROUP BY `p`.`id` ORDER BY `abs` DESC";$v39920834674921025af864e03eac4817 = "SET @all = (SELECT COUNT(*) AS `cnt` " . $v9efab2399c7c560b34de477b9aa0a465 . ")";l_mysql_query($v39920834674921025af864e03eac4817);return $this->simpleQuery($v36f75e2036c54462c47b965f4a581cff);}}public function getPath()    {$vd6fe1d0be6347b8ef2427fa629c04485 = explode('/', $this->params['path']);$v341be97d9aff90c9978347f66f945b77 = '';foreach ($vd6fe1d0be6347b8ef2427fa629c04485 as $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$v341be97d9aff90c9978347f66f945b77 .= (int)$v3a6d0284e743dc4a9b86f97d6dd1a3bf . ', ';}$v341be97d9aff90c9978347f66f945b77 = substr($v341be97d9aff90c9978347f66f945b77, 0, -2);$v36f75e2036c54462c47b965f4a581cff = "SELECT `id`, `uri` FROM `cms_stat_pages` WHERE `id` IN (" . $v341be97d9aff90c9978347f66f945b77 . ")";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$result = array();while ($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb)) {$result[$vf1965a857bc285d26fe22023aa5ab50d['id']] = $vf1965a857bc285d26fe22023aa5ab50d['uri'];}reset($vd6fe1d0be6347b8ef2427fa629c04485);$ve70c4df10ef0983b9c8c31bd06b2a2c3 = array();foreach ($vd6fe1d0be6347b8ef2427fa629c04485 as $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {if (isset($result[$v3a6d0284e743dc4a9b86f97d6dd1a3bf])) {$ve70c4df10ef0983b9c8c31bd06b2a2c3[] = $result[$v3a6d0284e743dc4a9b86f97d6dd1a3bf];}}return $ve70c4df10ef0983b9c8c31bd06b2a2c3;}}?>