<?php
 class umessStream extends umiBaseStream {protected $scheme = "umess", $group_name = NULL, $field_name = NULL;public function stream_open($vd6fe1d0be6347b8ef2427fa629c04485, $v15d61712450a686a7f365adf4fef581f, $v93da65a9fd0004d9477aeac024e08e15, $v6385a5865e0b96f09e4142ab2d9e3736) {$v21ffce5b8a6cc8cc6a41448dd69623c9 = $this->parsePath($vd6fe1d0be6347b8ef2427fa629c04485);$vde70938849b75d3db63bba421c93e018 = umiMessages::getInstance();switch($v21ffce5b8a6cc8cc6a41448dd69623c9['folder']) {case 'inbox': {$vd8e44dc257374b1530df18045f18d268 =  $vde70938849b75d3db63bba421c93e018->getMessages($v21ffce5b8a6cc8cc6a41448dd69623c9['user-id'], true);break;}case 'outbox': {$vd8e44dc257374b1530df18045f18d268 = $vde70938849b75d3db63bba421c93e018->getSendedMessages($v21ffce5b8a6cc8cc6a41448dd69623c9['user-id']);break;}default: {$vd8e44dc257374b1530df18045f18d268 = false;}}if(isset($this->params['limit'])) {$vaa9f73eea60a006820d0f8768bc8a3fc = (int) $this->params['limit'];$vd8e44dc257374b1530df18045f18d268 = array_slice($vd8e44dc257374b1530df18045f18d268, 0, $vaa9f73eea60a006820d0f8768bc8a3fc);}if(is_array($vd8e44dc257374b1530df18045f18d268)) {$v8d777f385d3dfec8815d20f7496026dc = $this->translateToXml($vd8e44dc257374b1530df18045f18d268);$this->setData($v8d777f385d3dfec8815d20f7496026dc);return true;}else {return $this->setDataError('not-found');}}protected function parsePath($vd6fe1d0be6347b8ef2427fa629c04485) {$v5d109cea561ac72c0c6d3b7e08be8292 = false;$v8e44f0089b076e18a718eb9ca3d94674 = false;$vd6fe1d0be6347b8ef2427fa629c04485 = parent::parsePath($vd6fe1d0be6347b8ef2427fa629c04485);$v47c80780ab608cc046f2a6e6f071feb6 = split("\/", $vd6fe1d0be6347b8ef2427fa629c04485);if(sizeof($v47c80780ab608cc046f2a6e6f071feb6) >= 1) $v5d109cea561ac72c0c6d3b7e08be8292 = $v47c80780ab608cc046f2a6e6f071feb6[0];if(sizeof($v47c80780ab608cc046f2a6e6f071feb6) >= 2) $v8e44f0089b076e18a718eb9ca3d94674  = $v47c80780ab608cc046f2a6e6f071feb6[1];$result = Array(    'folder' => $v5d109cea561ac72c0c6d3b7e08be8292,    'user-id' => $v8e44f0089b076e18a718eb9ca3d94674   );return $result;}protected function translateToXml($vde70938849b75d3db63bba421c93e018) {$v691d502cfd0e0626cd3b058e5682ad1c = array();$va8d56514d632f5768e2fdf156f5f6473 = (bool) getRequest('mark-as-opened');foreach($vde70938849b75d3db63bba421c93e018 as $v78e731027d8fd50ed642340b7c9a63b3) {if($va8d56514d632f5768e2fdf156f5f6473) $v78e731027d8fd50ed642340b7c9a63b3->setIsOpened(true);$v691d502cfd0e0626cd3b058e5682ad1c[] = $this->translateMessageToXml($v78e731027d8fd50ed642340b7c9a63b3);}$result = array(    'messages' => array('nodes:message' => $v691d502cfd0e0626cd3b058e5682ad1c)   );return parent::translateToXml($result);}protected function translateMessageToXml(iUmiMessage $v78e731027d8fd50ed642340b7c9a63b3) {$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$v86c61d2597857a96ae3a6048b5e7c5a7 = $v5891da2d64975cae48d175d1e001f5da->getObject($v78e731027d8fd50ed642340b7c9a63b3->getSenderId());$result = Array(    'attribute:id'   => $v78e731027d8fd50ed642340b7c9a63b3->getId(),    'attribute:title'  => $v78e731027d8fd50ed642340b7c9a63b3->getTitle(),    'attribute:type'  => $v78e731027d8fd50ed642340b7c9a63b3->getType(),    'attribute:priority' => $v78e731027d8fd50ed642340b7c9a63b3->getPriority(),    'date'     => array(     'attribute:unix-timestamp' => $v78e731027d8fd50ed642340b7c9a63b3->getCreateTime()->getDateTimestamp(),     'node:value'    => $v78e731027d8fd50ed642340b7c9a63b3->getCreateTime()->getFormattedDate()    ),    'sender'    => $v86c61d2597857a96ae3a6048b5e7c5a7,    'content'    => $v78e731027d8fd50ed642340b7c9a63b3->getContent()   );return $result;}};?>