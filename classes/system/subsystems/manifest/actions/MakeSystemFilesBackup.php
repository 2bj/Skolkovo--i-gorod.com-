<?php
 class MakeSystemFilesBackupAction extends atomicAction {protected $movedItems = Array(), $targetDirectory;public function execute() {$this->checkTargetDirectory();$veca07335a33c5aeb5e1bc7c98b4b9d80 = $this->getParam('targets');if(is_array($veca07335a33c5aeb5e1bc7c98b4b9d80)) {$this->copyItems($veca07335a33c5aeb5e1bc7c98b4b9d80);}else {throw new Exception("No items to copy");}}public function rollback() {$v48f735ca02261c9ff241a6529c1167c8 = $this->movedItems;$v48f735ca02261c9ff241a6529c1167c8 = array_reverse($v48f735ca02261c9ff241a6529c1167c8);foreach($v48f735ca02261c9ff241a6529c1167c8 as $v447b7147e84be512208dcc0995d67ebc) {if(is_file($v447b7147e84be512208dcc0995d67ebc)) {unlink($v447b7147e84be512208dcc0995d67ebc);}if(is_dir($v447b7147e84be512208dcc0995d67ebc)) {rmdir($v447b7147e84be512208dcc0995d67ebc);}}if(is_dir($this->targetDirectory)) {rmdir($this->targetDirectory);}}protected function checkTargetDirectory() {$this->targetDirectory = $this->getEnviromentValue('temporary-directory-path') . "system-files/";if(is_dir($this->targetDirectory)) {return;}else if(mkdir($this->targetDirectory, 0777)) {return;}else {throw new Exception("Can't create temporary directory");}}protected function copyItems($v691d502cfd0e0626cd3b058e5682ad1c) {clearstatcache();foreach($v691d502cfd0e0626cd3b058e5682ad1c as $v447b7147e84be512208dcc0995d67ebc) {if(is_file($v447b7147e84be512208dcc0995d67ebc)) {$this->copyFile($v447b7147e84be512208dcc0995d67ebc);}if(is_dir($v447b7147e84be512208dcc0995d67ebc)) {$this->copyDirectory($v447b7147e84be512208dcc0995d67ebc);}}}protected function copyFile($v447b7147e84be512208dcc0995d67ebc) {if(!is_writable($v447b7147e84be512208dcc0995d67ebc)) {throw new Exception("This file should be writable: \"{$v447b7147e84be512208dcc0995d67ebc}\"");}$v86a4a7fcdf32c5f3118fe2cd67a49608 = $this->targetDirectory . $v447b7147e84be512208dcc0995d67ebc;copy($v447b7147e84be512208dcc0995d67ebc, $v86a4a7fcdf32c5f3118fe2cd67a49608);$this->movedItems[] = $v86a4a7fcdf32c5f3118fe2cd67a49608;}protected function copyDirectory($v447b7147e84be512208dcc0995d67ebc) {$v86a4a7fcdf32c5f3118fe2cd67a49608 = $this->targetDirectory . $v447b7147e84be512208dcc0995d67ebc;$this->movedItems[] = $v86a4a7fcdf32c5f3118fe2cd67a49608;if(is_dir($v86a4a7fcdf32c5f3118fe2cd67a49608)) {if(!is_writable($v86a4a7fcdf32c5f3118fe2cd67a49608)) {throw new Exception("Directory is not writable: \"{$v86a4a7fcdf32c5f3118fe2cd67a49608}\"");}}else {if(mkdir($v86a4a7fcdf32c5f3118fe2cd67a49608 , 0777) == false) {throw new Exception("Can't create directory \"{$v86a4a7fcdf32c5f3118fe2cd67a49608}\"");}}$v736007832d2167baaae763fd3a3f3cf1 = new umiDirectory($v447b7147e84be512208dcc0995d67ebc);foreach($v736007832d2167baaae763fd3a3f3cf1 as $va4adb9689e75b94031060952074bf7a0) {if($va4adb9689e75b94031060952074bf7a0 instanceof umiDirectory) {if($va4adb9689e75b94031060952074bf7a0->getName() == ".svn") {continue;}if($va4adb9689e75b94031060952074bf7a0->getName() == "cngeoip.dat") {continue;}$this->copyDirectory($va4adb9689e75b94031060952074bf7a0->getPath());}if($va4adb9689e75b94031060952074bf7a0 instanceof umiFile) {$this->copyFile($va4adb9689e75b94031060952074bf7a0->getFilePath());}}}};?>