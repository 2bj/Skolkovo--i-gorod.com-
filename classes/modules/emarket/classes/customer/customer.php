<?php
 class customer extends umiObjectProxy {public static $defaultExpiration = 2678400;protected $isAuth;public static function get($vdf2bcfd8ee59b29e1ec63317dcf62b35 = false) {static $v91ec1f9324753048c0096d036a694f86;if(!$vdf2bcfd8ee59b29e1ec63317dcf62b35 && !is_null($v91ec1f9324753048c0096d036a694f86)) {return $v91ec1f9324753048c0096d036a694f86;}$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$permissions = permissionsCollection::getInstance();if($permissions->isAuth()) {$v8e44f0089b076e18a718eb9ca3d94674 = $permissions->getUserId();$va8cfde6331bd59eb2ac96f8911c4b666 = $v5891da2d64975cae48d175d1e001f5da->getObject($v8e44f0089b076e18a718eb9ca3d94674);}else {$va8cfde6331bd59eb2ac96f8911c4b666 = self::getCustomerId();if($va8cfde6331bd59eb2ac96f8911c4b666 === false) $va8cfde6331bd59eb2ac96f8911c4b666 = self::getCustomerId(true);}if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {$v91ec1f9324753048c0096d036a694f86 = new customer($va8cfde6331bd59eb2ac96f8911c4b666);$v91ec1f9324753048c0096d036a694f86->tryMerge();return $v91ec1f9324753048c0096d036a694f86;}}public function __construct(iUmiObject $va8cfde6331bd59eb2ac96f8911c4b666) {$permissions = permissionsCollection::getInstance();$v8e44f0089b076e18a718eb9ca3d94674 = $permissions->getUserId();$v92ad7554e2e0d208f33729db6d54b59b = permissionsCollection::getGuestId();$this->isAuth = ($v8e44f0089b076e18a718eb9ca3d94674 == $v92ad7554e2e0d208f33729db6d54b59b) ? false : $v8e44f0089b076e18a718eb9ca3d94674;parent::__construct($va8cfde6331bd59eb2ac96f8911c4b666);}public function isUser() {return (bool) $this->isAuth;}public function tryMerge() {if($this->isUser() && getCookie('customer-id')) {$vcc41d1c06c24d28cfe74d473428f577e = self::getCustomerId();if($vcc41d1c06c24d28cfe74d473428f577e instanceof iUmiObject) {$this->merge($vcc41d1c06c24d28cfe74d473428f577e);}}}public function merge(umiObject $v91ec1f9324753048c0096d036a694f86) {$v8be74552df93e31bbdd6b36ed74bdb6a = new selector('objects');$v8be74552df93e31bbdd6b36ed74bdb6a->types('object-type')->name('emarket', 'order');$v8be74552df93e31bbdd6b36ed74bdb6a->where('customer_id')->equals($v91ec1f9324753048c0096d036a694f86->id);$v8be74552df93e31bbdd6b36ed74bdb6a->order('id')->desc();if($v8be74552df93e31bbdd6b36ed74bdb6a->first) {$v10b02e139532ee1844b5a2e97b856cc5 = $v8be74552df93e31bbdd6b36ed74bdb6a->first;$v125400e5879efb03f17ff21cd2697b9e = $v10b02e139532ee1844b5a2e97b856cc5->order_items;if(is_array($v125400e5879efb03f17ff21cd2697b9e)) {$va47640b59dd4743ae5b10f0cd15fec65 = __emarket_purchasing::getBasketOrder();if($va47640b59dd4743ae5b10f0cd15fec65) {foreach($v125400e5879efb03f17ff21cd2697b9e as $vcb173b323074f9035b850b31afb196d6) {$v39b91a7e3e05f526a19899c65efe3675 = orderItem::get($vcb173b323074f9035b850b31afb196d6);if($v39b91a7e3e05f526a19899c65efe3675) {$va47640b59dd4743ae5b10f0cd15fec65->appendItem($v39b91a7e3e05f526a19899c65efe3675);}}$va47640b59dd4743ae5b10f0cd15fec65->commit();}}$v10b02e139532ee1844b5a2e97b856cc5->delete();setcookie('customer-id', 0, 1, '/');$v91ec1f9324753048c0096d036a694f86->delete();}}public function freeze() {$v98633eff1ff28867014bc59a63e8e4ee = umiObjectsExpiration::getInstance();$v98633eff1ff28867014bc59a63e8e4ee->clear($this->id);}public function __toString() {return (string) $this->object->id;}protected static function getCustomerId($v9f94b6f8cf416868f4dcf7226b76df36 = false) {static $vc7fe6c0da028dabd8e96b311aeb9eedc;if(is_null($vc7fe6c0da028dabd8e96b311aeb9eedc)) {$vc7fe6c0da028dabd8e96b311aeb9eedc = (int) getCookie('customer-id');}$v91ec1f9324753048c0096d036a694f86 = selector::get('object')->id($vc7fe6c0da028dabd8e96b311aeb9eedc);if($v91ec1f9324753048c0096d036a694f86 instanceof iUmiObject != false) {$v599dcce2998a6b40b1e38e8c6006cb0a = selector::get('object-type')->id($v91ec1f9324753048c0096d036a694f86->getTypeId());if($v599dcce2998a6b40b1e38e8c6006cb0a->getMethod() != 'customer') {$v91ec1f9324753048c0096d036a694f86 = null;}}else {$v91ec1f9324753048c0096d036a694f86 = null;}if(!$v91ec1f9324753048c0096d036a694f86) {$vc7fe6c0da028dabd8e96b311aeb9eedc = self::createGuestCustomer();$v91ec1f9324753048c0096d036a694f86 = selector::get('object')->id($vc7fe6c0da028dabd8e96b311aeb9eedc);}if(!$vc7fe6c0da028dabd8e96b311aeb9eedc) {$vc7fe6c0da028dabd8e96b311aeb9eedc = self::createGuestCustomer();}setcookie('customer-id', $vc7fe6c0da028dabd8e96b311aeb9eedc, (time() + self::$defaultExpiration), '/');$v98633eff1ff28867014bc59a63e8e4ee = umiObjectsExpiration::getInstance();$v98633eff1ff28867014bc59a63e8e4ee->set($vc7fe6c0da028dabd8e96b311aeb9eedc, self::$defaultExpiration);return $v91ec1f9324753048c0096d036a694f86;}protected static function createGuestCustomer() {$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$v6301cee35ea764a1e241978f93f01069 = $v0e8133eb006c0f85ed9444ae07a60842->getBaseType('emarket', 'customer');return $v5891da2d64975cae48d175d1e001f5da->addObject(getServer('REMOTE_ADDR'), $v6301cee35ea764a1e241978f93f01069);}};?>