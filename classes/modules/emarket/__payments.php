<?php
 abstract class __emarket_payment {public function payment(order $v70a17ffa722a3985b86d30b034ad06d7, $v2764ca9d34e90313978d044f27ae433b, $v15d61712450a686a7f365adf4fef581f, $v66f6181bcb4cff4cd38fbc804a036db6) {$v7d159ae56109a25cabc194107488ab74 = $v70a17ffa722a3985b86d30b034ad06d7->getValue('payment_id');if($v7d159ae56109a25cabc194107488ab74)   $vf83c2a85d972a89238f31296c63f0dbc = payment::get($v7d159ae56109a25cabc194107488ab74, $v70a17ffa722a3985b86d30b034ad06d7);switch($v2764ca9d34e90313978d044f27ae433b) {case 'choose':     return ($v15d61712450a686a7f365adf4fef581f == 'do') ? $this->choosePayment($v70a17ffa722a3985b86d30b034ad06d7) : $this->renderPaymentsList($v70a17ffa722a3985b86d30b034ad06d7, $v66f6181bcb4cff4cd38fbc804a036db6);break;default:     if($vf83c2a85d972a89238f31296c63f0dbc instanceof payment) {return $vf83c2a85d972a89238f31296c63f0dbc->process($v66f6181bcb4cff4cd38fbc804a036db6);}else {throw new privateException("Unkown payment step \"{$v2764ca9d34e90313978d044f27ae433b}\"");}}}public function paymentCheckStep(order $v70a17ffa722a3985b86d30b034ad06d7, $v2764ca9d34e90313978d044f27ae433b) {return $v2764ca9d34e90313978d044f27ae433b;}public function renderPaymentsList(order $v70a17ffa722a3985b86d30b034ad06d7, $v66f6181bcb4cff4cd38fbc804a036db6) {list($v31912934b8f34be4364cc043cd8a0176, $v5ad10ccde9b1728f3d06c1eb0b05ab0f) = def_module::loadTemplates("./tpls/emarket/payment/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", 'payment_block', 'payment_item');$ve6f67ae99b11c27adf8237f3820009d3 = payment::getList();$vf1386a17eed513dff70798b0551dc170 = array();$v37f060a56a2532fdbc422f04856d627d = $v70a17ffa722a3985b86d30b034ad06d7->getValue('payment_id');foreach($ve6f67ae99b11c27adf8237f3820009d3 as $v7d159ae56109a25cabc194107488ab74) {$vf83c2a85d972a89238f31296c63f0dbc = payment::get($v7d159ae56109a25cabc194107488ab74);if($vf83c2a85d972a89238f31296c63f0dbc->validate($v70a17ffa722a3985b86d30b034ad06d7) == false) continue;$vaa5d593390f7a6d87b33f23abd358a19 = $vf83c2a85d972a89238f31296c63f0dbc->getObject();$v1254b0ee457aeed202594b8c9f754954 = $vaa5d593390f7a6d87b33f23abd358a19->getValue('payment_type_id');$v23de265b2fdfc05bfeb15fcadd463afc = umiObjectsCollection::getInstance()->getObject($v1254b0ee457aeed202594b8c9f754954)->getValue('class_name');$ve253bed1357afcefc5fadfbc92f9eb97 = array(     'attribute:id'   => $vaa5d593390f7a6d87b33f23abd358a19->id,     'attribute:name'  => $vaa5d593390f7a6d87b33f23abd358a19->name,     'attribute:type-name' => $v23de265b2fdfc05bfeb15fcadd463afc,     'xlink:href'   => $vaa5d593390f7a6d87b33f23abd358a19->xlink    );if($v7d159ae56109a25cabc194107488ab74 == $v37f060a56a2532fdbc422f04856d627d) {$ve253bed1357afcefc5fadfbc92f9eb97['attribute:active'] = 'active';}$vf1386a17eed513dff70798b0551dc170[] = def_module::parseTemplate($v5ad10ccde9b1728f3d06c1eb0b05ab0f, $ve253bed1357afcefc5fadfbc92f9eb97, false, $vaa5d593390f7a6d87b33f23abd358a19->id);}if($v31912934b8f34be4364cc043cd8a0176) {return def_module::parseTemplate($v31912934b8f34be4364cc043cd8a0176, array('items' => $vf1386a17eed513dff70798b0551dc170));}else {return array('items' => array('nodes:item' => $vf1386a17eed513dff70798b0551dc170));}}public function choosePayment(order $v70a17ffa722a3985b86d30b034ad06d7) {$v70a17ffa722a3985b86d30b034ad06d7->setValue('payment_id', getRequest('payment-id'));$v7d159ae56109a25cabc194107488ab74 = getRequest('payment-id');if(!$v7d159ae56109a25cabc194107488ab74) {$this->errorNewMessage(getLabel('error-emarket-choose-payment'));$this->errorPanic();}$vf83c2a85d972a89238f31296c63f0dbc = payment::get($v7d159ae56109a25cabc194107488ab74);if($vf83c2a85d972a89238f31296c63f0dbc instanceof payment) {$v59985644607259484f714d567cf61e8c = $vf83c2a85d972a89238f31296c63f0dbc->getCodeName();$v572d4e421e5e6b9bc11d815e8a027112 = "{$this->pre_lang}/emarket/purchase/payment/{$v59985644607259484f714d567cf61e8c}/";}else {$v572d4e421e5e6b9bc11d815e8a027112 = "{$this->pre_lang}/emarket/purchase/payment/choose/";}$this->redirect($v572d4e421e5e6b9bc11d815e8a027112);}public function gateway() {$v61e9abeaa2ba0e1296555c135d818e6e = (int) getRequest('param0');if(!$v61e9abeaa2ba0e1296555c135d818e6e) $v61e9abeaa2ba0e1296555c135d818e6e = (int) getRequest('order-id');if(!$v61e9abeaa2ba0e1296555c135d818e6e) $v61e9abeaa2ba0e1296555c135d818e6e = (int) getRequest('shp_orderId');if(!$v61e9abeaa2ba0e1296555c135d818e6e) $v61e9abeaa2ba0e1296555c135d818e6e = (int) getRequest('orderId');$v70a17ffa722a3985b86d30b034ad06d7 = order::get($v61e9abeaa2ba0e1296555c135d818e6e);if($v70a17ffa722a3985b86d30b034ad06d7 instanceof order) {$v7d159ae56109a25cabc194107488ab74 = $v70a17ffa722a3985b86d30b034ad06d7->getValue('payment_id');if($v7d159ae56109a25cabc194107488ab74) {$vf83c2a85d972a89238f31296c63f0dbc = payment::get($v7d159ae56109a25cabc194107488ab74, $v70a17ffa722a3985b86d30b034ad06d7);return $vf83c2a85d972a89238f31296c63f0dbc->poll();}else {throw new publicException("No payment method inited for order #{$v61e9abeaa2ba0e1296555c135d818e6e}");}}else {throw new publicException("Order #{$v61e9abeaa2ba0e1296555c135d818e6e} doesn't exists");}}public function receipt() {$v61e9abeaa2ba0e1296555c135d818e6e = (int) getRequest('param0');if(!$v61e9abeaa2ba0e1296555c135d818e6e) $v61e9abeaa2ba0e1296555c135d818e6e = (int) getRequest('order-id');$v04b29480233f4def5c875875b6bdc3b1 = (string) getRequest('param1');if(!$v04b29480233f4def5c875875b6bdc3b1) $v04b29480233f4def5c875875b6bdc3b1 = (string) getRequest('signature');$v70a17ffa722a3985b86d30b034ad06d7 = order::get($v61e9abeaa2ba0e1296555c135d818e6e);if($v70a17ffa722a3985b86d30b034ad06d7 instanceof order) {$v91ec1f9324753048c0096d036a694f86 = customer::get($v70a17ffa722a3985b86d30b034ad06d7->getCustomerId());if($v91ec1f9324753048c0096d036a694f86->isUser()) {$v9bc65c2abec141778ffaa729489f3e87 = cmsController::getInstance()->getModule('users');if($v9bc65c2abec141778ffaa729489f3e87->user_id != $v91ec1f9324753048c0096d036a694f86->id) {throw new publicException("Access denied");}}else {if(strcasecmp($v04b29480233f4def5c875875b6bdc3b1, sha1("{$v91ec1f9324753048c0096d036a694f86->id}:{$v91ec1f9324753048c0096d036a694f86->email}:{$v70a17ffa722a3985b86d30b034ad06d7->order_date}")) !== 0) {throw new publicException("Access denied");}}$v9305b73d359bd06734fee0b3638079e1 = "uobject://{$v61e9abeaa2ba0e1296555c135d818e6e}/?transform=sys-tpls/emarket-receipt.xsl";$result = file_get_contents($v9305b73d359bd06734fee0b3638079e1);$v7f2db423a49b305459147332fb01cf87 = outputBuffer::current();$v7f2db423a49b305459147332fb01cf87->charset('utf-8');$v7f2db423a49b305459147332fb01cf87->contentType('text/html');$v7f2db423a49b305459147332fb01cf87->clear();$v7f2db423a49b305459147332fb01cf87->push($result);$v7f2db423a49b305459147332fb01cf87->end();}else {throw new publicException("Order #{$v61e9abeaa2ba0e1296555c135d818e6e} doesn't exists");}}};?>
