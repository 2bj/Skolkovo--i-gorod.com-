<?php
 class umiHierarchy extends singleton implements iSingleton, iUmiHierarchy {private $elements = array(),   $objects, $langs, $domains, $templates;private $updatedElements = Array();private $autocorrectionDisabled = false;private $elementsLastUpdateTime = 0;private $bForceAbsolutePath = false;private $symlinks = Array();private $misc_elements = Array();protected function __construct() {$this->objects  = umiObjectsCollection::getInstance();$this->langs  = langsCollection::getInstance();$this->domains  = domainsCollection::getInstance();$this->templates = templatesCollection::getInstance();if(regedit::getInstance()->getVal("//settings/disable_url_autocorrection")) {$this->autocorrectionDisabled = true;}}public static function getInstance() {return parent::getInstance(__CLASS__);}public function isExists($v7057e8409c7c531a1a6e9ac3df4ed549) {if($this->isLoaded($v7057e8409c7c531a1a6e9ac3df4ed549)) {return true;}else {$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id FROM cms3_hierarchy WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list($ve2942a04780e223b215eb8b663cf5353) = mysql_fetch_row($result);return (bool) $ve2942a04780e223b215eb8b663cf5353;}}public function isLoaded($v7057e8409c7c531a1a6e9ac3df4ed549) {if($v7057e8409c7c531a1a6e9ac3df4ed549 === false) {return false;}if(is_array($v7057e8409c7c531a1a6e9ac3df4ed549)) {$v5b78ddc78e0a270e44c7928843456220 = true;foreach($v7057e8409c7c531a1a6e9ac3df4ed549 as $v7a83e592dae31301d9b5c2bbc544d822) {if(!array_key_exists($v7a83e592dae31301d9b5c2bbc544d822, $this->elements)) {$v5b78ddc78e0a270e44c7928843456220 = false;break;}}return $v5b78ddc78e0a270e44c7928843456220;}else {return (bool) array_key_exists($v7057e8409c7c531a1a6e9ac3df4ed549, $this->elements);}}public function getElement($v7057e8409c7c531a1a6e9ac3df4ed549, $ve70325c72e806c33fd52022dd9c07eb2 = false, $vbeaf7e25161be5ef9784e550ab4fc891 = false) {if(!$v7057e8409c7c531a1a6e9ac3df4ed549) return false;if(!$ve70325c72e806c33fd52022dd9c07eb2 && !$this->isAllowed($v7057e8409c7c531a1a6e9ac3df4ed549)) return false;$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();if($this->isLoaded($v7057e8409c7c531a1a6e9ac3df4ed549)) {return $this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549];}else {$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb99eb979e6f6efabc396f777b503f7e7->load($v7057e8409c7c531a1a6e9ac3df4ed549, "element");if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement == false) {try {$v8e2dcfd7e7e24b1ca76c1193f645902b = new umiHierarchyElement($v7057e8409c7c531a1a6e9ac3df4ed549);$vb99eb979e6f6efabc396f777b503f7e7->save($v8e2dcfd7e7e24b1ca76c1193f645902b, "element");}catch (privateException $ve1671797c52e15f763380b45e841ec32) {return false;}}$this->misc_elements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;if(is_object($v8e2dcfd7e7e24b1ca76c1193f645902b)) {if($v8e2dcfd7e7e24b1ca76c1193f645902b->getIsBroken()) return false;if($v8e2dcfd7e7e24b1ca76c1193f645902b->getIsDeleted() && !$vbeaf7e25161be5ef9784e550ab4fc891) return false;$this->pushElementsLastUpdateTime($v8e2dcfd7e7e24b1ca76c1193f645902b->getUpdateTime());$this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549] = $v8e2dcfd7e7e24b1ca76c1193f645902b;return $this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549];}else return false;}}public function delElement($v7057e8409c7c531a1a6e9ac3df4ed549) {$this->disableCache();$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$permissions = permissionsCollection::getInstance();$this->addUpdatedElementId($v7057e8409c7c531a1a6e9ac3df4ed549);$this->forceCacheCleanup();if(!$permissions->isAllowedObject($permissions->getUserId(), $v7057e8409c7c531a1a6e9ac3df4ed549)) return false;if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549)) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy FORCE INDEX(rel) WHERE rel = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($vf36263a38d7de5cdaa953c1e2b2f79b5) = mysql_fetch_row($result)) {$v2da0d90fc7822dade6effbdd1f48b458 = $this->getElement($vf36263a38d7de5cdaa953c1e2b2f79b5, true, true);$this->delElement($vf36263a38d7de5cdaa953c1e2b2f79b5);$vb99eb979e6f6efabc396f777b503f7e7->del($vf36263a38d7de5cdaa953c1e2b2f79b5, "element");}$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsDeleted(true);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();unset($this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549]);$vb99eb979e6f6efabc396f777b503f7e7->del($v7057e8409c7c531a1a6e9ac3df4ed549, "element");return true;}else {return false;}}public function copyElement($v7057e8409c7c531a1a6e9ac3df4ed549, $vd5d4bb9b2c282937ee64b1fb0495ef08, $v5972c4d2dc988e33130281251a6f282a = false) {$this->disableCache();cacheFrontend::getInstance()->flush();$this->misc_elements[] = $vd5d4bb9b2c282937ee64b1fb0495ef08;$this->misc_elements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;$this->forceCacheCleanup();if($this->isExists($v7057e8409c7c531a1a6e9ac3df4ed549) && ($this->isExists($vd5d4bb9b2c282937ee64b1fb0495ef08) || $vd5d4bb9b2c282937ee64b1fb0495ef08 === 0)) {$vd5d4bb9b2c282937ee64b1fb0495ef08 = (int) $vd5d4bb9b2c282937ee64b1fb0495ef08;$vd7e6d55ba379a13d08c25d15faf2a23b = self::getTimeStamp();if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549)) {$this->misc_elements[] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();}$v9b207167e5381c47682c6b4f58a623fb = mysql_fetch_array(l_mysql_query('SELECT MAX(ord) FROM cms3_hierarchy', true));$v8bef1cc20ada3bef55fdf132cb2a1cb9 = $v9b207167e5381c47682c6b4f58a623fb[0]+1;$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL

INSERT INTO cms3_hierarchy
	(rel, type_id, lang_id, domain_id, tpl_id, obj_id, alt_name, is_active, is_visible, is_deleted, updatetime, ord)
		SELECT '{$vd5d4bb9b2c282937ee64b1fb0495ef08}', type_id, lang_id, domain_id, tpl_id, obj_id, alt_name, is_active, is_visible, is_deleted, '{$vd7e6d55ba379a13d08c25d15faf2a23b}', '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}'
				FROM cms3_hierarchy WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' LIMIT 1
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v2114c8075d855b3cea53d5d880c68948 = $v7057e8409c7c531a1a6e9ac3df4ed549;$v7057e8409c7c531a1a6e9ac3df4ed549 = mysql_insert_id();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL

INSERT INTO cms3_permissions
	(level, owner_id, rel_id)
		SELECT level, owner_id, '{$v7057e8409c7c531a1a6e9ac3df4ed549}' FROM cms3_permissions WHERE rel_id = '{$v2114c8075d855b3cea53d5d880c68948}'

SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549)) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v8e2dcfd7e7e24b1ca76c1193f645902b->getAltName());$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$this->buildRelationNewNodes($v7057e8409c7c531a1a6e9ac3df4ed549);if($v5972c4d2dc988e33130281251a6f282a) {$v662cbf1253ac7d8750ed9190c52163e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId();$vadce578d04ed03c31f6ac59451fcf8e4 = $this->getChilds($v2114c8075d855b3cea53d5d880c68948, true, true, 0, false, $v662cbf1253ac7d8750ed9190c52163e5);foreach($vadce578d04ed03c31f6ac59451fcf8e4 as $vf36263a38d7de5cdaa953c1e2b2f79b5 => $v1a13105b7e4eb5fb2e7c9515ac06aa48) {$this->copyElement($vf36263a38d7de5cdaa953c1e2b2f79b5, $v7057e8409c7c531a1a6e9ac3df4ed549, true);}}$this->misc_elements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;return $v7057e8409c7c531a1a6e9ac3df4ed549;}else return false;}else return false;}public function cloneElement($v7057e8409c7c531a1a6e9ac3df4ed549, $vd5d4bb9b2c282937ee64b1fb0495ef08, $v5972c4d2dc988e33130281251a6f282a = false) {$this->disableCache();cacheFrontend::getInstance()->flush();$this->misc_elements[] = $vd5d4bb9b2c282937ee64b1fb0495ef08;$this->misc_elements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;$this->forceCacheCleanup();if($this->isExists($v7057e8409c7c531a1a6e9ac3df4ed549) && ($this->isExists($vd5d4bb9b2c282937ee64b1fb0495ef08) || $vd5d4bb9b2c282937ee64b1fb0495ef08 === 0)) {if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549)) {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $v8e2dcfd7e7e24b1ca76c1193f645902b->getOrd();}$this->misc_elements[] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();$v9b207167e5381c47682c6b4f58a623fb = mysql_fetch_array(l_mysql_query('SELECT MAX(ord) FROM cms3_hierarchy', true));$v8bef1cc20ada3bef55fdf132cb2a1cb9 = $v9b207167e5381c47682c6b4f58a623fb[0] + 1;$vaf31437ce61345f416579830a98c91e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getObject()->getId();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_objects
	(name, is_locked, type_id, owner_id)
		SELECT name, is_locked, type_id, owner_id
			FROM cms3_objects
				WHERE id = '{$vaf31437ce61345f416579830a98c91e5}'
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v5e3f5f5bf865de072ff1e4cd710d4a39 = mysql_insert_id();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_object_content
	(field_id, int_val, varchar_val, text_val, rel_val, float_val, tree_val, obj_id)
		SELECT field_id, int_val, varchar_val, text_val, rel_val, float_val, tree_val, '{$v5e3f5f5bf865de072ff1e4cd710d4a39}'
			FROM cms3_object_content
				WHERE obj_id = '{$vaf31437ce61345f416579830a98c91e5}'
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vd7e6d55ba379a13d08c25d15faf2a23b = self::getTimeStamp();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL

INSERT INTO cms3_hierarchy
	(rel, type_id, lang_id, domain_id, tpl_id, obj_id, alt_name, is_active, is_visible, is_deleted, updatetime, ord)
		SELECT '{$vd5d4bb9b2c282937ee64b1fb0495ef08}', type_id, lang_id, domain_id, tpl_id, '{$v5e3f5f5bf865de072ff1e4cd710d4a39}', alt_name, is_active, is_visible, is_deleted, '{$vd7e6d55ba379a13d08c25d15faf2a23b}', '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}'
				FROM cms3_hierarchy WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' LIMIT 1
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v2114c8075d855b3cea53d5d880c68948 = $v7057e8409c7c531a1a6e9ac3df4ed549;$v7057e8409c7c531a1a6e9ac3df4ed549 = mysql_insert_id();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL

INSERT INTO cms3_permissions
	(level, owner_id, rel_id)
		SELECT level, owner_id, '{$v7057e8409c7c531a1a6e9ac3df4ed549}' FROM cms3_permissions WHERE rel_id = '{$v2114c8075d855b3cea53d5d880c68948}'

SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549)) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v8e2dcfd7e7e24b1ca76c1193f645902b->getAltName());$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$this->buildRelationNewNodes($v7057e8409c7c531a1a6e9ac3df4ed549);if($v5972c4d2dc988e33130281251a6f282a) {$v662cbf1253ac7d8750ed9190c52163e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId();$vadce578d04ed03c31f6ac59451fcf8e4 = $this->getChilds($v2114c8075d855b3cea53d5d880c68948, true, true, 0, false, $v662cbf1253ac7d8750ed9190c52163e5);foreach($vadce578d04ed03c31f6ac59451fcf8e4 as $vf36263a38d7de5cdaa953c1e2b2f79b5 => $v1a13105b7e4eb5fb2e7c9515ac06aa48) {$this->cloneElement($vf36263a38d7de5cdaa953c1e2b2f79b5, $v7057e8409c7c531a1a6e9ac3df4ed549, true);}}$this->misc_elements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;return $v7057e8409c7c531a1a6e9ac3df4ed549;}else  return false;}}public function getDeletedList() {$v9b207167e5381c47682c6b4f58a623fb = array();$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT id, rel FROM cms3_hierarchy WHERE is_deleted = '1' ORDER BY updatetime DESC
SQL;   $result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vfa816edb83e95bf0c8da580bdfd491ef = array();while(list($vb80bb7740288fda1f201890375a60c8f, $v7ffc4d510260a8544e5550e62ec56bc1) = mysql_fetch_row($result)) {if(array_key_exists($v7ffc4d510260a8544e5550e62ec56bc1, $vfa816edb83e95bf0c8da580bdfd491ef)) {continue;}if(array_key_exists($vb80bb7740288fda1f201890375a60c8f, $v9b207167e5381c47682c6b4f58a623fb)) {unset($v9b207167e5381c47682c6b4f58a623fb[$vfa816edb83e95bf0c8da580bdfd491ef[$vb80bb7740288fda1f201890375a60c8f]]);}$v9b207167e5381c47682c6b4f58a623fb[$vb80bb7740288fda1f201890375a60c8f] = $vb80bb7740288fda1f201890375a60c8f;$vfa816edb83e95bf0c8da580bdfd491ef[$vb80bb7740288fda1f201890375a60c8f] = $v7ffc4d510260a8544e5550e62ec56bc1;}return array_values($v9b207167e5381c47682c6b4f58a623fb);}public function restoreElement($v7057e8409c7c531a1a6e9ac3df4ed549) {$this->disableCache();if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, false, true)) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsDeleted(false);$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v8e2dcfd7e7e24b1ca76c1193f645902b->getAltName());$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE rel = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($vf36263a38d7de5cdaa953c1e2b2f79b5) = mysql_fetch_row($result)) {$v2da0d90fc7822dade6effbdd1f48b458 = $this->getElement($vf36263a38d7de5cdaa953c1e2b2f79b5, true, true);$this->restoreElement($vf36263a38d7de5cdaa953c1e2b2f79b5);}return true;}else return false;}public function removeDeletedElement($v7057e8409c7c531a1a6e9ac3df4ed549) {$this->disableCache();if($v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true, true)) {if($v8e2dcfd7e7e24b1ca76c1193f645902b->getIsDeleted()) {$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vaf31437ce61345f416579830a98c91e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getObjectId();$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE rel = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($vf36263a38d7de5cdaa953c1e2b2f79b5) = mysql_fetch_row($result)) {$v2da0d90fc7822dade6effbdd1f48b458 = $this->getElement($vf36263a38d7de5cdaa953c1e2b2f79b5, true, true);$v2da0d90fc7822dade6effbdd1f48b458->setIsDeleted(true);$this->removeDeletedElement($vf36263a38d7de5cdaa953c1e2b2f79b5);}$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_hierarchy WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' LIMIT 1";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);unset($v8e2dcfd7e7e24b1ca76c1193f645902b);unset($this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549]);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT COUNT(*) FROM cms3_hierarchy WHERE obj_id = '{$vaf31437ce61345f416579830a98c91e5}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a, true);if(list($v4a8a08f09d37b73795649038408b5f33) = mysql_fetch_row($result)) {if($v4a8a08f09d37b73795649038408b5f33 == 0) {$v5891da2d64975cae48d175d1e001f5da->delObject($vaf31437ce61345f416579830a98c91e5);}}$this->earseRelationNodes($v7057e8409c7c531a1a6e9ac3df4ed549);return true;}else return false;}else return false;}public function removeDeletedAll() {$this->disableCache();mysql_query("START TRANSACTION /* umiHierarchy::removeDeletedAll() */");$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE is_deleted = '1'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v7057e8409c7c531a1a6e9ac3df4ed549) = mysql_fetch_row($result)) {$this->removeDeletedElement($v7057e8409c7c531a1a6e9ac3df4ed549);}mysql_query("COMMIT");return true;}public function getParent($v7057e8409c7c531a1a6e9ac3df4ed549) {$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE rel FROM cms3_hierarchy WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(mysql_num_rows($result)) {list($v6be379826b20cc58475f636e33f4606b) = mysql_fetch_row($result);$this->misc_elements[] = $v6be379826b20cc58475f636e33f4606b;return (int) $v6be379826b20cc58475f636e33f4606b;}else {return false;}}public function getAllParents($v7057e8409c7c531a1a6e9ac3df4ed549, $vd0e8988bcdf8745f43ea50ef3e1b54b2 = false, $vece42746c2b3aa1e585809fa739602ae = false) {static $v0fea6a13c52b4d4725368f24b045ca84 = Array();$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vc68ad910ed49ac65f21f1bf2c5dbf912 = array();$v248064bbf6355f96570c9a17b0b1f781 = $vb99eb979e6f6efabc396f777b503f7e7->loadSql('hierarchy_parents');if(is_array($v248064bbf6355f96570c9a17b0b1f781) && sizeof($v248064bbf6355f96570c9a17b0b1f781)) {$v0fea6a13c52b4d4725368f24b045ca84 = $v248064bbf6355f96570c9a17b0b1f781;}if(!$vece42746c2b3aa1e585809fa739602ae && isset($v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549])) {$vc68ad910ed49ac65f21f1bf2c5dbf912 = $v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549];}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT rel_id FROM cms3_hierarchy_relations WHERE child_id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' ORDER BY id";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v6be379826b20cc58475f636e33f4606b) = mysql_fetch_row($result)) {$vc68ad910ed49ac65f21f1bf2c5dbf912[] = (int) $v6be379826b20cc58475f636e33f4606b;}$v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549] = $vc68ad910ed49ac65f21f1bf2c5dbf912;$vb99eb979e6f6efabc396f777b503f7e7->saveSql('hierarchy_parents', $v0fea6a13c52b4d4725368f24b045ca84, 120);}if($vd0e8988bcdf8745f43ea50ef3e1b54b2) {$vc68ad910ed49ac65f21f1bf2c5dbf912[] = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;}return $vc68ad910ed49ac65f21f1bf2c5dbf912;}public function getChilds($v7057e8409c7c531a1a6e9ac3df4ed549, $v69077352f5ac48235305c08dd983bf9f = true, $vbdbeb3b037059befbd5195fe4863ac5e = true, $v12a055bf01a31369fe81ac35d85c7bc1 = 0, $v0715f6d9497f93911417c9c324265771 = false, $v72ee76c5c29383b7c9f9225c1fa4d10b = false) {$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$v69077352f5ac48235305c08dd983bf9f = (int) $v69077352f5ac48235305c08dd983bf9f;$vbdbeb3b037059befbd5195fe4863ac5e = (int) $vbdbeb3b037059befbd5195fe4863ac5e;$v0715f6d9497f93911417c9c324265771 = (int) $v0715f6d9497f93911417c9c324265771;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = ($v72ee76c5c29383b7c9f9225c1fa4d10b) ? $v72ee76c5c29383b7c9f9225c1fa4d10b : $v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain()->getId();$vee90edc893b714c546b99fe996ebd90d = ($v7057e8409c7c531a1a6e9ac3df4ed549 > 0) ? "" : " AND h.domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";$permissions = permissionsCollection::getInstance();$v8e44f0089b076e18a718eb9ca3d94674 = $permissions->getUserId();$ve6f9f41f5312cc3f7302c1a2687fc264 = $permissions->isSv($v8e44f0089b076e18a718eb9ca3d94674);$v5cfe921b204e2c73f8afbec7c4b9ac54 = $permissions->makeSqlWhere($v8e44f0089b076e18a718eb9ca3d94674);$v9b207167e5381c47682c6b4f58a623fb = array();$vc561c84df7b4640190f8290b973108e1 = ($v7057e8409c7c531a1a6e9ac3df4ed549) ? "= '{$v7057e8409c7c531a1a6e9ac3df4ed549}'" : "IS NULL";$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE hr.child_id, h.rel, cp.level FROM cms3_hierarchy_relations hr, cms3_permissions cp, cms3_hierarchy h WHERE hr.rel_id {$vc561c84df7b4640190f8290b973108e1} AND h.id = hr.child_id {$vee90edc893b714c546b99fe996ebd90d} AND h.lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND h.is_deleted = '0'";if($ve6f9f41f5312cc3f7302c1a2687fc264) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE hr.child_id, h.rel, 2 FROM cms3_hierarchy_relations hr, cms3_hierarchy h WHERE hr.rel_id {$vc561c84df7b4640190f8290b973108e1} AND h.id = hr.child_id {$vee90edc893b714c546b99fe996ebd90d} AND h.lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND h.is_deleted = '0'";}if(!$v69077352f5ac48235305c08dd983bf9f) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND h.is_active = '1'";if(!$vbdbeb3b037059befbd5195fe4863ac5e) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND h.is_visible = '1'";if($v0715f6d9497f93911417c9c324265771) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND h.type_id = '{$v0715f6d9497f93911417c9c324265771}'";if(!$ve6f9f41f5312cc3f7302c1a2687fc264) {$vac5c74b64b4b8352ef2f181affb5ac2a .= " AND (cp.rel_id = h.id AND {$v5cfe921b204e2c73f8afbec7c4b9ac54} AND cp.level IN (1, 2))";}if($v12a055bf01a31369fe81ac35d85c7bc1) {if($v7057e8409c7c531a1a6e9ac3df4ed549) {$result = l_mysql_query("SELECT SQL_CACHE level FROM cms3_hierarchy_relations WHERE child_id = {$v7057e8409c7c531a1a6e9ac3df4ed549}");if(mysql_num_rows($result)) {list($vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row($result);++$vc9e9a848920877e76685b2e4e76de38d;}else {return false;}}else {$vc9e9a848920877e76685b2e4e76de38d = $v12a055bf01a31369fe81ac35d85c7bc1;}$vac5c74b64b4b8352ef2f181affb5ac2a .= " AND hr.level <= '{$vc9e9a848920877e76685b2e4e76de38d}'";}$vac5c74b64b4b8352ef2f181affb5ac2a .= " ORDER BY hr.level, h.ord";if($v9b207167e5381c47682c6b4f58a623fb = $vb99eb979e6f6efabc396f777b503f7e7->loadSql($vac5c74b64b4b8352ef2f181affb5ac2a)) {foreach($v9b207167e5381c47682c6b4f58a623fb[1] as $v7552cd149af7495ee7d8225974e50f80 => $vc9e9a848920877e76685b2e4e76de38d) {$permissions->pushElementPermissions($v7552cd149af7495ee7d8225974e50f80, $vc9e9a848920877e76685b2e4e76de38d);}return $v9b207167e5381c47682c6b4f58a623fb[0];}$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vd22bbd30e009c5a782250725e19d22f2 = $v4051c8368d6b69eca174681d8daf0bf1 = $v9b207167e5381c47682c6b4f58a623fb = array();while(list($vf36263a38d7de5cdaa953c1e2b2f79b5, $vd5d4bb9b2c282937ee64b1fb0495ef08, $vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row($result)) {$permissions->pushElementPermissions($vf36263a38d7de5cdaa953c1e2b2f79b5, $vc9e9a848920877e76685b2e4e76de38d);$vd22bbd30e009c5a782250725e19d22f2[$vf36263a38d7de5cdaa953c1e2b2f79b5] = array();if($vd5d4bb9b2c282937ee64b1fb0495ef08 == $v7057e8409c7c531a1a6e9ac3df4ed549) {$v9b207167e5381c47682c6b4f58a623fb[$vf36263a38d7de5cdaa953c1e2b2f79b5] = &$vd22bbd30e009c5a782250725e19d22f2[$vf36263a38d7de5cdaa953c1e2b2f79b5];}if(isset($vd22bbd30e009c5a782250725e19d22f2[$vd5d4bb9b2c282937ee64b1fb0495ef08])) {$vd22bbd30e009c5a782250725e19d22f2[$vd5d4bb9b2c282937ee64b1fb0495ef08][$vf36263a38d7de5cdaa953c1e2b2f79b5] = &$vd22bbd30e009c5a782250725e19d22f2[$vf36263a38d7de5cdaa953c1e2b2f79b5];}$v4051c8368d6b69eca174681d8daf0bf1[$vf36263a38d7de5cdaa953c1e2b2f79b5] = $vc9e9a848920877e76685b2e4e76de38d;}$vb99eb979e6f6efabc396f777b503f7e7->saveSql($vac5c74b64b4b8352ef2f181affb5ac2a, array($v9b207167e5381c47682c6b4f58a623fb, $v4051c8368d6b69eca174681d8daf0bf1), 60);return $v9b207167e5381c47682c6b4f58a623fb;}public function getChildsCount($v7057e8409c7c531a1a6e9ac3df4ed549, $v69077352f5ac48235305c08dd983bf9f = true, $vbdbeb3b037059befbd5195fe4863ac5e = true, $v12a055bf01a31369fe81ac35d85c7bc1 = 0, $v0715f6d9497f93911417c9c324265771 = false, $v72ee76c5c29383b7c9f9225c1fa4d10b = false) {$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$v69077352f5ac48235305c08dd983bf9f = (int) $v69077352f5ac48235305c08dd983bf9f;$vbdbeb3b037059befbd5195fe4863ac5e = (int) $vbdbeb3b037059befbd5195fe4863ac5e;$v0715f6d9497f93911417c9c324265771 = (int) $v0715f6d9497f93911417c9c324265771;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = ($v72ee76c5c29383b7c9f9225c1fa4d10b) ? $v72ee76c5c29383b7c9f9225c1fa4d10b : cmsController::getInstance()->getCurrentDomain()->getId();if($v7057e8409c7c531a1a6e9ac3df4ed549) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement) {$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getLangId();$v662cbf1253ac7d8750ed9190c52163e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId();}}$vee90edc893b714c546b99fe996ebd90d = ($v7057e8409c7c531a1a6e9ac3df4ed549 > 0) ? "" : " AND h.domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";$v9b207167e5381c47682c6b4f58a623fb = array();$vc561c84df7b4640190f8290b973108e1 = ($v7057e8409c7c531a1a6e9ac3df4ed549) ? "= '{$v7057e8409c7c531a1a6e9ac3df4ed549}'" : "IS NULL";$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE COUNT(hr.child_id) FROM cms3_hierarchy_relations hr, cms3_hierarchy h WHERE hr.rel_id {$vc561c84df7b4640190f8290b973108e1} AND h.id = hr.child_id {$vee90edc893b714c546b99fe996ebd90d} AND h.lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND h.is_deleted = '0'";if(!$v69077352f5ac48235305c08dd983bf9f) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND h.is_active = '1'";if(!$vbdbeb3b037059befbd5195fe4863ac5e) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND h.is_visible = '1'";if($v0715f6d9497f93911417c9c324265771) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND h.type_id = '{$v0715f6d9497f93911417c9c324265771}'";if($v12a055bf01a31369fe81ac35d85c7bc1) {if($v7057e8409c7c531a1a6e9ac3df4ed549) {list($vc9e9a848920877e76685b2e4e76de38d) = mysql_fetch_row(l_mysql_query("SELECT level FROM cms3_hierarchy_relations WHERE child_id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'"));$vc9e9a848920877e76685b2e4e76de38d = $v12a055bf01a31369fe81ac35d85c7bc1 + $vc9e9a848920877e76685b2e4e76de38d;}else {$vc9e9a848920877e76685b2e4e76de38d = 1;}$vac5c74b64b4b8352ef2f181affb5ac2a .= " AND hr.level <= '{$vc9e9a848920877e76685b2e4e76de38d}'";}$vac5c74b64b4b8352ef2f181affb5ac2a .= " ORDER BY hr.level, h.ord";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(mysql_num_rows($result)) {list($ve2942a04780e223b215eb8b663cf5353) = mysql_fetch_row($result);return $ve2942a04780e223b215eb8b663cf5353;}else {return false;}}public function forceAbsolutePath($vf9448cc5666e281bc210298b60567801 = true) {$v8123ef13520d88a438e469cc8a7ab63b = $this->bForceAbsolutePath;$this->bForceAbsolutePath = (bool) $vf9448cc5666e281bc210298b60567801;return $v8123ef13520d88a438e469cc8a7ab63b;}public function getPathById($v7057e8409c7c531a1a6e9ac3df4ed549, $v5cd943c36b800237522c35155d898244 = false, $vbc9ecd0be77ceffa51fc6918c714e5d3 = false, $vece42746c2b3aa1e585809fa739602ae = false) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;if(!$vece42746c2b3aa1e585809fa739602ae && isset($v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549 . $v5cd943c36b800237522c35155d898244 . $this->bForceAbsolutePath])) return $v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549 . $v5cd943c36b800237522c35155d898244 . $this->bForceAbsolutePath];$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$ve4e46deb7f9cc58c7abfb32e5570b6f3 = domainsCollection::getInstance();$v5a05866850c28651fe234659f6c92ada = langsCollection::getInstance();$v25173eac47bcd1aa0bb3a146f0595bb7 = $v8b1dc169bf460ee884fceef66c6607d6->pre_lang;if($v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true)) {$v263deaa64d2e600bed1b85f3303f608e = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain();$v3c2d776e82f7716166c1c2183822a04b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId();if(!$this->bForceAbsolutePath && $v263deaa64d2e600bed1b85f3303f608e->getId() == $v3c2d776e82f7716166c1c2183822a04b) {$v37540249ba8b3080e8092c62b08e7d4d = "";}else {$v37540249ba8b3080e8092c62b08e7d4d = "http://" . $ve4e46deb7f9cc58c7abfb32e5570b6f3->getDomain($v3c2d776e82f7716166c1c2183822a04b)->getHost();}$vfb479516754f41871773a666a31026c4 = intval($v8e2dcfd7e7e24b1ca76c1193f645902b->getLangId());$va51d26dd5a799dd184b4093d8cfb8d1b = $v5a05866850c28651fe234659f6c92ada->getLang($vfb479516754f41871773a666a31026c4);$v795e772d23c3965d128d13aa8ee3e1f4 = ($vfb479516754f41871773a666a31026c4 === intval($v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain()->getDefaultLangId()));if(!$va51d26dd5a799dd184b4093d8cfb8d1b || $v795e772d23c3965d128d13aa8ee3e1f4 || $v5cd943c36b800237522c35155d898244 == true) {$v5a6e3be618e0347ab0766b23ec68d7fc = "";}else {$v5a6e3be618e0347ab0766b23ec68d7fc = "/" . $va51d26dd5a799dd184b4093d8cfb8d1b->getPrefix();}if($v8e2dcfd7e7e24b1ca76c1193f645902b->getIsDefault() && !$vbc9ecd0be77ceffa51fc6918c714e5d3) {return $v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549 . $v5cd943c36b800237522c35155d898244 . $this->bForceAbsolutePath] = $v37540249ba8b3080e8092c62b08e7d4d . $v5a6e3be618e0347ab0766b23ec68d7fc . "/";}}else {return $v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549 . $v5cd943c36b800237522c35155d898244 . $this->bForceAbsolutePath] = "";}if($vc68ad910ed49ac65f21f1bf2c5dbf912 = $this->getAllParents($v7057e8409c7c531a1a6e9ac3df4ed549, false, $vece42746c2b3aa1e585809fa739602ae)) {$vd6fe1d0be6347b8ef2427fa629c04485 = $v37540249ba8b3080e8092c62b08e7d4d . $v5a6e3be618e0347ab0766b23ec68d7fc;$vc68ad910ed49ac65f21f1bf2c5dbf912[] = $v7057e8409c7c531a1a6e9ac3df4ed549;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id, alt_name FROM cms3_hierarchy WHERE id IN (" . implode(", ", $vc68ad910ed49ac65f21f1bf2c5dbf912) . ")";$vd2bdf98f906ac8b3f641d40000c97caa = !$vece42746c2b3aa1e585809fa739602ae ? $vb99eb979e6f6efabc396f777b503f7e7->loadSql($vac5c74b64b4b8352ef2f181affb5ac2a) : null;if(!is_array($vd2bdf98f906ac8b3f641d40000c97caa)) {$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vd2bdf98f906ac8b3f641d40000c97caa = array();while(list($vb80bb7740288fda1f201890375a60c8f, $v0330da281541887f65b0a60066351c91) = mysql_fetch_row($result)) {$vd2bdf98f906ac8b3f641d40000c97caa[$vb80bb7740288fda1f201890375a60c8f] = $v0330da281541887f65b0a60066351c91;}$vb99eb979e6f6efabc396f777b503f7e7->saveSql($vac5c74b64b4b8352ef2f181affb5ac2a, $vd2bdf98f906ac8b3f641d40000c97caa, 600);}$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($vc68ad910ed49ac65f21f1bf2c5dbf912);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {if(!$vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741]) continue;if(isset($vd2bdf98f906ac8b3f641d40000c97caa[$vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741]])) {$vd6fe1d0be6347b8ef2427fa629c04485 .= "/" . $vd2bdf98f906ac8b3f641d40000c97caa[$vc68ad910ed49ac65f21f1bf2c5dbf912[$v865c0c0b4ab0e063e5caa3387c1a8741]];}}$vd6fe1d0be6347b8ef2427fa629c04485 .= "/";return $v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549 . $v5cd943c36b800237522c35155d898244 . $this->bForceAbsolutePath] = $vd6fe1d0be6347b8ef2427fa629c04485;}else {return $v0fea6a13c52b4d4725368f24b045ca84[$v7057e8409c7c531a1a6e9ac3df4ed549 . $v5cd943c36b800237522c35155d898244 . $this->bForceAbsolutePath] = false;}}public function getIdByPath($v84d8c2148d233e7430fceb3f20ae3314, $vda936bf93b2dd512e0554fd9eb7b4120 = false, &$v3dbd53d892aaea70c9f5fefc18fc7e4c = 0) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();$ve4e46deb7f9cc58c7abfb32e5570b6f3 = domainsCollection::getInstance();if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v84d8c2148d233e7430fceb3f20ae3314])) return $v0fea6a13c52b4d4725368f24b045ca84[$v84d8c2148d233e7430fceb3f20ae3314];if($vb80bb7740288fda1f201890375a60c8f = $vb99eb979e6f6efabc396f777b503f7e7->loadSql($v84d8c2148d233e7430fceb3f20ae3314 . "_path")) {return $vb80bb7740288fda1f201890375a60c8f;}if($v84d8c2148d233e7430fceb3f20ae3314 == "/") {return $v0fea6a13c52b4d4725368f24b045ca84[$v84d8c2148d233e7430fceb3f20ae3314] = $this->getDefaultElementId();}$v84d8c2148d233e7430fceb3f20ae3314 = trim($v84d8c2148d233e7430fceb3f20ae3314, "\/ \n");$v13872c0118a4316afd1e99295017d654 = split("/", $v84d8c2148d233e7430fceb3f20ae3314);$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain()->getId();$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($v13872c0118a4316afd1e99295017d654);$vb80bb7740288fda1f201890375a60c8f = 0;for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vd84ff935144e00c3e1d395c2379aca47 = $v13872c0118a4316afd1e99295017d654[$v865c0c0b4ab0e063e5caa3387c1a8741];$vd84ff935144e00c3e1d395c2379aca47 = l_mysql_real_escape_string($vd84ff935144e00c3e1d395c2379aca47);if($v865c0c0b4ab0e063e5caa3387c1a8741 == 0) {if($v3c2d776e82f7716166c1c2183822a04b = $ve4e46deb7f9cc58c7abfb32e5570b6f3->getDomainId($vd84ff935144e00c3e1d395c2379aca47)) {$v662cbf1253ac7d8750ed9190c52163e5 = $v3c2d776e82f7716166c1c2183822a04b;continue;}}if($vda936bf93b2dd512e0554fd9eb7b4120) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id FROM cms3_hierarchy WHERE rel = '{$vb80bb7740288fda1f201890375a60c8f}' AND alt_name = '{$vd84ff935144e00c3e1d395c2379aca47}' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id FROM cms3_hierarchy WHERE rel = '{$vb80bb7740288fda1f201890375a60c8f}' AND alt_name = '{$vd84ff935144e00c3e1d395c2379aca47}' AND is_active='1' AND is_deleted = '0' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";}$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(!mysql_num_rows($result)) {if($vda936bf93b2dd512e0554fd9eb7b4120) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id, alt_name FROM cms3_hierarchy WHERE rel = '{$vb80bb7740288fda1f201890375a60c8f}' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id, alt_name FROM cms3_hierarchy WHERE rel = '{$vb80bb7740288fda1f201890375a60c8f}' AND is_active = '1' AND is_deleted = '0' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";}$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v2ffe4e77325d9a7152f7086ea7aa5114 = 0;$vb6b6e66c9db093b3c4c8800ac9365830 = 0;$v1a1cc17b4341344c0ceec516de628da3 = 0;while(list($vb6b6e66c9db093b3c4c8800ac9365830, $v423b21e5932f11b123a1ddb35654b51b) = mysql_fetch_row($result)) {if($this->autocorrectionDisabled) {if($vd84ff935144e00c3e1d395c2379aca47 == $v423b21e5932f11b123a1ddb35654b51b) {$v1a1cc17b4341344c0ceec516de628da3 = $vb6b6e66c9db093b3c4c8800ac9365830;}}else {$v3d801aa532c1cec3ee82d87a99fdf63f = umiHierarchy::compareStrings($vd84ff935144e00c3e1d395c2379aca47, $v423b21e5932f11b123a1ddb35654b51b);if($v3d801aa532c1cec3ee82d87a99fdf63f > $v2ffe4e77325d9a7152f7086ea7aa5114) {$v2ffe4e77325d9a7152f7086ea7aa5114 = $v3d801aa532c1cec3ee82d87a99fdf63f;$v1a1cc17b4341344c0ceec516de628da3 = $vb6b6e66c9db093b3c4c8800ac9365830;++$v3dbd53d892aaea70c9f5fefc18fc7e4c;}}}if($v2ffe4e77325d9a7152f7086ea7aa5114 > 75) {$vb80bb7740288fda1f201890375a60c8f = $v1a1cc17b4341344c0ceec516de628da3;}else {return $v0fea6a13c52b4d4725368f24b045ca84[$v84d8c2148d233e7430fceb3f20ae3314] = false;}}else {if(!(list($vb80bb7740288fda1f201890375a60c8f) = mysql_fetch_row($result))) {return $v0fea6a13c52b4d4725368f24b045ca84[$v84d8c2148d233e7430fceb3f20ae3314] = false;}}}$vb99eb979e6f6efabc396f777b503f7e7->saveSql($v84d8c2148d233e7430fceb3f20ae3314 . "_path", $vb80bb7740288fda1f201890375a60c8f, 3600);return $v0fea6a13c52b4d4725368f24b045ca84[$v84d8c2148d233e7430fceb3f20ae3314] = $vb80bb7740288fda1f201890375a60c8f;}public function addElement($vd5d4bb9b2c282937ee64b1fb0495ef08, $v0715f6d9497f93911417c9c324265771, $vb068931cc450442b63f5b3d276ea4297, $vd84ff935144e00c3e1d395c2379aca47, $v94757cae63fd3e398c0811a976dd6bbe = false, $v662cbf1253ac7d8750ed9190c52163e5 = false, $v78e6dd7a49f5b0cb2106a3a434dd5c86 = false, $vd02e12eb6d6c3f6ebd763197df01e211 = false) {$this->disableCache();if($v94757cae63fd3e398c0811a976dd6bbe === false) {if($vb946c44d711ade3b061653732977d043 = umiHierarchyTypesCollection::getInstance()->getType($v0715f6d9497f93911417c9c324265771)) {$v94757cae63fd3e398c0811a976dd6bbe = umiObjectTypesCollection::getInstance()->getBaseType($vb946c44d711ade3b061653732977d043->getName(), $vb946c44d711ade3b061653732977d043->getExt());if(!$v94757cae63fd3e398c0811a976dd6bbe) {throw new coreException("There is no base object type for hierarchy type #{$v0715f6d9497f93911417c9c324265771}");return false;}}else {throw new coreException("Wrong hierarchy type id given");return false;}}$vd0e45878043844ffc41aac437e86b602 = null;if($v662cbf1253ac7d8750ed9190c52163e5 === false) {if($vd5d4bb9b2c282937ee64b1fb0495ef08 == 0) {$v662cbf1253ac7d8750ed9190c52163e5 = cmsController::getInstance()->getCurrentDomain()->getId();}else {$vd0e45878043844ffc41aac437e86b602 = $this->getElement($vd5d4bb9b2c282937ee64b1fb0495ef08, true, true);$v662cbf1253ac7d8750ed9190c52163e5 = $vd0e45878043844ffc41aac437e86b602->getDomainId();}}if($v78e6dd7a49f5b0cb2106a3a434dd5c86 === false) {if($vd5d4bb9b2c282937ee64b1fb0495ef08 == 0) {$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();}else {if(!$vd0e45878043844ffc41aac437e86b602) $vd0e45878043844ffc41aac437e86b602 = $this->getElement($vd5d4bb9b2c282937ee64b1fb0495ef08, true, true);$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $vd0e45878043844ffc41aac437e86b602->getLangId();}}if($vd02e12eb6d6c3f6ebd763197df01e211 === false) {$vd02e12eb6d6c3f6ebd763197df01e211 = $this->getDominantTplId($vd5d4bb9b2c282937ee64b1fb0495ef08);if(!$vd02e12eb6d6c3f6ebd763197df01e211) {$vd02e12eb6d6c3f6ebd763197df01e211 = templatesCollection::getInstance()->getDefaultTemplate($v662cbf1253ac7d8750ed9190c52163e5, $v78e6dd7a49f5b0cb2106a3a434dd5c86)->getId();}}if($vd5d4bb9b2c282937ee64b1fb0495ef08) {$this->addUpdatedElementId($vd5d4bb9b2c282937ee64b1fb0495ef08);}else {$this->addUpdatedElementId($this->getDefaultElementId());}if($vaf31437ce61345f416579830a98c91e5 = $this->objects->addObject($vb068931cc450442b63f5b3d276ea4297, $v94757cae63fd3e398c0811a976dd6bbe)) {$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_hierarchy (rel, type_id, domain_id, lang_id, tpl_id, obj_id) VALUES('{$vd5d4bb9b2c282937ee64b1fb0495ef08}', '{$v0715f6d9497f93911417c9c324265771}', '{$v662cbf1253ac7d8750ed9190c52163e5}', '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}', '{$vd02e12eb6d6c3f6ebd763197df01e211}', '{$vaf31437ce61345f416579830a98c91e5}')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v7057e8409c7c531a1a6e9ac3df4ed549 = mysql_insert_id();$v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true);$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($vd84ff935144e00c3e1d395c2379aca47);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT MAX(ord) FROM cms3_hierarchy WHERE rel = '{$vd5d4bb9b2c282937ee64b1fb0495ef08}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(list($v8bef1cc20ada3bef55fdf132cb2a1cb9) = mysql_fetch_row($result)) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setOrd( ($v8bef1cc20ada3bef55fdf132cb2a1cb9 + 1) );}$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549] = $v8e2dcfd7e7e24b1ca76c1193f645902b;$this->addUpdatedElementId($vd5d4bb9b2c282937ee64b1fb0495ef08);$this->addUpdatedElementId($v7057e8409c7c531a1a6e9ac3df4ed549);if($vd5d4bb9b2c282937ee64b1fb0495ef08) {$vc975d8201fe751ebb3429336eeee7d3b = $this->getElement($vd5d4bb9b2c282937ee64b1fb0495ef08);if($vc975d8201fe751ebb3429336eeee7d3b instanceof umiHierarchyElement) {$vd011f21d73bbed77facded50f36b9e7d = $this->getObjectInstances($vc975d8201fe751ebb3429336eeee7d3b->getObject()->getId());if(sizeof($vd011f21d73bbed77facded50f36b9e7d) > 1) {foreach($vd011f21d73bbed77facded50f36b9e7d as $v249d9032fd2c81de7f755fc06b1c397a) {if($v249d9032fd2c81de7f755fc06b1c397a == $vd5d4bb9b2c282937ee64b1fb0495ef08) continue;$this->symlinks[] = array($v7057e8409c7c531a1a6e9ac3df4ed549, $v249d9032fd2c81de7f755fc06b1c397a);}}}}$this->misc_elements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;$this->buildRelationNewNodes($v7057e8409c7c531a1a6e9ac3df4ed549);return $v7057e8409c7c531a1a6e9ac3df4ed549;}else {throw new coreException("Failed to create new object for hierarchy element");return false;}}public function getDefaultElementId($v78e6dd7a49f5b0cb2106a3a434dd5c86 = false, $v662cbf1253ac7d8750ed9190c52163e5 = false) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();$vb99eb979e6f6efabc396f777b503f7e7 = cacheFrontend::getInstance();$v8b1dc169bf460ee884fceef66c6607d6 = cmsController::getInstance();if(empty($v0fea6a13c52b4d4725368f24b045ca84)) {$v248064bbf6355f96570c9a17b0b1f781 = $vb99eb979e6f6efabc396f777b503f7e7->loadData('default_pages');if(is_array($v248064bbf6355f96570c9a17b0b1f781)) {$v0fea6a13c52b4d4725368f24b045ca84 = $v248064bbf6355f96570c9a17b0b1f781;}}if($v78e6dd7a49f5b0cb2106a3a434dd5c86 === false) $v78e6dd7a49f5b0cb2106a3a434dd5c86 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentLang()->getId();if($v662cbf1253ac7d8750ed9190c52163e5 === false) $v662cbf1253ac7d8750ed9190c52163e5 = $v8b1dc169bf460ee884fceef66c6607d6->getCurrentDomain()->getId();if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v78e6dd7a49f5b0cb2106a3a434dd5c86][$v662cbf1253ac7d8750ed9190c52163e5])) {return $v0fea6a13c52b4d4725368f24b045ca84[$v78e6dd7a49f5b0cb2106a3a434dd5c86][$v662cbf1253ac7d8750ed9190c52163e5];}$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id FROM cms3_hierarchy WHERE is_default = '1' AND is_deleted='0' AND is_active='1' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(list($v7057e8409c7c531a1a6e9ac3df4ed549) = mysql_fetch_row($result)) {$v0fea6a13c52b4d4725368f24b045ca84[$v78e6dd7a49f5b0cb2106a3a434dd5c86][$v662cbf1253ac7d8750ed9190c52163e5] = $v7057e8409c7c531a1a6e9ac3df4ed549;$vb99eb979e6f6efabc396f777b503f7e7->saveData('default_pages', $v0fea6a13c52b4d4725368f24b045ca84, 3600);return $v0fea6a13c52b4d4725368f24b045ca84[$v78e6dd7a49f5b0cb2106a3a434dd5c86][$v662cbf1253ac7d8750ed9190c52163e5];}else {return false;}}public static function compareStrings($vd7b5808c3f443eb5a496225468c7e4a5, $v6dc84905d6df841d6f19153bd593e213) {return 100 * (    similar_text($vd7b5808c3f443eb5a496225468c7e4a5, $v6dc84905d6df841d6f19153bd593e213) / (     (strlen($vd7b5808c3f443eb5a496225468c7e4a5) + strlen($v6dc84905d6df841d6f19153bd593e213))    / 2)   );}public static function convertAltName($vd84ff935144e00c3e1d395c2379aca47) {$vd84ff935144e00c3e1d395c2379aca47 = translit::convert($vd84ff935144e00c3e1d395c2379aca47);$vd84ff935144e00c3e1d395c2379aca47 = preg_replace("/[\?\\\\&=]+/", "_", $vd84ff935144e00c3e1d395c2379aca47);$vd84ff935144e00c3e1d395c2379aca47 = preg_replace("/[_\/]+/", "_", $vd84ff935144e00c3e1d395c2379aca47);return $vd84ff935144e00c3e1d395c2379aca47;}public static function getTimeStamp() {return time();}public function moveBefore($v7057e8409c7c531a1a6e9ac3df4ed549, $vd5d4bb9b2c282937ee64b1fb0495ef08, $v37b7e5e846e31d9da322c6e743ce3b3c = false) {$this->disableCache();if(!$this->isExists($v7057e8409c7c531a1a6e9ac3df4ed549)) return false;$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v78e6dd7a49f5b0cb2106a3a434dd5c86 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getLangId();$v662cbf1253ac7d8750ed9190c52163e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getDomainId();$v41a1470180f8488ba6040c5ff7dc6833 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getRel();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vd5d4bb9b2c282937ee64b1fb0495ef08 = (int) $vd5d4bb9b2c282937ee64b1fb0495ef08;$v8e2dcfd7e7e24b1ca76c1193f645902b->setRel($vd5d4bb9b2c282937ee64b1fb0495ef08);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$v46a8df3f1b0f374830be2497076b9446 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getTplId();$v3568678a69e0e639e9c3163b2d10ceba = templatesCollection::getInstance()->getTemplatesList($v662cbf1253ac7d8750ed9190c52163e5, $v78e6dd7a49f5b0cb2106a3a434dd5c86);$vf07440bfac87b2aa38a59a0109b6cd38 = true;foreach($v3568678a69e0e639e9c3163b2d10ceba as $vcfc7e0dcf6883d635b928f1e31f7694d) {if ($vcfc7e0dcf6883d635b928f1e31f7694d->getId() == $v46a8df3f1b0f374830be2497076b9446) {$vf07440bfac87b2aa38a59a0109b6cd38 = false;break;}}if ($vf07440bfac87b2aa38a59a0109b6cd38) {$v84b4de448609c5297d79dbec08101fbd = templatesCollection::getInstance()->getDefaultTemplate($v662cbf1253ac7d8750ed9190c52163e5, $v78e6dd7a49f5b0cb2106a3a434dd5c86);if ($v84b4de448609c5297d79dbec08101fbd) {$v8c3112e89e491f40ed057b32883c646c = $v84b4de448609c5297d79dbec08101fbd->getId();$v770c309c1aed0fbfabad24a3d5933129 = new umiSelection;$v770c309c1aed0fbfabad24a3d5933129->addHierarchyFilter($v7057e8409c7c531a1a6e9ac3df4ed549, 100);$v4650086681d0c3d7660463e94b1156a5 = umiSelectionsParser::runSelection($v770c309c1aed0fbfabad24a3d5933129);$v4650086681d0c3d7660463e94b1156a5[] = $v7057e8409c7c531a1a6e9ac3df4ed549;$v18e7588ee516318bc8ae9c8c0ff7c917 = implode(",", $v4650086681d0c3d7660463e94b1156a5);$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_hierarchy SET tpl_id = '{$v8c3112e89e491f40ed057b32883c646c}' WHERE id IN (".$v18e7588ee516318bc8ae9c8c0ff7c917.")";}}if($v37b7e5e846e31d9da322c6e743ce3b3c) {$v37b7e5e846e31d9da322c6e743ce3b3c = (int) $v37b7e5e846e31d9da322c6e743ce3b3c;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT ord FROM cms3_hierarchy WHERE id = '{$v37b7e5e846e31d9da322c6e743ce3b3c}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a, true);if(list($v8bef1cc20ada3bef55fdf132cb2a1cb9) = mysql_fetch_row($result)) {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_hierarchy SET ord = (ord + 1) WHERE rel = '{$vd5d4bb9b2c282937ee64b1fb0495ef08}' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}' AND ord >= {$v8bef1cc20ada3bef55fdf132cb2a1cb9}";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_hierarchy SET ord = '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}', rel = '{$vd5d4bb9b2c282937ee64b1fb0495ef08}' WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$this->rewriteElementAltName($v7057e8409c7c531a1a6e9ac3df4ed549);$this->rebuildRelationNodes($v7057e8409c7c531a1a6e9ac3df4ed549);return true;}else return false;}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT MAX(ord) FROM cms3_hierarchy WHERE rel = '{$vd5d4bb9b2c282937ee64b1fb0495ef08}' AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(list($v8bef1cc20ada3bef55fdf132cb2a1cb9) = mysql_fetch_row($result)) {++$v8bef1cc20ada3bef55fdf132cb2a1cb9;}else {$v8bef1cc20ada3bef55fdf132cb2a1cb9 = 1;}$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_hierarchy SET ord = '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}', rel = '{$vd5d4bb9b2c282937ee64b1fb0495ef08}' WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$this->rewriteElementAltName($v7057e8409c7c531a1a6e9ac3df4ed549);$this->rebuildRelationNodes($v7057e8409c7c531a1a6e9ac3df4ed549);return true;}}public function moveFirst($v7057e8409c7c531a1a6e9ac3df4ed549, $vd5d4bb9b2c282937ee64b1fb0495ef08) {$this->disableCache();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vd5d4bb9b2c282937ee64b1fb0495ef08 = (int) $vd5d4bb9b2c282937ee64b1fb0495ef08;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE rel = '{$vd5d4bb9b2c282937ee64b1fb0495ef08}' ORDER BY ord ASC";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a, true);list($v37b7e5e846e31d9da322c6e743ce3b3c) = mysql_fetch_row($result);return $this->moveBefore($v7057e8409c7c531a1a6e9ac3df4ed549, $vd5d4bb9b2c282937ee64b1fb0495ef08, $v37b7e5e846e31d9da322c6e743ce3b3c);}protected function isAllowed($v7552cd149af7495ee7d8225974e50f80) {$permissions = permissionsCollection::getInstance();list($v4b43b0aee35624cd95b910189b3dc231) = $permissions->isAllowedObject($permissions->getUserId(), $v7552cd149af7495ee7d8225974e50f80);return $v4b43b0aee35624cd95b910189b3dc231;}public function getDominantTypeId($v7057e8409c7c531a1a6e9ac3df4ed549, $v12a055bf01a31369fe81ac35d85c7bc1 = 1) {if($this->isExists($v7057e8409c7c531a1a6e9ac3df4ed549) || $v7057e8409c7c531a1a6e9ac3df4ed549 === 0) {$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = cmsController::getInstance()->getCurrentDomain()->getId();$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$v12a055bf01a31369fe81ac35d85c7bc1      = (int) $v12a055bf01a31369fe81ac35d85c7bc1;if($v12a055bf01a31369fe81ac35d85c7bc1 > 1) {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT o.type_id, COUNT(*) AS c
	FROM cms3_hierarchy h, cms3_objects o, cms3_hierarchy_relations hr
		WHERE hr.rel_id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' AND h.id=hr.child_id AND h.is_deleted = '0' AND o.id = h.obj_id AND h.lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND h.domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'
			GROUP BY o.type_id
				ORDER BY c DESC
					LIMIT 1
SQL;    }else {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT o.type_id, COUNT(*) AS c
	FROM cms3_hierarchy h, cms3_objects o
		WHERE h.rel = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' AND h.is_deleted = '0' AND o.id = h.obj_id AND h.lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}' AND h.domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'
			GROUP BY o.type_id
				ORDER BY c DESC
					LIMIT 1
SQL;    }if($v94757cae63fd3e398c0811a976dd6bbe = (int) cacheFrontend::getInstance()->loadSql($vac5c74b64b4b8352ef2f181affb5ac2a)) {return $v94757cae63fd3e398c0811a976dd6bbe;}$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(mysql_num_rows($result)) {list($v94757cae63fd3e398c0811a976dd6bbe) = mysql_fetch_row($result);$v94757cae63fd3e398c0811a976dd6bbe = (int) $v94757cae63fd3e398c0811a976dd6bbe;cacheFrontend::getInstance()->saveSql($vac5c74b64b4b8352ef2f181affb5ac2a, $v94757cae63fd3e398c0811a976dd6bbe);return $v94757cae63fd3e398c0811a976dd6bbe;}else {return NULL;}}else {return false;}}public function addUpdatedElementId($v7057e8409c7c531a1a6e9ac3df4ed549) {if(!in_array($v7057e8409c7c531a1a6e9ac3df4ed549, $this->updatedElements)) {$this->updatedElements[] = $v7057e8409c7c531a1a6e9ac3df4ed549;}}public function getUpdatedElements() {return $this->updatedElements;}protected function forceCacheCleanup() {if(sizeof($this->updatedElements)) {if(function_exists("deleteElementsRelatedPages")) {deleteElementsRelatedPages();}}}public function __destruct() {if(defined('SMU_PROCESS') && SMU_PROCESS) {return;}$this->forceCacheCleanup();if(sizeof($this->symlinks)) {foreach($this->symlinks as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v47c80780ab608cc046f2a6e6f071feb6) {list($v7057e8409c7c531a1a6e9ac3df4ed549, $va473047c73202ee9a9ff3648c5aab351) = $v47c80780ab608cc046f2a6e6f071feb6;$this->copyElement($v7057e8409c7c531a1a6e9ac3df4ed549, $va473047c73202ee9a9ff3648c5aab351);unset($this->symlinks[$v865c0c0b4ab0e063e5caa3387c1a8741]);}$this->symlinks = Array();}if(class_exists('staticCache')) {$v805e6b8e623f5dd06f99f55e55230cca = new staticCache;$v805e6b8e623f5dd06f99f55e55230cca->cleanup();unset($v805e6b8e623f5dd06f99f55e55230cca);}}public function getCollectedElements() {return array_merge(array_keys($this->elements), $this->misc_elements);}public function unloadElement($v7057e8409c7c531a1a6e9ac3df4ed549) {static $v0db3209e1adc6d67be435a81baf9a66e;if($v0db3209e1adc6d67be435a81baf9a66e === NULL) {$v0db3209e1adc6d67be435a81baf9a66e = cmsController::getInstance()->getCurrentElementId();}if($v0db3209e1adc6d67be435a81baf9a66e == $v7057e8409c7c531a1a6e9ac3df4ed549) return false;if(array_key_exists($v7057e8409c7c531a1a6e9ac3df4ed549, $this->elements)) {unset($this->elements[$v7057e8409c7c531a1a6e9ac3df4ed549]);}else {return false;}}public function getElementsCount($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce = "") {$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName($v22884db148f0ffb0d830ba431102b0b5, $vea9f6aca279138c58f705c8d4cb4b8ce)->getId();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT COUNT(*) FROM cms3_hierarchy WHERE type_id = '{$v0715f6d9497f93911417c9c324265771}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(list($ve2942a04780e223b215eb8b663cf5353) = mysql_fetch_row($result)) {return $ve2942a04780e223b215eb8b663cf5353;}else {return false;}}private function pushElementsLastUpdateTime($ve0df5a999da22bc6fa9e26b115eb4ae4 = 0) {if($ve0df5a999da22bc6fa9e26b115eb4ae4 > $this->elementsLastUpdateTime) {$this->elementsLastUpdateTime = $ve0df5a999da22bc6fa9e26b115eb4ae4;}}public function getElementsLastUpdateTime() {return $this->elementsLastUpdateTime;}public function getObjectInstances($vaf31437ce61345f416579830a98c91e5, $vfc9bd216c399e5612672290fa3f0cbe2 = false, $v1200c36ada21fb70df10f131f49eaf3d = false) {$vaf31437ce61345f416579830a98c91e5 = (int) $vaf31437ce61345f416579830a98c91e5;$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = cmsController::getInstance()->getCurrentDomain()->getId();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE obj_id = '{$vaf31437ce61345f416579830a98c91e5}'";if(!$vfc9bd216c399e5612672290fa3f0cbe2) $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND domain_id = '{$v662cbf1253ac7d8750ed9190c52163e5}'";if(!$v1200c36ada21fb70df10f131f49eaf3d)   $vac5c74b64b4b8352ef2f181affb5ac2a .= " AND lang_id = '{$v78e6dd7a49f5b0cb2106a3a434dd5c86}'" ;$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v9b207167e5381c47682c6b4f58a623fb = array();while(list($v7057e8409c7c531a1a6e9ac3df4ed549) = mysql_fetch_row($result)) {$v9b207167e5381c47682c6b4f58a623fb[] = $v7057e8409c7c531a1a6e9ac3df4ed549;}return $v9b207167e5381c47682c6b4f58a623fb;}public function getDominantTplId($v7552cd149af7495ee7d8225974e50f80) {$v7552cd149af7495ee7d8225974e50f80 = (int) $v7552cd149af7495ee7d8225974e50f80;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT `tpl_id`, COUNT(*) AS `cnt` FROM cms3_hierarchy WHERE rel = '{$v7552cd149af7495ee7d8225974e50f80}' AND is_deleted = '0' GROUP BY tpl_id ORDER BY `cnt` DESC";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result)) {list($vd02e12eb6d6c3f6ebd763197df01e211) = $vf1965a857bc285d26fe22023aa5ab50d;return $vd02e12eb6d6c3f6ebd763197df01e211;}else {$v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7552cd149af7495ee7d8225974e50f80);if(get_class($v8e2dcfd7e7e24b1ca76c1193f645902b) == "umiHierarchyElement") {return $v8e2dcfd7e7e24b1ca76c1193f645902b->getTplId();}}}public function getLastUpdatedElements($vaa9f73eea60a006820d0f8768bc8a3fc, $vd7e6d55ba379a13d08c25d15faf2a23b = 0) {$vaa9f73eea60a006820d0f8768bc8a3fc = (int) $vaa9f73eea60a006820d0f8768bc8a3fc;$vd7e6d55ba379a13d08c25d15faf2a23b = (int) $vd7e6d55ba379a13d08c25d15faf2a23b;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE updatetime >= {$vd7e6d55ba379a13d08c25d15faf2a23b} LIMIT {$vaa9f73eea60a006820d0f8768bc8a3fc}";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v9b207167e5381c47682c6b4f58a623fb = Array();while(list($vb80bb7740288fda1f201890375a60c8f) = mysql_fetch_row($result)) {$v9b207167e5381c47682c6b4f58a623fb[] = $vb80bb7740288fda1f201890375a60c8f;}return $v9b207167e5381c47682c6b4f58a623fb;}public function checkIsVirtual($v47c80780ab608cc046f2a6e6f071feb6) {if(sizeof($v47c80780ab608cc046f2a6e6f071feb6) == 0) return $v47c80780ab608cc046f2a6e6f071feb6;foreach($v47c80780ab608cc046f2a6e6f071feb6 as $v7057e8409c7c531a1a6e9ac3df4ed549 => $v1a13105b7e4eb5fb2e7c9515ac06aa48) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v47c80780ab608cc046f2a6e6f071feb6[$v7057e8409c7c531a1a6e9ac3df4ed549] = (string) $v8e2dcfd7e7e24b1ca76c1193f645902b->getObjectId();}$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT obj_id, COUNT(*) FROM cms3_hierarchy WHERE obj_id IN (" . implode(", ", $v47c80780ab608cc046f2a6e6f071feb6) . ") AND is_deleted = '0' GROUP BY obj_id";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v818ad5ef6588e140ecb9f81e810c028a, $v4a8a08f09d37b73795649038408b5f33) = mysql_fetch_row($result)) {$vcfeadf6a60808e5ffeff8268bec49bb6 = ($v4a8a08f09d37b73795649038408b5f33 > 1) ? true : false;foreach($v47c80780ab608cc046f2a6e6f071feb6 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v9e3669d19b675bd57058fd4664205d2a) {if($v9e3669d19b675bd57058fd4664205d2a === $v818ad5ef6588e140ecb9f81e810c028a) {$v47c80780ab608cc046f2a6e6f071feb6[$v865c0c0b4ab0e063e5caa3387c1a8741] = $vcfeadf6a60808e5ffeff8268bec49bb6;}}}return $v47c80780ab608cc046f2a6e6f071feb6;}protected function rewriteElementAltName($v7057e8409c7c531a1a6e9ac3df4ed549) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $this->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true, true);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v8e2dcfd7e7e24b1ca76c1193f645902b->getAltName());$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();return true;}else {return false;}}protected function earseRelationNodes($v7057e8409c7c531a1a6e9ac3df4ed549) {$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_hierarchy_relations WHERE rel_id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}' OR child_id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);}public function rebuildRelationNodes($v7552cd149af7495ee7d8225974e50f80) {$v7552cd149af7495ee7d8225974e50f80 = (int) $v7552cd149af7495ee7d8225974e50f80;$this->earseRelationNodes($v7552cd149af7495ee7d8225974e50f80);$this->buildRelationNewNodes($v7552cd149af7495ee7d8225974e50f80);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id FROM cms3_hierarchy WHERE rel = '{$v7552cd149af7495ee7d8225974e50f80}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v6b6fbabcee280415a5bc3e6f99d3a15e) = mysql_fetch_row($result)) {$this->rebuildRelationNodes($v6b6fbabcee280415a5bc3e6f99d3a15e);}}public function buildRelationNewNodes($v7057e8409c7c531a1a6e9ac3df4ed549) {$v7057e8409c7c531a1a6e9ac3df4ed549 = (int) $v7057e8409c7c531a1a6e9ac3df4ed549;$this->earseRelationNodes($v7057e8409c7c531a1a6e9ac3df4ed549);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT rel FROM cms3_hierarchy WHERE id = '{$v7057e8409c7c531a1a6e9ac3df4ed549}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a, true);if(mysql_num_rows($result)) {list($v6be379826b20cc58475f636e33f4606b) = mysql_fetch_row($result);$v8eeb1538ad4ac95142835550d08f1212 = ($v6be379826b20cc58475f636e33f4606b > 0) ? " = '{$v6be379826b20cc58475f636e33f4606b}'" : " IS NULL";$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_hierarchy_relations (rel_id, child_id, level)
SELECT rel_id, '{$v7057e8409c7c531a1a6e9ac3df4ed549}', (level + 1) FROM cms3_hierarchy_relations WHERE child_id {$v8eeb1538ad4ac95142835550d08f1212}
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$vc68ad910ed49ac65f21f1bf2c5dbf912 = $this->getAllParents($v6be379826b20cc58475f636e33f4606b, true, true);$vc68ad910ed49ac65f21f1bf2c5dbf912 = array_extract_values($vc68ad910ed49ac65f21f1bf2c5dbf912);$vc9e9a848920877e76685b2e4e76de38d = sizeof($vc68ad910ed49ac65f21f1bf2c5dbf912);$v59a040d8f146c76cb91c7f341268d909 = ($v6be379826b20cc58475f636e33f4606b > 0) ? "'{$v6be379826b20cc58475f636e33f4606b}'" : "NULL";$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_hierarchy_relations (rel_id, child_id, level)
VALUES ({$v59a040d8f146c76cb91c7f341268d909}, '{$v7057e8409c7c531a1a6e9ac3df4ed549}', '{$vc9e9a848920877e76685b2e4e76de38d}')
SQL;    l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}else return false;}};?>
