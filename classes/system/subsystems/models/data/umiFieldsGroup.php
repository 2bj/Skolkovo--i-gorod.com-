<?php
 class umiFieldsGroup extends umiEntinty implements iUmiEntinty, iUmiFieldsGroup {private $name, $title,   $type_id, $ord,   $is_active = true, $is_visible = true, $is_locked = false,   $autoload_fields = false,   $fields = Array();protected $store_type = "fields_group";public function getName() {return $this->name;}public function getTitle() {return $this->translateLabel($this->title);}public function getTypeId() {return $this->type_id;}public function getOrd() {return $this->ord;}public function getIsActive() {return $this->is_active;}public function getIsVisible() {return $this->is_visible;}public function getIsLocked() {return $this->is_locked;}public function setName($vb068931cc450442b63f5b3d276ea4297) {$this->name = umiObjectProperty::filterInputString($vb068931cc450442b63f5b3d276ea4297);$this->setIsUpdated();}public function setTitle($vd5d3db1765287eef77d7927cc956f50a) {$vd5d3db1765287eef77d7927cc956f50a = $this->translateI18n($vd5d3db1765287eef77d7927cc956f50a, "fields-group");$this->title = umiObjectProperty::filterInputString($vd5d3db1765287eef77d7927cc956f50a);$this->setIsUpdated();}public function setTypeId($v94757cae63fd3e398c0811a976dd6bbe) {$vd14a8022b085f9ef19d479cbdd581127 = umiObjectTypesCollection::getInstance();if($vd14a8022b085f9ef19d479cbdd581127->isExists($v94757cae63fd3e398c0811a976dd6bbe)) {$this->type_id = $v94757cae63fd3e398c0811a976dd6bbe;return true;}else {return false;}}public function setOrd($v8bef1cc20ada3bef55fdf132cb2a1cb9) {$this->ord = $v8bef1cc20ada3bef55fdf132cb2a1cb9;$this->setIsUpdated();}public function setIsActive($v4264c638e0098acb172519b0436db099) {$this->is_active = (bool) $v4264c638e0098acb172519b0436db099;$this->setIsUpdated();}public function setIsVisible($ve1c6c9ef2fcbe75f26f815c4ef2e60b4) {$this->is_visible = (bool) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4;$this->setIsUpdated();}public function setIsLocked($v1945c9a2a5e2ba6133f1db6757a35fcb) {$this->is_locked = (bool) $v1945c9a2a5e2ba6133f1db6757a35fcb;$this->setIsUpdated();}protected function loadInfo($vf1965a857bc285d26fe22023aa5ab50d = false) {if($vf1965a857bc285d26fe22023aa5ab50d === false) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE id, name, title, type_id, is_active, is_visible, is_locked, ord FROM cms3_object_field_groups WHERE id = '{$this->id}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result);}if(list($vb80bb7740288fda1f201890375a60c8f, $vb068931cc450442b63f5b3d276ea4297, $vd5d3db1765287eef77d7927cc956f50a, $v94757cae63fd3e398c0811a976dd6bbe, $v4264c638e0098acb172519b0436db099, $ve1c6c9ef2fcbe75f26f815c4ef2e60b4, $v1945c9a2a5e2ba6133f1db6757a35fcb, $v8bef1cc20ada3bef55fdf132cb2a1cb9) = $vf1965a857bc285d26fe22023aa5ab50d) {if(!umiObjectTypesCollection::getInstance()->isExists($v94757cae63fd3e398c0811a976dd6bbe)) {return false;}$this->name = $vb068931cc450442b63f5b3d276ea4297;$this->title = $vd5d3db1765287eef77d7927cc956f50a;$this->type_id = $v94757cae63fd3e398c0811a976dd6bbe;$this->is_active = (bool) $v4264c638e0098acb172519b0436db099;$this->is_visible = (bool) $ve1c6c9ef2fcbe75f26f815c4ef2e60b4;$this->is_locked = (bool) $v1945c9a2a5e2ba6133f1db6757a35fcb;$this->ord = (int) $v8bef1cc20ada3bef55fdf132cb2a1cb9;if($this->autoload_fields) {return $this->loadFields();}else {return true;}}else {return false;}}protected function save() {$vb068931cc450442b63f5b3d276ea4297 = mysql_real_escape_string($this->name);$vd5d3db1765287eef77d7927cc956f50a = mysql_real_escape_string($this->title);$v94757cae63fd3e398c0811a976dd6bbe = (int) $this->type_id;$v4264c638e0098acb172519b0436db099 = (int) $this->is_active;$ve1c6c9ef2fcbe75f26f815c4ef2e60b4 = (int) $this->is_visible;$v8bef1cc20ada3bef55fdf132cb2a1cb9 = (int) $this->ord;$v1945c9a2a5e2ba6133f1db6757a35fcb = (int) $this->is_locked;$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_object_field_groups SET name = '{$vb068931cc450442b63f5b3d276ea4297}', title = '{$vd5d3db1765287eef77d7927cc956f50a}', type_id = '{$v94757cae63fd3e398c0811a976dd6bbe}', is_active = '{$v4264c638e0098acb172519b0436db099}', is_visible = '{$ve1c6c9ef2fcbe75f26f815c4ef2e60b4}', ord = '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}', is_locked = '{$v1945c9a2a5e2ba6133f1db6757a35fcb}' WHERE id = '{$this->id}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}else {return true;}}public function loadFields($vdf347a373b8f92aa0ae3dd920a5ec2f6 = false) {$vd05b6ed7d2345020440df396d6da7f73 = umiFieldsCollection::getInstance();if($vdf347a373b8f92aa0ae3dd920a5ec2f6 === false) {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT SQL_CACHE cof.id, cof.name, cof.title, cof.is_locked, cof.is_inheritable, cof.is_visible, cof.field_type_id, cof.guide_id, cof.in_search, cof.in_filter, cof.tip, cof.is_required FROM cms3_fields_controller cfc, cms3_object_fields cof WHERE cfc.group_id = '{$this->id}' AND cof.id = cfc.field_id ORDER BY cfc.ord ASC";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}while(list($v3aabf39f2d943fa886d86dcbbee4d910) = $vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result)) {if($v06e3d36fa30cea095545139854ad1fb9 = $vd05b6ed7d2345020440df396d6da7f73->getField($v3aabf39f2d943fa886d86dcbbee4d910, $vf1965a857bc285d26fe22023aa5ab50d)) {$this->fields[$v3aabf39f2d943fa886d86dcbbee4d910] = $v06e3d36fa30cea095545139854ad1fb9;}}}else {foreach($vdf347a373b8f92aa0ae3dd920a5ec2f6 as $vf1965a857bc285d26fe22023aa5ab50d) {list($v3aabf39f2d943fa886d86dcbbee4d910) = $vf1965a857bc285d26fe22023aa5ab50d;if($v06e3d36fa30cea095545139854ad1fb9 = $vd05b6ed7d2345020440df396d6da7f73->getField($v3aabf39f2d943fa886d86dcbbee4d910, $vf1965a857bc285d26fe22023aa5ab50d)) {$this->fields[$v3aabf39f2d943fa886d86dcbbee4d910] = $v06e3d36fa30cea095545139854ad1fb9;}}}}public function getFields() {return $this->fields;}private function isLoaded($v3aabf39f2d943fa886d86dcbbee4d910) {return (bool) array_key_exists($v3aabf39f2d943fa886d86dcbbee4d910, $this->fields);}public function attachField($v3aabf39f2d943fa886d86dcbbee4d910, $vcfc3576cd3c177283e25ebc525a5aece = false) {if($this->isLoaded($v3aabf39f2d943fa886d86dcbbee4d910) && !$vcfc3576cd3c177283e25ebc525a5aece) {return true;}else {$v3aabf39f2d943fa886d86dcbbee4d910 = (int) $v3aabf39f2d943fa886d86dcbbee4d910;$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT MAX(ord) FROM cms3_fields_controller WHERE group_id = '{$this->id}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}list($v8bef1cc20ada3bef55fdf132cb2a1cb9) = mysql_fetch_row($result);$v8bef1cc20ada3bef55fdf132cb2a1cb9 += 5;$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_fields_controller (field_id, group_id, ord) VALUES('{$v3aabf39f2d943fa886d86dcbbee4d910}', '{$this->id}', '{$v8bef1cc20ada3bef55fdf132cb2a1cb9}')";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}cacheFrontend::getInstance()->flush();$vd05b6ed7d2345020440df396d6da7f73 = umiFieldsCollection::getInstance();$v06e3d36fa30cea095545139854ad1fb9 = $vd05b6ed7d2345020440df396d6da7f73->getField($v3aabf39f2d943fa886d86dcbbee4d910);$this->fields[$v3aabf39f2d943fa886d86dcbbee4d910] = $v06e3d36fa30cea095545139854ad1fb9;$this->fillInContentTable($v3aabf39f2d943fa886d86dcbbee4d910);}}protected function fillInContentTable($v3aabf39f2d943fa886d86dcbbee4d910) {$v94757cae63fd3e398c0811a976dd6bbe = $this->type_id;$vac5c74b64b4b8352ef2f181affb5ac2a = "INSERT INTO cms3_object_content (obj_id, field_id, int_val, varchar_val, text_val, rel_val, tree_val, float_val) SELECT id, {$v3aabf39f2d943fa886d86dcbbee4d910}, NULL, NULL, NULL, NULL, NULL, NULL FROM cms3_objects WHERE type_id = {$v94757cae63fd3e398c0811a976dd6bbe}";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);}}public function detachField($v3aabf39f2d943fa886d86dcbbee4d910) {if($this->isLoaded($v3aabf39f2d943fa886d86dcbbee4d910)) {$v3aabf39f2d943fa886d86dcbbee4d910 = (int) $v3aabf39f2d943fa886d86dcbbee4d910;$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_fields_controller WHERE field_id = '{$v3aabf39f2d943fa886d86dcbbee4d910}' AND group_id = '{$this->id}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}unset($this->fields[$v3aabf39f2d943fa886d86dcbbee4d910]);$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT COUNT(*) FROM cms3_fields_controller WHERE field_id = '{$v3aabf39f2d943fa886d86dcbbee4d910}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}cacheFrontend::getInstance()->flush();if(list($v4a8a08f09d37b73795649038408b5f33) = mysql_fetch_row($result)) {return ($v4a8a08f09d37b73795649038408b5f33 == 0) ? umiFieldsCollection::getInstance()->delField($v3aabf39f2d943fa886d86dcbbee4d910) : true;}else return false;return true;}else {return false;}}public function moveFieldAfter($v3aabf39f2d943fa886d86dcbbee4d910, $vfcd4b86e12c95a57c24239e8a4125360, $v0e939a4ffd3aacd724dd3b50147b4353, $v3f84b203eef48e9862ac1ffbe344dffe) {if($vfcd4b86e12c95a57c24239e8a4125360 == 0) {$vf2400bf3c8b70283e04af07d6d67fe6a = 0;}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT ord FROM cms3_fields_controller WHERE group_id = '{$v0e939a4ffd3aacd724dd3b50147b4353}' AND field_id = '{$vfcd4b86e12c95a57c24239e8a4125360}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}else {list($vf2400bf3c8b70283e04af07d6d67fe6a) = mysql_fetch_row($result);}}if($v3f84b203eef48e9862ac1ffbe344dffe) {$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_fields_controller SET ord = (ord + 1) WHERE group_id = '{$this->id}' AND ord >= '{$vf2400bf3c8b70283e04af07d6d67fe6a}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}}else {$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT MAX(ord) FROM cms3_fields_controller WHERE group_id = '{$v0e939a4ffd3aacd724dd3b50147b4353}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}list($vf2400bf3c8b70283e04af07d6d67fe6a) = mysql_fetch_row($result);++$vf2400bf3c8b70283e04af07d6d67fe6a;}$vac5c74b64b4b8352ef2f181affb5ac2a = "UPDATE cms3_fields_controller SET ord = '{$vf2400bf3c8b70283e04af07d6d67fe6a}', group_id = '$v0e939a4ffd3aacd724dd3b50147b4353' WHERE group_id = '{$this->id}' AND field_id = '{$v3aabf39f2d943fa886d86dcbbee4d910}'";l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);cacheFrontend::getInstance()->flush();if($v56bd7107802ebe56c6918992f0608ec6 = mysql_error()) {throw new coreException($v56bd7107802ebe56c6918992f0608ec6);return false;}else {return true;}}public function commit() {parent::commit();cacheFrontend::getInstance()->flush();}public static function getAllGroupsByName($vb068931cc450442b63f5b3d276ea4297) {if($vb068931cc450442b63f5b3d276ea4297) {$vb068931cc450442b63f5b3d276ea4297 = mysql_real_escape_string($vb068931cc450442b63f5b3d276ea4297);}else {return false;}$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT `id` FROM `cms3_object_field_groups` WHERE `name` = '{$vb068931cc450442b63f5b3d276ea4297}'";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);$v1471e4e05a4db95d353cc867fe317314 = Array();while(list($v47db2588331bbe530c80dd001fc60aed) = mysql_fetch_row($result)) {$vdb0f6f37ebeb6ea09489124345af2a45 = new umiFieldsGroup($v47db2588331bbe530c80dd001fc60aed);if($vdb0f6f37ebeb6ea09489124345af2a45 instanceof umiFieldsGroup) {$v1471e4e05a4db95d353cc867fe317314[] = $vdb0f6f37ebeb6ea09489124345af2a45;}}return $v1471e4e05a4db95d353cc867fe317314;}};?>
