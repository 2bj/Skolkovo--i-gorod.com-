<?php
 class forum extends def_module {public $per_page = 10;public function __construct() {parent::__construct();if (cmsController::getInstance()->getCurrentMode() == "admin") {$v38d1e18b54816e157dda5426c36970e3 = $this->getCommonTabs();if($v38d1e18b54816e157dda5426c36970e3) {$v38d1e18b54816e157dda5426c36970e3->add('lists', array('confs_list'));$v38d1e18b54816e157dda5426c36970e3->add('last_messages');}$this->__loadLib("__admin.php");$this->__implement("__forum");$this->__loadLib("__custom_adm.php");$this->__implement("__custom_adm_forum");}else {$this->__loadLib("__sysevents.php");$this->__implement("__sysevents_forum");$this->__loadLib("__custom.php");$this->__implement("__custom_forum");}$this->__loadLib("__events_handlers.php");$this->__implement("__events_handlers_forum");if ($v9d85c254b5062e518a134a61950999c3 = (int) regedit::getInstance()->getVal("//modules/forum/per_page")) {$this->per_page = $v9d85c254b5062e518a134a61950999c3;}}public function confs_list($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $v05daae513775f43f630b84af23ac8629 = '', $v6394e0c7370f6463acee544fd29ab83c = 0, $v126424c808da347218ba631a78feaf04 = false) {if(cmsController::getInstance()->getCurrentMode() == "admin") {$this->redirect($this->pre_lang . '/admin/forum/lists/');}if($this->breakMe()) return;if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c, $vb1c0ed8b2e25638833f73a19e1954309) = self::loadTemplates("./tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "confs_block", "confs_block_line");if (!$v05daae513775f43f630b84af23ac8629) $v05daae513775f43f630b84af23ac8629 = getRequest('param1');if($v05daae513775f43f630b84af23ac8629) {$v558363dde110ad2b3af09518966e0197 = $this->analyzeRequiredPath($v05daae513775f43f630b84af23ac8629);if (!$v558363dde110ad2b3af09518966e0197) {$v05daae513775f43f630b84af23ac8629 = getRequest('item');$v558363dde110ad2b3af09518966e0197 = $this->analyzeRequiredPath($v05daae513775f43f630b84af23ac8629);}}else {$v558363dde110ad2b3af09518966e0197 = false;}if (!$v6394e0c7370f6463acee544fd29ab83c) $v6394e0c7370f6463acee544fd29ab83c = intval(getRequest('param2'));if (!$v6394e0c7370f6463acee544fd29ab83c) $v6394e0c7370f6463acee544fd29ab83c = 0;$v9d85c254b5062e518a134a61950999c3 = $this->per_page;$ve1ba980ce14a8c0d7e2779f895ab8695 = getRequest('p');if($v126424c808da347218ba631a78feaf04) $ve1ba980ce14a8c0d7e2779f895ab8695 = 0;$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v9d85c254b5062e518a134a61950999c3, $ve1ba980ce14a8c0d7e2779f895ab8695);$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "conf")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);if ($v558363dde110ad2b3af09518966e0197) {$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v558363dde110ad2b3af09518966e0197, $v6394e0c7370f6463acee544fd29ab83c);}$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);unset($v8be74552df93e31bbdd6b36ed74bdb6a);$v980da98409d058c365664ff7ea33dd6b = Array();$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($result);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v085bc1863075960923bacbc2bfebdab8 = $result[$v865c0c0b4ab0e063e5caa3387c1a8741];$vd8af4326a65c582d01912b0eca614617 = umiHierarchy::getInstance()->getElement($v085bc1863075960923bacbc2bfebdab8);$v382cc02541d4d10c4effc1fa5e4a0ecd = $this->getConfTopicsCount($v085bc1863075960923bacbc2bfebdab8);$vb8878876b010ef6c736fc1b5e791bf16 = $this->getConfMessagesCount($v085bc1863075960923bacbc2bfebdab8);$v69ba0c89abba8a3e9cc0c5e32be0d35d = Array();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:id'] = $v085bc1863075960923bacbc2bfebdab8;$v69ba0c89abba8a3e9cc0c5e32be0d35d['node:name'] = $vd8af4326a65c582d01912b0eca614617->getName();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:link'] = umiHierarchy::getInstance()->getPathById($v085bc1863075960923bacbc2bfebdab8);$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:topics_count'] = $v382cc02541d4d10c4effc1fa5e4a0ecd;$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:messages_count'] = $vb8878876b010ef6c736fc1b5e791bf16;$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:href'] = "upage://" . $v085bc1863075960923bacbc2bfebdab8;$v980da98409d058c365664ff7ea33dd6b[] = self::parseTemplate($vb1c0ed8b2e25638833f73a19e1954309, $v69ba0c89abba8a3e9cc0c5e32be0d35d, $v085bc1863075960923bacbc2bfebdab8);templater::pushEditable("forum", "conf", $v085bc1863075960923bacbc2bfebdab8);}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:lines'] = $v980da98409d058c365664ff7ea33dd6b;$vfca1bff8ad8b3a8585abfb0ad523ba42['total'] = $vfbb44b4487415b134bce9c790a27fe5e;$vfca1bff8ad8b3a8585abfb0ad523ba42['per_page'] = $v9d85c254b5062e518a134a61950999c3;return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function conf($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $v9d85c254b5062e518a134a61950999c3 = false, $v1437f65c10a3e2cb80d25d097ad37ae2 = false) {if($this->breakMe()) return;if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c, $vb1c0ed8b2e25638833f73a19e1954309) = self::loadTemplates("tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "topics_block", "topics_block_line");$v7057e8409c7c531a1a6e9ac3df4ed549 = cmsController::getInstance()->getCurrentElementId();$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);templater::pushEditable("forum", "conf", $v7057e8409c7c531a1a6e9ac3df4ed549);$v9d85c254b5062e518a134a61950999c3 = ($v9d85c254b5062e518a134a61950999c3) ? $v9d85c254b5062e518a134a61950999c3 : $this->per_page;$ve1ba980ce14a8c0d7e2779f895ab8695 = getRequest('p');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v9d85c254b5062e518a134a61950999c3, $ve1ba980ce14a8c0d7e2779f895ab8695);$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$vcf50d2282682dd498adb071bfee534cf = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "topic")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($vcf50d2282682dd498adb071bfee534cf);if (!$v1437f65c10a3e2cb80d25d097ad37ae2) {$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v7057e8409c7c531a1a6e9ac3df4ed549);}else {$v8be74552df93e31bbdd6b36ed74bdb6a->forceHierarchyTable();}$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("forum", "topic");$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v551ee5aab91fccd02619d58ecde0448d = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('last_post_time');$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderFilter();if (getRequest('order_property')) {$vee582a7eb44cddb34dad18148ed80836 = false;$v4774f71beef63a5c36fc86fd3e50bbc4 = getRequest('order_direction');if (strtoupper($v4774f71beef63a5c36fc86fd3e50bbc4) === 'ASC') $vee582a7eb44cddb34dad18148ed80836 = true;$v2601d654cbc23369b0b1eb7a20428c43 = getRequest('order_property');if (!$v2601d654cbc23369b0b1eb7a20428c43) $v2601d654cbc23369b0b1eb7a20428c43 = 'publish_time';switch ($v2601d654cbc23369b0b1eb7a20428c43) {case 'sys::ord':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByOrd();break;case 'sys::rand':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByRand();break;case 'sys::name':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByName($vee582a7eb44cddb34dad18148ed80836);break;case 'sys::objectid':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByObjectId($vee582a7eb44cddb34dad18148ed80836);break;default:      $vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId($v2601d654cbc23369b0b1eb7a20428c43);if (!$vd0d5ad0219c6bb59a29b5027add37795) $vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, $vee582a7eb44cddb34dad18148ed80836);break;}}else {if ($v551ee5aab91fccd02619d58ecde0448d) {if(regedit::getInstance()->getVal("//modules/forum/sort_by_last_message")) {$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($v551ee5aab91fccd02619d58ecde0448d, false);}else {$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, false);}}}$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);unset($v8be74552df93e31bbdd6b36ed74bdb6a);$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$v980da98409d058c365664ff7ea33dd6b = Array();foreach($result as $ve56de0585398a3ae83272a01a85e76f8) {$v69ba0c89abba8a3e9cc0c5e32be0d35d = Array();$v3cae0a2443a456a727a7b3caa0b549f3 = umiHierarchy::getInstance()->getElement($ve56de0585398a3ae83272a01a85e76f8);if(!$v3cae0a2443a456a727a7b3caa0b549f3) {continue;}$vb8878876b010ef6c736fc1b5e791bf16 = $this->getTopicMessagesCount($ve56de0585398a3ae83272a01a85e76f8);$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:id'] = $ve56de0585398a3ae83272a01a85e76f8;$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:link'] = umiHierarchy::getInstance()->getPathById($ve56de0585398a3ae83272a01a85e76f8);$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:messages_count'] = $vb8878876b010ef6c736fc1b5e791bf16;$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:href'] = "upage://" . $ve56de0585398a3ae83272a01a85e76f8;$v69ba0c89abba8a3e9cc0c5e32be0d35d['node:name'] = $v3cae0a2443a456a727a7b3caa0b549f3->getName();$v980da98409d058c365664ff7ea33dd6b[] = self::parseTemplate($vb1c0ed8b2e25638833f73a19e1954309, $v69ba0c89abba8a3e9cc0c5e32be0d35d, $ve56de0585398a3ae83272a01a85e76f8);templater::pushEditable("forum", "topic", $ve56de0585398a3ae83272a01a85e76f8);}$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:id'] = $v7057e8409c7c531a1a6e9ac3df4ed549;$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:lines'] = $v980da98409d058c365664ff7ea33dd6b;$vfca1bff8ad8b3a8585abfb0ad523ba42['total'] = $vfbb44b4487415b134bce9c790a27fe5e;$vfca1bff8ad8b3a8585abfb0ad523ba42['per_page'] = $v9d85c254b5062e518a134a61950999c3;return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42, $v7057e8409c7c531a1a6e9ac3df4ed549);}public function topic($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $v9d85c254b5062e518a134a61950999c3 = false, $v1437f65c10a3e2cb80d25d097ad37ae2 = false) {if($this->breakMe()) return;if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c, $vb1c0ed8b2e25638833f73a19e1954309) = self::loadTemplates("./tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "messages_block", "messages_block_line");$v7057e8409c7c531a1a6e9ac3df4ed549 = cmsController::getInstance()->getCurrentElementId();$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$ve6bbc60e5b72ac7628b8a531f9885596 = (string) getRequest('unsubscribe');if($ve6bbc60e5b72ac7628b8a531f9885596) {$ve6bbc60e5b72ac7628b8a531f9885596 = base64_decode($ve6bbc60e5b72ac7628b8a531f9885596);$va85a6874c938b4505ec7496bebec29da = umiObjectsCollection::getInstance()->getObject($ve6bbc60e5b72ac7628b8a531f9885596);if($va85a6874c938b4505ec7496bebec29da instanceof umiObject) {$v19b4d72735aafc4970ca2c69b34cb3aa = cmsController::getInstance()->getCurrentElementId();$vdec177e7702875801c6711990652f62d = $va85a6874c938b4505ec7496bebec29da->getValue("subscribed_pages");$vfa816edb83e95bf0c8da580bdfd491ef = Array();foreach($vdec177e7702875801c6711990652f62d as $v71860c77c6745379b0d44304d66b6a13) {if($v71860c77c6745379b0d44304d66b6a13->getId() != $v19b4d72735aafc4970ca2c69b34cb3aa) {$vfa816edb83e95bf0c8da580bdfd491ef[] = $v71860c77c6745379b0d44304d66b6a13;}}$vdec177e7702875801c6711990652f62d = $vfa816edb83e95bf0c8da580bdfd491ef;unset($vfa816edb83e95bf0c8da580bdfd491ef);}$va85a6874c938b4505ec7496bebec29da->setValue("subscribed_pages", $vdec177e7702875801c6711990652f62d);$va85a6874c938b4505ec7496bebec29da->commit();}templater::pushEditable("forum", "topic", $v7057e8409c7c531a1a6e9ac3df4ed549);$v9d85c254b5062e518a134a61950999c3 = ($v9d85c254b5062e518a134a61950999c3) ? $v9d85c254b5062e518a134a61950999c3 : $this->per_page;$ve1ba980ce14a8c0d7e2779f895ab8695 = getRequest('p');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$vcf50d2282682dd498adb071bfee534cf = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "message")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($vcf50d2282682dd498adb071bfee534cf);if (!$v1437f65c10a3e2cb80d25d097ad37ae2) {$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v7057e8409c7c531a1a6e9ac3df4ed549);}else {$v8be74552df93e31bbdd6b36ed74bdb6a->forceHierarchyTable();}$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("forum", "message");$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');if (getRequest('order_property')) {$vee582a7eb44cddb34dad18148ed80836 = false;$v4774f71beef63a5c36fc86fd3e50bbc4 = getRequest('order_direction');if (strtoupper($v4774f71beef63a5c36fc86fd3e50bbc4) === 'ASC') $vee582a7eb44cddb34dad18148ed80836 = true;$v2601d654cbc23369b0b1eb7a20428c43 = getRequest('order_property');if (!$v2601d654cbc23369b0b1eb7a20428c43) $v2601d654cbc23369b0b1eb7a20428c43 = 'publish_time';switch ($v2601d654cbc23369b0b1eb7a20428c43) {case 'sys::ord':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByOrd();break;case 'sys::rand':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByRand();break;case 'sys::name':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByName($vee582a7eb44cddb34dad18148ed80836);break;case 'sys::objectid':      $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByObjectId($vee582a7eb44cddb34dad18148ed80836);break;default:      $vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId($v2601d654cbc23369b0b1eb7a20428c43);if (!$vd0d5ad0219c6bb59a29b5027add37795) $vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, $vee582a7eb44cddb34dad18148ed80836);break;}}else {$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, true);}$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v9d85c254b5062e518a134a61950999c3, $ve1ba980ce14a8c0d7e2779f895ab8695);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);unset($v8be74552df93e31bbdd6b36ed74bdb6a);$v980da98409d058c365664ff7ea33dd6b = Array();$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($result);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v51cdce0f94523cbd6334e96d43e9fe39 = $result[$v865c0c0b4ab0e063e5caa3387c1a8741];$vae71b6bb69548ec060f0eca8af641304 = umiHierarchy::getInstance()->getElement($v51cdce0f94523cbd6334e96d43e9fe39);if(!$vae71b6bb69548ec060f0eca8af641304) {$vfbb44b4487415b134bce9c790a27fe5e--;continue;}$v69ba0c89abba8a3e9cc0c5e32be0d35d = Array();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:id'] = $v51cdce0f94523cbd6334e96d43e9fe39;$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:name'] = $vae71b6bb69548ec060f0eca8af641304->getName();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:num'] = ($v9d85c254b5062e518a134a61950999c3 * $ve1ba980ce14a8c0d7e2779f895ab8695) + $v865c0c0b4ab0e063e5caa3387c1a8741 + 1;$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:author_id'] = $v4f331e2fa932c4f9b933388ce1df675f = $vae71b6bb69548ec060f0eca8af641304->getValue("author_id");$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:href'] = "upage://" . $v51cdce0f94523cbd6334e96d43e9fe39;$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:author-href'] = "udata://users/viewAuthor/" . $v4f331e2fa932c4f9b933388ce1df675f;$v78e731027d8fd50ed642340b7c9a63b3 = $vae71b6bb69548ec060f0eca8af641304->getValue("message");$v69ba0c89abba8a3e9cc0c5e32be0d35d['node:message'] = self::formatMessage($v78e731027d8fd50ed642340b7c9a63b3);$v980da98409d058c365664ff7ea33dd6b[] = self::parseTemplate($vb1c0ed8b2e25638833f73a19e1954309, $v69ba0c89abba8a3e9cc0c5e32be0d35d, $v51cdce0f94523cbd6334e96d43e9fe39);templater::pushEditable("forum", "message", $v51cdce0f94523cbd6334e96d43e9fe39);umiHierarchy::getInstance()->unloadElement($v7057e8409c7c531a1a6e9ac3df4ed549);}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:id'] = $v7057e8409c7c531a1a6e9ac3df4ed549;$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:lines'] = $v980da98409d058c365664ff7ea33dd6b;$vfca1bff8ad8b3a8585abfb0ad523ba42['total'] = $vfbb44b4487415b134bce9c790a27fe5e;$vfca1bff8ad8b3a8585abfb0ad523ba42['per_page'] = $v9d85c254b5062e518a134a61950999c3;return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42, $v7057e8409c7c531a1a6e9ac3df4ed549);}public function message() {$v7057e8409c7c531a1a6e9ac3df4ed549 = cmsController::getInstance()->getCurrentElementId();$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v9d85c254b5062e518a134a61950999c3 = $this->per_page;$ve1ba980ce14a8c0d7e2779f895ab8695 = (int) getRequest('p');$v6be379826b20cc58475f636e33f4606b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();$vc975d8201fe751ebb3429336eeee7d3b = umiHierarchy::getInstance()->getElement($v6be379826b20cc58475f636e33f4606b);if($v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("publish_time"))   $v0faea619a3eb6dfca4ced9bbe5bf4c9a = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("publish_time")->getFormattedDate("U");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v9d85c254b5062e518a134a61950999c3, $ve1ba980ce14a8c0d7e2779f895ab8695);$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$vcf50d2282682dd498adb071bfee534cf = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "message")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($vcf50d2282682dd498adb071bfee534cf);$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v6be379826b20cc58475f636e33f4606b);$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("forum", "message");$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, true);$v8be74552df93e31bbdd6b36ed74bdb6a->setPropertyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterLess($vd0d5ad0219c6bb59a29b5027add37795, $v0faea619a3eb6dfca4ced9bbe5bf4c9a);$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v83878c91171338902e0fe0fb97a8c47a = floor(($vfbb44b4487415b134bce9c790a27fe5e - 1) / $this->per_page);if($v83878c91171338902e0fe0fb97a8c47a < 0) $v83878c91171338902e0fe0fb97a8c47a = 0;$v572d4e421e5e6b9bc11d815e8a027112 = umiHierarchy::getInstance()->getPathById($v6be379826b20cc58475f636e33f4606b) . "?p={$v83878c91171338902e0fe0fb97a8c47a}#" . $v7057e8409c7c531a1a6e9ac3df4ed549;$this->redirect($v572d4e421e5e6b9bc11d815e8a027112);}public function topic_last_message($vd6fe1d0be6347b8ef2427fa629c04485, $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if($this->breakMe()) return;if(!defined("DISABLE_SEARCH_REINDEX")) {define("DISABLE_SEARCH_REINDEX", "1");}if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c) = self::loadTemplates("./tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "topic_last_message");$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v72352a4d26581ef082a6d2243c5a6b88 = $this->analyzeRequiredPath($vd6fe1d0be6347b8ef2427fa629c04485);if($v72352a4d26581ef082a6d2243c5a6b88 === false && $vd6fe1d0be6347b8ef2427fa629c04485 != KEYWORD_GRAB_ALL) {throw new publicException(getLabel('error-page-does-not-exist', null, $vd6fe1d0be6347b8ef2427fa629c04485));}$va4f09cfeea7392a1f6df6a3de5c3bc9e = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v72352a4d26581ef082a6d2243c5a6b88);$vfa83f8728507ec49035e3cf6b7427feb = $this->getLastMessageId($v72352a4d26581ef082a6d2243c5a6b88);$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();if($vfa83f8728507ec49035e3cf6b7427feb) {$v481b170b7d56edc2dcfabfb7cf28a2c5 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vfa83f8728507ec49035e3cf6b7427feb);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:id'] = $vfa83f8728507ec49035e3cf6b7427feb;$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:name'] = $v481b170b7d56edc2dcfabfb7cf28a2c5->getName();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:link'] = $this->getMessageLink($vfa83f8728507ec49035e3cf6b7427feb);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:author_id'] = $v481b170b7d56edc2dcfabfb7cf28a2c5->getValue("author_id");$vfca1bff8ad8b3a8585abfb0ad523ba42['xlink:href'] = "upage://" . $vfa83f8728507ec49035e3cf6b7427feb;$vfca1bff8ad8b3a8585abfb0ad523ba42['node:message'] = self::formatMessage($v481b170b7d56edc2dcfabfb7cf28a2c5->getValue("message"));if($v1c9d289cd947659a7f8330f213b3a6e3 = $v481b170b7d56edc2dcfabfb7cf28a2c5->getValue("publish_time")) {if($v1c9d289cd947659a7f8330f213b3a6e3 instanceof iUmiDate) {$v1c9d289cd947659a7f8330f213b3a6e3 = $v1c9d289cd947659a7f8330f213b3a6e3->getFormattedDate("U");if($va4f09cfeea7392a1f6df6a3de5c3bc9e = $v481b170b7d56edc2dcfabfb7cf28a2c5->getRel()) {$va4f09cfeea7392a1f6df6a3de5c3bc9e = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v72352a4d26581ef082a6d2243c5a6b88);$va4f09cfeea7392a1f6df6a3de5c3bc9e->setValue("last_post_time", $v1c9d289cd947659a7f8330f213b3a6e3);$va4f09cfeea7392a1f6df6a3de5c3bc9e->commit();}}}}else {return "";}templater::pushEditable("forum", "message", $vfa83f8728507ec49035e3cf6b7427feb);return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42, $vfa83f8728507ec49035e3cf6b7427feb);}public function conf_last_message($vd6fe1d0be6347b8ef2427fa629c04485, $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if($this->breakMe()) return;if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c) = self::loadTemplates("./tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "conf_last_message");$v72352a4d26581ef082a6d2243c5a6b88 = $this->analyzeRequiredPath($vd6fe1d0be6347b8ef2427fa629c04485);if($v72352a4d26581ef082a6d2243c5a6b88 === false && $vd6fe1d0be6347b8ef2427fa629c04485 != KEYWORD_GRAB_ALL) {throw new publicException(getLabel('error-page-does-not-exist', null, $vd6fe1d0be6347b8ef2427fa629c04485));}$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v1b50504747ad30f27dbb5a465db85f4b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v72352a4d26581ef082a6d2243c5a6b88);$vfa83f8728507ec49035e3cf6b7427feb = $this->getLastMessageId($v72352a4d26581ef082a6d2243c5a6b88);$vfca1bff8ad8b3a8585abfb0ad523ba42 = array();if($vfa83f8728507ec49035e3cf6b7427feb) {$v481b170b7d56edc2dcfabfb7cf28a2c5 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vfa83f8728507ec49035e3cf6b7427feb);if(!$v481b170b7d56edc2dcfabfb7cf28a2c5) return "";$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:id'] = $vfa83f8728507ec49035e3cf6b7427feb;$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:name'] = $v481b170b7d56edc2dcfabfb7cf28a2c5->getName();$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:link'] = $this->getMessageLink($vfa83f8728507ec49035e3cf6b7427feb);$vfca1bff8ad8b3a8585abfb0ad523ba42['attribute:author_id'] = $v481b170b7d56edc2dcfabfb7cf28a2c5->getValue("author_id");$vfca1bff8ad8b3a8585abfb0ad523ba42['xlink:href'] = "upage://" . $vfa83f8728507ec49035e3cf6b7427feb;$vfca1bff8ad8b3a8585abfb0ad523ba42['node:message'] = self::formatMessage($v481b170b7d56edc2dcfabfb7cf28a2c5->getValue("message"));}else return "";templater::pushEditable("forum", "message", $vfa83f8728507ec49035e3cf6b7427feb);return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42, $vfa83f8728507ec49035e3cf6b7427feb);}public function topic_post($v4a20784bb5bad10b0f5c941a900f0c04, $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {$v7057e8409c7c531a1a6e9ac3df4ed549 = $this->analyzeRequiredPath($v4a20784bb5bad10b0f5c941a900f0c04);$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v4a20784bb5bad10b0f5c941a900f0c04);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement == false) {throw new publicException(getLabel('error-page-does-not-exist', null, $v4a20784bb5bad10b0f5c941a900f0c04));}if($v8e2dcfd7e7e24b1ca76c1193f645902b->comments_disallow) return '';if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v9fd81bc973ab5b6a31b5a0d29b4ee87a, $v9b0c324124acf2ac71c64a147cf0ad42, $v92e290b9214eb54bded0b42969e89fe1) = self::loadTemplates("./tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "add_topic_user", "add_topic_guest", "smiles");if($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if($v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {$v66f6181bcb4cff4cd38fbc804a036db6 = $v9fd81bc973ab5b6a31b5a0d29b4ee87a;}else {if(!(regedit::getInstance()->getVal("//modules/forum/allow_guest"))) {return "";}$v66f6181bcb4cff4cd38fbc804a036db6 = $v9b0c324124acf2ac71c64a147cf0ad42;}}return self::parseTemplate($v66f6181bcb4cff4cd38fbc804a036db6, array(    'void:smiles' => $v92e290b9214eb54bded0b42969e89fe1,    'id'  => $v8e2dcfd7e7e24b1ca76c1193f645902b->id,    'name'  => $v8e2dcfd7e7e24b1ca76c1193f645902b->name,    'action' => $this->pre_lang . '/forum/topic_post_do/' . $v8e2dcfd7e7e24b1ca76c1193f645902b->id . '/'   ), $v7057e8409c7c531a1a6e9ac3df4ed549);}public function message_post($v4a20784bb5bad10b0f5c941a900f0c04 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {$v7057e8409c7c531a1a6e9ac3df4ed549 = $this->analyzeRequiredPath($v4a20784bb5bad10b0f5c941a900f0c04);if(!$v7057e8409c7c531a1a6e9ac3df4ed549) {throw new publicException(getLabel('error-page-does-not-exist', null, $v4a20784bb5bad10b0f5c941a900f0c04));}$v2ffc8a96eadfecc14223b0d67fb27e2c = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);if($v2ffc8a96eadfecc14223b0d67fb27e2c->getValue('comments_disallow')) return '';if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v9fd81bc973ab5b6a31b5a0d29b4ee87a, $v9b0c324124acf2ac71c64a147cf0ad42, $v92e290b9214eb54bded0b42969e89fe1) = self::loadTemplates("./tpls/forum/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "add_message_user", "add_message_guest", "smiles");if($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if($v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {$v66f6181bcb4cff4cd38fbc804a036db6 = $v9fd81bc973ab5b6a31b5a0d29b4ee87a;}else {if(!(regedit::getInstance()->getVal("//modules/forum/allow_guest"))) {return "";}$v66f6181bcb4cff4cd38fbc804a036db6 = $v9b0c324124acf2ac71c64a147cf0ad42;}}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['void:smiles'] = $v92e290b9214eb54bded0b42969e89fe1;if($v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549)) {$vfca1bff8ad8b3a8585abfb0ad523ba42['id'] = $v7057e8409c7c531a1a6e9ac3df4ed549;$vfca1bff8ad8b3a8585abfb0ad523ba42['name'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getName();$vfca1bff8ad8b3a8585abfb0ad523ba42['action'] = $this->pre_lang . "/forum/message_post_do/" . $v7057e8409c7c531a1a6e9ac3df4ed549 . "/";}return self::parseTemplate($v66f6181bcb4cff4cd38fbc804a036db6, $vfca1bff8ad8b3a8585abfb0ad523ba42, $v7057e8409c7c531a1a6e9ac3df4ed549);}public function topic_post_do() {if($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if(!$v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {if(!(regedit::getInstance()->getVal("//modules/forum/allow_guest"))) {return "%forum_not_allowed_post%";}}}$v6be379826b20cc58475f636e33f4606b = (int) getRequest('param0');$vc975d8201fe751ebb3429336eeee7d3b = umiHierarchy::getInstance()->getElement($v6be379826b20cc58475f636e33f4606b);$vd5d3db1765287eef77d7927cc956f50a = getRequest('title');$v841a2d689ad86bd1611447453c22c6fc = getRequest('body');$vd5d3db1765287eef77d7927cc956f50a = htmlspecialchars($vd5d3db1765287eef77d7927cc956f50a);$v841a2d689ad86bd1611447453c22c6fc = htmlspecialchars($v841a2d689ad86bd1611447453c22c6fc);$ve80674170aae03909a55625e9cc9cf97 = htmlspecialchars(getRequest('nickname'));if (!$ve80674170aae03909a55625e9cc9cf97) $ve80674170aae03909a55625e9cc9cf97 = htmlspecialchars(getRequest('login'));$v0c83f57c786a0b4a39efab23731c7ebc = htmlspecialchars(getRequest('email'));$v957b527bcfbad2e80f58d20683931435 = $_SERVER['REMOTE_ADDR'];$v0faea619a3eb6dfca4ced9bbe5bf4c9a = new umiDate(time());$v12b29cd4a546ab7c02774080f819f7dc = $_SERVER['HTTP_REFERER'];if (isset($_REQUEST['captcha'])) {$_SESSION['user_captcha'] = md5((int) getRequest('captcha'));}if (!umiCaptcha::checkCaptcha()) {$this->errorNewMessage('%errors_wrong_captcha%', false);$this->errorPanic();}if(!strlen(trim($vd5d3db1765287eef77d7927cc956f50a))) {$this->errorNewMessage('%error_title_empty%', false);$this->errorPanic();}if(!strlen(trim($v841a2d689ad86bd1611447453c22c6fc))) {$this->errorNewMessage('%error_message_empty%', false);$this->errorPanic();}$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = cmsController::getInstance()->getCurrentDomain()->getId();$vd02e12eb6d6c3f6ebd763197df01e211 = $vc975d8201fe751ebb3429336eeee7d3b->getTplId();$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "topic")->getId();$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("forum", "topic");$vba96e9a4b5032c443e5f318808e777e3 = false;if($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if($v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {$ve8701ad48ba05a91604e480dd60899a3 = $v5571898aeb5505ee9a9111ddd83598f7->user_id;$vba96e9a4b5032c443e5f318808e777e3 = $v5571898aeb5505ee9a9111ddd83598f7->isSv($ve8701ad48ba05a91604e480dd60899a3);$v4f331e2fa932c4f9b933388ce1df675f = $v5571898aeb5505ee9a9111ddd83598f7->createAuthorUser($ve8701ad48ba05a91604e480dd60899a3);}else {$v4f331e2fa932c4f9b933388ce1df675f = $v5571898aeb5505ee9a9111ddd83598f7->createAuthorGuest($ve80674170aae03909a55625e9cc9cf97, $v0c83f57c786a0b4a39efab23731c7ebc, $v957b527bcfbad2e80f58d20683931435);}}$v7057e8409c7c531a1a6e9ac3df4ed549 = umiHierarchy::getInstance()->addElement($v6be379826b20cc58475f636e33f4606b, $v0715f6d9497f93911417c9c324265771, $vd5d3db1765287eef77d7927cc956f50a, $vd5d3db1765287eef77d7927cc956f50a, $v87306dd4235ed712ebc07fe169b76f83, $v662cbf1253ac7d8750ed9190c52163e5, $v78e6dd7a49f5b0cb2106a3a434dd5c86, $vd02e12eb6d6c3f6ebd763197df01e211);permissionsCollection::getInstance()->setDefaultPermissions($v7057e8409c7c531a1a6e9ac3df4ed549);$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true);$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsVisible(false);$v86c094c8c89978a73128816eb085e9f1 = !$vba96e9a4b5032c443e5f318808e777e3 && regedit::getInstance()->getVal("//modules/forum/need_moder");$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive(!$v86c094c8c89978a73128816eb085e9f1);$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->getObject()->setName($vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("meta_descriptions", "");$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("meta_keywords", "");$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("h1", $vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("title", $vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("is_expanded", false);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("show_submenu", false);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("author_id", $v4f331e2fa932c4f9b933388ce1df675f);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("publish_time", $v0faea619a3eb6dfca4ced9bbe5bf4c9a);if ($v4340fd73e75df7a9d9e45902a59ba3a4 = umiFile::upload("pics", "headers", "./images/cms/headers/")) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("header_pic", $v4340fd73e75df7a9d9e45902a59ba3a4);}$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$_REQUEST['param0'] = $v7057e8409c7c531a1a6e9ac3df4ed549;if (!$v86c094c8c89978a73128816eb085e9f1) {$this->recalcCounts($v8e2dcfd7e7e24b1ca76c1193f645902b);}$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("forum_topic_post_do");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("topic_id", $v7057e8409c7c531a1a6e9ac3df4ed549);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$this->message_post_do();}public function message_post_do() {if($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if(!$v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {if(!(regedit::getInstance()->getVal("//modules/forum/allow_guest"))) {return "%forum_not_allowed_post%";}}}$vd5d3db1765287eef77d7927cc956f50a = getRequest('title');$v841a2d689ad86bd1611447453c22c6fc = getRequest('body');$vd5d3db1765287eef77d7927cc956f50a = htmlspecialchars($vd5d3db1765287eef77d7927cc956f50a);$v841a2d689ad86bd1611447453c22c6fc = htmlspecialchars($v841a2d689ad86bd1611447453c22c6fc);$ve80674170aae03909a55625e9cc9cf97 = htmlspecialchars(getRequest('nickname'));$v0c83f57c786a0b4a39efab23731c7ebc = htmlspecialchars(getRequest('email'));$v957b527bcfbad2e80f58d20683931435 = getServer('REMOTE_ADDR');$v0faea619a3eb6dfca4ced9bbe5bf4c9a = new umiDate(time());$v6be379826b20cc58475f636e33f4606b = (int) getRequest('param0');$vc975d8201fe751ebb3429336eeee7d3b = umiHierarchy::getInstance()->getElement($v6be379826b20cc58475f636e33f4606b, true);if (!strlen(trim($vd5d3db1765287eef77d7927cc956f50a)) && ($vc975d8201fe751ebb3429336eeee7d3b instanceof umiHierarchyElement)) {$vd5d3db1765287eef77d7927cc956f50a = "Re: ".$vc975d8201fe751ebb3429336eeee7d3b->getName();}$v12b29cd4a546ab7c02774080f819f7dc = isset($_SERVER['HTTP_REFERER'])? $_SERVER['HTTP_REFERER'] : '/';if (isset($_REQUEST['captcha'])) {$_SESSION['user_captcha'] = md5((int) getRequest('captcha'));}if (!umiCaptcha::checkCaptcha() || !$vc975d8201fe751ebb3429336eeee7d3b) {$this->errorNewMessage('%errors_wrong_captcha%', false);$this->errorPanic();}if(!strlen(trim($v841a2d689ad86bd1611447453c22c6fc))) {$this->errorNewMessage('%error_message_empty%', false);$this->errorPanic();}$v78e6dd7a49f5b0cb2106a3a434dd5c86 = cmsController::getInstance()->getCurrentLang()->getId();$v662cbf1253ac7d8750ed9190c52163e5 = cmsController::getInstance()->getCurrentDomain()->getId();$vd02e12eb6d6c3f6ebd763197df01e211 = $vc975d8201fe751ebb3429336eeee7d3b->getTplId();$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "message")->getId();$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("forum", "message");$vba96e9a4b5032c443e5f318808e777e3 = false;if ($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if ($v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {$ve8701ad48ba05a91604e480dd60899a3 = $v5571898aeb5505ee9a9111ddd83598f7->user_id;$v4f331e2fa932c4f9b933388ce1df675f = $v5571898aeb5505ee9a9111ddd83598f7->createAuthorUser($ve8701ad48ba05a91604e480dd60899a3);$vba96e9a4b5032c443e5f318808e777e3 = $v5571898aeb5505ee9a9111ddd83598f7->isSv($ve8701ad48ba05a91604e480dd60899a3);}else {$v4f331e2fa932c4f9b933388ce1df675f = $v5571898aeb5505ee9a9111ddd83598f7->createAuthorGuest($ve80674170aae03909a55625e9cc9cf97, $v0c83f57c786a0b4a39efab23731c7ebc, $v957b527bcfbad2e80f58d20683931435);}$v02bd92faa38aaa6cc0ea75e59937a1ef = umiObjectsCollection::getInstance()->getObject($v4f331e2fa932c4f9b933388ce1df675f);$v02bd92faa38aaa6cc0ea75e59937a1ef->commit();}$v7057e8409c7c531a1a6e9ac3df4ed549 = umiHierarchy::getInstance()->addElement($v6be379826b20cc58475f636e33f4606b, $v0715f6d9497f93911417c9c324265771, $vd5d3db1765287eef77d7927cc956f50a, $vd5d3db1765287eef77d7927cc956f50a, $v87306dd4235ed712ebc07fe169b76f83, $v662cbf1253ac7d8750ed9190c52163e5, $v78e6dd7a49f5b0cb2106a3a434dd5c86, $vd02e12eb6d6c3f6ebd763197df01e211);permissionsCollection::getInstance()->setDefaultPermissions($v7057e8409c7c531a1a6e9ac3df4ed549);$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true);$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsVisible(false);$v86c094c8c89978a73128816eb085e9f1 = !$vba96e9a4b5032c443e5f318808e777e3 && regedit::getInstance()->getVal("//modules/forum/need_moder");$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive(!$v86c094c8c89978a73128816eb085e9f1);$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->getObject()->setName($vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("meta_descriptions", "");$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("meta_keywords", "");$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("h1", $vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("title", $vd5d3db1765287eef77d7927cc956f50a);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("is_expanded", false);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("show_submenu", false);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("message", $v841a2d689ad86bd1611447453c22c6fc);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("author_id", $v4f331e2fa932c4f9b933388ce1df675f);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("publish_time", $v0faea619a3eb6dfca4ced9bbe5bf4c9a);if ($v4340fd73e75df7a9d9e45902a59ba3a4 = umiFile::upload("pics", "headers", "./images/cms/headers/")) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("header_pic", $v4340fd73e75df7a9d9e45902a59ba3a4);}$vaf31437ce61345f416579830a98c91e5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getObject()->getId();$ve98bb545c87bd6f12f14ce797342ef54 = cmsController::getInstance()->getModule('data');$ve98bb545c87bd6f12f14ce797342ef54->saveEditedObject($vaf31437ce61345f416579830a98c91e5, true);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();if(!defined("DISABLE_SEARCH_REINDEX")) {define("DISABLE_SEARCH_REINDEX", 1);}if($v6be379826b20cc58475f636e33f4606b) {$va4f09cfeea7392a1f6df6a3de5c3bc9e = umiHierarchy::getInstance()->getElement($v8e2dcfd7e7e24b1ca76c1193f645902b->getRel());if($va4f09cfeea7392a1f6df6a3de5c3bc9e instanceof umiHierarchyElement) {$va4f09cfeea7392a1f6df6a3de5c3bc9e->setValue("last_message", $v7057e8409c7c531a1a6e9ac3df4ed549);$va4f09cfeea7392a1f6df6a3de5c3bc9e->setValue("last_post_time", time());$va4f09cfeea7392a1f6df6a3de5c3bc9e->commit();}$va4f09cfeea7392a1f6df6a3de5c3bc9e = umiHierarchy::getInstance()->getElement($va4f09cfeea7392a1f6df6a3de5c3bc9e->getRel());if($va4f09cfeea7392a1f6df6a3de5c3bc9e instanceof umiHierarchyElement) {$va4f09cfeea7392a1f6df6a3de5c3bc9e->setValue("last_message", $v7057e8409c7c531a1a6e9ac3df4ed549);$va4f09cfeea7392a1f6df6a3de5c3bc9e->commit();}}if (!$v86c094c8c89978a73128816eb085e9f1) {$this->recalcCounts($v8e2dcfd7e7e24b1ca76c1193f645902b);}$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("forum_message_post_do");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("topic_id", $v6be379826b20cc58475f636e33f4606b);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("message_id", $v7057e8409c7c531a1a6e9ac3df4ed549);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$vd6fe1d0be6347b8ef2427fa629c04485 = $v86c094c8c89978a73128816eb085e9f1 ? $v12b29cd4a546ab7c02774080f819f7dc : $this->getMessageLink($v7057e8409c7c531a1a6e9ac3df4ed549);$this->redirect($vd6fe1d0be6347b8ef2427fa629c04485);}public function onMessagePost(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {$v009bc6ca542405d9097ae589731691fb = $v4119639092e62c55ea8be348e4d9260d->getParam("message_id");antiSpamHelper::checkForSpam($v009bc6ca542405d9097ae589731691fb);}public function getMessageLink($v7057e8409c7c531a1a6e9ac3df4ed549) {$v7057e8409c7c531a1a6e9ac3df4ed549 = $this->analyzeRequiredPath($v7057e8409c7c531a1a6e9ac3df4ed549);$v9d85c254b5062e518a134a61950999c3 = $this->per_page;$ve1ba980ce14a8c0d7e2779f895ab8695 = (int) getRequest('p');$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true);$v6be379826b20cc58475f636e33f4606b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();$vc975d8201fe751ebb3429336eeee7d3b = umiHierarchy::getInstance()->getElement($v6be379826b20cc58475f636e33f4606b);if($v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("publish_time"))   $v0faea619a3eb6dfca4ced9bbe5bf4c9a = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("publish_time")->getFormattedDate("U");$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v9d85c254b5062e518a134a61950999c3, $ve1ba980ce14a8c0d7e2779f895ab8695);$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$vcf50d2282682dd498adb071bfee534cf = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", "message")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($vcf50d2282682dd498adb071bfee534cf);$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v6be379826b20cc58475f636e33f4606b);$v87306dd4235ed712ebc07fe169b76f83 = umiObjectTypesCollection::getInstance()->getBaseType("forum", "message");$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);$vd0d5ad0219c6bb59a29b5027add37795 = $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId('publish_time');$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($vd0d5ad0219c6bb59a29b5027add37795, true);$v8be74552df93e31bbdd6b36ed74bdb6a->setPropertyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterLess($vd0d5ad0219c6bb59a29b5027add37795, $v0faea619a3eb6dfca4ced9bbe5bf4c9a);$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v83878c91171338902e0fe0fb97a8c47a = floor(($vfbb44b4487415b134bce9c790a27fe5e - 1) / $this->per_page);if($v83878c91171338902e0fe0fb97a8c47a < 0) $v83878c91171338902e0fe0fb97a8c47a = 0;return umiHierarchy::getInstance()->getPathById($v6be379826b20cc58475f636e33f4606b) . "?p={$v83878c91171338902e0fe0fb97a8c47a}#" . $v7057e8409c7c531a1a6e9ac3df4ed549;}public function getHTypeByName($v9d1d369cb136d359b283cd02165d2cd2) {$vf577a2dd0c3d2f6e885d1dbfde82295e = 0;$v9120c2598e9cfe5d28c02f215d66dd6e = umiHierarchyTypesCollection::getInstance()->getTypeByName("forum", $v9d1d369cb136d359b283cd02165d2cd2);if ($v9120c2598e9cfe5d28c02f215d66dd6e instanceof umiHierarchyType) $vf577a2dd0c3d2f6e885d1dbfde82295e = intval($v9120c2598e9cfe5d28c02f215d66dd6e->getId());return $vf577a2dd0c3d2f6e885d1dbfde82295e;}public function getOTypeByName($v9d1d369cb136d359b283cd02165d2cd2) {$vd3d80c069f36881b944b704c65113edb = 0;$vd3d80c069f36881b944b704c65113edb = umiObjectTypesCollection::getInstance()->getBaseType("forum", $v9d1d369cb136d359b283cd02165d2cd2);return $vd3d80c069f36881b944b704c65113edb;}public function getFieldId($v9185c5fca33b7a8ca1a41b89128ac46c, $v49e2b2de000aa40e2b654230fff5ed3e) {$v87306dd4235ed712ebc07fe169b76f83 = $this->getOTypeByName($v9185c5fca33b7a8ca1a41b89128ac46c);$v7ae7003da59ae71dcc9f8638ef50593d = umiObjectTypesCollection::getInstance()->getType($v87306dd4235ed712ebc07fe169b76f83);return $v7ae7003da59ae71dcc9f8638ef50593d->getFieldId($v49e2b2de000aa40e2b654230fff5ed3e);}public function makeAdminOutputList($v4be3602628aac075af255ca1f05577f2, $v42e8acd0ff7c2f6265955d3f1115584b, $v853ded4a0c315658527d9ba7ed28a3c3, $vee00b4dd5a72dccc8a3bf821a0854ef9, $vf4a0ecf68633a2a8d8bbc8a44a5c8829) {$v7dc5291b1ee158186937dced87c5cdbd = umiSelectionsParser::runSelection($v853ded4a0c315658527d9ba7ed28a3c3);$v8016fd3f91b68b651801a7c279f41ea4 = umiSelectionsParser::runSelectionCounts($v853ded4a0c315658527d9ba7ed28a3c3);$this->setDataType("list");$this->setActionType($v4be3602628aac075af255ca1f05577f2);$this->setDataRange($vee00b4dd5a72dccc8a3bf821a0854ef9, $vf4a0ecf68633a2a8d8bbc8a44a5c8829);$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($v7dc5291b1ee158186937dced87c5cdbd, $v42e8acd0ff7c2f6265955d3f1115584b);$this->setData($v8d777f385d3dfec8815d20f7496026dc, $v8016fd3f91b68b651801a7c279f41ea4);return $this->doData();}public function makeAdminOutputForm($v4be3602628aac075af255ca1f05577f2, $vfaac4d317d6130a7b2f323e9a9694359, $ve62e4d22f2d8630f6e44e2b7c3f70ddc) {$this->setDataType("form");$this->setActionType($v4be3602628aac075af255ca1f05577f2);$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($ve62e4d22f2d8630f6e44e2b7c3f70ddc,  $vfaac4d317d6130a7b2f323e9a9694359);$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}public function getConfTopicsCount($v1e57166c280a9b80005b889ff8281ce2) {$v8e2dcfd7e7e24b1ca76c1193f645902b = selector::get('page')->id($v1e57166c280a9b80005b889ff8281ce2);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement) {return $v8e2dcfd7e7e24b1ca76c1193f645902b->topics_count;}else return '';}public function getConfMessagesCount($v1e57166c280a9b80005b889ff8281ce2) {$v8e2dcfd7e7e24b1ca76c1193f645902b = selector::get('page')->id($v1e57166c280a9b80005b889ff8281ce2);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement) {return $v8e2dcfd7e7e24b1ca76c1193f645902b->messages_count;}else return '';}public function getTopicMessagesCount($v3900b5059c8c1fa240b8c6b53dea8150) {$v8e2dcfd7e7e24b1ca76c1193f645902b = selector::get('page')->id($v3900b5059c8c1fa240b8c6b53dea8150);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement) {return $v8e2dcfd7e7e24b1ca76c1193f645902b->messages_count;}else return '';}public function config () {if (class_exists("__forum")) {return __forum::config();}}public function getEditLink($v7057e8409c7c531a1a6e9ac3df4ed549, $vb8910fa4dc8f637c214b8e9094ef35b9) {$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v6be379826b20cc58475f636e33f4606b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();$v441c674b4099be68caf8fb0f7ff47e3e = $this->pre_lang."/admin/forum/edit/". $v7057e8409c7c531a1a6e9ac3df4ed549."/";switch($vb8910fa4dc8f637c214b8e9094ef35b9) {case "conf":     $v20d49e744b40132da5f81045b5d6ec25 = $this->pre_lang."/admin/forum/add/".$v7057e8409c7c531a1a6e9ac3df4ed549."/topic/";return Array($v20d49e744b40132da5f81045b5d6ec25, $v441c674b4099be68caf8fb0f7ff47e3e);break;case "topic":     $v20d49e744b40132da5f81045b5d6ec25 = $this->pre_lang."/admin/forum/add/".$v7057e8409c7c531a1a6e9ac3df4ed549."/message/";return Array($v20d49e744b40132da5f81045b5d6ec25, $v441c674b4099be68caf8fb0f7ff47e3e);break;case "message":     $v20d49e744b40132da5f81045b5d6ec25 = false;return Array($v20d49e744b40132da5f81045b5d6ec25, $v441c674b4099be68caf8fb0f7ff47e3e);break;default:     return false;break;}}protected function getLastMessageId($v7552cd149af7495ee7d8225974e50f80) {$v8e2dcfd7e7e24b1ca76c1193f645902b = selector::get('page')->id($v7552cd149af7495ee7d8225974e50f80);if($v8e2dcfd7e7e24b1ca76c1193f645902b) {$vd21e774855ba0933b5a2a2b046c6c2c5 = $v8e2dcfd7e7e24b1ca76c1193f645902b->last_message;if(sizeof($vd21e774855ba0933b5a2a2b046c6c2c5) && false) {$vd21e774855ba0933b5a2a2b046c6c2c5 = getArrayKey($vd21e774855ba0933b5a2a2b046c6c2c5, 0);return ($vd21e774855ba0933b5a2a2b046c6c2c5 instanceof iUmiHierarchyElement) ? $vd21e774855ba0933b5a2a2b046c6c2c5->id : false;}else {$vd21e774855ba0933b5a2a2b046c6c2c5 = $this->calculateLastMessageId($v8e2dcfd7e7e24b1ca76c1193f645902b);if($vd21e774855ba0933b5a2a2b046c6c2c5) {if(!defined('DISABLE_SEARCH_REINDEX')) {define('DISABLE_SEARCH_REINDEX', '1');}$v8e2dcfd7e7e24b1ca76c1193f645902b->last_message = $vd21e774855ba0933b5a2a2b046c6c2c5;$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();return $vd21e774855ba0933b5a2a2b046c6c2c5->id;}}}return false;}};?>