<?php
 interface iQuickCsvImporter {public function __construct(umiFile $vb1e3840c73bd1d04e68740c009214532);public function importAsElements($vacf567c9c3d6cf7c6e2cc0ce108e0631 = false, $v72352a4d26581ef082a6d2243c5a6b88 = false);public function importAsObjects($v6301cee35ea764a1e241978f93f01069 = false);public static function autoImport(selector $v8be74552df93e31bbdd6b36ed74bdb6a, $vb8c8ec69026adfe891bf5e618eabb17b = false);};class quickCsvImporter implements iQuickCsvImporter {public $allowNewItemsCreation = true, $forceHierarchy = false, $errors = array();protected $csvFile, $fileHandler, $mode = "object";public function __construct(umiFile $vb1e3840c73bd1d04e68740c009214532) {if($vb1e3840c73bd1d04e68740c009214532->getIsBroken()) {throw new coreException("CSV file doesn't exists: \"" . $vb1e3840c73bd1d04e68740c009214532->getFilePath() . "\"");}$this->csvFile = $vb1e3840c73bd1d04e68740c009214532;$this->openFile();}public function __destruct() {$this->closeFile();}public function importAsElements($vacf567c9c3d6cf7c6e2cc0ce108e0631 = false, $v72352a4d26581ef082a6d2243c5a6b88 = false) {$this->mode = "element";$v6301cee35ea764a1e241978f93f01069 = false;$v0e8133eb006c0f85ed9444ae07a60842 = umiObjectTypesCollection::getInstance();if($v72352a4d26581ef082a6d2243c5a6b88) {$v6301cee35ea764a1e241978f93f01069 = umiHierarchy::getInstance()->getDominantTypeId($v72352a4d26581ef082a6d2243c5a6b88);}if(!$v6301cee35ea764a1e241978f93f01069) {$v6301cee35ea764a1e241978f93f01069 = $v0e8133eb006c0f85ed9444ae07a60842->getTypeByHierarchyTypeId($vacf567c9c3d6cf7c6e2cc0ce108e0631);}$v726e8e4809d4c1b28a6549d86436a124 = $v0e8133eb006c0f85ed9444ae07a60842->getType($v6301cee35ea764a1e241978f93f01069);if(!$vacf567c9c3d6cf7c6e2cc0ce108e0631) {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = $v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId();}$this->importElements($v726e8e4809d4c1b28a6549d86436a124, $vacf567c9c3d6cf7c6e2cc0ce108e0631, $v72352a4d26581ef082a6d2243c5a6b88);}public function importAsObjects($v726e8e4809d4c1b28a6549d86436a124 = false) {$this->importObjects($v726e8e4809d4c1b28a6549d86436a124);}public static function autoImport(selector $v8be74552df93e31bbdd6b36ed74bdb6a, $vb8c8ec69026adfe891bf5e618eabb17b = false) {$v7f2db423a49b305459147332fb01cf87 = outputBuffer::current();$v7f2db423a49b305459147332fb01cf87->contentType('text/html');$v7f2db423a49b305459147332fb01cf87->push("<script type='text/javascript'>\n");if(isset($_FILES['csv-file'])) {$v1ded0622d3320f26b47f514fabab54f1 = getArrayKey($_FILES, 'csv-file');$vb068931cc450442b63f5b3d276ea4297 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'name');$v656840677a2dbd5ab56a2202e415b293 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'tmp_name');$vcb5e100e5a9a3e7f6d1fd97512215282 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'error');$vf7bd60b75b29d79b660a2859395c1a24 = getArrayKey($v1ded0622d3320f26b47f514fabab54f1, 'size');if($vcb5e100e5a9a3e7f6d1fd97512215282) {$v7f2db423a49b305459147332fb01cf87->push("alert('Failed to upload file');\n");}else {$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();$v8c7dd922ad47494fc02c388e12c00eac = umiFile::manualUpload($vb068931cc450442b63f5b3d276ea4297, $v656840677a2dbd5ab56a2202e415b293, $vf7bd60b75b29d79b660a2859395c1a24, $v2245023265ae4cf87d02c8b6ba991139->includeParam('system.runtime-cache'));if(!($v8c7dd922ad47494fc02c388e12c00eac instanceof iUmiFile) || $v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {$v7f2db423a49b305459147332fb01cf87->push("alert('Upload file is broken');\n");}else {$v93473a7344419b15c4219cc2b6c64c6f = new quickCsvImporter($v8c7dd922ad47494fc02c388e12c00eac);$v93473a7344419b15c4219cc2b6c64c6f->forceHierarchy = $vb8c8ec69026adfe891bf5e618eabb17b;$v0e8133eb006c0f85ed9444ae07a60842 = array();$v6942e8fa62b3cc9d93881a58210e2fd7 = array();foreach($v8be74552df93e31bbdd6b36ed74bdb6a->types as $v599dcce2998a6b40b1e38e8c6006cb0a) {if(!is_null($v599dcce2998a6b40b1e38e8c6006cb0a->objectType)) $v0e8133eb006c0f85ed9444ae07a60842[] = $v599dcce2998a6b40b1e38e8c6006cb0a->objectType;if(!is_null($v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType)) $v6942e8fa62b3cc9d93881a58210e2fd7[] = $v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType;}if(!$vb8c8ec69026adfe891bf5e618eabb17b && !sizeof($v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy)) {if(sizeof($v0e8133eb006c0f85ed9444ae07a60842)) {$v93473a7344419b15c4219cc2b6c64c6f->importAsObjects($v0e8133eb006c0f85ed9444ae07a60842[0]);$v7f2db423a49b305459147332fb01cf87->push("//Upload completed\n");}}else {if(sizeof($v6942e8fa62b3cc9d93881a58210e2fd7) > 1) {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = false;for($v865c0c0b4ab0e063e5caa3387c1a8741 = sizeof($v6942e8fa62b3cc9d93881a58210e2fd7) - 1;$v865c0c0b4ab0e063e5caa3387c1a8741 >= 0;$v865c0c0b4ab0e063e5caa3387c1a8741--) {if($v6942e8fa62b3cc9d93881a58210e2fd7[$v865c0c0b4ab0e063e5caa3387c1a8741]->getId() == 21) {continue;}$vacf567c9c3d6cf7c6e2cc0ce108e0631 = $v6942e8fa62b3cc9d93881a58210e2fd7[$v865c0c0b4ab0e063e5caa3387c1a8741]->getId();break;}$v72352a4d26581ef082a6d2243c5a6b88 = false;if($v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy) {$v72352a4d26581ef082a6d2243c5a6b88 = $v8be74552df93e31bbdd6b36ed74bdb6a->hierarchy->elementId;}if($v72352a4d26581ef082a6d2243c5a6b88) {$vfabf67ff39a368b3c0eae3c66d81cc5e = umiHierarchy::getInstance()->getDominantTypeId($v72352a4d26581ef082a6d2243c5a6b88);if($vfabf67ff39a368b3c0eae3c66d81cc5e) {$v726e8e4809d4c1b28a6549d86436a124 = umiObjectTypesCollection::getInstance()->getType($vfabf67ff39a368b3c0eae3c66d81cc5e);if($ve6d258c789c675bb2d39aa58e3bc6fb0 = $v726e8e4809d4c1b28a6549d86436a124->getHierarchyTypeId()) {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = $ve6d258c789c675bb2d39aa58e3bc6fb0;}}}$v93473a7344419b15c4219cc2b6c64c6f->importAsElements($vacf567c9c3d6cf7c6e2cc0ce108e0631, $v72352a4d26581ef082a6d2243c5a6b88);}}$v8c7dd922ad47494fc02c388e12c00eac->delete();}}}else {$v7f2db423a49b305459147332fb01cf87->push("alert('File is not posted');\n");}$v7f2db423a49b305459147332fb01cf87->push("window.parent.csvQuickImportCallback();\n");$v7f2db423a49b305459147332fb01cf87->push("</script>\n");$v7f2db423a49b305459147332fb01cf87->end();}protected function importElements(umiObjectType $v726e8e4809d4c1b28a6549d86436a124, $vacf567c9c3d6cf7c6e2cc0ce108e0631, $v72352a4d26581ef082a6d2243c5a6b88) {$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->splitRow($this->readNextRow());$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$permissions = permissionsCollection::getInstance();def_module::$noRedirectOnPanic = true;$v76cf1d4ff412fd3cb644aa58a53c78dc = Array();$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->analyzeHeaders($v726e8e4809d4c1b28a6549d86436a124, $v4340fd73e75df7a9d9e45902a59ba3a4);while($vf1965a857bc285d26fe22023aa5ab50d = $this->readNextRow()) {$v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->splitRow($vf1965a857bc285d26fe22023aa5ab50d);$v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->analyzeColumns($v4340fd73e75df7a9d9e45902a59ba3a4, $v07d43db2a74336dcfbdaeeeffe6f7a19);if(!isset($v07d43db2a74336dcfbdaeeeffe6f7a19['id'])) continue;$v7552cd149af7495ee7d8225974e50f80 = $v07d43db2a74336dcfbdaeeeffe6f7a19['id'];if($v7552cd149af7495ee7d8225974e50f80) {$v53cc4db543d7a569e51c1d76ac6f278e = "systemModifyElement";$v1c0600fd6342c3a498944309318b7689 = $v7552cd149af7495ee7d8225974e50f80;}else if($v72352a4d26581ef082a6d2243c5a6b88 && !$this->forceHierarchy) {$v53cc4db543d7a569e51c1d76ac6f278e = "systemCreateElement";$v1c0600fd6342c3a498944309318b7689 = "new";if(!$v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name']) {$v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'] = $v07d43db2a74336dcfbdaeeeffe6f7a19['name'];}$v7552cd149af7495ee7d8225974e50f80 = $vb81ca7c0ccaa77e7aa91936ab0070695->addElement($v72352a4d26581ef082a6d2243c5a6b88, $vacf567c9c3d6cf7c6e2cc0ce108e0631, $v07d43db2a74336dcfbdaeeeffe6f7a19['name'], $v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'], $v726e8e4809d4c1b28a6549d86436a124->getId());$v07d43db2a74336dcfbdaeeeffe6f7a19['id'] = $v7552cd149af7495ee7d8225974e50f80;$permissions->setDefaultPermissions($v7552cd149af7495ee7d8225974e50f80);}else {continue;}$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7552cd149af7495ee7d8225974e50f80, ($v7552cd149af7495ee7d8225974e50f80 == "new"));if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement == false) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      'id' => $v7552cd149af7495ee7d8225974e50f80,      'name' => $v07d43db2a74336dcfbdaeeeffe6f7a19['name'],      'error' => getLabel('csv-error-not-found')     );continue;}if($v1c0600fd6342c3a498944309318b7689 != "new") {if($v8e2dcfd7e7e24b1ca76c1193f645902b->getTypeId() != $vacf567c9c3d6cf7c6e2cc0ce108e0631) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(       'id' => $v7552cd149af7495ee7d8225974e50f80,       'name' => $v07d43db2a74336dcfbdaeeeffe6f7a19['name'],       'error' => getLabel('csv-error-wrong-type')      );continue;}}if(isset($v07d43db2a74336dcfbdaeeeffe6f7a19['name'])) $_REQUEST['name'] = $v07d43db2a74336dcfbdaeeeffe6f7a19['name'];if(isset($v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'])) $_REQUEST['alt_name'] = $v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name'];if(isset($v07d43db2a74336dcfbdaeeeffe6f7a19['is-active'])) $_REQUEST['is_active'] = $v07d43db2a74336dcfbdaeeeffe6f7a19['is-active'];foreach($v07d43db2a74336dcfbdaeeeffe6f7a19 as $v972bf3f05d14ffbdb817bef60638ff00 => $v2063c1608d6e0baf80249c42e2be5804) {$_REQUEST['data'][$v1c0600fd6342c3a498944309318b7689][$v972bf3f05d14ffbdb817bef60638ff00] = $v2063c1608d6e0baf80249c42e2be5804;}try {$v4119639092e62c55ea8be348e4d9260d = new umiEventPoint($v53cc4db543d7a569e51c1d76ac6f278e);$v4119639092e62c55ea8be348e4d9260d->addRef("element", $v8e2dcfd7e7e24b1ca76c1193f645902b);$v4119639092e62c55ea8be348e4d9260d->setMode("before");$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      "id" => $v1c0600fd6342c3a498944309318b7689,      "error" => $ve1671797c52e15f763380b45e841ec32->getMessage(),      "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19['name']     );if($v1c0600fd6342c3a498944309318b7689 == "new") {$vb81ca7c0ccaa77e7aa91936ab0070695->delElement($v8e2dcfd7e7e24b1ca76c1193f645902b);}continue;}if($v1c0600fd6342c3a498944309318b7689 == 'new') {$v19fad0416b4b101ab72faccf4c323024 = ($v8e2dcfd7e7e24b1ca76c1193f645902b->getModule() == 'content');$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsVisible($v19fad0416b4b101ab72faccf4c323024);}foreach($v07d43db2a74336dcfbdaeeeffe6f7a19 as $v972bf3f05d14ffbdb817bef60638ff00 => $v2063c1608d6e0baf80249c42e2be5804) {switch($v972bf3f05d14ffbdb817bef60638ff00) {case "id": continue;case "name": {$v8e2dcfd7e7e24b1ca76c1193f645902b->setName($v2063c1608d6e0baf80249c42e2be5804);break;}case "alt-name": {$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v07d43db2a74336dcfbdaeeeffe6f7a19['alt-name']);break;}case "is-active": {$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive($v07d43db2a74336dcfbdaeeeffe6f7a19['is-active']);break;}default: {try {$this->modifyProperty($v8e2dcfd7e7e24b1ca76c1193f645902b, $v972bf3f05d14ffbdb817bef60638ff00, $v2063c1608d6e0baf80249c42e2be5804);}catch (fieldRestrictionException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(         "id" => $vccae550f37edb4e56f3bf01df9953a6f,         "error" => $ve1671797c52e15f763380b45e841ec32->getMessage(),         "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19[$v972bf3f05d14ffbdb817bef60638ff00]        );}break;}}}try {$v4119639092e62c55ea8be348e4d9260d->setMode("after");$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      "id" => $v1c0600fd6342c3a498944309318b7689,      "error" => $ve1671797c52e15f763380b45e841ec32->getMessage(),      "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19['name']     );if($vccae550f37edb4e56f3bf01df9953a6f == "new") {$vb81ca7c0ccaa77e7aa91936ab0070695->delElement($v7552cd149af7495ee7d8225974e50f80);}continue;}unset($_REQUEST['name']);unset($_REQUEST['alt_name']);unset($_REQUEST['is_active']);$_REQUEST['data'][$v1c0600fd6342c3a498944309318b7689];$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();unset($v8e2dcfd7e7e24b1ca76c1193f645902b);$vb81ca7c0ccaa77e7aa91936ab0070695->unloadElement($v7552cd149af7495ee7d8225974e50f80);}def_module::$noRedirectOnPanic = true;if(sizeof($v76cf1d4ff412fd3cb644aa58a53c78dc)) {echo "var err = '" . getLabel('csv-error-import-list') . "\\n';\n";foreach($v76cf1d4ff412fd3cb644aa58a53c78dc as $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb) {if($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id'] == "new") {echo "err += '{$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name']} (" . getLabel('csv-new-item') . ") - {$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']}\\n';\n";}else {echo "err += '{$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name']} (#{$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id']}) - {$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']}\\n';\n";}}echo "alert(err);\n\n";}}protected function importObjects(umiObjectType $v726e8e4809d4c1b28a6549d86436a124) {$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->splitRow($this->readNextRow());$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();def_module::$noRedirectOnPanic = true;$v4340fd73e75df7a9d9e45902a59ba3a4 = $this->analyzeHeaders($v726e8e4809d4c1b28a6549d86436a124, $v4340fd73e75df7a9d9e45902a59ba3a4);$v76cf1d4ff412fd3cb644aa58a53c78dc = Array();while($vf1965a857bc285d26fe22023aa5ab50d = $this->readNextRow()) {$v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->splitRow($vf1965a857bc285d26fe22023aa5ab50d);$v07d43db2a74336dcfbdaeeeffe6f7a19 = $this->analyzeColumns($v4340fd73e75df7a9d9e45902a59ba3a4, $v07d43db2a74336dcfbdaeeeffe6f7a19);if(!isset($v07d43db2a74336dcfbdaeeeffe6f7a19['id'])) continue;$v16b2b26000987faccb260b9d39df1269 = $v07d43db2a74336dcfbdaeeeffe6f7a19['id'];if($v16b2b26000987faccb260b9d39df1269) {$vccae550f37edb4e56f3bf01df9953a6f = $v16b2b26000987faccb260b9d39df1269;$v53cc4db543d7a569e51c1d76ac6f278e = "systemModifyObject";}else {$v53cc4db543d7a569e51c1d76ac6f278e = "systemCreateObject";$v16b2b26000987faccb260b9d39df1269 = $v5891da2d64975cae48d175d1e001f5da->addObject("Temporary object name", $v726e8e4809d4c1b28a6549d86436a124->getId());echo "//Create new object \"{$v07d43db2a74336dcfbdaeeeffe6f7a19['name']}\" of type {$v726e8e4809d4c1b28a6549d86436a124->getId()}, id #{$v16b2b26000987faccb260b9d39df1269}\n";$vccae550f37edb4e56f3bf01df9953a6f = "new";}$va8cfde6331bd59eb2ac96f8911c4b666 = $v5891da2d64975cae48d175d1e001f5da->getObject($v16b2b26000987faccb260b9d39df1269);if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject == false) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      "id" => $v16b2b26000987faccb260b9d39df1269,      "error" => getLabel('csv-error-not-found'),      "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19['name']     );continue;}if($va8cfde6331bd59eb2ac96f8911c4b666->getTypeId() != $v726e8e4809d4c1b28a6549d86436a124->getId()) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      "id" => $v16b2b26000987faccb260b9d39df1269,      "error" => getLabel('csv-error-wrong-type'),      "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19['name']     );continue;}$vd05b6ed7d2345020440df396d6da7f73 = umiFieldsCollection::getInstance();$_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f] = Array();foreach($v4340fd73e75df7a9d9e45902a59ba3a4 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v46b9e6004c49d9cc040029c197cab278) {if($v865c0c0b4ab0e063e5caa3387c1a8741 == 'id') continue;if($v865c0c0b4ab0e063e5caa3387c1a8741 == 'name' && isset($v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741])) {$_REQUEST['name'] = $v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741];}if(isset($v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741])) {$_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f][$v865c0c0b4ab0e063e5caa3387c1a8741] = $v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741];}}try {$v4119639092e62c55ea8be348e4d9260d = new umiEventPoint($v53cc4db543d7a569e51c1d76ac6f278e);$v4119639092e62c55ea8be348e4d9260d->addRef("object", $va8cfde6331bd59eb2ac96f8911c4b666);$v4119639092e62c55ea8be348e4d9260d->setMode("before");$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      "id" => $vccae550f37edb4e56f3bf01df9953a6f,      "error" => $ve1671797c52e15f763380b45e841ec32->getMessage(),      "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19['name']     );if($vccae550f37edb4e56f3bf01df9953a6f == "new") {$v5891da2d64975cae48d175d1e001f5da->delObject($v16b2b26000987faccb260b9d39df1269);}continue 1;}foreach($v07d43db2a74336dcfbdaeeeffe6f7a19 as $v972bf3f05d14ffbdb817bef60638ff00 => $v2063c1608d6e0baf80249c42e2be5804) {switch($v972bf3f05d14ffbdb817bef60638ff00) {case "id": continue;case "name": {$va8cfde6331bd59eb2ac96f8911c4b666->setName($v2063c1608d6e0baf80249c42e2be5804);break;}default: {try {$this->modifyProperty($va8cfde6331bd59eb2ac96f8911c4b666, $v972bf3f05d14ffbdb817bef60638ff00, $v2063c1608d6e0baf80249c42e2be5804);}catch (fieldRestrictionException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(         "id" => $vccae550f37edb4e56f3bf01df9953a6f,         "error" => $ve1671797c52e15f763380b45e841ec32->getMessage(),         "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19[$v972bf3f05d14ffbdb817bef60638ff00]        );}break;}}}$va8cfde6331bd59eb2ac96f8911c4b666->commit();try {$v4119639092e62c55ea8be348e4d9260d->setMode("after");$v4119639092e62c55ea8be348e4d9260d->call();}catch (errorPanicException $ve1671797c52e15f763380b45e841ec32) {$v76cf1d4ff412fd3cb644aa58a53c78dc[] = Array(      "id" => $vccae550f37edb4e56f3bf01df9953a6f,      "error" => $ve1671797c52e15f763380b45e841ec32->getMessage(),      "name" => $v07d43db2a74336dcfbdaeeeffe6f7a19['name']     );if($vccae550f37edb4e56f3bf01df9953a6f == "new") {$v5891da2d64975cae48d175d1e001f5da->delObject($v16b2b26000987faccb260b9d39df1269);}continue 1;}unset($_REQUEST['data'][$vccae550f37edb4e56f3bf01df9953a6f]);unset($va8cfde6331bd59eb2ac96f8911c4b666);}def_module::$noRedirectOnPanic = false;if(sizeof($v76cf1d4ff412fd3cb644aa58a53c78dc)) {echo "var err = '" . getLabel('csv-error-import-list') . ":\\n';\n";foreach($v76cf1d4ff412fd3cb644aa58a53c78dc as $v6b3e9cdfd9fd6b6f313d7dd4526c9ceb) {if($v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id'] == "new") {echo "err += '{$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name']} (" . getLabel('csv-new-item') . ") - {$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']}\\n';\n";}else {echo "err += '{$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['name']} (#{$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['id']}) - {$v6b3e9cdfd9fd6b6f313d7dd4526c9ceb['error']}\\n';\n";}}echo "alert(err);\n\n";}}protected function readNextRow() {$result = "";$vc1cbfe271a40788a00e8bf8574d94d4b = $this->getFileHandler();if(feof($vc1cbfe271a40788a00e8bf8574d94d4b)) {return false;}else {return iconv("CP1251", "UTF-8//IGNORE", trim(fgets($vc1cbfe271a40788a00e8bf8574d94d4b, 10240)));}}protected function splitRow($vbbd8471fbb71b98724406e29408dcdb0) {$v07d43db2a74336dcfbdaeeeffe6f7a19 = Array();if(substr($vbbd8471fbb71b98724406e29408dcdb0, -1) != ";") $vbbd8471fbb71b98724406e29408dcdb0 .= ";";$vf5a8e923f8cd24b56b3bab32358cc58a = strlen($vbbd8471fbb71b98724406e29408dcdb0);$va87deb01c5f539e6bda34829c8ef2368 = "";$vb742f355c37e48e44c2817f798ee3f72 = "";$v7c7ec62e9b0800581f0ea493ababd3f0 = "";for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $vf5a8e923f8cd24b56b3bab32358cc58a;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$va87deb01c5f539e6bda34829c8ef2368 = substr($vbbd8471fbb71b98724406e29408dcdb0, $v865c0c0b4ab0e063e5caa3387c1a8741, 1);switch($va87deb01c5f539e6bda34829c8ef2368) {case ";": {if($vb742f355c37e48e44c2817f798ee3f72 != "\\") {$v07d43db2a74336dcfbdaeeeffe6f7a19[] = $v7c7ec62e9b0800581f0ea493ababd3f0;$v7c7ec62e9b0800581f0ea493ababd3f0 = "";break;}else {$v7c7ec62e9b0800581f0ea493ababd3f0 = substr($v7c7ec62e9b0800581f0ea493ababd3f0, 0, strlen($v7c7ec62e9b0800581f0ea493ababd3f0) - 1) . ";";break;}}case "\"": {if(substr($vbbd8471fbb71b98724406e29408dcdb0, $v865c0c0b4ab0e063e5caa3387c1a8741, 2) != "\"\"") {break;}else {if(substr($vbbd8471fbb71b98724406e29408dcdb0, $v865c0c0b4ab0e063e5caa3387c1a8741, 3) != "\"\";") {$v7c7ec62e9b0800581f0ea493ababd3f0 = $v7c7ec62e9b0800581f0ea493ababd3f0 . "\"";}$v865c0c0b4ab0e063e5caa3387c1a8741++;break;}}default: {$v7c7ec62e9b0800581f0ea493ababd3f0 .= $va87deb01c5f539e6bda34829c8ef2368;}}$vb742f355c37e48e44c2817f798ee3f72 = $va87deb01c5f539e6bda34829c8ef2368;}return $v07d43db2a74336dcfbdaeeeffe6f7a19;}protected function modifyProperty(umiEntinty $va8cfde6331bd59eb2ac96f8911c4b666, $v972bf3f05d14ffbdb817bef60638ff00, $v5b57ab60c984eec4bc98143f6d1e8775) {if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof umiObject) {$v6301cee35ea764a1e241978f93f01069 = $va8cfde6331bd59eb2ac96f8911c4b666->getTypeId();}else {$v6301cee35ea764a1e241978f93f01069 = $va8cfde6331bd59eb2ac96f8911c4b666->getObject()->getTypeId();}$v726e8e4809d4c1b28a6549d86436a124 = umiObjectTypesCollection::getInstance()->getType($v6301cee35ea764a1e241978f93f01069);if($v726e8e4809d4c1b28a6549d86436a124 instanceof umiObjectType == false) {throw new coreException("Object type #{$v6301cee35ea764a1e241978f93f01069} not found");}$v945100186b119048837b9859c2c46410 = $v726e8e4809d4c1b28a6549d86436a124->getFieldId($v972bf3f05d14ffbdb817bef60638ff00);$v06e3d36fa30cea095545139854ad1fb9 = umiFieldsCollection::getInstance()->getField($v945100186b119048837b9859c2c46410);if($v06e3d36fa30cea095545139854ad1fb9 instanceof umiField) {$v2063c1608d6e0baf80249c42e2be5804 = $this->prepareValue($v06e3d36fa30cea095545139854ad1fb9, $v5b57ab60c984eec4bc98143f6d1e8775);return $va8cfde6331bd59eb2ac96f8911c4b666->setValue($v06e3d36fa30cea095545139854ad1fb9->getName(), $v2063c1608d6e0baf80249c42e2be5804);}else return false;}protected function getFieldId(umiObjectType $v726e8e4809d4c1b28a6549d86436a124, $v46b9e6004c49d9cc040029c197cab278) {foreach($v726e8e4809d4c1b28a6549d86436a124->getAllFields() as $v06e3d36fa30cea095545139854ad1fb9) {if($v06e3d36fa30cea095545139854ad1fb9->getTitle() == $v46b9e6004c49d9cc040029c197cab278) {return $v06e3d36fa30cea095545139854ad1fb9->getId();}if($this->getFieldAlias($v46b9e6004c49d9cc040029c197cab278)) {if($this->getFieldAlias($v06e3d36fa30cea095545139854ad1fb9->getTitle()) == $this->getFieldAlias($v46b9e6004c49d9cc040029c197cab278)) {return $v06e3d36fa30cea095545139854ad1fb9->getId();}}}return false;}protected function getFieldAlias($v46b9e6004c49d9cc040029c197cab278) {$v46b9e6004c49d9cc040029c197cab278 = getI18N($v46b9e6004c49d9cc040029c197cab278);$v47c80780ab608cc046f2a6e6f071feb6 = Array('photo' => Array('field-photo', 'field-image', 'field-izobrazhenie', 'field-photo-s'));if(substr($v46b9e6004c49d9cc040029c197cab278, 0, 6) == "i18n::") {$v46b9e6004c49d9cc040029c197cab278 = substr($v46b9e6004c49d9cc040029c197cab278, 6);}foreach($v47c80780ab608cc046f2a6e6f071feb6 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v9e3669d19b675bd57058fd4664205d2a) {if(in_array($v46b9e6004c49d9cc040029c197cab278, $v9e3669d19b675bd57058fd4664205d2a)) {return $v865c0c0b4ab0e063e5caa3387c1a8741;}}return false;}protected function prepareValue(umiField $v06e3d36fa30cea095545139854ad1fb9, $v5b57ab60c984eec4bc98143f6d1e8775) {$v833750ac635fcc57dc33ecafe365f9a7 = $v06e3d36fa30cea095545139854ad1fb9->getFieldType();switch($v833750ac635fcc57dc33ecafe365f9a7->getDataType()) {case "relation": {$result = preg_split("/, ?/", $v5b57ab60c984eec4bc98143f6d1e8775);foreach($result as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {if($v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$i18n = ulangStream::getI18n($v3a6d0284e743dc4a9b86f97d6dd1a3bf);$result[$v865c0c0b4ab0e063e5caa3387c1a8741] = $i18n ? $i18n : $v3a6d0284e743dc4a9b86f97d6dd1a3bf;}}return $result;}case "tags": {return preg_split("/, ?/", $v5b57ab60c984eec4bc98143f6d1e8775);}case "int": {return (int) $v5b57ab60c984eec4bc98143f6d1e8775;}case "float":    case "price": {return (float) $v5b57ab60c984eec4bc98143f6d1e8775;break;}case "date": {if($v5b57ab60c984eec4bc98143f6d1e8775) {return umiDate::getTimeStamp($v5b57ab60c984eec4bc98143f6d1e8775);}else {return false;}}case "file":    case "img_file":    case "swf_file": {if($v5b57ab60c984eec4bc98143f6d1e8775 && substr($v5b57ab60c984eec4bc98143f6d1e8775, 0, 1) == "/") {$v5b57ab60c984eec4bc98143f6d1e8775 = "." . $v5b57ab60c984eec4bc98143f6d1e8775;}return $v5b57ab60c984eec4bc98143f6d1e8775;}default: {return $v5b57ab60c984eec4bc98143f6d1e8775;}}}protected function openFile() {$this->fileHandler = fopen($this->csvFile->getFilePath(), "r");}protected function getFileHandler() {return $this->fileHandler;}protected function closeFile() {if($vc1cbfe271a40788a00e8bf8574d94d4b = $this->getFileHandler()) {fclose($vc1cbfe271a40788a00e8bf8574d94d4b);}if($this->csvFile instanceof umiFile) {$this->csvFile->delete();}}protected function analyzeColumns($v4340fd73e75df7a9d9e45902a59ba3a4, $v07d43db2a74336dcfbdaeeeffe6f7a19) {$result = Array();$v01ae5af0b0bdd5f727b2e7315c747739 = array_keys($v4340fd73e75df7a9d9e45902a59ba3a4);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < sizeof($v01ae5af0b0bdd5f727b2e7315c747739);$v865c0c0b4ab0e063e5caa3387c1a8741++) {$result[$v01ae5af0b0bdd5f727b2e7315c747739[$v865c0c0b4ab0e063e5caa3387c1a8741]] = isset($v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741]) ? $v07d43db2a74336dcfbdaeeeffe6f7a19[$v865c0c0b4ab0e063e5caa3387c1a8741] : NULL;}return $result;}protected function analyzeHeaders(umiObjectType $v726e8e4809d4c1b28a6549d86436a124, $v4340fd73e75df7a9d9e45902a59ba3a4) {$result = Array();$vd05b6ed7d2345020440df396d6da7f73 = umiFieldsCollection::getInstance();$v865c0c0b4ab0e063e5caa3387c1a8741 = 0;foreach($v4340fd73e75df7a9d9e45902a59ba3a4 as $vd5d3db1765287eef77d7927cc956f50a) {switch(wa_strtolower($vd5d3db1765287eef77d7927cc956f50a)) {case "id":      $result['id'] = $vd5d3db1765287eef77d7927cc956f50a;break;case wa_strtolower(getLabel('label-name')):      $result['name'] = $vd5d3db1765287eef77d7927cc956f50a;break;case wa_strtolower(getLabel('label-alt-name')):      if($this->mode == "element") {$result['alt-name'] = $vd5d3db1765287eef77d7927cc956f50a;break;}case wa_strtolower(getLabel('field-is_active')):      if($this->mode == "element") {$result['is-active'] = $vd5d3db1765287eef77d7927cc956f50a;break;}default: {$v945100186b119048837b9859c2c46410 = $this->getFieldId($v726e8e4809d4c1b28a6549d86436a124, $vd5d3db1765287eef77d7927cc956f50a);$v06e3d36fa30cea095545139854ad1fb9 = $vd05b6ed7d2345020440df396d6da7f73->getField($v945100186b119048837b9859c2c46410);if($v06e3d36fa30cea095545139854ad1fb9 instanceof umiField) {$result[$v06e3d36fa30cea095545139854ad1fb9->getName()] = $vd5d3db1765287eef77d7927cc956f50a;}else {$result['unkonwn-field-' . (++$v865c0c0b4ab0e063e5caa3387c1a8741)] = $vd5d3db1765287eef77d7927cc956f50a;}}}}return $result;}};?>