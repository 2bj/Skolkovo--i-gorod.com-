<?php
 class CopyDirectoryAction extends atomicAction {protected $movedItems = Array(), $targetDirectory;public function execute() {$vb5a14a72bf8c23f88b41e0760e9156d4 = $this->getParam("source-directory");$v207e5b7e7d2b07f6b19066e8d62f4b1d = $this->getParam("target-directory");$this->checkDirectory($vb5a14a72bf8c23f88b41e0760e9156d4);$this->checkDirectory($v207e5b7e7d2b07f6b19066e8d62f4b1d);$this->targetDirectory = $v207e5b7e7d2b07f6b19066e8d62f4b1d;$this->sourceDirectory = $vb5a14a72bf8c23f88b41e0760e9156d4;if($vb5a14a72bf8c23f88b41e0760e9156d4) {$this->copyDirectory(new umiDirectory($vb5a14a72bf8c23f88b41e0760e9156d4));}else {throw new Exception("No items to copy");}}public function rollback() {$v48f735ca02261c9ff241a6529c1167c8 = $this->movedItems;$v48f735ca02261c9ff241a6529c1167c8 = array_reverse($v48f735ca02261c9ff241a6529c1167c8);foreach($v48f735ca02261c9ff241a6529c1167c8 as $v447b7147e84be512208dcc0995d67ebc) {if(is_file($v447b7147e84be512208dcc0995d67ebc . ".bak")) {copy($v447b7147e84be512208dcc0995d67ebc . ".bak", $v447b7147e84be512208dcc0995d67ebc);unlink($v447b7147e84be512208dcc0995d67ebc . ".bak");}else if (is_file($v447b7147e84be512208dcc0995d67ebc)) {unlink($v447b7147e84be512208dcc0995d67ebc);}else if (is_dir($v447b7147e84be512208dcc0995d67ebc)) {rmdir($v447b7147e84be512208dcc0995d67ebc);}}}protected function checkDirectory($v5f8f22b8cdbaeee8cf857673a9b6ba20) {if(is_dir($v5f8f22b8cdbaeee8cf857673a9b6ba20)) {return;}else if(mkdir($v5f8f22b8cdbaeee8cf857673a9b6ba20, 0777)) {return;}else {throw new Exception("Can't create temporary directory");}}protected function copyDirectory(umiDirectory $v736007832d2167baaae763fd3a3f3cf1) {$ve6c2a6346c15ba2584950ab8e0f946f8 = $this->targetDirectory . substr($v736007832d2167baaae763fd3a3f3cf1->getPath(), strlen($this->sourceDirectory));if($ve6c2a6346c15ba2584950ab8e0f946f8) {if(is_dir($ve6c2a6346c15ba2584950ab8e0f946f8) == false) {mkdir($ve6c2a6346c15ba2584950ab8e0f946f8, 0777, true);$this->movedItems[] = $ve6c2a6346c15ba2584950ab8e0f946f8;}}foreach($v736007832d2167baaae763fd3a3f3cf1 as $v447b7147e84be512208dcc0995d67ebc) {if($v447b7147e84be512208dcc0995d67ebc instanceof umiDirectory) {$this->copyDirectory($v447b7147e84be512208dcc0995d67ebc);}if($v447b7147e84be512208dcc0995d67ebc instanceof umiFile) {$this->copyFile($v447b7147e84be512208dcc0995d67ebc);}}}protected function copyFile(umiFile $v8c7dd922ad47494fc02c388e12c00eac) {$vba1383ce0ab1b09b605e4c7010356023 = $v8c7dd922ad47494fc02c388e12c00eac->getFilePath();$ve6c2a6346c15ba2584950ab8e0f946f8 = $this->targetDirectory . substr($vba1383ce0ab1b09b605e4c7010356023, strlen($this->sourceDirectory));if(is_file($ve6c2a6346c15ba2584950ab8e0f946f8)) {copy($ve6c2a6346c15ba2584950ab8e0f946f8, $ve6c2a6346c15ba2584950ab8e0f946f8 . ".bak");}copy($vba1383ce0ab1b09b605e4c7010356023, $ve6c2a6346c15ba2584950ab8e0f946f8);$this->movedItems[] = $ve6c2a6346c15ba2584950ab8e0f946f8;}};?>