<?php
 class selectorExecutor {protected   $selector,   $queryColumns = array(),   $queryTables = array(),   $queryLimit = array(),   $queryFields = array(),   $queryOptions = array('SQL_CACHE'),      $length = null;public function __construct(selector $v5b3c32009797feb79096d52e56a56b82) {$this->selector = $v5b3c32009797feb79096d52e56a56b82;$this->analyze();}public function query() {return $this->buildQuery('result');}public function result() {$vac5c74b64b4b8352ef2f181affb5ac2a = $this->buildQuery('result');if(defined('DEBUG_SQL_SELECTOR')) {echo $vac5c74b64b4b8352ef2f181affb5ac2a, "\n\n\n";}$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);if(!DISABLE_CALC_FOUND_ROWS) {$v770c639e20ac2f19c5ae0da373080e25 = l_mysql_query("SELECT FOUND_ROWS()", true);list($ve2942a04780e223b215eb8b663cf5353) = mysql_fetch_row($v770c639e20ac2f19c5ae0da373080e25);mysql_free_result($v770c639e20ac2f19c5ae0da373080e25);$this->length = (int) $ve2942a04780e223b215eb8b663cf5353;}if($this->selector->mode == 'objects') {$v10ae9fc7d453b0dd525d0edf2ede7961 = array();$v5891da2d64975cae48d175d1e001f5da = umiObjectsCollection::getInstance();while(list($v16b2b26000987faccb260b9d39df1269) = mysql_fetch_row($result)) {$va8cfde6331bd59eb2ac96f8911c4b666 = $v5891da2d64975cae48d175d1e001f5da->getObject($v16b2b26000987faccb260b9d39df1269);if($va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {$v10ae9fc7d453b0dd525d0edf2ede7961[] = $va8cfde6331bd59eb2ac96f8911c4b666;}}return $v10ae9fc7d453b0dd525d0edf2ede7961;}else {$va7ef1586e4bce6064f74264fbbab9165 = array();$permissions = null;while(list($v7552cd149af7495ee7d8225974e50f80) = $vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_row($result)) {if(isset($vf1965a857bc285d26fe22023aa5ab50d[1])) {if(is_null($permissions)) {$permissions = permissionsCollection::getInstance();}$permissions->pushElementPermissions($v7552cd149af7495ee7d8225974e50f80, $vf1965a857bc285d26fe22023aa5ab50d[1]);}$va7ef1586e4bce6064f74264fbbab9165[] = $v7552cd149af7495ee7d8225974e50f80;}if($this->selector->option('exclude-nested')) {$va7ef1586e4bce6064f74264fbbab9165 = $this->excludeNestedPages($va7ef1586e4bce6064f74264fbbab9165);$this->length = sizeof($va7ef1586e4bce6064f74264fbbab9165);}$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v10ae9fc7d453b0dd525d0edf2ede7961 = array();foreach($va7ef1586e4bce6064f74264fbbab9165 as $v7552cd149af7495ee7d8225974e50f80) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7552cd149af7495ee7d8225974e50f80);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof iUmiHierarchyElement) {$v10ae9fc7d453b0dd525d0edf2ede7961[] = $v8e2dcfd7e7e24b1ca76c1193f645902b;}}return $v10ae9fc7d453b0dd525d0edf2ede7961;}}public function length() {if(!is_null($this->length)) {return $this->length;}$vac5c74b64b4b8352ef2f181affb5ac2a = $this->buildQuery('count');$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);list($ve2942a04780e223b215eb8b663cf5353) = mysql_fetch_row($result);return $this->length = (int) $ve2942a04780e223b215eb8b663cf5353;}public static function getContentTableName(selector $v5b3c32009797feb79096d52e56a56b82, $v945100186b119048837b9859c2c46410) {if(!is_null($v945100186b119048837b9859c2c46410) && self::getFieldColumn($v945100186b119048837b9859c2c46410) == 'cnt') {return 'cms3_object_content_cnt';}$v0e8133eb006c0f85ed9444ae07a60842 = array();$v6942e8fa62b3cc9d93881a58210e2fd7 = array();$vd14a8022b085f9ef19d479cbdd581127 = $v5b3c32009797feb79096d52e56a56b82->types;foreach($vd14a8022b085f9ef19d479cbdd581127 as $v599dcce2998a6b40b1e38e8c6006cb0a) {if(is_null($v599dcce2998a6b40b1e38e8c6006cb0a->objectType) == false) $v0e8133eb006c0f85ed9444ae07a60842[] = $v599dcce2998a6b40b1e38e8c6006cb0a->objectType->getId();if(is_null($v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType) == false) {$v89b0b9deff65f8b9cd1f71bc74ce36ba = $v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType;if($v89b0b9deff65f8b9cd1f71bc74ce36ba->getModule() == 'comments') continue;$v6942e8fa62b3cc9d93881a58210e2fd7[] = $v89b0b9deff65f8b9cd1f71bc74ce36ba->getId();}}if(sizeof($v0e8133eb006c0f85ed9444ae07a60842)) {return umiBranch::getBranchedTableByTypeId(array_pop($v0e8133eb006c0f85ed9444ae07a60842));}if(sizeof($v6942e8fa62b3cc9d93881a58210e2fd7)) {$vacf567c9c3d6cf7c6e2cc0ce108e0631 = array_pop($v6942e8fa62b3cc9d93881a58210e2fd7);if(umiBranch::checkIfBranchedByHierarchyTypeId($vacf567c9c3d6cf7c6e2cc0ce108e0631)) {return 'cms3_object_content_' . $vacf567c9c3d6cf7c6e2cc0ce108e0631;}}return 'cms3_object_content';}protected function analyze() {$v5b3c32009797feb79096d52e56a56b82 = $this->selector;switch($v5b3c32009797feb79096d52e56a56b82->mode) {case 'objects':     $this->requireTable('o', 'cms3_objects');break;case 'pages':     $this->requireTable('h', 'cms3_hierarchy');break;}$this->analyzeFields();$this->analyzeLimit();}protected function requireTable($v724874d1be77f450a09b305fc1534afb, $v80071f37861c360a27b7327e132c911a) {$this->queryTables[$v724874d1be77f450a09b305fc1534afb] = $v80071f37861c360a27b7327e132c911a;}protected function requireSysProp($v46b9e6004c49d9cc040029c197cab278) {$v90e46a37654bd99f32b7dce981c0d9a0 = array();$v90e46a37654bd99f32b7dce981c0d9a0['name'] = array('o.name', 'table' => array('o', 'cms3_objects'));$v90e46a37654bd99f32b7dce981c0d9a0['owner'] = array('o.owner_id', 'table' => array('o', 'cms3_objects'));$v90e46a37654bd99f32b7dce981c0d9a0['domain'] = array('h.domain_id');$v90e46a37654bd99f32b7dce981c0d9a0['lang'] = array('h.lang_id');$v90e46a37654bd99f32b7dce981c0d9a0['is_deleted'] = array('h.is_deleted');$v90e46a37654bd99f32b7dce981c0d9a0['is_default'] = array('h.is_default');$v90e46a37654bd99f32b7dce981c0d9a0['is_visible'] = array('h.is_visible');$v90e46a37654bd99f32b7dce981c0d9a0['is_active'] = array('h.is_active');$v90e46a37654bd99f32b7dce981c0d9a0['domain'] = array('h.domain_id');$v90e46a37654bd99f32b7dce981c0d9a0['updatetime'] = array('h.updatetime');$v90e46a37654bd99f32b7dce981c0d9a0['rand'] = array('RAND()');$v90e46a37654bd99f32b7dce981c0d9a0['template_id'] = array('h.tpl_id');if($this->selector->mode == 'pages') {$v90e46a37654bd99f32b7dce981c0d9a0['ord'] = array('h.ord', 'table' => array('h', 'cms3_hierarchy'));}if($v46b9e6004c49d9cc040029c197cab278 == 'id') {$v90e46a37654bd99f32b7dce981c0d9a0['id'] = array('o.id', 'table' => array('o', 'cms3_objects'));};if(isset($v90e46a37654bd99f32b7dce981c0d9a0[$v46b9e6004c49d9cc040029c197cab278])) {$vcaf9b6b99962bf5c2264824231d7a40c = $v90e46a37654bd99f32b7dce981c0d9a0[$v46b9e6004c49d9cc040029c197cab278];if(isset($vcaf9b6b99962bf5c2264824231d7a40c['table'])) {$this->requireTable($vcaf9b6b99962bf5c2264824231d7a40c['table'][0], $vcaf9b6b99962bf5c2264824231d7a40c['table'][1]);}return $vcaf9b6b99962bf5c2264824231d7a40c[0];}else {throw new selectorException("Not supported property \"{$v46b9e6004c49d9cc040029c197cab278}\"");}}protected function analyzeFields() {$v5b3c32009797feb79096d52e56a56b82 = $this->selector;$v4d15c1a5147ac6e7c61f1f05cc0339bc = array_merge($v5b3c32009797feb79096d52e56a56b82->whereFieldProps, $v5b3c32009797feb79096d52e56a56b82->orderFieldProps);$vd05b6ed7d2345020440df396d6da7f73 = array();foreach($v4d15c1a5147ac6e7c61f1f05cc0339bc as $v06e3d36fa30cea095545139854ad1fb9) {$vd05b6ed7d2345020440df396d6da7f73[] = $v06e3d36fa30cea095545139854ad1fb9->fieldId;}$vd05b6ed7d2345020440df396d6da7f73 = array_unique($vd05b6ed7d2345020440df396d6da7f73);foreach($vd05b6ed7d2345020440df396d6da7f73 as $v945100186b119048837b9859c2c46410) {$v80071f37861c360a27b7327e132c911a = self::getContentTableName($v5b3c32009797feb79096d52e56a56b82, $v945100186b119048837b9859c2c46410);$this->requireTable('oc_' . $v945100186b119048837b9859c2c46410, $v80071f37861c360a27b7327e132c911a);$this->queryFields[] = $v945100186b119048837b9859c2c46410;}}protected function analyzeLimit() {$v5b3c32009797feb79096d52e56a56b82 = $this->selector;if($v5b3c32009797feb79096d52e56a56b82->option('exclude-nested')) {return;}if($v5b3c32009797feb79096d52e56a56b82->limit || $v5b3c32009797feb79096d52e56a56b82->offset) {$this->queryLimit = array((int) $v5b3c32009797feb79096d52e56a56b82->limit, (int) $v5b3c32009797feb79096d52e56a56b82->offset);}}protected function buildQuery($v15d61712450a686a7f365adf4fef581f) {if($v15d61712450a686a7f365adf4fef581f == 'result') {if($this->selector->mode == 'objects') {$this->queryColumns = array('o.id');}else {$this->queryColumns = array('h.id');}}else {$this->queryColumns = ($this->selector->mode == 'objects') ? array('COUNT(o.id)') : array('COUNT(h.id)');}if($this->selector->option('root')) {return $this->buildRootQuery($v15d61712450a686a7f365adf4fef581f);}$v5a6f85b0e2c34b7c96af65b0f54b4dea = $this->buildColumns();$vc6c12f4db6ba0426c8e023cb1ca31038 = $this->buildLimit();$va85bfb9c6bcd889ceb433a1c9cd4b218 = $this->buildOrder();$vccc9e74cf27019ed02701010da900d6d = $this->buildWhere();$v75a8be0fca0bc0497c40180b6d02d580 = $this->buildTables();$v39daa41bf389071ad9cd7a7a0ad2ff2c = $this->buildOptions($v15d61712450a686a7f365adf4fef581f);return <<<SQL
SELECT {$v39daa41bf389071ad9cd7a7a0ad2ff2c} {$v5a6f85b0e2c34b7c96af65b0f54b4dea}
	FROM {$v75a8be0fca0bc0497c40180b6d02d580}
	{$vccc9e74cf27019ed02701010da900d6d}
	{$va85bfb9c6bcd889ceb433a1c9cd4b218}
	{$vc6c12f4db6ba0426c8e023cb1ca31038}
SQL;  }protected function buildOptions($v15d61712450a686a7f365adf4fef581f) {$v56b07ca9227f50ef928ccc932038180f = $this->queryOptions;if($v15d61712450a686a7f365adf4fef581f == 'result') {if(!DISABLE_CALC_FOUND_ROWS) {$v56b07ca9227f50ef928ccc932038180f[] = 'SQL_CALC_FOUND_ROWS';}}if(MAX_SELECTION_TABLE_JOINS > 0 && MAX_SELECTION_TABLE_JOINS > sizeof($this->queryTables)) {$v56b07ca9227f50ef928ccc932038180f[] = 'STRAIGHT_JOIN';}return implode(' ', $v56b07ca9227f50ef928ccc932038180f);}protected function buildColumns() {return implode(', ', $this->queryColumns);}protected function buildTables() {$v9ab2ec7ea4a2041306f7bdf150fcd453 = array();foreach($this->queryTables as $v724874d1be77f450a09b305fc1534afb => $vb068931cc450442b63f5b3d276ea4297) $v9ab2ec7ea4a2041306f7bdf150fcd453[] = $vb068931cc450442b63f5b3d276ea4297 . ' ' . $v724874d1be77f450a09b305fc1534afb;return implode(', ', $v9ab2ec7ea4a2041306f7bdf150fcd453);}protected function buildLimit() {if(sizeof($this->queryLimit)) {return " LIMIT {$this->queryLimit[0]}, {$this->queryLimit[1]}";}else {return "";}}protected function buildWhere() {$vac5c74b64b4b8352ef2f181affb5ac2a = "";$vb71a97a0f96cb8b238309d23a188ae98 = array();$v0e8133eb006c0f85ed9444ae07a60842 = array();$v6942e8fa62b3cc9d93881a58210e2fd7 = array();foreach($this->selector->types as $v599dcce2998a6b40b1e38e8c6006cb0a) {if(is_null($v599dcce2998a6b40b1e38e8c6006cb0a->objectType) == false) $v0e8133eb006c0f85ed9444ae07a60842[] = $v599dcce2998a6b40b1e38e8c6006cb0a->objectType->getId();if(is_null($v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType) == false) $v6942e8fa62b3cc9d93881a58210e2fd7[] = $v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType->getId();}if(sizeof($v0e8133eb006c0f85ed9444ae07a60842)) {$this->requireTable('o', 'cms3_objects');$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$veb52d3ec890b2d484d6630771e37554c = array();foreach($v0e8133eb006c0f85ed9444ae07a60842 as $v6301cee35ea764a1e241978f93f01069) {$veb52d3ec890b2d484d6630771e37554c = array_merge($veb52d3ec890b2d484d6630771e37554c, $vb3827f7111095f5ba1a9f49988fe9382->getChildClasses($v6301cee35ea764a1e241978f93f01069));}$v0e8133eb006c0f85ed9444ae07a60842 = array_unique(array_merge($v0e8133eb006c0f85ed9444ae07a60842, $veb52d3ec890b2d484d6630771e37554c));$vb71a97a0f96cb8b238309d23a188ae98[] = 'o.type_id IN (' . implode(', ', $v0e8133eb006c0f85ed9444ae07a60842) . ')';}if(sizeof($v6942e8fa62b3cc9d93881a58210e2fd7)) {$v6942e8fa62b3cc9d93881a58210e2fd7 = array_unique($v6942e8fa62b3cc9d93881a58210e2fd7);$vb71a97a0f96cb8b238309d23a188ae98[] = 'h.type_id IN (' . implode(', ', $v6942e8fa62b3cc9d93881a58210e2fd7) . ')';}if(sizeof($this->queryFields)) {$this->requireTable('o', 'cms3_objects');}foreach($this->queryFields as $v945100186b119048837b9859c2c46410) {$v724874d1be77f450a09b305fc1534afb = 'oc_' . $v945100186b119048837b9859c2c46410;$va06485e41fbaf59eb224d788ee94f85e = $this->buildWhereValue($v945100186b119048837b9859c2c46410);$vf18e49ce656eb8cbebf3eae5378908b7 = "({$v724874d1be77f450a09b305fc1534afb}.obj_id = o.id AND {$v724874d1be77f450a09b305fc1534afb}.field_id = {$v945100186b119048837b9859c2c46410}{$va06485e41fbaf59eb224d788ee94f85e})";$vb71a97a0f96cb8b238309d23a188ae98[] = $vf18e49ce656eb8cbebf3eae5378908b7;}$v620d6d4d09a18d4c5fdc7fa1abae6149 = $this->selector->whereSysProps;foreach($v620d6d4d09a18d4c5fdc7fa1abae6149 as $ve7b2acf954344b64ff7a1bdef7490812) {if($v26542fb18a8b14c9775aa475f23c909f = $this->buildSysProp($ve7b2acf954344b64ff7a1bdef7490812)) {$vb71a97a0f96cb8b238309d23a188ae98[] = $v26542fb18a8b14c9775aa475f23c909f;}}if($this->selector->mode == 'pages') {if($vc59a4dbfd0b091548a2f1d692a2a7c01 = $this->buildPermissions()) {$vb71a97a0f96cb8b238309d23a188ae98[] = $vc59a4dbfd0b091548a2f1d692a2a7c01;}if($v5b20cfc8862f370a9201f62df14c09c2 = $this->buildHierarchy()) {$vb71a97a0f96cb8b238309d23a188ae98[] = $v5b20cfc8862f370a9201f62df14c09c2;}if(isset($this->queryTables['o'])) {$vb71a97a0f96cb8b238309d23a188ae98[] = "h.obj_id = o.id";}}$vac5c74b64b4b8352ef2f181affb5ac2a .= implode(' AND ', $vb71a97a0f96cb8b238309d23a188ae98);if($vac5c74b64b4b8352ef2f181affb5ac2a) $vac5c74b64b4b8352ef2f181affb5ac2a = "WHERE " . $vac5c74b64b4b8352ef2f181affb5ac2a;return $vac5c74b64b4b8352ef2f181affb5ac2a;}protected function buildWhereValue($v945100186b119048837b9859c2c46410) {$v173936e059d215ede2e8b723a6165878 = $this->selector->whereFieldProps;$v43b5c9175984c071f30b873fdce0a000 = array();foreach($v173936e059d215ede2e8b723a6165878 as $v567904efe9e64d9faf3e41ef402cb568) {if($v567904efe9e64d9faf3e41ef402cb568->fieldId == $v945100186b119048837b9859c2c46410) $v43b5c9175984c071f30b873fdce0a000[] = $v567904efe9e64d9faf3e41ef402cb568;}$v1afd32818d1c9525f82aff4c09efd254 = self::getFieldColumn($v945100186b119048837b9859c2c46410);$vac5c74b64b4b8352ef2f181affb5ac2a = "";$vb71a97a0f96cb8b238309d23a188ae98 = array();foreach($v43b5c9175984c071f30b873fdce0a000 as $v567904efe9e64d9faf3e41ef402cb568) {$v3f9178c25b78ed8bed19091bcb62e266 = $this->parseValue($v567904efe9e64d9faf3e41ef402cb568->mode, $v567904efe9e64d9faf3e41ef402cb568->value);if($v1afd32818d1c9525f82aff4c09efd254 === false) {if(sizeof($v567904efe9e64d9faf3e41ef402cb568->value) == 1) {$v14f802e1fba977727845e8872c1743a7 = array_keys($v567904efe9e64d9faf3e41ef402cb568->value);$v1afd32818d1c9525f82aff4c09efd254 = array_pop($v14f802e1fba977727845e8872c1743a7) . '_val';}else continue;}$vb71a97a0f96cb8b238309d23a188ae98[] = "(oc_{$v945100186b119048837b9859c2c46410}.{$v1afd32818d1c9525f82aff4c09efd254}{$v3f9178c25b78ed8bed19091bcb62e266})";}$vac5c74b64b4b8352ef2f181affb5ac2a = implode(" AND ", array_unique($vb71a97a0f96cb8b238309d23a188ae98));return $vac5c74b64b4b8352ef2f181affb5ac2a ? " AND " . $vac5c74b64b4b8352ef2f181affb5ac2a : "";}protected function parseValue($v15d61712450a686a7f365adf4fef581f, $v2063c1608d6e0baf80249c42e2be5804) {switch($v15d61712450a686a7f365adf4fef581f) {case 'equals':     if(is_array($v2063c1608d6e0baf80249c42e2be5804) || is_object($v2063c1608d6e0baf80249c42e2be5804)) {$v2063c1608d6e0baf80249c42e2be5804 = $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);if(sizeof($v2063c1608d6e0baf80249c42e2be5804)) {return ' IN(' . implode(', ', $v2063c1608d6e0baf80249c42e2be5804) . ')';}else {return ' = 0 = 1';}}else      return ' = ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);break;case 'notequals':     if(is_array($v2063c1608d6e0baf80249c42e2be5804) || is_object($v2063c1608d6e0baf80249c42e2be5804)) {$v2063c1608d6e0baf80249c42e2be5804 = $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);if(sizeof($v2063c1608d6e0baf80249c42e2be5804)) {return ' NOT IN(' . implode(', ', $v2063c1608d6e0baf80249c42e2be5804) . ')';}else {return ' = 0 = 1';}}else      return ' != ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);break;case 'like':     if(is_array($v2063c1608d6e0baf80249c42e2be5804)) throw new selectorException("Method \"{$v15d61712450a686a7f365adf4fef581f}\" can't accept array");else return ' LIKE ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);case 'ilike':     if(is_array($v2063c1608d6e0baf80249c42e2be5804)) throw new selectorException("Method \"{$v15d61712450a686a7f365adf4fef581f}\" can't accept array");else return ' LIKE ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);case 'more':     if(is_array($v2063c1608d6e0baf80249c42e2be5804)) throw new selectorException("Method \"{$v15d61712450a686a7f365adf4fef581f}\" can't accept array");else return ' > ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);case 'eqmore':     if(is_array($v2063c1608d6e0baf80249c42e2be5804)) throw new selectorException("Method \"{$v15d61712450a686a7f365adf4fef581f}\" can't accept array");else return ' >= ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);case 'less':     if(is_array($v2063c1608d6e0baf80249c42e2be5804)) throw new selectorException("Method \"{$v15d61712450a686a7f365adf4fef581f}\" can't accept array");else return ' < ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);case 'eqless':     if(is_array($v2063c1608d6e0baf80249c42e2be5804)) throw new selectorException("Method \"{$v15d61712450a686a7f365adf4fef581f}\" can't accept array");else return ' <= ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804);case 'between':     return ' BETWEEN ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804[0]) . ' AND ' . $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804[1]);case 'isnotnull':     $v2063c1608d6e0baf80249c42e2be5804 != $v2063c1608d6e0baf80249c42e2be5804;case 'isnull':     return ($v2063c1608d6e0baf80249c42e2be5804) ? ' IS NULL' : ' IS NOT NULL';default:     throw new selectorException("Unsupported field mode \"{$v15d61712450a686a7f365adf4fef581f}\"");}}protected function buildSysProp($v23a5b8ab834cb5140fa6665622eb6417) {if($v23a5b8ab834cb5140fa6665622eb6417->name == 'domain' || $v23a5b8ab834cb5140fa6665622eb6417->name == 'lang') {if($v23a5b8ab834cb5140fa6665622eb6417->value === false) return false;}if($v23a5b8ab834cb5140fa6665622eb6417->name == '*') {$this->requireTable('o_asteriks', 'cms3_object_content');$this->requireTable('o', 'cms3_objects');$v724874d1be77f450a09b305fc1534afb = self::getContentTableName($this->selector, null);$v9ab2ec7ea4a2041306f7bdf150fcd453 = array('o_asteriks');if($v724874d1be77f450a09b305fc1534afb != 'cms3_object_content') {$this->requireTable('o_asteriks_branched', $v724874d1be77f450a09b305fc1534afb);$v9ab2ec7ea4a2041306f7bdf150fcd453[] = 'o_asteriks_branched';}$this->queryOptions[] = 'DISTINCT';$vb71a97a0f96cb8b238309d23a188ae98 = array();foreach($v9ab2ec7ea4a2041306f7bdf150fcd453 as $v80071f37861c360a27b7327e132c911a) {$vf09cc7ee3a9a93273f4b80601cafb00c = $v23a5b8ab834cb5140fa6665622eb6417->value;if(!is_array($vf09cc7ee3a9a93273f4b80601cafb00c)) $vf09cc7ee3a9a93273f4b80601cafb00c = array($vf09cc7ee3a9a93273f4b80601cafb00c);$v559cc56c655f21b6412d45a20dabd67d = array();foreach($vf09cc7ee3a9a93273f4b80601cafb00c as $v2063c1608d6e0baf80249c42e2be5804) {$vb29e62a6153f20d910bc9f0d25a57d83 = $this->escapeValue('%' . $v2063c1608d6e0baf80249c42e2be5804 . '%');$v559cc56c655f21b6412d45a20dabd67d[] = $v80071f37861c360a27b7327e132c911a . '.varchar_val LIKE ' . $vb29e62a6153f20d910bc9f0d25a57d83;$v559cc56c655f21b6412d45a20dabd67d[] = $v80071f37861c360a27b7327e132c911a . '.text_val LIKE ' . $vb29e62a6153f20d910bc9f0d25a57d83;$v559cc56c655f21b6412d45a20dabd67d[] = 'o.name LIKE ' . $vb29e62a6153f20d910bc9f0d25a57d83;if(is_numeric($v2063c1608d6e0baf80249c42e2be5804)) {$v559cc56c655f21b6412d45a20dabd67d[] = $v80071f37861c360a27b7327e132c911a . '.float_val = ' . $vb29e62a6153f20d910bc9f0d25a57d83;$v559cc56c655f21b6412d45a20dabd67d[] = $v80071f37861c360a27b7327e132c911a . '.int_val = ' . $vb29e62a6153f20d910bc9f0d25a57d83;}}$vb71a97a0f96cb8b238309d23a188ae98[] = '(' . $v80071f37861c360a27b7327e132c911a . '.obj_id = o.id AND (' . implode(' OR ', $v559cc56c655f21b6412d45a20dabd67d) . '))';}$vac5c74b64b4b8352ef2f181affb5ac2a = '(' . implode(' OR ', $vb71a97a0f96cb8b238309d23a188ae98) . ')';return $vac5c74b64b4b8352ef2f181affb5ac2a;}else {$vb068931cc450442b63f5b3d276ea4297 = $this->requireSysProp($v23a5b8ab834cb5140fa6665622eb6417->name);return "{$vb068931cc450442b63f5b3d276ea4297}" . $this->parseValue($v23a5b8ab834cb5140fa6665622eb6417->mode, $v23a5b8ab834cb5140fa6665622eb6417->value);}}protected function buildOrder() {$vac5c74b64b4b8352ef2f181affb5ac2a = "";$vb71a97a0f96cb8b238309d23a188ae98 = array();foreach($this->selector->orderFieldProps as $v70a17ffa722a3985b86d30b034ad06d7) {$v945100186b119048837b9859c2c46410 = $v70a17ffa722a3985b86d30b034ad06d7->fieldId;$v1afd32818d1c9525f82aff4c09efd254 = self::getFieldColumn($v945100186b119048837b9859c2c46410);$vb71a97a0f96cb8b238309d23a188ae98[] = "oc_{$v945100186b119048837b9859c2c46410}.{$v1afd32818d1c9525f82aff4c09efd254} " . ($v70a17ffa722a3985b86d30b034ad06d7->asc ? 'ASC' : 'DESC');}foreach($this->selector->orderSysProps as $v70a17ffa722a3985b86d30b034ad06d7) {$vb068931cc450442b63f5b3d276ea4297 = $this->requireSysProp($v70a17ffa722a3985b86d30b034ad06d7->name);$vb71a97a0f96cb8b238309d23a188ae98[] = $vb068931cc450442b63f5b3d276ea4297 . ' ' . ($v70a17ffa722a3985b86d30b034ad06d7->asc ? 'ASC' : 'DESC');}$vac5c74b64b4b8352ef2f181affb5ac2a = implode(', ', $vb71a97a0f96cb8b238309d23a188ae98);return $vac5c74b64b4b8352ef2f181affb5ac2a ? "ORDER BY " . $vac5c74b64b4b8352ef2f181affb5ac2a : "";}protected function buildPermissions() {$permissions = $this->selector->permissions;$vb132392a317588e56460e77a8fd74229 = $permissions->owners;if($permissions && sizeof($vb132392a317588e56460e77a8fd74229)) {$this->requireTable('p', 'cms3_permissions');$this->queryOptions[] = 'DISTINCT';$vb132392a317588e56460e77a8fd74229[] = 2373;$vb132392a317588e56460e77a8fd74229 = implode(', ', $vb132392a317588e56460e77a8fd74229);return "(p.rel_id = h.id AND p.level & {$permissions->level} AND p.owner_id IN({$vb132392a317588e56460e77a8fd74229}))";}else return "";}protected function buildHierarchy() {$vb81ca7c0ccaa77e7aa91936ab0070695 = $this->selector->hierarchy;if(!$vb81ca7c0ccaa77e7aa91936ab0070695) return "";$this->requireTable('hr', 'cms3_hierarchy_relations');$vac5c74b64b4b8352ef2f181affb5ac2a = "h.id = hr.child_id AND (hr.level <= {$vb81ca7c0ccaa77e7aa91936ab0070695->level} AND hr.rel_id";$vac5c74b64b4b8352ef2f181affb5ac2a .= ($vb81ca7c0ccaa77e7aa91936ab0070695->elementId > 0) ? " = '{$vb81ca7c0ccaa77e7aa91936ab0070695->elementId}')" : " IS NULL)";return $vac5c74b64b4b8352ef2f181affb5ac2a;}protected static function getFieldColumn($v945100186b119048837b9859c2c46410) {static $v0fea6a13c52b4d4725368f24b045ca84 = array();if(isset($v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410])) return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410];$v06e3d36fa30cea095545139854ad1fb9 = umiFieldsCollection::getInstance()->getField($v945100186b119048837b9859c2c46410);switch($v06e3d36fa30cea095545139854ad1fb9->getDataType()) {case 'string':    case 'file':    case 'img_file':    case 'swf_file':    case 'password':    case 'tags':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'varchar_val';case 'int':    case 'boolean':    case 'date':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'int_val';case 'counter':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'cnt';case 'price':    case 'float':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'float_val';case 'text':    case 'wysiwyg':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'text_val';case 'relation':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'rel_val';case 'symlink':     return $v0fea6a13c52b4d4725368f24b045ca84[$v945100186b119048837b9859c2c46410] = 'tree_val';case 'optioned': return false;default:     throw new selectorException("Unsupported field type \"{$v06e3d36fa30cea095545139854ad1fb9->getDataType()}\"");}}protected function escapeValue($v2063c1608d6e0baf80249c42e2be5804) {if(is_array($v2063c1608d6e0baf80249c42e2be5804)) {foreach($v2063c1608d6e0baf80249c42e2be5804 as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v3a6d0284e743dc4a9b86f97d6dd1a3bf) $v2063c1608d6e0baf80249c42e2be5804[$v865c0c0b4ab0e063e5caa3387c1a8741] = $this->escapeValue($v3a6d0284e743dc4a9b86f97d6dd1a3bf);return $v2063c1608d6e0baf80249c42e2be5804;}if ($v2063c1608d6e0baf80249c42e2be5804 instanceof selector) {return $this->escapeValue($v2063c1608d6e0baf80249c42e2be5804->result());}if ($v2063c1608d6e0baf80249c42e2be5804 instanceof iUmiObject || $v2063c1608d6e0baf80249c42e2be5804 instanceof iUmiHierarchyElement) {return $v2063c1608d6e0baf80249c42e2be5804->id;}else {return "'" . mysql_real_escape_string($v2063c1608d6e0baf80249c42e2be5804) . "'";}}protected function buildRootQuery($v15d61712450a686a7f365adf4fef581f) {$v5a6f85b0e2c34b7c96af65b0f54b4dea = $this->buildColumns();$vc6c12f4db6ba0426c8e023cb1ca31038 = $this->buildLimit();$va85bfb9c6bcd889ceb433a1c9cd4b218 = $this->buildOrder();$vccc9e74cf27019ed02701010da900d6d = $this->buildWhere();$v75a8be0fca0bc0497c40180b6d02d580 = $this->buildTables();$v39daa41bf389071ad9cd7a7a0ad2ff2c = $this->buildOptions($v15d61712450a686a7f365adf4fef581f);$vd14a8022b085f9ef19d479cbdd581127 = array();foreach($this->selector->types as $v599dcce2998a6b40b1e38e8c6006cb0a) {if($v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType) $vd14a8022b085f9ef19d479cbdd581127[] = $v599dcce2998a6b40b1e38e8c6006cb0a->hierarchyType->getId();}$ve067058f1b6dfcee3ff9b6e52cbada57 = implode(', ', $vd14a8022b085f9ef19d479cbdd581127);$v5a6f85b0e2c34b7c96af65b0f54b4dea = ($v15d61712450a686a7f365adf4fef581f == 'result') ? 'DISTINCT h.id' : 'COUNT(DISTINCT h.id)';$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT $v5a6f85b0e2c34b7c96af65b0f54b4dea 
	FROM cms3_hierarchy hp, {$v75a8be0fca0bc0497c40180b6d02d580}
	{$vccc9e74cf27019ed02701010da900d6d}
	AND (h.rel = 0 OR (h.rel = hp.id AND hp.type_id NOT IN ({$ve067058f1b6dfcee3ff9b6e52cbada57})))
		{$va85bfb9c6bcd889ceb433a1c9cd4b218}
		{$vc6c12f4db6ba0426c8e023cb1ca31038}
SQL;   return $vac5c74b64b4b8352ef2f181affb5ac2a;}protected function excludeNestedPages($v47c80780ab608cc046f2a6e6f071feb6) {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$result = array();foreach($v47c80780ab608cc046f2a6e6f071feb6 as $v7552cd149af7495ee7d8225974e50f80) {$v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v7552cd149af7495ee7d8225974e50f80);if($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement) {if(in_array($v8e2dcfd7e7e24b1ca76c1193f645902b->getRel(), $v47c80780ab608cc046f2a6e6f071feb6)) {continue;}else {$result[] = $v7552cd149af7495ee7d8225974e50f80;}}}return $result;}};?>