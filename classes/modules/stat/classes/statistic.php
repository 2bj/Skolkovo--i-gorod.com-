<?php
define('STAT_SITES', 1);define('STAT_SEARCH', 2);define('STAT_PR', 3);define('STAT_TICKET', 4);define('STAT_COUPON', 5);define('STAT_RETURN_INTERVAL', 15);class statistic{private $time;private $noCount;private $referer;private $uri;private $serverName;private $remoteAddr;private $_agent;private $_robots = array(        'Googlebot',        'msnbot',        'Slurp',        'Yahoo',        'Yandex',        'StackRambler',        'aport',        'appie',        'Arachnoidea',        'ArchitextSpider',        'Ask Jeeves',        'B-l-i-t-z-Bot',        'Baiduspider',        'BecomeBot',        'cfetch',        'ConveraCrawler',        'ExtractorPro',        'FAST-WebCrawler',        'FDSE robot',        'fido',        'findlinks',        'Francis',        'geckobot',        'Gigabot',        'Girafabot',        'grub-client',        'Gulliver',        'HTTrack',        'ia_archiver',        'iCCrawler',        'InfoSeek',        'kinjabot',        'KIT-Fireball',        'larbin',        'LEIA',        'lmspider',        'lwp-trivial',        'Lycos_Spider',        'Mediapartners-Google',        'MuscatFerret',        'NaverBot',        'OmniExplorer_Bot',        'polybot',        'Pompos',        'RufusBot',        'Scooter',        'Seekbot',        'sproose',        'Teoma',        'TheSuBot',        'TurnitinBot',        'Ultraseek',        'ViolaBot',        'voyager',        'webbandit',        'www.almaden.ibm.com/cs/crawler',        'yacy',        'ZyBorg',    );public function __construct($v07cc694b9b3fc636710fa08b6922c42b = null)    {if (!empty($v07cc694b9b3fc636710fa08b6922c42b)) {$this->time = $v07cc694b9b3fc636710fa08b6922c42b;}else {$this->time = time();}if (!isset($_COOKIE['stat_id'])) {setcookie('stat_id', session_id(), strtotime('+10 years'), "/");}}public function run()    {if ($this->noCount) {return null;}if (!isset($_SESSION['stat']['isSearchBot'])) {$_SESSION['stat']['isSearchBot'] = $this->isSearchBot();}if ($_SESSION['stat']['isSearchBot'] == true) {return false;}if (isset($_SESSION['stat']['doLogin'])) {$vd56b699830e77ba53855679cb1d252da = $this->getLogin();if (isset($_SESSION['stat']['loginId'])) {unset($_SESSION['stat']);}else {$this->setUpHostId();$v36f75e2036c54462c47b965f4a581cff = "SELECT `id` FROM `cms_stat_users` WHERE `login` = '" . mysql_real_escape_string($vd56b699830e77ba53855679cb1d252da) . "' AND `host_id` = " . $_SESSION['stat']['site_id'];$v9b207167e5381c47682c6b4f58a623fb = mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$ve8701ad48ba05a91604e480dd60899a3 = $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$ve8701ad48ba05a91604e480dd60899a3 = $this->addUser();}if (isset($_SESSION['stat']['path_id'])) {$v36f75e2036c54462c47b965f4a581cff = "UPDATE `cms_stat_paths` SET `user_id` = " . $ve8701ad48ba05a91604e480dd60899a3 . " WHERE `id` = " . $_SESSION['stat']['path_id'];l_mysql_query($v36f75e2036c54462c47b965f4a581cff);}$_SESSION['stat']['loginId'] = $ve8701ad48ba05a91604e480dd60899a3;}}if (!isset($_SESSION['stat']['id'])) {if (!isset($_COOKIE['stat_id'])) {setcookie('stat_id', session_id(), time()+315360000, "/");$_SESSION['stat']['id'] = session_id();$_SESSION['stat']['user_id'] = $this->addUser();}else {$vd56b699830e77ba53855679cb1d252da  = mysql_real_escape_string($this->getLogin());$v5766469aa305a3957f2c9cc49041c2f9 = mysql_real_escape_string($_COOKIE['stat_id']);$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query("SELECT SQL_CACHE `id` FROM `cms_stat_users` WHERE `session_id` = '" . $v5766469aa305a3957f2c9cc49041c2f9 . "' AND `login`='{$vd56b699830e77ba53855679cb1d252da}'");$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$_SESSION['stat']['id'] = $v5766469aa305a3957f2c9cc49041c2f9;$_SESSION['stat']['user_id'] = $vf1965a857bc285d26fe22023aa5ab50d['id'];$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE UNIX_TIMESTAMP(MAX(`h`.`date`)) AS `ts`, `p`.`id` FROM `cms_stat_hits` `h`
                             INNER JOIN `cms_stat_paths` `p` ON `p`.`id` = `h`.`path_id`
                              WHERE `p`.`user_id` = " . $vf1965a857bc285d26fe22023aa5ab50d['id'] . "
                               GROUP BY `p`.`user_id`";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['ts']) && ($this->time - $vf1965a857bc285d26fe22023aa5ab50d['ts']) / 60 <= STAT_RETURN_INTERVAL) {$_SESSION['stat']['path_id'] = $vf1965a857bc285d26fe22023aa5ab50d['id'];$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query("SELECT COUNT(*) AS `cnt` FROM `cms_stat_hits` WHERE `path_id` = " . $vf1965a857bc285d26fe22023aa5ab50d['id']);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);$_SESSION['stat']['number_in_path'] = $vf1965a857bc285d26fe22023aa5ab50d['cnt'];}}else {setcookie('stat_id', session_id(), strtotime('+10 years'), '/');$_SESSION['stat']['id'] = session_id();$_SESSION['stat']['user_id'] = $this->addUser();}}$this->setUpHostId();$v0afd9202ba86aa11ce63ad7007e7990b = 0;$v08751261d00b77b49c23834cedfff422 = 0;$vc66c00ae9f18fc0c67d8973bd07dc4cd = $this->getReferer();$vf9271b9a5cd20d95c4ad5c27819945f8 = parse_url($vc66c00ae9f18fc0c67d8973bd07dc4cd);if(!isset($vf9271b9a5cd20d95c4ad5c27819945f8['path'])) {$vf9271b9a5cd20d95c4ad5c27819945f8['path'] = '';}if (!isset($vf9271b9a5cd20d95c4ad5c27819945f8['host'])) {$vf9271b9a5cd20d95c4ad5c27819945f8['host'] = '';}if (strpos($vf9271b9a5cd20d95c4ad5c27819945f8['host'], 'www.') === 0) {$vad5f82e879a9c5d6b5b442eb37e50551 = substr($vf9271b9a5cd20d95c4ad5c27819945f8['host'], 4);}else {$vad5f82e879a9c5d6b5b442eb37e50551 = $vf9271b9a5cd20d95c4ad5c27819945f8['host'];}$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `pr_id` FROM `cms_stat_sources_pr_sites`
                    WHERE '" . mysql_real_escape_string($vad5f82e879a9c5d6b5b442eb37e50551) . "' LIKE `url`";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if ($vf1965a857bc285d26fe22023aa5ab50d) {$v0afd9202ba86aa11ce63ad7007e7990b = $this->getSourceId($vf1965a857bc285d26fe22023aa5ab50d['pr_id'], STAT_PR);}if (!$v0afd9202ba86aa11ce63ad7007e7990b && !empty($_SESSION['stat']['ticket_id'])) {$v0afd9202ba86aa11ce63ad7007e7990b = $_SESSION['stat']['ticket_id'];$v08751261d00b77b49c23834cedfff422 = STAT_TICKET;}if (!$v0afd9202ba86aa11ce63ad7007e7990b) {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id`, `varname`, `url_mask` FROM `cms_stat_sources_search_engines`
                           WHERE '" . mysql_real_escape_string($vad5f82e879a9c5d6b5b442eb37e50551) . "' LIKE `url_mask`";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(isset($vf1965a857bc285d26fe22023aa5ab50d['url_mask'])) {if($vf1965a857bc285d26fe22023aa5ab50d['url_mask'] == "yandex.ru") {if($vf1965a857bc285d26fe22023aa5ab50d['url_mask'] != $vad5f82e879a9c5d6b5b442eb37e50551) {unset($vf1965a857bc285d26fe22023aa5ab50d['id']);}}}if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v8ded83705dc3ada523ccbd36e3ddee61 = $vf1965a857bc285d26fe22023aa5ab50d['id'];if (isset($vf9271b9a5cd20d95c4ad5c27819945f8['query'])) {$v36f75e2036c54462c47b965f4a581cff = $vf9271b9a5cd20d95c4ad5c27819945f8['query'];parse_str($v36f75e2036c54462c47b965f4a581cff, $v47c80780ab608cc046f2a6e6f071feb6);if (isset($v47c80780ab608cc046f2a6e6f071feb6[$vf1965a857bc285d26fe22023aa5ab50d['varname']])) {$v1cb251ec0d568de6a929b520c4aed8d1 = $v47c80780ab608cc046f2a6e6f071feb6[$vf1965a857bc285d26fe22023aa5ab50d['varname']];$v1cb251ec0d568de6a929b520c4aed8d1 = $this->convertCharset($v1cb251ec0d568de6a929b520c4aed8d1);$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `s`.`id` FROM `cms_stat_sources_search_queries` `q`
                                     INNER JOIN `cms_stat_sources_search` `s` ON `s`.`text_id` = `q`.`id`
                                      WHERE `q`.`text` = '" . mysql_real_escape_string($v1cb251ec0d568de6a929b520c4aed8d1) . "' AND `engine_id` = " . $v8ded83705dc3ada523ccbd36e3ddee61;$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v0afd9202ba86aa11ce63ad7007e7990b = $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_sources_search_queries` WHERE `text` = '" . mysql_real_escape_string($v1cb251ec0d568de6a929b520c4aed8d1) . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_search` (`engine_id`, `text_id`) VALUES (" . $v8ded83705dc3ada523ccbd36e3ddee61 . ", " . $vf1965a857bc285d26fe22023aa5ab50d['id'] . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v0afd9202ba86aa11ce63ad7007e7990b = mysql_insert_id();}else {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_search_queries` (`text`) VALUES ('" . mysql_real_escape_string($v1cb251ec0d568de6a929b520c4aed8d1) . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v83ca49d02d735958e354492a19f076b0 = mysql_insert_id();$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_search` (`engine_id`, `text_id`) VALUES (" . $v8ded83705dc3ada523ccbd36e3ddee61 . ", " . $v83ca49d02d735958e354492a19f076b0 . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v0afd9202ba86aa11ce63ad7007e7990b = mysql_insert_id();}}$v0afd9202ba86aa11ce63ad7007e7990b = $this->getSourceId($v0afd9202ba86aa11ce63ad7007e7990b, STAT_SEARCH);}}}}if (!$v0afd9202ba86aa11ce63ad7007e7990b) {if ($vad5f82e879a9c5d6b5b442eb37e50551) {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `group_id` FROM `cms_stat_sites` WHERE `name` = '" . mysql_real_escape_string($vad5f82e879a9c5d6b5b442eb37e50551) . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (!isset($vf1965a857bc285d26fe22023aa5ab50d['group_id']) || $vf1965a857bc285d26fe22023aa5ab50d['group_id'] != $_SESSION['stat']['site_id']) {$v08751261d00b77b49c23834cedfff422 = STAT_SITES;$ve6cc189d3c12799491219df64626521b = $vf9271b9a5cd20d95c4ad5c27819945f8['path'] . (isset($vf9271b9a5cd20d95c4ad5c27819945f8['query']) ? "?" . $vf9271b9a5cd20d95c4ad5c27819945f8['query'] : '');$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `s`.`id` FROM `cms_stat_sources_sites_domains` `d`
                             INNER JOIN `cms_stat_sources_sites` `s` ON `s`.`domain` = `d`.`id`
                              WHERE `d`.`name` = '" . mysql_real_escape_string($vad5f82e879a9c5d6b5b442eb37e50551) . "' AND `s`.`uri`='".mysql_real_escape_string($ve6cc189d3c12799491219df64626521b)."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v0afd9202ba86aa11ce63ad7007e7990b = $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$v36f75e2036c54462c47b965f4a581cff = "SELECT * FROM `cms_stat_sources_sites_domains` `d`
                                  WHERE `d`.`name` = '" . mysql_real_escape_string($vad5f82e879a9c5d6b5b442eb37e50551) . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);$ve6cc189d3c12799491219df64626521b = $vf9271b9a5cd20d95c4ad5c27819945f8['path'] . (isset($vf9271b9a5cd20d95c4ad5c27819945f8['query']) ? "?" . $vf9271b9a5cd20d95c4ad5c27819945f8['query'] : '');if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_sites` (`uri`, `domain`) VALUES ('" . mysql_real_escape_string($ve6cc189d3c12799491219df64626521b) . "', " . $vf1965a857bc285d26fe22023aa5ab50d['id'] . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v0afd9202ba86aa11ce63ad7007e7990b = mysql_insert_id();}else {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_sites_domains` (`name`) VALUES ('" . mysql_real_escape_string($vad5f82e879a9c5d6b5b442eb37e50551) . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v13938654383e0803854e72b9ef4c3a4f = mysql_insert_id();$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_sites` (`uri`, `domain`) VALUES ('" . mysql_real_escape_string($ve6cc189d3c12799491219df64626521b) . "', " . $v13938654383e0803854e72b9ef4c3a4f . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v0afd9202ba86aa11ce63ad7007e7990b = mysql_insert_id();}}$v0afd9202ba86aa11ce63ad7007e7990b = $this->getSourceId($v0afd9202ba86aa11ce63ad7007e7990b, STAT_SITES);}}}if (!isset($_SESSION['stat']['path_id']) || true) {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_paths` (`user_id`, `date`, `host_id`" . (isset($v0afd9202ba86aa11ce63ad7007e7990b) ? ", `source_id`" : "") . ") VALUES (" . $_SESSION['stat']['user_id'] . ", '" . $this->getNow() . "', " . $_SESSION['stat']['site_id'] . "" . (isset($v0afd9202ba86aa11ce63ad7007e7990b) ? ", " . $v0afd9202ba86aa11ce63ad7007e7990b : "") . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$_SESSION['stat']['path_id'] = mysql_insert_id();$_SESSION['stat']['number_in_path'] = 0;}}if(!isset($v0afd9202ba86aa11ce63ad7007e7990b)) $v0afd9202ba86aa11ce63ad7007e7990b = NULL;if (!$v0afd9202ba86aa11ce63ad7007e7990b && isset($_GET['_openstat'])) {require_once dirname(__FILE__) . '/openstat.php';$v9c43dde2e742cc0f7dadeecce37763f2 = $_GET['_openstat'];try            {$v17757530e68209ec838613781b99a535 = new openstat($v9c43dde2e742cc0f7dadeecce37763f2);$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources_openstat` (`service_id`, `campaign_id`, `ad_id`, `source_id`, `path_id`)
                         VALUES (" . $v17757530e68209ec838613781b99a535->getServiceId()  . ", " . $v17757530e68209ec838613781b99a535->getCampaignId() . ", " . $v17757530e68209ec838613781b99a535->getAdId() . ", " . $v17757530e68209ec838613781b99a535->getSourceId() . ", " . $_SESSION['stat']['path_id'] . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vb5c8c967b148eeb92a5a728cc3f5d38e = mysql_insert_id();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {echo $ve1671797c52e15f763380b45e841ec32->getMessage();}}$v9305b73d359bd06734fee0b3638079e1 = mysql_real_escape_string($this->getUri());$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_pages` WHERE `uri` = '" . $v9305b73d359bd06734fee0b3638079e1 . "' AND `host_id` = " . $_SESSION['stat']['site_id'];$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v1a63c8004d716c8b91f5b7af780555b9 = $vf1965a857bc285d26fe22023aa5ab50d['id'];if (isset($_SESSION['stat']['last_page_id']) && $_SESSION['stat']['last_page_id'] == $v1a63c8004d716c8b91f5b7af780555b9) {return;}}else {if (strrpos($this->getUri(), '/') === 0) {$v73d5342eba070f636ac3246f319bf77f = 'index';}else {$v73d5342eba070f636ac3246f319bf77f = mysql_real_escape_string(substr($this->getUri(), 1, strpos($this->getUri(), '/', 1) - 1));}$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_pages` (`uri`, `host_id`, `section`) VALUES ('" . $v9305b73d359bd06734fee0b3638079e1 . "', '" . $_SESSION['stat']['site_id'] . "', '" . $v73d5342eba070f636ac3246f319bf77f . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v1a63c8004d716c8b91f5b7af780555b9 = mysql_insert_id();}$_SESSION['stat']['last_page_id'] = $v1a63c8004d716c8b91f5b7af780555b9;$_SESSION['stat']['number_in_path']++;$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_hits` (`page_id`, `date`, `hour`, `day_of_week`, `week`, `day`, `month`, `year`, `path_id`, `number_in_path`" . ((isset($_SESSION['stat']['prev_page_id'])) ? ', `prev_page_id`' : '') . ") VALUES
                 (" . $v1a63c8004d716c8b91f5b7af780555b9 . ", '" . $this->getNow() . "', HOUR('" . $this->getNow() . "'), DATE_FORMAT('" . $this->getNow() . "', '%w'), WEEK('" . $this->getNow() . "'), DAY('" . $this->getNow() . "'), MONTH('" . $this->getNow() . "'), YEAR('" . $this->getNow() . "'), " . $_SESSION['stat']['path_id'] . ", " . $_SESSION['stat']['number_in_path'] . (isset($_SESSION['stat']['prev_page_id']) ? ", " . $_SESSION['stat']['prev_page_id'] : '') . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$ve01ef419bf0b76b8fab5f91751360efc = mysql_insert_id();$_SESSION['stat']['prev_page_id'] = $v1a63c8004d716c8b91f5b7af780555b9;$v36f75e2036c54462c47b965f4a581cff = "(SELECT SQL_CACHE `r`.`event_id` FROM `cms_stat_events_urls` `u`
                 INNER JOIN `cms_stat_events_rel` `r` ON `r`.`metaevent_id` = `u`.`event_id`
                  WHERE `u`.`page_id` = " . $v1a63c8004d716c8b91f5b7af780555b9 . ")

                UNION DISTINCT

                (SELECT SQL_CACHE `event_id` FROM `cms_stat_events_urls`
                  WHERE `page_id` = " . $v1a63c8004d716c8b91f5b7af780555b9 . ")";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v7694f4a66316e53c8cdd9d9954bd611d = '';while($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb)) {$v7694f4a66316e53c8cdd9d9954bd611d .= '(' . $vf1965a857bc285d26fe22023aa5ab50d['event_id'] . ', ' . $ve01ef419bf0b76b8fab5f91751360efc . '), ';}if (isset($_SESSION['stat']['entryQry'])) {foreach ($_SESSION['stat']['entryQry'] as $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$v7694f4a66316e53c8cdd9d9954bd611d .= '(' . $v3a6d0284e743dc4a9b86f97d6dd1a3bf . ', ' . $ve01ef419bf0b76b8fab5f91751360efc . '), ';}unset($_SESSION['stat']['entryQry']);}if (isset($_SESSION['stat']['events'])) {foreach ($_SESSION['stat']['events'] as $v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$v7694f4a66316e53c8cdd9d9954bd611d .= '(' . $v3a6d0284e743dc4a9b86f97d6dd1a3bf . ', ' . $ve01ef419bf0b76b8fab5f91751360efc . '), ';}unset($_SESSION['stat']['events']);}if ($v7694f4a66316e53c8cdd9d9954bd611d) {$v7694f4a66316e53c8cdd9d9954bd611d = substr($v7694f4a66316e53c8cdd9d9954bd611d, 0, -2);$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_events_collected` (`event_id`, `hit_id`) VALUES " . $v7694f4a66316e53c8cdd9d9954bd611d;l_mysql_query($v36f75e2036c54462c47b965f4a581cff);}}private function getReferer()    {return !empty($this->referer) ? $this->referer : (isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '');}private function getUri()    {return !empty($this->uri) ? $this->uri : $_SERVER['REQUEST_URI'];}private function getServerName()    {$v6b43c095dc346101e505ef2afa47157d = ($_SERVER['HTTP_HOST'])?$_SERVER['HTTP_HOST']:$_SERVER['SERVER_NAME'];return !empty($this->serverName) ? $this->serverName : $v6b43c095dc346101e505ef2afa47157d;}private function getRemoteAddr()    {return !empty($this->remoteAddr) ? $this->remoteAddr : $_SERVER['REMOTE_ADDR'];}public function setReferer($vc66c00ae9f18fc0c67d8973bd07dc4cd)    {$this->referer = $vc66c00ae9f18fc0c67d8973bd07dc4cd;}public function setUri($v9305b73d359bd06734fee0b3638079e1)    {$this->uri = $v9305b73d359bd06734fee0b3638079e1;}public function setServerName($v3be4dbe3c6405f416e9f42002cfe4326)    {$this->serverName = $v3be4dbe3c6405f416e9f42002cfe4326;}public function setRemoteAddr($v9a2d397f3a2c8a2c27e5004de64858e7)    {$this->remoteAddr = $v9a2d397f3a2c8a2c27e5004de64858e7;}private function setUpHostId()    {if (!isset($_SESSION['stat']['site_id'])) {$vb068931cc450442b63f5b3d276ea4297 = mysql_real_escape_string($this->getServerName());$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `rel` FROM `cms3_domain_mirrows` WHERE `host` = '".$vb068931cc450442b63f5b3d276ea4297."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['rel']) && ($vf1965a857bc285d26fe22023aa5ab50d['rel'] > 0)) {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `host` FROM `cms3_domains` WHERE `id`='". $vf1965a857bc285d26fe22023aa5ab50d['rel'] ."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(isset($vf1965a857bc285d26fe22023aa5ab50d['host']) && ($vf1965a857bc285d26fe22023aa5ab50d['host']!='')) $vb068931cc450442b63f5b3d276ea4297 = $vf1965a857bc285d26fe22023aa5ab50d['host'];}else {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms3_domains` WHERE `host`='". $vb068931cc450442b63f5b3d276ea4297 ."'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(!isset($vf1965a857bc285d26fe22023aa5ab50d['id']) || ($vf1965a857bc285d26fe22023aa5ab50d['id']==0)) {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `host` FROM `cms3_domains` WHERE `is_default`='1'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if(isset($vf1965a857bc285d26fe22023aa5ab50d['host']) && ($vf1965a857bc285d26fe22023aa5ab50d['host']!='')) $vb068931cc450442b63f5b3d276ea4297 = $vf1965a857bc285d26fe22023aa5ab50d['host'];}}$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `group_id` FROM `cms_stat_sites` WHERE `name` = '" . $vb068931cc450442b63f5b3d276ea4297 . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['group_id'])) {$_SESSION['stat']['site_id'] = $vf1965a857bc285d26fe22023aa5ab50d['group_id'];return;}$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sites_groups` (`name`) VALUES ('" . $vb068931cc450442b63f5b3d276ea4297 . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vb80bb7740288fda1f201890375a60c8f = mysql_insert_id();$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sites` (`name`, `group_id`) VALUES ('" . $vb068931cc450442b63f5b3d276ea4297 . "', " . $vb80bb7740288fda1f201890375a60c8f . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$_SESSION['stat']['site_id'] = $vb80bb7740288fda1f201890375a60c8f;}}public function ticket($vb068931cc450442b63f5b3d276ea4297)    {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_sources_ticket` WHERE `url` = '" . mysql_real_escape_string($vb068931cc450442b63f5b3d276ea4297) . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);if ($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb)) {$v0afd9202ba86aa11ce63ad7007e7990b = $this->getSourceId($vf1965a857bc285d26fe22023aa5ab50d['id'], STAT_TICKET);$_SESSION['stat']['ticket_id'] = $v0afd9202ba86aa11ce63ad7007e7990b;}}public function entry($vb068931cc450442b63f5b3d276ea4297)    {$this->noCount = true;$this->setUpHostId();$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `p`.`url`, `e`.`event_id` FROM `cms_stat_entry_points` `p`
                 LEFT JOIN `cms_stat_entry_points_events` `e` ON `e`.`entry_point_id` = `p`.`id`
                  WHERE `name` = '" . mysql_real_escape_string($vb068931cc450442b63f5b3d276ea4297) . "' AND `host_id` = " . $_SESSION['stat']['site_id'];$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);if (isset($_SESSION['stat']['entryQry'])) {unset($_SESSION['stat']['entryQry']);}while ($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb)) {if (!isset($vf17ca2c829680ada2fec9fc87bc5f606)) {$vf17ca2c829680ada2fec9fc87bc5f606 = $vf1965a857bc285d26fe22023aa5ab50d['url'];}$_SESSION['stat']['entryQry'][] = $vf1965a857bc285d26fe22023aa5ab50d['event_id'];}if (!isset($vf17ca2c829680ada2fec9fc87bc5f606)) {$vf17ca2c829680ada2fec9fc87bc5f606 = '/';}header('Location:' . $vf17ca2c829680ada2fec9fc87bc5f606);exit;}public function event($vb068931cc450442b63f5b3d276ea4297)    {$this->setUpHostId();$vb068931cc450442b63f5b3d276ea4297 = mysql_real_escape_string($vb068931cc450442b63f5b3d276ea4297);$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_events`
                 WHERE `name` = '" . $vb068931cc450442b63f5b3d276ea4297 . "' AND `host_id` = " . $_SESSION['stat']['site_id'];$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);if ($vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb)) {$vb80bb7740288fda1f201890375a60c8f = $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_events` (`description`, `name`, `type`, `profit`, `host_id`) VALUES ('" . $vb068931cc450442b63f5b3d276ea4297 . "', '" . $vb068931cc450442b63f5b3d276ea4297 . "', 2, 0, " . $_SESSION['stat']['site_id'] . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vb80bb7740288fda1f201890375a60c8f = mysql_insert_id();}$_SESSION['stat']['events'][] = $vb80bb7740288fda1f201890375a60c8f;}private function getSourceId($v7fab7769a3d3d15c509e276d3f936825, $v599dcce2998a6b40b1e38e8c6006cb0a)    {$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_sources` WHERE `concrete_src_id` = " . $v7fab7769a3d3d15c509e276d3f936825 . " AND `src_type` = " .  $v599dcce2998a6b40b1e38e8c6006cb0a;$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {$v0afd9202ba86aa11ce63ad7007e7990b = $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_sources` (`src_type`, `concrete_src_id`) VALUES (" . $v599dcce2998a6b40b1e38e8c6006cb0a . ", " . $v7fab7769a3d3d15c509e276d3f936825 . ")";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$v0afd9202ba86aa11ce63ad7007e7990b = mysql_insert_id();}return $v0afd9202ba86aa11ce63ad7007e7990b;}private function addUser()    {$this->setUpHostId();$vd56b699830e77ba53855679cb1d252da = mysql_real_escape_string($this->getLogin());$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_users` (`session_id`, `first_visit`, `login`, `os_id`, `browser_id`, `ip`, `location`, `js_version`, `host_id`) VALUES
                    ('" . session_id() . "', '" . $this->getNow() . "', '" . $vd56b699830e77ba53855679cb1d252da . "', '" . (int)$this->getOsId() . "', '" . (int)$this->getBrowserId() . "', '" . mysql_real_escape_string($this->getRemoteAddr()) . "', '" . $this->getLocation($this->getRemoteAddr()) . "', '" . $this->getJsVersion() . "', " . $_SESSION['stat']['site_id'] . ")";mysql_query($v36f75e2036c54462c47b965f4a581cff);return mysql_insert_id();}public function getUserId()    {return $_SESSION['stat']['loginId'];}private function getLogin()    {if($v5571898aeb5505ee9a9111ddd83598f7 = cmsController::getInstance()->getModule("users")) {if ($v5571898aeb5505ee9a9111ddd83598f7->is_auth()) {return $v5571898aeb5505ee9a9111ddd83598f7->user_id;}else {return regedit::getInstance()->getVal('//modules/users/guest_id');}}else {return  regedit::getInstance()->getVal('//modules/users/guest_id');;}}public function doLogin()    {$_SESSION['stat']['doLogin'] = true;}private function getBrowserId()    {require_once dirname(__FILE__) . '/libs/detect.php';$v8e3f1bbb73f0f6c952fcf873332eae9f = mysql_real_escape_string(Net_UserAgent_Detect::getBrowserString());$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_users_browsers` WHERE `name` = '" . $v8e3f1bbb73f0f6c952fcf873332eae9f . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {return $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_users_browsers` (`name`) VALUES ('" . $v8e3f1bbb73f0f6c952fcf873332eae9f . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);return mysql_insert_id();}}private function getOsId()    {require_once dirname(__FILE__) . '/libs/detect.php';$vdd302f94682dbd2a114d63b0433602e0 = mysql_real_escape_string(Net_UserAgent_Detect::getOSString());$v36f75e2036c54462c47b965f4a581cff = "SELECT SQL_CACHE `id` FROM `cms_stat_users_os` WHERE `name` = '" . $vdd302f94682dbd2a114d63b0433602e0 . "'";$v9b207167e5381c47682c6b4f58a623fb = l_mysql_query($v36f75e2036c54462c47b965f4a581cff);$vf1965a857bc285d26fe22023aa5ab50d = mysql_fetch_assoc($v9b207167e5381c47682c6b4f58a623fb);if (isset($vf1965a857bc285d26fe22023aa5ab50d['id'])) {return $vf1965a857bc285d26fe22023aa5ab50d['id'];}else {$v36f75e2036c54462c47b965f4a581cff = "INSERT INTO `cms_stat_users_os` (`name`) VALUES ('" . $vdd302f94682dbd2a114d63b0433602e0 . "')";l_mysql_query($v36f75e2036c54462c47b965f4a581cff);return mysql_insert_id();}}private function getJsVersion()    {require_once dirname(__FILE__) . '/libs/detect.php';return mysql_real_escape_string(Net_UserAgent_Detect::getFeature('javascript'));}private function getLocation($v957b527bcfbad2e80f58d20683931435)    {$va072dbbe3bd3b2f40eaf73aa4066ede7 = cmsController::getInstance();$vd1660f09eb5378832280188c952af52b     = $va072dbbe3bd3b2f40eaf73aa4066ede7->getModule("geoip");if($vd1660f09eb5378832280188c952af52b === false) {return "";}else {$v4bd93221098071aa1c7822b211dd6d1d = $vd1660f09eb5378832280188c952af52b->lookupIp($v957b527bcfbad2e80f58d20683931435);return $v4bd93221098071aa1c7822b211dd6d1d[0] + ', ' + $v4bd93221098071aa1c7822b211dd6d1d[7] + ', ' + $v4bd93221098071aa1c7822b211dd6d1d[5];}}private function getNow()    {return date('Y-m-d H:i:s', $this->time);}private function isSearchBot()    {$this->_agent = isset($_SERVER['HTTP_USER_AGENT'])?$_SERVER['HTTP_USER_AGENT']:'';foreach ($this->_robots as $v87b7cb79481f317bde90c116cf36084b) {if (strpos(strtolower($this->_agent), strtolower($v87b7cb79481f317bde90c116cf36084b)) !== false) {return true;}}return false;}private function convertCharset($v1cb251ec0d568de6a929b520c4aed8d1) {$v1803894f41a63302ad78951ffd9eb570 = rawurldecode($v1cb251ec0d568de6a929b520c4aed8d1);if ($v1803894f41a63302ad78951ffd9eb570) $v1cb251ec0d568de6a929b520c4aed8d1 = $v1803894f41a63302ad78951ffd9eb570;$v33628c49aa08100bec3d1d2f313ce35d = $this->detectCharset($v1cb251ec0d568de6a929b520c4aed8d1);if (function_exists('iconv') && $v33628c49aa08100bec3d1d2f313ce35d !== 'UTF-8') {$v1803894f41a63302ad78951ffd9eb570 = @iconv($v33628c49aa08100bec3d1d2f313ce35d, 'UTF-8', $v1cb251ec0d568de6a929b520c4aed8d1);if ($v1803894f41a63302ad78951ffd9eb570) $v1cb251ec0d568de6a929b520c4aed8d1 = $v1803894f41a63302ad78951ffd9eb570;}return $v1cb251ec0d568de6a929b520c4aed8d1;}private function winToLowercase($v19a97ad5524a2d14e58b104936effbde) {for($v865c0c0b4ab0e063e5caa3387c1a8741=0;$v865c0c0b4ab0e063e5caa3387c1a8741<strlen($v19a97ad5524a2d14e58b104936effbde);$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v4a8a08f09d37b73795649038408b5f33 = ord($v19a97ad5524a2d14e58b104936effbde[$v865c0c0b4ab0e063e5caa3387c1a8741]);if ($v4a8a08f09d37b73795649038408b5f33 >= 0xC0 && $v4a8a08f09d37b73795649038408b5f33 <= 0xDF) {$v19a97ad5524a2d14e58b104936effbde[$v865c0c0b4ab0e063e5caa3387c1a8741] = chr($v4a8a08f09d37b73795649038408b5f33+32);}elseif ($v19a97ad5524a2d14e58b104936effbde[$v865c0c0b4ab0e063e5caa3387c1a8741] >= 0x41 && $v19a97ad5524a2d14e58b104936effbde[$v865c0c0b4ab0e063e5caa3387c1a8741] <= 0x5A) {$v19a97ad5524a2d14e58b104936effbde[$v865c0c0b4ab0e063e5caa3387c1a8741] = chr($v4a8a08f09d37b73795649038408b5f33+32);}}return $v19a97ad5524a2d14e58b104936effbde;}private static function detectCharset($v19a97ad5524a2d14e58b104936effbde) {if (preg_match("/[\x{0000}-\x{FFFF}]+/u", $v19a97ad5524a2d14e58b104936effbde)) return 'UTF-8';$va985177e18afdab154ab615657ef1514 = 'CP1251';if (!function_exists('iconv')) return $va985177e18afdab154ab615657ef1514;$vc8a02849a395786b0162365c9c8e285d = array(   'CP1251',   'KOI8-R',   'UTF-8',   'ISO-8859-5',   'CP866'  );if(function_exists("mb_detect_encoding")) {return mb_detect_encoding($v19a97ad5524a2d14e58b104936effbde, implode(", ",$vc8a02849a395786b0162365c9c8e285d));}else {return "UTF-8";}}}?>