<?php
 class filemanager extends def_module {public function __construct() {parent::__construct();if(cmsController::getInstance()->getCurrentMode() == "admin") {$this->__loadLib("__admin.php");$this->__implement("__filemanager");$this->__loadLib("__shared_files.php");$this->__implement("__shared_files");}else {$this->__loadLib("__custom.php");$this->__implement("__custom_filemanager");}$this->per_page = 25;$this->s_root_path = realpath(ini_get("include_path"));$this->s_root_path = str_replace("\\", "/", $this->s_root_path);while (substr($this->s_root_path, -1) == "/") $this->s_root_path = substr($this->s_root_path, 0, (strlen($this->s_root_path)-1));}public function list_files($v7057e8409c7c531a1a6e9ac3df4ed549 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v364f9b183bd2dd9e0beb45c754830a6c, $vb1c0ed8b2e25638833f73a19e1954309) = def_module::loadTemplates("tpls/filemanager/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "list_files", "list_files_row");$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$v7057e8409c7c531a1a6e9ac3df4ed549 = $this->analyzeRequiredPath($v7057e8409c7c531a1a6e9ac3df4ed549);$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("filemanager", "shared_file")->getId();$v9d85c254b5062e518a134a61950999c3 = $this->per_page;$ve1ba980ce14a8c0d7e2779f895ab8695 = (int) getRequest('p');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->setElementTypeFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$v8be74552df93e31bbdd6b36ed74bdb6a->setHierarchyFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v7057e8409c7c531a1a6e9ac3df4ed549);$v8be74552df93e31bbdd6b36ed74bdb6a->setLimitFilter();$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v9d85c254b5062e518a134a61950999c3, $ve1ba980ce14a8c0d7e2779f895ab8695);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v980da98409d058c365664ff7ea33dd6b = Array();foreach($result as $v344fe56833920762d79635cf2e623810) {$v69ba0c89abba8a3e9cc0c5e32be0d35d = Array();$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v344fe56833920762d79635cf2e623810);$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:id'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getId();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:name'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getName();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:link'] = umiHierarchy::getInstance()->getPathById($v344fe56833920762d79635cf2e623810);$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:downloads-count'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue('downloads_counter');$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:download-link'] = $this->pre_lang . "/filemanager/download/" . $v344fe56833920762d79635cf2e623810;$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:href'] = "upage://" . $v344fe56833920762d79635cf2e623810;$v69ba0c89abba8a3e9cc0c5e32be0d35d['node:desc'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("content");templater::pushEditable("filemanager", "shared_file", $v344fe56833920762d79635cf2e623810);$v980da98409d058c365664ff7ea33dd6b[] = self::parseTemplate($vb1c0ed8b2e25638833f73a19e1954309, $v69ba0c89abba8a3e9cc0c5e32be0d35d, $v344fe56833920762d79635cf2e623810);}$vfca1bff8ad8b3a8585abfb0ad523ba42['nodes:items'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:lines'] = $v980da98409d058c365664ff7ea33dd6b;$vfca1bff8ad8b3a8585abfb0ad523ba42['per_page'] = $v9d85c254b5062e518a134a61950999c3;$vfca1bff8ad8b3a8585abfb0ad523ba42['total'] = $vfbb44b4487415b134bce9c790a27fe5e;return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function shared_file($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $v84d8c2148d233e7430fceb3f20ae3314 = false) {if($this->breakMe()) return;if(!$v66f6181bcb4cff4cd38fbc804a036db6) $v66f6181bcb4cff4cd38fbc804a036db6 = "default";list($v74b82d224e33254ef04d08065c7be6fc, $v9d0b0d3b2831a660cfbd76fc6837e43f, $v8730520a3886fc135b4d1ac18588f56c) = def_module::loadTemplates("tpls/filemanager/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "shared_file", "broken_file", "upload_file");$v7057e8409c7c531a1a6e9ac3df4ed549 = $this->analyzeRequiredPath($v84d8c2148d233e7430fceb3f20ae3314);$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$v364f9b183bd2dd9e0beb45c754830a6c = $v9d0b0d3b2831a660cfbd76fc6837e43f;if ($v8e2dcfd7e7e24b1ca76c1193f645902b) {$v7ad6e70c936a7223ff2f1663258f4a0a = cmsController::getInstance()->getModule('users')->user_id;list($v821812429d8311140c4470f2da1fc14c, $v97c6f9437be4c23d54d793a6591bd844) = cmsController::getInstance()->getModule('users')->isAllowedObject($v7ad6e70c936a7223ff2f1663258f4a0a, $v7057e8409c7c531a1a6e9ac3df4ed549);$vfca1bff8ad8b3a8585abfb0ad523ba42['upload_file'] = "";if ($v97c6f9437be4c23d54d793a6591bd844) {$vfca1bff8ad8b3a8585abfb0ad523ba42['upload_file'] = $v8730520a3886fc135b4d1ac18588f56c;if (count($_FILES)) {$vcfe9db40868e8c52eb7fd570ddcee785 = umiFile::upload("shared_files", "upload", "./files/");if ($vcfe9db40868e8c52eb7fd570ddcee785 instanceof umiFile) {$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("fs_file", $vcfe9db40868e8c52eb7fd570ddcee785);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();}}}$vfca1bff8ad8b3a8585abfb0ad523ba42['id'] = $v7057e8409c7c531a1a6e9ac3df4ed549;$vfca1bff8ad8b3a8585abfb0ad523ba42['descr'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("descr");$vfca1bff8ad8b3a8585abfb0ad523ba42['alt_name'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getAltName();$vfca1bff8ad8b3a8585abfb0ad523ba42['link'] = umiHierarchy::getInstance()->getPathById($v7057e8409c7c531a1a6e9ac3df4ed549);$vfca1bff8ad8b3a8585abfb0ad523ba42['download_link'] = "";$vfca1bff8ad8b3a8585abfb0ad523ba42['file_name'] = "";$vfca1bff8ad8b3a8585abfb0ad523ba42['file_size'] = 0;$v2a134df0dd361791a8dda752dd5e4987 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("fs_file");if ($v2a134df0dd361791a8dda752dd5e4987 instanceof umiFile) {if (!$v2a134df0dd361791a8dda752dd5e4987->getIsBroken()) {$v364f9b183bd2dd9e0beb45c754830a6c = $v74b82d224e33254ef04d08065c7be6fc;$vfca1bff8ad8b3a8585abfb0ad523ba42['download_link'] = $this->pre_lang."/filemanager/download/".$v7057e8409c7c531a1a6e9ac3df4ed549;$vfca1bff8ad8b3a8585abfb0ad523ba42['file_name'] = $v2a134df0dd361791a8dda752dd5e4987->getFileName();$vfca1bff8ad8b3a8585abfb0ad523ba42['file_size'] = round($v2a134df0dd361791a8dda752dd5e4987->getSize()/1024, 2);}}}else {return cmsController::getInstance()->getModule("users")->auth();}templater::pushEditable("filemanager", "shared_file", $v7057e8409c7c531a1a6e9ac3df4ed549);return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function download() {$v7057e8409c7c531a1a6e9ac3df4ed549 = getRequest('param0');$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);define("DISABLE_STATIC_CACHE", 1);if ($v8e2dcfd7e7e24b1ca76c1193f645902b instanceof umiHierarchyElement) {$v2a134df0dd361791a8dda752dd5e4987 = $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("fs_file");if ($v2a134df0dd361791a8dda752dd5e4987 instanceof umiFile) {if (!$v2a134df0dd361791a8dda752dd5e4987->getIsBroken()) {$vf0b6bb5412fa88c10b243bdcb9a26f6a = (int) $v8e2dcfd7e7e24b1ca76c1193f645902b->getValue("downloads_counter");$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("downloads_counter", ++$vf0b6bb5412fa88c10b243bdcb9a26f6a);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$v2a134df0dd361791a8dda752dd5e4987->download();exit();}else {}}}return cmsController::getInstance()->getModule("users")->auth();}public function getEditLink($v7057e8409c7c531a1a6e9ac3df4ed549, $vb8910fa4dc8f637c214b8e9094ef35b9) {$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);$v6be379826b20cc58475f636e33f4606b = $v8e2dcfd7e7e24b1ca76c1193f645902b->getParentId();switch($vb8910fa4dc8f637c214b8e9094ef35b9) {case "shared_file": {$v441c674b4099be68caf8fb0f7ff47e3e = $this->pre_lang . "/admin/filemanager/edit_shared_file/{$v7057e8409c7c531a1a6e9ac3df4ed549}/";return Array(false, $v441c674b4099be68caf8fb0f7ff47e3e);break;}default: {return false;}}}};?>