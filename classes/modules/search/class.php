<?php
 class search extends def_module {public function __construct() {parent::__construct();if(cmsController::getInstance()->getCurrentMode() == "admin") {$this->__loadLib("__admin.php");$this->__implement("__search");}else {$this->__loadLib("__custom.php");$this->__implement("__custom_search");$this->per_page = regedit::getInstance()->getVal("//modules/search/per_page");}}public function search_do($v66f6181bcb4cff4cd38fbc804a036db6 = "default", $va3dbaf37ab12f39c3cd19c0f04a360a0 = "", $vb934cdf74d9a078a5654bd8b129741d9 = "", $vdb39ae2030f7b7017699bb17e5d1443c = "", $v9d85c254b5062e518a134a61950999c3 = 0) {if($this->breakMe()) return;list($v364f9b183bd2dd9e0beb45c754830a6c, $vb1c0ed8b2e25638833f73a19e1954309, $v354617335f393dd1df87980c466ead95, $v6774b4fc0dbe8db9fd884f38bf3eff86) = self::loadTemplates("tpls/search/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "search_block", "search_block_line", "search_empty_result", "search_block_line_quant");if (!$va3dbaf37ab12f39c3cd19c0f04a360a0) $va3dbaf37ab12f39c3cd19c0f04a360a0 = (string) getRequest('search_string');$va3dbaf37ab12f39c3cd19c0f04a360a0 = urldecode($va3dbaf37ab12f39c3cd19c0f04a360a0);$va3dbaf37ab12f39c3cd19c0f04a360a0 = htmlspecialchars($va3dbaf37ab12f39c3cd19c0f04a360a0);$va3dbaf37ab12f39c3cd19c0f04a360a0 = str_replace(".", " ", $va3dbaf37ab12f39c3cd19c0f04a360a0);$va3dbaf37ab12f39c3cd19c0f04a360a0 = trim($va3dbaf37ab12f39c3cd19c0f04a360a0, " \t\r\n%");$va3dbaf37ab12f39c3cd19c0f04a360a0 = str_replace(array('"', "'"), "", $va3dbaf37ab12f39c3cd19c0f04a360a0);$vae1d6a6518a73b480c52bcf30553f9f8 = (bool) getRequest('search-or-mode');if (!$va3dbaf37ab12f39c3cd19c0f04a360a0) return $this->insert_form($v66f6181bcb4cff4cd38fbc804a036db6);$v0f6812df5c1adf76be1443757aa22a03 = array();if (!$vdb39ae2030f7b7017699bb17e5d1443c) $vdb39ae2030f7b7017699bb17e5d1443c = (string) getRequest('search_branches');$vdb39ae2030f7b7017699bb17e5d1443c = trim(rawurldecode($vdb39ae2030f7b7017699bb17e5d1443c));if (strlen($vdb39ae2030f7b7017699bb17e5d1443c)) {$v8f92357f7aeb7bbfcb8e67cdf28e983d = preg_split("/[\s,]+/", $vdb39ae2030f7b7017699bb17e5d1443c);foreach ($v8f92357f7aeb7bbfcb8e67cdf28e983d as $vf4bb13baa75a2185fb957d0659184ed5 => $v5319cf6ae71ca427aa0d57fba2beb087) {$v8f92357f7aeb7bbfcb8e67cdf28e983d[$vf4bb13baa75a2185fb957d0659184ed5] = $this->analyzeRequiredPath($v5319cf6ae71ca427aa0d57fba2beb087);}$v8f92357f7aeb7bbfcb8e67cdf28e983d = array_map('intval', $v8f92357f7aeb7bbfcb8e67cdf28e983d);$v0f6812df5c1adf76be1443757aa22a03 = array_merge($v0f6812df5c1adf76be1443757aa22a03, $v8f92357f7aeb7bbfcb8e67cdf28e983d);$v853ded4a0c315658527d9ba7ed28a3c3 = new umiSelection;$v853ded4a0c315658527d9ba7ed28a3c3->addHierarchyFilter($v8f92357f7aeb7bbfcb8e67cdf28e983d, 100, true);$vb0f3fe5d556811e1bc4effe65af4f80c = umiSelectionsParser::runSelection($v853ded4a0c315658527d9ba7ed28a3c3);$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($vb0f3fe5d556811e1bc4effe65af4f80c);for ($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) $v0f6812df5c1adf76be1443757aa22a03[] = intval($vb0f3fe5d556811e1bc4effe65af4f80c[$v865c0c0b4ab0e063e5caa3387c1a8741]);}if (!$vb934cdf74d9a078a5654bd8b129741d9) $vb934cdf74d9a078a5654bd8b129741d9 = (string) getRequest('search_types');$vb934cdf74d9a078a5654bd8b129741d9 = rawurldecode($vb934cdf74d9a078a5654bd8b129741d9);if (strlen($vb934cdf74d9a078a5654bd8b129741d9)) {$vb934cdf74d9a078a5654bd8b129741d9 = preg_split("/[\s,]+/", $vb934cdf74d9a078a5654bd8b129741d9);$vb934cdf74d9a078a5654bd8b129741d9 = array_map('intval', $vb934cdf74d9a078a5654bd8b129741d9);}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$v980da98409d058c365664ff7ea33dd6b = Array();$result = searchModel::getInstance()->runSearch($va3dbaf37ab12f39c3cd19c0f04a360a0, $vb934cdf74d9a078a5654bd8b129741d9, $v0f6812df5c1adf76be1443757aa22a03, $vae1d6a6518a73b480c52bcf30553f9f8);$v83878c91171338902e0fe0fb97a8c47a = (int) getRequest('p');$vfbb44b4487415b134bce9c790a27fe5e = sizeof($result);if (!$v9d85c254b5062e518a134a61950999c3) $v9d85c254b5062e518a134a61950999c3 = intval(getRequest('per_page'));if (!$v9d85c254b5062e518a134a61950999c3) $v9d85c254b5062e518a134a61950999c3 = $this->per_page;$result = array_slice($result, $v9d85c254b5062e518a134a61950999c3 * $v83878c91171338902e0fe0fb97a8c47a, $v9d85c254b5062e518a134a61950999c3);$v865c0c0b4ab0e063e5caa3387c1a8741 = $v9d85c254b5062e518a134a61950999c3 * $v83878c91171338902e0fe0fb97a8c47a;foreach($result as $v0fc3cfbc27e91ea60a787de13dae3e3c => $v7057e8409c7c531a1a6e9ac3df4ed549) {$v69ba0c89abba8a3e9cc0c5e32be0d35d = Array();$v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549);if(!$v8e2dcfd7e7e24b1ca76c1193f645902b) continue;$v69ba0c89abba8a3e9cc0c5e32be0d35d['void:num'] = ++$v865c0c0b4ab0e063e5caa3387c1a8741;$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:id'] = $v7057e8409c7c531a1a6e9ac3df4ed549;$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:name'] = $v8e2dcfd7e7e24b1ca76c1193f645902b->getName();$v69ba0c89abba8a3e9cc0c5e32be0d35d['attribute:link'] = umiHierarchy::getInstance()->getPathById($v7057e8409c7c531a1a6e9ac3df4ed549);$v69ba0c89abba8a3e9cc0c5e32be0d35d['xlink:href'] = "upage://" . $v7057e8409c7c531a1a6e9ac3df4ed549;$v69ba0c89abba8a3e9cc0c5e32be0d35d['node:context'] = searchModel::getInstance()->getContext($v7057e8409c7c531a1a6e9ac3df4ed549, $va3dbaf37ab12f39c3cd19c0f04a360a0);$v69ba0c89abba8a3e9cc0c5e32be0d35d['void:quant'] = ($v0fc3cfbc27e91ea60a787de13dae3e3c < count($result)-1? self::parseTemplate($v6774b4fc0dbe8db9fd884f38bf3eff86, array()) : "");$v980da98409d058c365664ff7ea33dd6b[] = self::parseTemplate($vb1c0ed8b2e25638833f73a19e1954309, $v69ba0c89abba8a3e9cc0c5e32be0d35d, $v7057e8409c7c531a1a6e9ac3df4ed549);templater::pushEditable(false, false, $v7057e8409c7c531a1a6e9ac3df4ed549);umiHierarchy::getInstance()->unloadElement($v7057e8409c7c531a1a6e9ac3df4ed549);}$vfca1bff8ad8b3a8585abfb0ad523ba42['subnodes:items'] = $vfca1bff8ad8b3a8585abfb0ad523ba42['void:lines'] = $v980da98409d058c365664ff7ea33dd6b;$vfca1bff8ad8b3a8585abfb0ad523ba42['total'] = $vfbb44b4487415b134bce9c790a27fe5e;$vfca1bff8ad8b3a8585abfb0ad523ba42['per_page'] = $v9d85c254b5062e518a134a61950999c3;$vfca1bff8ad8b3a8585abfb0ad523ba42['last_search_string'] = "";return self::parseTemplate(($vfbb44b4487415b134bce9c790a27fe5e > 0 ? $v364f9b183bd2dd9e0beb45c754830a6c : $v354617335f393dd1df87980c466ead95), $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function insert_form($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {if(defined("DB_DRIVER") && DB_DRIVER == "xml") return;list($v364f9b183bd2dd9e0beb45c754830a6c) = self::loadTemplates("tpls/search/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "search_form");$va3dbaf37ab12f39c3cd19c0f04a360a0 = (string) getRequest('search_string');$va3dbaf37ab12f39c3cd19c0f04a360a0 = strip_tags($va3dbaf37ab12f39c3cd19c0f04a360a0);$va3dbaf37ab12f39c3cd19c0f04a360a0 = trim($va3dbaf37ab12f39c3cd19c0f04a360a0, " \t\r\n%");$va3dbaf37ab12f39c3cd19c0f04a360a0 = htmlspecialchars(urldecode($va3dbaf37ab12f39c3cd19c0f04a360a0));$vae1d6a6518a73b480c52bcf30553f9f8 = (bool) getRequest('search-or-mode');$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['last_search_string'] = ($va3dbaf37ab12f39c3cd19c0f04a360a0) ? $va3dbaf37ab12f39c3cd19c0f04a360a0 : "%search_input_text%";if($vae1d6a6518a73b480c52bcf30553f9f8) {$vfca1bff8ad8b3a8585abfb0ad523ba42['void:search_mode_and_checked'] = "";$vfca1bff8ad8b3a8585abfb0ad523ba42['void:search_mode_or_checked'] = " checked";}else {$vfca1bff8ad8b3a8585abfb0ad523ba42['void:search_mode_and_checked'] = " checked";$vfca1bff8ad8b3a8585abfb0ad523ba42['void:search_mode_or_checked'] = "";}return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function suggestions($v66f6181bcb4cff4cd38fbc804a036db6 = 'default', $vb45cffe084dd3d20d928bee85e7b0f21 = false, $vaa9f73eea60a006820d0f8768bc8a3fc = 10) {if($vb45cffe084dd3d20d928bee85e7b0f21 == false) $vb45cffe084dd3d20d928bee85e7b0f21 = getRequest('suggest-string');if($this->breakMe()) return;list($v364f9b183bd2dd9e0beb45c754830a6c, $vb1c0ed8b2e25638833f73a19e1954309, $v28d65bb7a643774ada22f54ca0679289) = self::loadTemplates(    "tpls/search/{$v66f6181bcb4cff4cd38fbc804a036db6}.tpl", "suggestion_block", "suggestion_block_line", "suggestion_block_empty"   );$v06a943c59f33a34bb5924aaf72cd2995 = searchModel::getInstance();$v89759e1284e2479b991d2669de104942 = $v06a943c59f33a34bb5924aaf72cd2995->suggestions($vb45cffe084dd3d20d928bee85e7b0f21, $vaa9f73eea60a006820d0f8768bc8a3fc);$vfbb44b4487415b134bce9c790a27fe5e = sizeof($v89759e1284e2479b991d2669de104942);if($vfbb44b4487415b134bce9c790a27fe5e == 0) {return self::parseTemplate($v28d65bb7a643774ada22f54ca0679289, array());}$vf1386a17eed513dff70798b0551dc170 = array();foreach($v89759e1284e2479b991d2669de104942 as $vc47d187067c6cf953245f128b5fde62a) {$ve253bed1357afcefc5fadfbc92f9eb97 = array(     'attribute:count' => $vc47d187067c6cf953245f128b5fde62a['cnt'],     'node:word'   => $vc47d187067c6cf953245f128b5fde62a['word']    );$vf1386a17eed513dff70798b0551dc170[] = self::parseTemplate($vb1c0ed8b2e25638833f73a19e1954309, $ve253bed1357afcefc5fadfbc92f9eb97);}$vfca1bff8ad8b3a8585abfb0ad523ba42 = array(    'words' => array('nodes:word' => $vf1386a17eed513dff70798b0551dc170),    'total' => $vfbb44b4487415b134bce9c790a27fe5e   );return self::parseTemplate($v364f9b183bd2dd9e0beb45c754830a6c, $vfca1bff8ad8b3a8585abfb0ad523ba42);}};?>