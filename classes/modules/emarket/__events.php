<?php
 abstract class __emarket_events {public function onCronSyncCurrency(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();if(!$vb1444fb0c07653567ad325aa25d4e37a->getVal('//modules/emarket/enable-currency')) return false;$v2245023265ae4cf87d02c8b6ba991139 = mainConfiguration::getInstance();$vaa8d056981feeec7a56c9491bf6902ab = $v2245023265ae4cf87d02c8b6ba991139->get('modules', 'emarket.currency.sync.source');$vfe53e41d8de996a88a87ecafae37162c = './xsl/currencies/' . $v2245023265ae4cf87d02c8b6ba991139->get('modules', 'emarket.currency.sync.xsl');$v6d325d47f090ce01365eb4a02b6c4729 = umiRemoteFileGetter::get($vaa8d056981feeec7a56c9491bf6902ab);if(function_exists('mb_detect_encoding') && (mb_detect_encoding($v6d325d47f090ce01365eb4a02b6c4729, "UTF-8, ISO-8859-1, GBK, CP1251") != "UTF-8")) {$v6d325d47f090ce01365eb4a02b6c4729 = iconv ("CP1251", "UTF-8", $v6d325d47f090ce01365eb4a02b6c4729);$v6d325d47f090ce01365eb4a02b6c4729 = preg_replace("/(encoding=\"windows-1251\")/i", "encoding=\"UTF-8\"", $v6d325d47f090ce01365eb4a02b6c4729);}$v801f7201346b43f8ee8390a1ef20ddcd = new xsltProcessor;$vdd988cfd769c9f7fbd795a0f5da8e751 = new DomDocument();$vdd988cfd769c9f7fbd795a0f5da8e751->loadXML($v6d325d47f090ce01365eb4a02b6c4729);$v801f7201346b43f8ee8390a1ef20ddcd->importStyleSheet(DomDocument::load($vfe53e41d8de996a88a87ecafae37162c));$v9be17bcb5016279b920cf0fbc42aa00e = $v801f7201346b43f8ee8390a1ef20ddcd->transformToXML($vdd988cfd769c9f7fbd795a0f5da8e751);$v3b4305ca5958466aca62ab417ca628f5 = SYS_CACHE_RUNTIME . 'tmpcurrencies.xml';file_put_contents($v3b4305ca5958466aca62ab417ca628f5, $v9be17bcb5016279b920cf0fbc42aa00e);$v42a106586212e35940db2e523cf0b175 = new baseXmlConfig($v3b4305ca5958466aca62ab417ca628f5);$v7f24d9fc4140045241b3f97bcf36bf03 = $v42a106586212e35940db2e523cf0b175->getList('/Exchange/Exchange_Rates', array (    'code'  => '/New_Country',    'rate'  => '/Rate',    'nominal' => '/Nominal'   ));foreach($v7f24d9fc4140045241b3f97bcf36bf03 as $v0f031add9572ee8f21b7b1d5b908d5a9) {$vc13367945d5d4c91047b3b50234aa7ab = getArrayKey($v0f031add9572ee8f21b7b1d5b908d5a9, 'code');try {if($v1af0389838508d7016a9841eb6273962 = $this->getCurrency($vc13367945d5d4c91047b3b50234aa7ab)) {$v1af0389838508d7016a9841eb6273962->nominal = getArrayKey($v0f031add9572ee8f21b7b1d5b908d5a9, 'nominal');$v1af0389838508d7016a9841eb6273962->rate = getArrayKey($v0f031add9572ee8f21b7b1d5b908d5a9, 'rate');$v1af0389838508d7016a9841eb6273962->commit();}}catch(privateException $ve1671797c52e15f763380b45e841ec32) {}}unlink($v3b4305ca5958466aca62ab417ca628f5);}public function onModifyProperty(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {$vf5e638cc78dd325906c1298a0c21fb6b = $v4119639092e62c55ea8be348e4d9260d->getRef("entity");if($vf5e638cc78dd325906c1298a0c21fb6b instanceof iUmiObject) {$v287c9def6b677d90560866d2b45cb930 = array("status_id", "payment_status_id", "delivery_status_id");$v5f694956811487225d15e973ca38fbab = umiObjectTypesCollection::getInstance()->getBaseType('emarket', 'order');if(($vf5e638cc78dd325906c1298a0c21fb6b->getTypeId() == $v5f694956811487225d15e973ca38fbab) &&     (in_array($v4119639092e62c55ea8be348e4d9260d->getParam("property"), $v287c9def6b677d90560866d2b45cb930) ) &&        ($v4119639092e62c55ea8be348e4d9260d->getParam("newValue") != $v4119639092e62c55ea8be348e4d9260d->getParam("oldValue")) ) {$this->notifyOrderStatusChange(order::get($vf5e638cc78dd325906c1298a0c21fb6b->getId()), $v4119639092e62c55ea8be348e4d9260d->getParam("property"));}}}public function onModifyObject(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {static $v9ada1f68c17d9a15eeaf136552921cd8 = array();$va8cfde6331bd59eb2ac96f8911c4b666 = $v4119639092e62c55ea8be348e4d9260d->getRef("object");$v5f694956811487225d15e973ca38fbab = umiObjectTypesCollection::getInstance()->getBaseType('emarket', 'order');if($va8cfde6331bd59eb2ac96f8911c4b666->getTypeId() != $v5f694956811487225d15e973ca38fbab) return;if($v4119639092e62c55ea8be348e4d9260d->getMode() == "before") {$v8d777f385d3dfec8815d20f7496026dc = getRequest("data");$vb80bb7740288fda1f201890375a60c8f   = $va8cfde6331bd59eb2ac96f8911c4b666->getId();$v2fdbf28d5a46754a79fb59644f43fac3    = getArrayKey($v8d777f385d3dfec8815d20f7496026dc[$vb80bb7740288fda1f201890375a60c8f], 'status_id');$vd05eb828e7ff61bc9fc1e2e80dea5089  = getArrayKey($v8d777f385d3dfec8815d20f7496026dc[$vb80bb7740288fda1f201890375a60c8f], 'payment_status_id');$v0a2d6b50b3a32ed1ebb9adbe6fe85c2e = getArrayKey($v8d777f385d3dfec8815d20f7496026dc[$vb80bb7740288fda1f201890375a60c8f], 'delivery_status_id');switch(true) {case ($v2fdbf28d5a46754a79fb59644f43fac3 != $va8cfde6331bd59eb2ac96f8911c4b666->getValue("status_id") ) : $v9ada1f68c17d9a15eeaf136552921cd8[$va8cfde6331bd59eb2ac96f8911c4b666->getId()] = "status_id";break;case ($v0a2d6b50b3a32ed1ebb9adbe6fe85c2e != $va8cfde6331bd59eb2ac96f8911c4b666->getValue("delivery_status_id")) : $v9ada1f68c17d9a15eeaf136552921cd8[$va8cfde6331bd59eb2ac96f8911c4b666->getId()] = "delivery_status_id";break;case ($vd05eb828e7ff61bc9fc1e2e80dea5089 != $va8cfde6331bd59eb2ac96f8911c4b666->getValue("payment_status_id") ) : $v9ada1f68c17d9a15eeaf136552921cd8[$va8cfde6331bd59eb2ac96f8911c4b666->getId()] = "payment_status_id";break;}}else {if(isset($v9ada1f68c17d9a15eeaf136552921cd8[$va8cfde6331bd59eb2ac96f8911c4b666->getId()])) {$this->notifyOrderStatusChange(order::get($va8cfde6331bd59eb2ac96f8911c4b666->getId()), $v9ada1f68c17d9a15eeaf136552921cd8[$va8cfde6331bd59eb2ac96f8911c4b666->getId()]);}}}public function onStatusChanged(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {if($v4119639092e62c55ea8be348e4d9260d->getMode() == "after" &&    $v4119639092e62c55ea8be348e4d9260d->getParam("old-status-id") != $v4119639092e62c55ea8be348e4d9260d->getParam("new-status-id")) {$v70a17ffa722a3985b86d30b034ad06d7 = $v4119639092e62c55ea8be348e4d9260d->getRef("order");$this->notifyOrderStatusChange($v70a17ffa722a3985b86d30b034ad06d7, "status_id");}}public function onPaymentStatusChanged(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {if($v4119639092e62c55ea8be348e4d9260d->getMode() == "after" &&    $v4119639092e62c55ea8be348e4d9260d->getParam("old-status-id") != $v4119639092e62c55ea8be348e4d9260d->getParam("new-status-id")) {$v70a17ffa722a3985b86d30b034ad06d7 = $v4119639092e62c55ea8be348e4d9260d->getRef("order");$this->notifyOrderStatusChange($v70a17ffa722a3985b86d30b034ad06d7, "payment_status_id");}}public function onDeliveryStatusChanged(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {if($v4119639092e62c55ea8be348e4d9260d->getMode() == "after" &&    $v4119639092e62c55ea8be348e4d9260d->getParam("old-status-id") != $v4119639092e62c55ea8be348e4d9260d->getParam("new-status-id")) {$v70a17ffa722a3985b86d30b034ad06d7 = $v4119639092e62c55ea8be348e4d9260d->getRef("order");$this->notifyOrderStatusChange($v70a17ffa722a3985b86d30b034ad06d7, "delivery_status_id");}}};?>