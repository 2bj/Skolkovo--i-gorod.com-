<?php
 class umiDistrWriter {protected $configFilePath,    $force,    $skipMySql,    $paths = Array(),    $totalSize = 0,    $fh;protected $version = "1.0.0",    $signature = "ucp";public  $author = "";public  $comment = "";public function __construct($vcc87d2cfc5127128ded076ce5e7af0c8, $vae254d63f2381cc183c11594873793e0 = false, $v4d9f132a683b745ceb76606727002d66 = false) {if(!is_file($vcc87d2cfc5127128ded076ce5e7af0c8)) {trigger_error("Config file \"{$vcc87d2cfc5127128ded076ce5e7af0c8}\" doesn't exists", E_USER_ERROR);}$this->configFilePath = $vcc87d2cfc5127128ded076ce5e7af0c8;$this->force = $vae254d63f2381cc183c11594873793e0;$this->skipMySql = $v4d9f132a683b745ceb76606727002d66;$this->readConfigFile();}public function __destruct() {if(is_resource($this->fh)) {trigger_error("Resource \"{$this->fh}\" is not closed.", E_USER_NOTICE);fclose($this->fh);}}protected function readConfigFile() {if(!is_readable($this->configFilePath)) {trigger_error("Config file \"{$this->configFilePath}\" is not readable", E_USER_ERROR);}$v8fa14cdd754f91cc6554c9e71929cce7 = $this->fh = fopen($this->configFilePath, "r");for($v865c0c0b4ab0e063e5caa3387c1a8741 = 1;!feof($v8fa14cdd754f91cc6554c9e71929cce7);++$v865c0c0b4ab0e063e5caa3387c1a8741) {$vd6fe1d0be6347b8ef2427fa629c04485 = trim(stream_get_line($v8fa14cdd754f91cc6554c9e71929cce7, 512, "\r\n"));if(!$vd6fe1d0be6347b8ef2427fa629c04485 || substr($vd6fe1d0be6347b8ef2427fa629c04485, 0, 1) == "#") continue;if(!file_exists($vd6fe1d0be6347b8ef2427fa629c04485)) {if($this->force) {trigger_error("Error parsing {$this->configFilePath} on line {$v865c0c0b4ab0e063e5caa3387c1a8741}. File not found: \"{$vd6fe1d0be6347b8ef2427fa629c04485}\".", E_USER_WARNING);continue;}else {trigger_error("Error parsing {$this->configFilePath} on line {$v865c0c0b4ab0e063e5caa3387c1a8741}. File not found: \"{$vd6fe1d0be6347b8ef2427fa629c04485}\".", E_USER_ERROR);return false;}}$vd6fe1d0be6347b8ef2427fa629c04485 = realpath($vd6fe1d0be6347b8ef2427fa629c04485);if(!is_readable($vd6fe1d0be6347b8ef2427fa629c04485)) {if($this->force) {trigger_error("Error parsing {$this->configFilePath} on line {$v865c0c0b4ab0e063e5caa3387c1a8741}. File is not readable: \"{$vd6fe1d0be6347b8ef2427fa629c04485}\".", E_USER_WARNING);continue;}else {trigger_error("Error parsing {$this->configFilePath} on line {$v865c0c0b4ab0e063e5caa3387c1a8741}. File is not readable: \"{$vd6fe1d0be6347b8ef2427fa629c04485}\".", E_USER_ERROR);return false;}}if(!in_array($vd6fe1d0be6347b8ef2427fa629c04485, $this->paths)) {$vfe86e77f98ae548db0b7d706cc6d4722 = realpath(dirname(__FILE__) . '/../..') . "/";$vd6fe1d0be6347b8ef2427fa629c04485 = substr($vd6fe1d0be6347b8ef2427fa629c04485, strlen($vfe86e77f98ae548db0b7d706cc6d4722), strlen($vd6fe1d0be6347b8ef2427fa629c04485) - strlen($vfe86e77f98ae548db0b7d706cc6d4722));$this->paths[] = $vd6fe1d0be6347b8ef2427fa629c04485;$this->totalSize += filesize($vd6fe1d0be6347b8ef2427fa629c04485);}}fclose($v8fa14cdd754f91cc6554c9e71929cce7);}public function generatePackage($v97dfe6695a26ae585d8a9a85327a91e0 = "./output/umicmsproinfo.ucp") {$this->fh = $v8fa14cdd754f91cc6554c9e71929cce7 = fopen($v97dfe6695a26ae585d8a9a85327a91e0, "wb");$this->generatePackageHeader();if(!$this->skipMySql) {$this->generateMySqlDump();}$this->generateDump();fclose($v8fa14cdd754f91cc6554c9e71929cce7);chmod($v97dfe6695a26ae585d8a9a85327a91e0, 0777);}protected function generatePackageHeader() {$v8fa14cdd754f91cc6554c9e71929cce7 = $this->fh;fseek($v8fa14cdd754f91cc6554c9e71929cce7, 0);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $this->signature);fseek($v8fa14cdd754f91cc6554c9e71929cce7, 5);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $this->version);fseek($v8fa14cdd754f91cc6554c9e71929cce7, 10);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, time());fseek($v8fa14cdd754f91cc6554c9e71929cce7, 25);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $this->totalSize);fseek($v8fa14cdd754f91cc6554c9e71929cce7, 50);$v02bd92faa38aaa6cc0ea75e59937a1ef = substr($this->author, 0, 25);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $v02bd92faa38aaa6cc0ea75e59937a1ef);fseek($v8fa14cdd754f91cc6554c9e71929cce7, 75);$v06d4cd63bde972fc66a0aed41d2f5c51 = substr($this->comment, 0, 255);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $v06d4cd63bde972fc66a0aed41d2f5c51);fseek($v8fa14cdd754f91cc6554c9e71929cce7, 330);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, "\n");}protected function generateDump() {$v8fa14cdd754f91cc6554c9e71929cce7 = $this->fh;$v7dabf5c198b0bab2eaa42bb03a113e55 = sizeof($this->paths);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v865c0c0b4ab0e063e5caa3387c1a8741 < $v7dabf5c198b0bab2eaa42bb03a113e55;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->paths[$v865c0c0b4ab0e063e5caa3387c1a8741];if(file_exists($vd6fe1d0be6347b8ef2427fa629c04485)) {$v6708fceffc1870a015ac41ac504c5229 = filetype($vd6fe1d0be6347b8ef2427fa629c04485);}else {$v6708fceffc1870a015ac41ac504c5229 = "sql";}switch($v6708fceffc1870a015ac41ac504c5229) {case "file": {$vbe8f80182e0c983916da7338c2c1c040 = new umiDistrFile($vd6fe1d0be6347b8ef2427fa629c04485);break;}case "dir": {$vbe8f80182e0c983916da7338c2c1c040 = new umiDistrFolder($vd6fe1d0be6347b8ef2427fa629c04485);break;}case "sql": {if(!$this->skipMySql) {$vbe8f80182e0c983916da7338c2c1c040 = new umiDistrMySql($vd6fe1d0be6347b8ef2427fa629c04485);}break;}default: {continue;}}if(!$vbe8f80182e0c983916da7338c2c1c040) continue;$v8d777f385d3dfec8815d20f7496026dc = $vbe8f80182e0c983916da7338c2c1c040->pack();$v83878c91171338902e0fe0fb97a8c47a = ftell($v8fa14cdd754f91cc6554c9e71929cce7);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, strlen($v8d777f385d3dfec8815d20f7496026dc));fseek($v8fa14cdd754f91cc6554c9e71929cce7, $v83878c91171338902e0fe0fb97a8c47a + 25);fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $v8d777f385d3dfec8815d20f7496026dc);unset($vbe8f80182e0c983916da7338c2c1c040);unset($v8d777f385d3dfec8815d20f7496026dc);}}protected function generateMySqlDump() {include "./mysql.php";$vac5c74b64b4b8352ef2f181affb5ac2a = "SHOW TABLES";$result = l_mysql_query($vac5c74b64b4b8352ef2f181affb5ac2a);while(list($v4b27b6e578e03e53206b2e4688d7a3e5) = mysql_fetch_row($result)) {$this->paths[] = $v4b27b6e578e03e53206b2e4688d7a3e5;}}};?>