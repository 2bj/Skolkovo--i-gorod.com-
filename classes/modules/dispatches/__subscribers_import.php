<?php
 abstract class __subscribers_import_dispatches extends baseModuleAdmin {public function subscribers_import() {$v15d61712450a686a7f365adf4fef581f = (string) getRequest('param0');$v21ffce5b8a6cc8cc6a41448dd69623c9 = Array(    'options' => Array(      'file:csvfile' => Array('value' => NULL, 'destination-folder' => './files/')     )   );if($v15d61712450a686a7f365adf4fef581f == "do") {$this->subscribers_import_do();}$this->setDataType('settings');$this->setActionType('modify');$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($v21ffce5b8a6cc8cc6a41448dd69623c9, 'settings');$this->setData($v8d777f385d3dfec8815d20f7496026dc);return $this->doData();}public function subscribers_import_do() {$vb2383cb050f8cd4be92235ba9c1409f9 = getRequest('select_csvfile');if(!($v1339f16408810c2f7dc1546201b15def = umiFile::upload("data", "csvfile", "./files/"))) $v1339f16408810c2f7dc1546201b15def = new umiFile("./files/" . $vb2383cb050f8cd4be92235ba9c1409f9);if($v6a2a431fe8b621037ea949531c28551d = $v1339f16408810c2f7dc1546201b15def->getFilePath()) {$v628cb5675ff524f3e719b7aa2e88fe3f = file_get_contents($v6a2a431fe8b621037ea949531c28551d);$v628cb5675ff524f3e719b7aa2e88fe3f = iconv("CP1251", "UTF-8//IGNORE", $v628cb5675ff524f3e719b7aa2e88fe3f);$v4912434195547d06b590403d2a36a8fe = split("\n", $v628cb5675ff524f3e719b7aa2e88fe3f);foreach($v4912434195547d06b590403d2a36a8fe as $v1a5e15a250c1be44099d376c348a05bc) {$v47c80780ab608cc046f2a6e6f071feb6 = split(";", $v1a5e15a250c1be44099d376c348a05bc);if(sizeof($v47c80780ab608cc046f2a6e6f071feb6) < 2) continue;list($v0c83f57c786a0b4a39efab23731c7ebc, $va3da707b651c79ecc39a4986516180b2) = $v47c80780ab608cc046f2a6e6f071feb6;$vbfbb12dc2dce9d328e8303093db2ca33 = (isset($v47c80780ab608cc046f2a6e6f071feb6[2])) ? $v47c80780ab608cc046f2a6e6f071feb6[2] : false;$this->import_subscriber($v0c83f57c786a0b4a39efab23731c7ebc, $va3da707b651c79ecc39a4986516180b2, $vbfbb12dc2dce9d328e8303093db2ca33);}}$this->redirect($this->pre_lang . "/admin/dispatches/subscribers/");}public function import_subscriber ($v0c83f57c786a0b4a39efab23731c7ebc, $va3da707b651c79ecc39a4986516180b2, $vbfbb12dc2dce9d328e8303093db2ca33) {if(!$v0c83f57c786a0b4a39efab23731c7ebc) return false;$v18ea1849dbf10a18b2dfd4ed0eb3a231 = new umiSelection;$v18ea1849dbf10a18b2dfd4ed0eb3a231->setObjectTypeFilter();$vf7b7708e49b5e697e01291fdbb169c31 = umiHierarchyTypesCollection::getInstance()->getTypeByName("dispatches", "subscriber")->getId();$v3ec9f372b2dad35356b9884c89cf0ef2 =  umiObjectTypesCollection::getInstance()->getTypeByHierarchyTypeId($vf7b7708e49b5e697e01291fdbb169c31);$vff500849b1c1163f66c899c7aec17813 = umiObjectTypesCollection::getInstance()->getType($v3ec9f372b2dad35356b9884c89cf0ef2);$v18ea1849dbf10a18b2dfd4ed0eb3a231->addObjectType($v3ec9f372b2dad35356b9884c89cf0ef2);$v18ea1849dbf10a18b2dfd4ed0eb3a231->setNamesFilter();$v18ea1849dbf10a18b2dfd4ed0eb3a231->addNameFilterEquals($v0c83f57c786a0b4a39efab23731c7ebc);$v2cf58721416a170aa34368186d661d4b = umiSelectionsParser::runSelection($v18ea1849dbf10a18b2dfd4ed0eb3a231);if(sizeof($v2cf58721416a170aa34368186d661d4b)) {list($vaf31437ce61345f416579830a98c91e5) = $v2cf58721416a170aa34368186d661d4b;}else {$vaf31437ce61345f416579830a98c91e5 = umiObjectsCollection::getInstance()->addObject($v0c83f57c786a0b4a39efab23731c7ebc, $v3ec9f372b2dad35356b9884c89cf0ef2);}if($vf674b89869b81fcedca2243c18bbcdd1 = umiObjectsCollection::getInstance()->getObject($vaf31437ce61345f416579830a98c91e5)) {$vf674b89869b81fcedca2243c18bbcdd1->setName($v0c83f57c786a0b4a39efab23731c7ebc);$vf674b89869b81fcedca2243c18bbcdd1->setValue('fname', $va3da707b651c79ecc39a4986516180b2);$vf674b89869b81fcedca2243c18bbcdd1->setValue('lname', $vbfbb12dc2dce9d328e8303093db2ca33);$v61a9cd46c360819bab753cd29ccea4c4 = new umiDate(time());$vf674b89869b81fcedca2243c18bbcdd1->setValue('subscribe_date', $v61a9cd46c360819bab753cd29ccea4c4);$vf674b89869b81fcedca2243c18bbcdd1->setValue('subscriber_dispatches', $this->getAllDispatches());$vf674b89869b81fcedca2243c18bbcdd1->commit();}else {return false;}return $vaf31437ce61345f416579830a98c91e5;}};?>