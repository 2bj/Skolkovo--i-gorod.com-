<?php
 abstract class __json_autoupdate {public function json_check_updates() {header("Content-type: text/javascript; charset=utf-8");$v9b207167e5381c47682c6b4f58a623fb = <<<JS
window.location = "/smu/index.php";
JS;   $this->flush($v9b207167e5381c47682c6b4f58a623fb);}public function json_install_updates() {header("Content-type: text/javascript; charset=utf-8");$v9b207167e5381c47682c6b4f58a623fb = <<<JS
window.location = "/smu/index.php";
JS;   $this->flush($v9b207167e5381c47682c6b4f58a623fb);}public function saveUpdateFile($v9b207167e5381c47682c6b4f58a623fb) {if(!is_dir("./updates")) {mkdir("./updates");}file_put_contents("./updates/update.ucp", $v9b207167e5381c47682c6b4f58a623fb);chmod("./updates/update.ucp", 0600);}public function commitUpdateFile() {list($v2af72f100c356273d46284f6fd1dfc08, $vb5f927bae9a11c2967a368e3e9bd9e75) = split("\n", umiRemoteFileGetter::get("http://udod.umihost.ru:82/status.txt"));if($v2af72f100c356273d46284f6fd1dfc08 && $vb5f927bae9a11c2967a368e3e9bd9e75) {include "classes/umiDistr/umiDistrReader.php";include "classes/umiDistr/umiDistrInstallItem.php";include "classes/umiDistr/umiDistrFile.php";include "classes/umiDistr/umiDistrFolder.php";$ve29d90706cd6f797567f79e1a10e1bb2 = new umiDistrReader("./updates/update.ucp");unset($ve29d90706cd6f797567f79e1a10e1bb2);if(file_exists("./updates/update.ucp")) {unlink("./updates/update.ucp");}$this->updateTypes();$ve69592adf0fc8cd7edb1d4a3b6c51f19 = time();$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/autoupdate/system_version", $v2af72f100c356273d46284f6fd1dfc08);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/autoupdate/system_build", $vb5f927bae9a11c2967a368e3e9bd9e75);$vb1444fb0c07653567ad325aa25d4e37a->setVar("//modules/autoupdate/last_updated", $ve69592adf0fc8cd7edb1d4a3b6c51f19);if(file_exists("./cache/reg")) {unlink("./cache/reg");}$v0eb9b3af2e4a00837a1b1a854c9ea18c = $vb1444fb0c07653567ad325aa25d4e37a->getList("//modules");foreach($v0eb9b3af2e4a00837a1b1a854c9ea18c as $v793914c9c583d9d86d0f4ed8c521b0c1)  {list($v854203cccade0bbe21be239a208aea49) = $v793914c9c583d9d86d0f4ed8c521b0c1;$vb4d1cb64bb422ee326f99d05c787e465 = "classes/modules/" . $v854203cccade0bbe21be239a208aea49 . "/update.php";if(file_exists($vb4d1cb64bb422ee326f99d05c787e465)) {include_once $vb4d1cb64bb422ee326f99d05c787e465;}}return $ve69592adf0fc8cd7edb1d4a3b6c51f19;}else {return false;}}public function updateTypes() {$v0eb9b3af2e4a00837a1b1a854c9ea18c = regedit::getInstance()->getList("//modules");foreach($v0eb9b3af2e4a00837a1b1a854c9ea18c as $v22884db148f0ffb0d830ba431102b0b5) {list($v22884db148f0ffb0d830ba431102b0b5) = $v22884db148f0ffb0d830ba431102b0b5;$v435ed7e9f07f740abf511a62c00eef6e = "./classes/modules/{$v22884db148f0ffb0d830ba431102b0b5}/types.xml";if(file_exists($v435ed7e9f07f740abf511a62c00eef6e)) {$v1bc49dba86c5074c5266c6d38c301a46 = new umiModuleDataImporter();$v1bc49dba86c5074c5266c6d38c301a46->loadXmlFile($v435ed7e9f07f740abf511a62c00eef6e);$v1bc49dba86c5074c5266c6d38c301a46->import();}}}public function cleanupUpdateFiles() {$v23fd6faa3d3256d1708b0970f834b8bc = "./updates";if(is_dir($v23fd6faa3d3256d1708b0970f834b8bc)) {$v736007832d2167baaae763fd3a3f3cf1 = opendir($v23fd6faa3d3256d1708b0970f834b8bc);while($vbe8f80182e0c983916da7338c2c1c040 = readdir($v736007832d2167baaae763fd3a3f3cf1)) {if(substr($vbe8f80182e0c983916da7338c2c1c040, 0, 1) == ".") continue;$v61cdeb5194efaef4fa627f7a4c30e5e1 = $v23fd6faa3d3256d1708b0970f834b8bc . "/" . $vbe8f80182e0c983916da7338c2c1c040;if(file_exists($v61cdeb5194efaef4fa627f7a4c30e5e1)) {unlink($v61cdeb5194efaef4fa627f7a4c30e5e1);}}}}public function loadPartialUpdate($v572d4e421e5e6b9bc11d815e8a027112, $vb4e61b8d3d0775afd6213143a112726b) {$v23fd6faa3d3256d1708b0970f834b8bc = "./updates";$v572d4e421e5e6b9bc11d815e8a027112 = $v572d4e421e5e6b9bc11d815e8a027112 . $vb4e61b8d3d0775afd6213143a112726b . "/";$v435ed7e9f07f740abf511a62c00eef6e = $v23fd6faa3d3256d1708b0970f834b8bc . "/update.{$vb4e61b8d3d0775afd6213143a112726b}.ucp";$v568d8e07bbe5575518d5005e559743c3 = umiRemoteFileGetter::get($v572d4e421e5e6b9bc11d815e8a027112);if($v568d8e07bbe5575518d5005e559743c3) {if($v568d8e07bbe5575518d5005e559743c3 == "[EOF]") return false;file_put_contents($v435ed7e9f07f740abf511a62c00eef6e, $v568d8e07bbe5575518d5005e559743c3);unset($v568d8e07bbe5575518d5005e559743c3);return true;}else {return false;}}public function mergePartialUpdate() {$v23fd6faa3d3256d1708b0970f834b8bc = "./updates";$vb47276990e57a4b7461b78981f692bae = $v23fd6faa3d3256d1708b0970f834b8bc . "/update.ucp";if(file_exists($vb47276990e57a4b7461b78981f692bae)) {unlink($vb47276990e57a4b7461b78981f692bae);}touch($vb47276990e57a4b7461b78981f692bae);chmod($vb47276990e57a4b7461b78981f692bae, 0600);for($v865c0c0b4ab0e063e5caa3387c1a8741 = 1;true;$v865c0c0b4ab0e063e5caa3387c1a8741++) {$v435ed7e9f07f740abf511a62c00eef6e = $v23fd6faa3d3256d1708b0970f834b8bc . "/update.{$v865c0c0b4ab0e063e5caa3387c1a8741}.ucp";if(file_exists($v435ed7e9f07f740abf511a62c00eef6e)) {$v568d8e07bbe5575518d5005e559743c3 = file_get_contents($v435ed7e9f07f740abf511a62c00eef6e);$v8fa14cdd754f91cc6554c9e71929cce7 = fopen($vb47276990e57a4b7461b78981f692bae, "a");fwrite($v8fa14cdd754f91cc6554c9e71929cce7, $v568d8e07bbe5575518d5005e559743c3);fclose($v8fa14cdd754f91cc6554c9e71929cce7);unset($v568d8e07bbe5575518d5005e559743c3);}else {break;}}return;}};?>