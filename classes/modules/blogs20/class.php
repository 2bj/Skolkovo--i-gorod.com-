<?php
class blogs20 extends def_module {private $blogs_per_page    = 0;private $posts_per_page    = 0;private $comments_per_page = 0;public function __construct() {if(cmsController::getInstance()->getCurrentMode() === 'admin') {$this->__loadLib("__admin.php");$this->__implement("__admin");$this->__loadLib("__import.php");$this->__implement("__import");$v38d1e18b54816e157dda5426c36970e3 = $this->getCommonTabs();if($v38d1e18b54816e157dda5426c36970e3) {$v38d1e18b54816e157dda5426c36970e3->add("posts");$v38d1e18b54816e157dda5426c36970e3->add("blogs");$v38d1e18b54816e157dda5426c36970e3->add("comments");}}else {$this->__loadLib("__events_handlers.php");$this->__implement("__eventsHandlersBlogs");$this->__loadLib("__custom.php");$this->__implement("__custom_blogs20");}$vb1444fb0c07653567ad325aa25d4e37a = regedit::getInstance();$this->blogs_per_page   = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/blogs20/paging/blogs");$this->posts_per_page   = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/blogs20/paging/posts");$this->comments_per_page = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/blogs20/paging/comments");}public function getEditLink($v7057e8409c7c531a1a6e9ac3df4ed549, $vb8910fa4dc8f637c214b8e9094ef35b9) {switch($vb8910fa4dc8f637c214b8e9094ef35b9) {case "blog": {$v20d49e744b40132da5f81045b5d6ec25  = $this->pre_lang . "/admin/blogs20/add/{$v7057e8409c7c531a1a6e9ac3df4ed549}/post/";$v441c674b4099be68caf8fb0f7ff47e3e = $this->pre_lang . "/admin/blogs20/edit/{$v7057e8409c7c531a1a6e9ac3df4ed549}/";return Array($v20d49e744b40132da5f81045b5d6ec25, $v441c674b4099be68caf8fb0f7ff47e3e);break;}case "comment":   case "post": {$v441c674b4099be68caf8fb0f7ff47e3e = $this->pre_lang . "/admin/blogs20/edit/{$v7057e8409c7c531a1a6e9ac3df4ed549}/";return Array(false, $v441c674b4099be68caf8fb0f7ff47e3e);break;}default: {return false;}}}public function blog() {if($this->breakMe()) return;$v5ec92172c9f45d96f490290ccbaaf809 = cmsController::getInstance()->getCurrentElementId();return $this->postsList($v5ec92172c9f45d96f490290ccbaaf809);}public function post() {if($this->breakMe()) return;$v73f10df5e289faaff50345b514062c0e = cmsController::getInstance()->getCurrentElementId();return $this->postView($v73f10df5e289faaff50345b514062c0e);}public function comment() {$v84582ccdffe07a1c9f8e895eb2152e53 = umiHierarchyTypesCollection::getInstance()->getTypeByName('blogs20', 'comment')->getId();$ve2e1896b91c77e852e93acb763cdb1a7    = cmsController::getInstance()->getCurrentElementId();$vb81ca7c0ccaa77e7aa91936ab0070695    = umiHierarchy::getInstance();$v8e2dcfd7e7e24b1ca76c1193f645902b      = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($ve2e1896b91c77e852e93acb763cdb1a7);while($v8e2dcfd7e7e24b1ca76c1193f645902b->getTypeId() == $v84582ccdffe07a1c9f8e895eb2152e53) $v8e2dcfd7e7e24b1ca76c1193f645902b = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($v8e2dcfd7e7e24b1ca76c1193f645902b->getRel());$this->redirect( $vb81ca7c0ccaa77e7aa91936ab0070695->getPathById($v8e2dcfd7e7e24b1ca76c1193f645902b->getId()) . '#comment_' . $ve2e1896b91c77e852e93acb763cdb1a7 );}public function blogsList($v802297d1ee00b70d0fe35a3cbf96295f = false, $v196ff468dd22ac429da86fe7084fd6b5=false, $v72ee76c5c29383b7c9f9225c1fa4d10b = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {list($vfbd4fece8410679bc4d12bf890485244, $v60bea1419e0d2afc208fd869ba872e68) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'blogs_list_block', 'blogs_list_line');$v71860c77c6745379b0d44304d66b6a13 = (int)getRequest('p');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "blog")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();if($v802297d1ee00b70d0fe35a3cbf96295f)   $v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($v802297d1ee00b70d0fe35a3cbf96295f, 0);else   $v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($this->blogs_per_page, $v71860c77c6745379b0d44304d66b6a13);switch($v196ff468dd22ac429da86fe7084fd6b5) {case 1:   case 'name': $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByName(true);break;case 2:   case 'ord':  $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByOrd(true);break;case 4:   case 'rand': $v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByRand();break;}$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e  = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();$result = array_unique($result);$v58adb00b289a0e0e1b51fa7e280b6bbc = array();foreach($result as $ve779466dcd8083dab2ca071f4fb28e67) {$v4640d44b30f3273e05905771772fd9be      = $vc20baa4161945565bd89bb659504b1a7->getElement($ve779466dcd8083dab2ca071f4fb28e67);$ve03aaad027a88fc6cd24c8cfdfd8db10 = array();$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:bid']   = $ve779466dcd8083dab2ca071f4fb28e67;$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:title'] = $v4640d44b30f3273e05905771772fd9be->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:link']  = $vc20baa4161945565bd89bb659504b1a7->getPathById($ve779466dcd8083dab2ca071f4fb28e67);$ve03aaad027a88fc6cd24c8cfdfd8db10['node:name']       = $v4640d44b30f3273e05905771772fd9be->getName();$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v60bea1419e0d2afc208fd869ba872e68, $ve03aaad027a88fc6cd24c8cfdfd8db10, $ve779466dcd8083dab2ca071f4fb28e67);}$v017b0f18009a57a2723c5baf03fe7a95 = array();$v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v017b0f18009a57a2723c5baf03fe7a95['void:lines'] = $v58adb00b289a0e0e1b51fa7e280b6bbc;$v017b0f18009a57a2723c5baf03fe7a95['per_page'] = $v802297d1ee00b70d0fe35a3cbf96295f ? $v802297d1ee00b70d0fe35a3cbf96295f : $this->blogs_per_page;$v017b0f18009a57a2723c5baf03fe7a95['total']    = $vfbb44b4487415b134bce9c790a27fe5e;return self::parseTemplate($vfbd4fece8410679bc4d12bf890485244, $v017b0f18009a57a2723c5baf03fe7a95);}public function postsList($v5ec92172c9f45d96f490290ccbaaf809 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default', $vaa9f73eea60a006820d0f8768bc8a3fc = false) {list($vfbd4fece8410679bc4d12bf890485244, $v60bea1419e0d2afc208fd869ba872e68, $ved43a1f04b8d51c21f16d85ac4c43e30) =     self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'posts_list_block', 'posts_list_line', 'posts_list_block_empty');$v71860c77c6745379b0d44304d66b6a13 = (int)getRequest('p');$v4640d44b30f3273e05905771772fd9be = null;$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();if($v5ec92172c9f45d96f490290ccbaaf809 == false) {$vbec49e4ebb1c7d10a8c350f010648fc7 = (int)getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) $v5ec92172c9f45d96f490290ccbaaf809 = $vbec49e4ebb1c7d10a8c350f010648fc7;}$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "post")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$v5f694956811487225d15e973ca38fbab   = $vb3827f7111095f5ba1a9f49988fe9382->getTypeByHierarchyTypeId($v0715f6d9497f93911417c9c324265771);$v39be0ffe988694a761696118ff876ac0 = $vb3827f7111095f5ba1a9f49988fe9382->getType($v5f694956811487225d15e973ca38fbab);if($v5ec92172c9f45d96f490290ccbaaf809 != false && !($v4640d44b30f3273e05905771772fd9be = $vc20baa4161945565bd89bb659504b1a7->getElement($v5ec92172c9f45d96f490290ccbaaf809))) {throw new publicException(getLabel('error-page-does-not-exist', null, $v5ec92172c9f45d96f490290ccbaaf809));}if($v5ec92172c9f45d96f490290ccbaaf809 != false) {$v8e44f0089b076e18a718eb9ca3d94674        = cmsController::getInstance()->getModule('users')->user_id;$vb2f4dfe176ecb8f5602e258e2df4d790   = $v4640d44b30f3273e05905771772fd9be->getValue('friendlist');$vb2f4dfe176ecb8f5602e258e2df4d790[] = 14;if($vb2f4dfe176ecb8f5602e258e2df4d790 === NULL) {$vb2f4dfe176ecb8f5602e258e2df4d790 = Array();}$v4289cd838e2c5065a6fdadbbec97095e   = permissionsCollection::getInstance()->getUsersByElementPermissions($v5ec92172c9f45d96f490290ccbaaf809, 2);$v4289cd838e2c5065a6fdadbbec97095e[] = $v4640d44b30f3273e05905771772fd9be->getObject()->getOwnerId();$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v5ec92172c9f45d96f490290ccbaaf809);if(!in_array($v8e44f0089b076e18a718eb9ca3d94674, $vb2f4dfe176ecb8f5602e258e2df4d790) && !in_array($v8e44f0089b076e18a718eb9ca3d94674, $v4289cd838e2c5065a6fdadbbec97095e)) {$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterNotEqual($v39be0ffe988694a761696118ff876ac0->getFieldId('only_for_friends'), 1);}}else {$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterNotEqual($v39be0ffe988694a761696118ff876ac0->getFieldId('only_for_friends'), 1);}self::applyTimeRange($v8be74552df93e31bbdd6b36ed74bdb6a, $v39be0ffe988694a761696118ff876ac0);$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($v39be0ffe988694a761696118ff876ac0->getFieldId('publish_time'), false);$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($vaa9f73eea60a006820d0f8768bc8a3fc ? $vaa9f73eea60a006820d0f8768bc8a3fc : $this->posts_per_page, $v71860c77c6745379b0d44304d66b6a13);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e  = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);if(!empty($result)) {$v58adb00b289a0e0e1b51fa7e280b6bbc = array();foreach($result as $v8cdfb8fa2017366f7aded8a2f83835d1) {$v62231d334b7078487e1c894e03b3265f    = $vc20baa4161945565bd89bb659504b1a7->getElement($v8cdfb8fa2017366f7aded8a2f83835d1);if(!$v62231d334b7078487e1c894e03b3265f) continue;if(!$v5ec92172c9f45d96f490290ccbaaf809) {$v4640d44b30f3273e05905771772fd9be = $vc20baa4161945565bd89bb659504b1a7->getElement( $v62231d334b7078487e1c894e03b3265f->getRel() );}$v0ab87ff38431d460cda87557ae31cc82  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v8cdfb8fa2017366f7aded8a2f83835d1, true);$v70f1b7c5e80021c50c8487ef644ce29c  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v4640d44b30f3273e05905771772fd9be->getId(), true);$ve03aaad027a88fc6cd24c8cfdfd8db10 = array();$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:id'] = $v8cdfb8fa2017366f7aded8a2f83835d1;$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:author_id'] = $v62231d334b7078487e1c894e03b3265f->getObject()->getOwnerId();$ve03aaad027a88fc6cd24c8cfdfd8db10['name']   = $v62231d334b7078487e1c894e03b3265f->getName();$ve03aaad027a88fc6cd24c8cfdfd8db10['post_link']    = $v0ab87ff38431d460cda87557ae31cc82;$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_link']    = $v70f1b7c5e80021c50c8487ef644ce29c;$ve03aaad027a88fc6cd24c8cfdfd8db10['bid']     = $v4640d44b30f3273e05905771772fd9be->getId();$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_name']    = $v4640d44b30f3273e05905771772fd9be->getName();$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_title']   = $v4640d44b30f3273e05905771772fd9be->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['title']  = $v62231d334b7078487e1c894e03b3265f->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['cut']   = $this->prepareCut($v62231d334b7078487e1c894e03b3265f->getValue('content'), $v0ab87ff38431d460cda87557ae31cc82, $v66f6181bcb4cff4cd38fbc804a036db6);$ve03aaad027a88fc6cd24c8cfdfd8db10['subnodes:tags'] = $this->prepareTags($v62231d334b7078487e1c894e03b3265f->getValue('tags'));$ve03aaad027a88fc6cd24c8cfdfd8db10['comments_count'] = $vc20baa4161945565bd89bb659504b1a7->getChildsCount($v8cdfb8fa2017366f7aded8a2f83835d1);$ve03aaad027a88fc6cd24c8cfdfd8db10['publish_time']   = ($ve358efa489f58062f10dd7316b65649e = $v62231d334b7078487e1c894e03b3265f->getValue('publish_time')) ? $ve358efa489f58062f10dd7316b65649e->getFormattedDate('U') : '';$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v60bea1419e0d2afc208fd869ba872e68, $ve03aaad027a88fc6cd24c8cfdfd8db10, $v8cdfb8fa2017366f7aded8a2f83835d1);}$v017b0f18009a57a2723c5baf03fe7a95     = array();$v017b0f18009a57a2723c5baf03fe7a95['void:lines'] = $v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v58adb00b289a0e0e1b51fa7e280b6bbc;$v017b0f18009a57a2723c5baf03fe7a95['bid']   = $v5ec92172c9f45d96f490290ccbaaf809;$v017b0f18009a57a2723c5baf03fe7a95['per_page'] = $vaa9f73eea60a006820d0f8768bc8a3fc ? $vaa9f73eea60a006820d0f8768bc8a3fc : $this->posts_per_page;$v017b0f18009a57a2723c5baf03fe7a95['total']    = $vfbb44b4487415b134bce9c790a27fe5e;return self::parseTemplate($vfbd4fece8410679bc4d12bf890485244, $v017b0f18009a57a2723c5baf03fe7a95);}else {return self::parseTemplate($ved43a1f04b8d51c21f16d85ac4c43e30, array('bid'=>$v5ec92172c9f45d96f490290ccbaaf809));}}public function postsByTag($ve4d23e841d8e8804190027bce3180fa5 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default', $vaa9f73eea60a006820d0f8768bc8a3fc = false) {list($vfbd4fece8410679bc4d12bf890485244, $v60bea1419e0d2afc208fd869ba872e68) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'posts_list_block', 'posts_list_line');$v71860c77c6745379b0d44304d66b6a13 = (int)getRequest('p');$v4640d44b30f3273e05905771772fd9be = null;$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();if($ve4d23e841d8e8804190027bce3180fa5 === false) {$ve4d23e841d8e8804190027bce3180fa5 = ($vfa816edb83e95bf0c8da580bdfd491ef = getRequest('param0')) ? $vfa816edb83e95bf0c8da580bdfd491ef : $ve4d23e841d8e8804190027bce3180fa5;}$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "post")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$v5f694956811487225d15e973ca38fbab   = $vb3827f7111095f5ba1a9f49988fe9382->getTypeByHierarchyTypeId($v0715f6d9497f93911417c9c324265771);$v39be0ffe988694a761696118ff876ac0 = $vb3827f7111095f5ba1a9f49988fe9382->getType($v5f694956811487225d15e973ca38fbab);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterNotEqual($v39be0ffe988694a761696118ff876ac0->getFieldId('only_for_friends'), 1);$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($v39be0ffe988694a761696118ff876ac0->getFieldId('tags'), $ve4d23e841d8e8804190027bce3180fa5);$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($v39be0ffe988694a761696118ff876ac0->getFieldId('publish_time'), false);$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($vaa9f73eea60a006820d0f8768bc8a3fc ? $vaa9f73eea60a006820d0f8768bc8a3fc : $this->posts_per_page, $v71860c77c6745379b0d44304d66b6a13);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e  = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v58adb00b289a0e0e1b51fa7e280b6bbc = array();foreach($result as $v8cdfb8fa2017366f7aded8a2f83835d1) {$v62231d334b7078487e1c894e03b3265f    = $vc20baa4161945565bd89bb659504b1a7->getElement($v8cdfb8fa2017366f7aded8a2f83835d1);if(!$v62231d334b7078487e1c894e03b3265f) continue;$v4640d44b30f3273e05905771772fd9be = $vc20baa4161945565bd89bb659504b1a7->getElement( $v62231d334b7078487e1c894e03b3265f->getRel() );$v0ab87ff38431d460cda87557ae31cc82  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v8cdfb8fa2017366f7aded8a2f83835d1, true);$v70f1b7c5e80021c50c8487ef644ce29c  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v4640d44b30f3273e05905771772fd9be->getId(), true);$ve03aaad027a88fc6cd24c8cfdfd8db10 = array();$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:id'] = $v8cdfb8fa2017366f7aded8a2f83835d1;$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:author_id'] = $v62231d334b7078487e1c894e03b3265f->getObject()->getOwnerId();$ve03aaad027a88fc6cd24c8cfdfd8db10['name']   = $v62231d334b7078487e1c894e03b3265f->getName();$ve03aaad027a88fc6cd24c8cfdfd8db10['post_link']    = $v0ab87ff38431d460cda87557ae31cc82;$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_link']    = $v70f1b7c5e80021c50c8487ef644ce29c;$ve03aaad027a88fc6cd24c8cfdfd8db10['bid']     = $v4640d44b30f3273e05905771772fd9be->getId();$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_title']   = $v4640d44b30f3273e05905771772fd9be->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_name']    = $v4640d44b30f3273e05905771772fd9be->getName();$ve03aaad027a88fc6cd24c8cfdfd8db10['title']  = $v62231d334b7078487e1c894e03b3265f->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['cut']   = $this->prepareCut($v62231d334b7078487e1c894e03b3265f->getValue('content'), $v0ab87ff38431d460cda87557ae31cc82, $v66f6181bcb4cff4cd38fbc804a036db6);$ve03aaad027a88fc6cd24c8cfdfd8db10['subnodes:tags'] = $this->prepareTags($v62231d334b7078487e1c894e03b3265f->getValue('tags'));$ve03aaad027a88fc6cd24c8cfdfd8db10['comments_count'] = $vc20baa4161945565bd89bb659504b1a7->getChildsCount($v8cdfb8fa2017366f7aded8a2f83835d1);$ve03aaad027a88fc6cd24c8cfdfd8db10['publish_time']   = ($v8277e0910d750195b448797616e091ad = $v62231d334b7078487e1c894e03b3265f->getValue('publish_time')) ? $v8277e0910d750195b448797616e091ad->getFormattedDate('U') : "";$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v60bea1419e0d2afc208fd869ba872e68, $ve03aaad027a88fc6cd24c8cfdfd8db10, $v8cdfb8fa2017366f7aded8a2f83835d1);}$v017b0f18009a57a2723c5baf03fe7a95     = array();$v017b0f18009a57a2723c5baf03fe7a95['void:lines'] = $v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v58adb00b289a0e0e1b51fa7e280b6bbc;$v017b0f18009a57a2723c5baf03fe7a95['per_page'] = $vaa9f73eea60a006820d0f8768bc8a3fc ? $vaa9f73eea60a006820d0f8768bc8a3fc : $this->posts_per_page;$v017b0f18009a57a2723c5baf03fe7a95['total']    = $vfbb44b4487415b134bce9c790a27fe5e;return self::parseTemplate($vfbd4fece8410679bc4d12bf890485244, $v017b0f18009a57a2723c5baf03fe7a95);}public function draughtsList($v5ec92172c9f45d96f490290ccbaaf809 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default', $vaa9f73eea60a006820d0f8768bc8a3fc = false) {list($vfbd4fece8410679bc4d12bf890485244, $v60bea1419e0d2afc208fd869ba872e68) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'posts_list_block', 'posts_list_line');$v71860c77c6745379b0d44304d66b6a13 = (int)getRequest('p');$v4640d44b30f3273e05905771772fd9be = null;$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();if($v5ec92172c9f45d96f490290ccbaaf809 === false) {$vbec49e4ebb1c7d10a8c350f010648fc7 = getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) $v5ec92172c9f45d96f490290ccbaaf809 = $vbec49e4ebb1c7d10a8c350f010648fc7;}$v6942e8fa62b3cc9d93881a58210e2fd7     = umiHierarchyTypesCollection::getInstance();$v9d8f64d5c26a02b05dc020e2eb7bfa91 = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName("blogs20", "blog")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v0715f6d9497f93911417c9c324265771 = $v6942e8fa62b3cc9d93881a58210e2fd7->getTypeByName("blogs20", "post")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$v5f694956811487225d15e973ca38fbab   = $vb3827f7111095f5ba1a9f49988fe9382->getTypeByHierarchyTypeId($v0715f6d9497f93911417c9c324265771);$v39be0ffe988694a761696118ff876ac0 = $vb3827f7111095f5ba1a9f49988fe9382->getType($v5f694956811487225d15e973ca38fbab);$v8e44f0089b076e18a718eb9ca3d94674 = cmsController::getInstance()->getModule('users')->user_id;$v8be74552df93e31bbdd6b36ed74bdb6a->addOwnerFilter(array($v8e44f0089b076e18a718eb9ca3d94674));if($v5ec92172c9f45d96f490290ccbaaf809 !== false) {$v4640d44b30f3273e05905771772fd9be = $vc20baa4161945565bd89bb659504b1a7->getElement( $v5ec92172c9f45d96f490290ccbaaf809 );if($v4640d44b30f3273e05905771772fd9be && $v4640d44b30f3273e05905771772fd9be->getHierarchyType() == $v9d8f64d5c26a02b05dc020e2eb7bfa91) {$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($v5ec92172c9f45d96f490290ccbaaf809);}}$v8be74552df93e31bbdd6b36ed74bdb6a->addActiveFilter(false);$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByProperty($v39be0ffe988694a761696118ff876ac0->getFieldId('publish_time'), false);$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($vaa9f73eea60a006820d0f8768bc8a3fc ? $vaa9f73eea60a006820d0f8768bc8a3fc : $this->posts_per_page, $v71860c77c6745379b0d44304d66b6a13);self::applyTimeRange($v8be74552df93e31bbdd6b36ed74bdb6a, $v39be0ffe988694a761696118ff876ac0);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e  = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v58adb00b289a0e0e1b51fa7e280b6bbc = array();foreach($result as $v8cdfb8fa2017366f7aded8a2f83835d1) {$v62231d334b7078487e1c894e03b3265f    = $vc20baa4161945565bd89bb659504b1a7->getElement($v8cdfb8fa2017366f7aded8a2f83835d1);if(!$v62231d334b7078487e1c894e03b3265f) continue;if(!$v4640d44b30f3273e05905771772fd9be) {$v4640d44b30f3273e05905771772fd9be = $vc20baa4161945565bd89bb659504b1a7->getElement( $v62231d334b7078487e1c894e03b3265f->getRel() );}if(!$v4640d44b30f3273e05905771772fd9be) continue;$v0ab87ff38431d460cda87557ae31cc82  = '/blogs20/postView/'.$v8cdfb8fa2017366f7aded8a2f83835d1.'/';$v70f1b7c5e80021c50c8487ef644ce29c  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v4640d44b30f3273e05905771772fd9be->getId(), true);$ve03aaad027a88fc6cd24c8cfdfd8db10 = array();$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:id'] = $v8cdfb8fa2017366f7aded8a2f83835d1;$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:author_id'] = $v62231d334b7078487e1c894e03b3265f->getObject()->getOwnerId();$ve03aaad027a88fc6cd24c8cfdfd8db10['node:name']    = $v62231d334b7078487e1c894e03b3265f->getName();$ve03aaad027a88fc6cd24c8cfdfd8db10['post_link']    = $v0ab87ff38431d460cda87557ae31cc82;$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_link']    = $v70f1b7c5e80021c50c8487ef644ce29c;$ve03aaad027a88fc6cd24c8cfdfd8db10['bid']     = $v4640d44b30f3273e05905771772fd9be->getId();$ve03aaad027a88fc6cd24c8cfdfd8db10['blog_title']   = $v4640d44b30f3273e05905771772fd9be->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['title']  = $v62231d334b7078487e1c894e03b3265f->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['content']  = $v62231d334b7078487e1c894e03b3265f->getValue('content');$ve03aaad027a88fc6cd24c8cfdfd8db10['cut']   = $this->prepareCut($ve03aaad027a88fc6cd24c8cfdfd8db10['content'], $v0ab87ff38431d460cda87557ae31cc82, $v66f6181bcb4cff4cd38fbc804a036db6);$ve03aaad027a88fc6cd24c8cfdfd8db10['subnodes:tags']   = $this->prepareTags($v62231d334b7078487e1c894e03b3265f->getValue('tags'));$ve03aaad027a88fc6cd24c8cfdfd8db10['comments_count'] = $vc20baa4161945565bd89bb659504b1a7->getChildsCount($v8cdfb8fa2017366f7aded8a2f83835d1);$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v60bea1419e0d2afc208fd869ba872e68, $ve03aaad027a88fc6cd24c8cfdfd8db10, $v8cdfb8fa2017366f7aded8a2f83835d1);}$v017b0f18009a57a2723c5baf03fe7a95     = array();$v017b0f18009a57a2723c5baf03fe7a95['void:lines'] = $v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v58adb00b289a0e0e1b51fa7e280b6bbc;$v017b0f18009a57a2723c5baf03fe7a95['bid']   = $v5ec92172c9f45d96f490290ccbaaf809;$v017b0f18009a57a2723c5baf03fe7a95['per_page'] = $vaa9f73eea60a006820d0f8768bc8a3fc ? $vaa9f73eea60a006820d0f8768bc8a3fc : $this->posts_per_page;$v017b0f18009a57a2723c5baf03fe7a95['total']    = $vfbb44b4487415b134bce9c790a27fe5e;return self::parseTemplate($vfbd4fece8410679bc4d12bf890485244, $v017b0f18009a57a2723c5baf03fe7a95);}public function commentsList($v73f10df5e289faaff50345b514062c0e = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {list($vfbd4fece8410679bc4d12bf890485244, $v60bea1419e0d2afc208fd869ba872e68) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'comments_list_block', 'comments_list_line');$vc20baa4161945565bd89bb659504b1a7      = umiHierarchy::getInstance();$v5bd1ab9a21af6fccf30a049bb7baa40f = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "comment")->getId();$vfbb44b4487415b134bce9c790a27fe5e       = 0;$v58adb00b289a0e0e1b51fa7e280b6bbc   = $this->placeComments($v73f10df5e289faaff50345b514062c0e, $v60bea1419e0d2afc208fd869ba872e68, $vc20baa4161945565bd89bb659504b1a7, $v5bd1ab9a21af6fccf30a049bb7baa40f, $vfbb44b4487415b134bce9c790a27fe5e);$v017b0f18009a57a2723c5baf03fe7a95 = array();$v017b0f18009a57a2723c5baf03fe7a95['subnodes:items'] = $v017b0f18009a57a2723c5baf03fe7a95['void:lines'] = $v58adb00b289a0e0e1b51fa7e280b6bbc;$v017b0f18009a57a2723c5baf03fe7a95['per_page'] = $this->comments_per_page;$v017b0f18009a57a2723c5baf03fe7a95['total']    = $vfbb44b4487415b134bce9c790a27fe5e;return self::parseTemplate($vfbd4fece8410679bc4d12bf890485244, $v017b0f18009a57a2723c5baf03fe7a95);}public function postView($v73f10df5e289faaff50345b514062c0e = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {$v8e44f0089b076e18a718eb9ca3d94674 = cmsController::getInstance()->getModule('users')->user_id;if(!$v73f10df5e289faaff50345b514062c0e) {$v73f10df5e289faaff50345b514062c0e = ($vfa816edb83e95bf0c8da580bdfd491ef = getRequest('param0')) ? $vfa816edb83e95bf0c8da580bdfd491ef : $v73f10df5e289faaff50345b514062c0e;}if($v73f10df5e289faaff50345b514062c0e === false) {$this->redirect(getServer('HTTP_REFERER'));}list($v39f17319be96f2b5889115ba057e5c2a) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'post_view');$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();$v62231d334b7078487e1c894e03b3265f      = $vc20baa4161945565bd89bb659504b1a7->getElement($v73f10df5e289faaff50345b514062c0e);if(!$v62231d334b7078487e1c894e03b3265f ||     $v62231d334b7078487e1c894e03b3265f->getTypeId() != umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "post")->getId() ) {throw new publicException("The id(#{$v73f10df5e289faaff50345b514062c0e}) given is not an id of the blog's post");}if(!$v62231d334b7078487e1c894e03b3265f->getIsActive() && $v62231d334b7078487e1c894e03b3265f->getObject()->getOwnerId() != $v8e44f0089b076e18a718eb9ca3d94674) {$this->redirect('/blogs20/draughtsList/');}$v4640d44b30f3273e05905771772fd9be  = $vc20baa4161945565bd89bb659504b1a7->getElement($v62231d334b7078487e1c894e03b3265f->getRel());$v0ab87ff38431d460cda87557ae31cc82  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v73f10df5e289faaff50345b514062c0e, true);$v70f1b7c5e80021c50c8487ef644ce29c  = $vc20baa4161945565bd89bb659504b1a7->getPathById($v4640d44b30f3273e05905771772fd9be->getId(), true);$vbc56a26be3caac24e508bf4003a5eb4d    = array();$vbc56a26be3caac24e508bf4003a5eb4d['name']    = $v62231d334b7078487e1c894e03b3265f->getName();$vbc56a26be3caac24e508bf4003a5eb4d['content']    = $this->prepareContent( $v62231d334b7078487e1c894e03b3265f->getValue('content') );$vbc56a26be3caac24e508bf4003a5eb4d['pid']        = $v73f10df5e289faaff50345b514062c0e;$vbc56a26be3caac24e508bf4003a5eb4d['bid']        = $v4640d44b30f3273e05905771772fd9be->getId();$vbc56a26be3caac24e508bf4003a5eb4d['blog_title'] = $v4640d44b30f3273e05905771772fd9be->getValue('title');$vbc56a26be3caac24e508bf4003a5eb4d['blog_name']  = $v4640d44b30f3273e05905771772fd9be->getName();$vbc56a26be3caac24e508bf4003a5eb4d['post_link']  = $v0ab87ff38431d460cda87557ae31cc82;$vbc56a26be3caac24e508bf4003a5eb4d['blog_link']  = $v70f1b7c5e80021c50c8487ef644ce29c;$vbc56a26be3caac24e508bf4003a5eb4d['author_id']  = $v62231d334b7078487e1c894e03b3265f->getObject()->getOwnerId();return self::parseTemplate($v39f17319be96f2b5889115ba057e5c2a, $vbc56a26be3caac24e508bf4003a5eb4d, $v73f10df5e289faaff50345b514062c0e);}public function postEdit($v73f10df5e289faaff50345b514062c0e = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {if(!$v73f10df5e289faaff50345b514062c0e) {$vbec49e4ebb1c7d10a8c350f010648fc7 = getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) {$v73f10df5e289faaff50345b514062c0e = $vbec49e4ebb1c7d10a8c350f010648fc7;}else {$this->redirect(getServer('HTTP_REFERER'));}}$v62231d334b7078487e1c894e03b3265f = null;$vc20baa4161945565bd89bb659504b1a7   = umiHierarchy::getInstance();$v62231d334b7078487e1c894e03b3265f        = $vc20baa4161945565bd89bb659504b1a7->getElement($v73f10df5e289faaff50345b514062c0e);if(!$v62231d334b7078487e1c894e03b3265f ||       $v62231d334b7078487e1c894e03b3265f->getTypeId() != umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "post")->getId()) {throw new publicException("The id(#{$v73f10df5e289faaff50345b514062c0e}) given is not an id of the blog's post");}if(getRequest('param1') == 'do') {$vb790175058e05911758cdaedd66fe5d9   = getRequest('title');$vb01a74494194b212fcf94b6a6364e046 = htmlspecialchars(trim(getRequest('content')));if(strlen($vb790175058e05911758cdaedd66fe5d9) && strlen($vb01a74494194b212fcf94b6a6364e046)) {$v112781f2698d89ed552540a9b9f8e03a = getRequest('visible_for_friends') ? 1 : 0;$v5814e9bc61bd359339584899677c519e   = getRequest('draught') ? false : true;$v65518e182c68d30a5735f31f2763d2d1     = getRequest('tags');$ve779466dcd8083dab2ca071f4fb28e67      = getRequest('bid');if($ve779466dcd8083dab2ca071f4fb28e67 && $ve779466dcd8083dab2ca071f4fb28e67 != $v62231d334b7078487e1c894e03b3265f->getRel()) {$vc20baa4161945565bd89bb659504b1a7->moveBefore($v73f10df5e289faaff50345b514062c0e, $ve779466dcd8083dab2ca071f4fb28e67);}$v62231d334b7078487e1c894e03b3265f->setIsActive($v5814e9bc61bd359339584899677c519e);$v62231d334b7078487e1c894e03b3265f->setValue('title', $vb790175058e05911758cdaedd66fe5d9);$v62231d334b7078487e1c894e03b3265f->setValue('content', $vb01a74494194b212fcf94b6a6364e046);$v62231d334b7078487e1c894e03b3265f->setValue('tags', $v65518e182c68d30a5735f31f2763d2d1);$v62231d334b7078487e1c894e03b3265f->setValue('only_for_friends', $v112781f2698d89ed552540a9b9f8e03a);$v5e05ed1276b7193cf090cf9719a13e0f = getRequest('redirect');if(strlen($v5e05ed1276b7193cf090cf9719a13e0f)) $this->redirect($v5e05ed1276b7193cf090cf9719a13e0f);$this->redirect($vc20baa4161945565bd89bb659504b1a7->getPathById($v73f10df5e289faaff50345b514062c0e));return null;}else {}}if(!$v62231d334b7078487e1c894e03b3265f) {$v62231d334b7078487e1c894e03b3265f = umiHierarchy::getInstance()->getElement($v73f10df5e289faaff50345b514062c0e);}list($vd08226ef928902c551b91071320fccf8) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'post_edit_form');$vbc56a26be3caac24e508bf4003a5eb4d = array('action'    => '/blogs20/postEdit/'.$v73f10df5e289faaff50345b514062c0e.'/do/',       'id'    => $v73f10df5e289faaff50345b514062c0e,       'blog_select'  => $this->prepareBlogSelect($v62231d334b7078487e1c894e03b3265f->getRel(), true, $v66f6181bcb4cff4cd38fbc804a036db6),       'visible_for_friends' => (($v62231d334b7078487e1c894e03b3265f->getValue('only_for_friends'))? 'checked="checked"' : '' ) );return self::parseTemplate($vd08226ef928902c551b91071320fccf8, $vbc56a26be3caac24e508bf4003a5eb4d, $v73f10df5e289faaff50345b514062c0e);}public function postAdd($v5ec92172c9f45d96f490290ccbaaf809 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {if($v5ec92172c9f45d96f490290ccbaaf809 === false) {$vbec49e4ebb1c7d10a8c350f010648fc7 = getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) $v5ec92172c9f45d96f490290ccbaaf809 = $vbec49e4ebb1c7d10a8c350f010648fc7;else      $v5ec92172c9f45d96f490290ccbaaf809 = getRequest('bid');}$v5ec92172c9f45d96f490290ccbaaf809 = intval($v5ec92172c9f45d96f490290ccbaaf809);if($v2285c8dbaad09008016f9b367370fb67 = cmsController::getInstance()->getModule('users')) {list($va427375652d89d7fc3053c5429b87df9, $v8aec865075433c9da0a7ee1cf81a9e38) = permissionsCollection::getInstance()->isAllowedObject($v2285c8dbaad09008016f9b367370fb67->user_id, $v5ec92172c9f45d96f490290ccbaaf809);if(!$v2285c8dbaad09008016f9b367370fb67->is_auth() || (!$v8aec865075433c9da0a7ee1cf81a9e38 && $v5ec92172c9f45d96f490290ccbaaf809)) {return false;}}else {return false;}$vb790175058e05911758cdaedd66fe5d9   = getRequest('title');$vb01a74494194b212fcf94b6a6364e046 = htmlspecialchars(trim(getRequest('content')));if(strlen($vb790175058e05911758cdaedd66fe5d9) && strlen($vb01a74494194b212fcf94b6a6364e046) && $v5ec92172c9f45d96f490290ccbaaf809) {if (!umiCaptcha::checkCaptcha()) {$this->errorNewMessage("%errors_wrong_captcha%");$this->errorPanic();}if(!($v126ac9f6149081eb0e97c2e939eaad52 = umiHierarchy::getInstance()->getElement($v5ec92172c9f45d96f490290ccbaaf809)) ||    ($v126ac9f6149081eb0e97c2e939eaad52->getTypeId() != umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "blog")->getId()) ) {$this->errorNewMessage('%error_wrong_parent%');$this->errorPanic();}$v112781f2698d89ed552540a9b9f8e03a = getRequest('visible_for_friends') ? 1 : 0;$v5814e9bc61bd359339584899677c519e   = getRequest('draught') ? false : true;$v65518e182c68d30a5735f31f2763d2d1     = getRequest('tags');$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "post")->getId();$v8cdfb8fa2017366f7aded8a2f83835d1 = $vc20baa4161945565bd89bb659504b1a7->addElement($v5ec92172c9f45d96f490290ccbaaf809, $v0715f6d9497f93911417c9c324265771, $vb790175058e05911758cdaedd66fe5d9, $vb790175058e05911758cdaedd66fe5d9);permissionsCollection::getInstance()->setDefaultPermissions($v8cdfb8fa2017366f7aded8a2f83835d1);$v62231d334b7078487e1c894e03b3265f   = $vc20baa4161945565bd89bb659504b1a7->getElement($v8cdfb8fa2017366f7aded8a2f83835d1, true);$v62231d334b7078487e1c894e03b3265f->setIsActive($v5814e9bc61bd359339584899677c519e);$v62231d334b7078487e1c894e03b3265f->setValue('title', $vb790175058e05911758cdaedd66fe5d9);$v62231d334b7078487e1c894e03b3265f->setValue('content', $vb01a74494194b212fcf94b6a6364e046);$v62231d334b7078487e1c894e03b3265f->setValue('tags', $v65518e182c68d30a5735f31f2763d2d1);$v62231d334b7078487e1c894e03b3265f->setValue('publish_time', new umiDate());$v62231d334b7078487e1c894e03b3265f->setValue('only_for_friends', $v112781f2698d89ed552540a9b9f8e03a);$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("blogs20PostAdded");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("after");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("id", $v8cdfb8fa2017366f7aded8a2f83835d1);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam('template', $v66f6181bcb4cff4cd38fbc804a036db6);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$v5e05ed1276b7193cf090cf9719a13e0f = getServer('HTTP_REFERER');if(strlen($v5e05ed1276b7193cf090cf9719a13e0f)) $this->redirect(str_replace("_err=","",$v5e05ed1276b7193cf090cf9719a13e0f));return null;}else {if($v5ec92172c9f45d96f490290ccbaaf809 && !strlen($vb790175058e05911758cdaedd66fe5d9) && strlen($vb01a74494194b212fcf94b6a6364e046)) {$this->errorNewMessage('Не заполнен заголовок');}else if($v5ec92172c9f45d96f490290ccbaaf809 && strlen($vb790175058e05911758cdaedd66fe5d9) && !strlen($vb01a74494194b212fcf94b6a6364e046)) {$this->errorNewMessage('Не заполнен текст публикации');}}list($vd08226ef928902c551b91071320fccf8) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'post_add_form');$vbc56a26be3caac24e508bf4003a5eb4d = array('action'  => '/blogs20/postAdd/'.$v5ec92172c9f45d96f490290ccbaaf809.'/',       'id'    => 'new',       'title'   => '',       'content' => '',       'tags'    => '',       'visible_for_friends' => '',       'blog_select' => $this->prepareBlogSelect($v5ec92172c9f45d96f490290ccbaaf809, false, $v66f6181bcb4cff4cd38fbc804a036db6)       );return self::parseTemplate($vd08226ef928902c551b91071320fccf8, $vbc56a26be3caac24e508bf4003a5eb4d);}public function commentAdd($v73f10df5e289faaff50345b514062c0e = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {if(!$v4cdc889a6fa8983cb13088748fdd5dd7 = cmsController::getInstance()->getModule("users")) {throw new publicException("Can't find users module");}if(!($v4cdc889a6fa8983cb13088748fdd5dd7->is_auth() || regedit::getInstance()->getVal("//modules/blogs20/allow_guest_comments"))) return;if($v73f10df5e289faaff50345b514062c0e === false) {$vbec49e4ebb1c7d10a8c350f010648fc7 = getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) $v73f10df5e289faaff50345b514062c0e = $vbec49e4ebb1c7d10a8c350f010648fc7;else      $v73f10df5e289faaff50345b514062c0e = cmsController::getInstance()->getCurrentElementId();}$vc20baa4161945565bd89bb659504b1a7     = umiHierarchy::getInstance();$vb9b79a450b5b8cae69e5443f295dc5ef = umiHierarchyTypesCollection::getInstance();if(!($v62231d334b7078487e1c894e03b3265f = $vc20baa4161945565bd89bb659504b1a7->getElement($v73f10df5e289faaff50345b514062c0e))) {throw new publicException(getLabel('error-page-does-not-exist', null, $v73f10df5e289faaff50345b514062c0e));}if($v62231d334b7078487e1c894e03b3265f->getTypeId() != $vb9b79a450b5b8cae69e5443f295dc5ef->getTypeByName("blogs20", "post")->getId() &&     $v62231d334b7078487e1c894e03b3265f->getTypeId() != $vb9b79a450b5b8cae69e5443f295dc5ef->getTypeByName("blogs20", "comment")->getId()) {throw new publicException("The id(#{$v73f10df5e289faaff50345b514062c0e}) given is not an id of the blog's post");}$vb790175058e05911758cdaedd66fe5d9   = ($vfa816edb83e95bf0c8da580bdfd491ef = getRequest('title')) ? $vfa816edb83e95bf0c8da580bdfd491ef : 'Re: '.$v62231d334b7078487e1c894e03b3265f->getName();$vb01a74494194b212fcf94b6a6364e046 = htmlspecialchars(trim(getRequest('content')));if(strlen($vb01a74494194b212fcf94b6a6364e046) && $v73f10df5e289faaff50345b514062c0e !== false) {if (!umiCaptcha::checkCaptcha()) {$this->errorNewMessage("%errors_wrong_captcha%");$this->errorPanic();}$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "comment")->getId();$v9e79e55e3cc06018291bf381876d159c = $vc20baa4161945565bd89bb659504b1a7->addElement($v73f10df5e289faaff50345b514062c0e, $v0715f6d9497f93911417c9c324265771, $vb790175058e05911758cdaedd66fe5d9, $vb790175058e05911758cdaedd66fe5d9);permissionsCollection::getInstance()->setDefaultPermissions($v9e79e55e3cc06018291bf381876d159c);if($v4cdc889a6fa8983cb13088748fdd5dd7->is_auth()) {$v8e44f0089b076e18a718eb9ca3d94674   = $v4cdc889a6fa8983cb13088748fdd5dd7->user_id;$ve0d61127bd180c59c3c5a9565ade8a7e = $v4cdc889a6fa8983cb13088748fdd5dd7->createAuthorUser($v8e44f0089b076e18a718eb9ca3d94674);}else {$ve2e42a07550863f8b67f5eb252581f6d  = getRequest('nick');$v0c83f57c786a0b4a39efab23731c7ebc = getRequest('email');$v957b527bcfbad2e80f58d20683931435    = getServer('REMOTE_ADDR');$ve0d61127bd180c59c3c5a9565ade8a7e = $v4cdc889a6fa8983cb13088748fdd5dd7->createAuthorGuest($ve2e42a07550863f8b67f5eb252581f6d, $v0c83f57c786a0b4a39efab23731c7ebc, $v957b527bcfbad2e80f58d20683931435);}$v9894ce3abcd8c0c55d700cce56b565ca = $vc20baa4161945565bd89bb659504b1a7->getElement($v9e79e55e3cc06018291bf381876d159c, true);$v9894ce3abcd8c0c55d700cce56b565ca->setIsActive();$v9894ce3abcd8c0c55d700cce56b565ca->setValue('title',        $vb790175058e05911758cdaedd66fe5d9);$v9894ce3abcd8c0c55d700cce56b565ca->setValue('content',      $vb01a74494194b212fcf94b6a6364e046);$v9894ce3abcd8c0c55d700cce56b565ca->setValue('author_id',    $ve0d61127bd180c59c3c5a9565ade8a7e);$v9894ce3abcd8c0c55d700cce56b565ca->setValue('publish_time', new umiDate());$v9894ce3abcd8c0c55d700cce56b565ca->commit();$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("blogs20CommentAdded");$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("after");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("id", $v9e79e55e3cc06018291bf381876d159c);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam('template', $v66f6181bcb4cff4cd38fbc804a036db6);$this->setEventPoint($v161c9aaa4fe035e7b2f465bc59f3ab45);$v5e05ed1276b7193cf090cf9719a13e0f = getServer('HTTP_REFERER');if(strlen($v5e05ed1276b7193cf090cf9719a13e0f)) $this->redirect($v5e05ed1276b7193cf090cf9719a13e0f.'#comment_'.$v9e79e55e3cc06018291bf381876d159c);return null;}else {}$va35841ac08e68f3d24cdb3414c411a1b = $v4cdc889a6fa8983cb13088748fdd5dd7->is_auth() ? 'comment_add_form' : 'comment_add_form_guest';list($vd08226ef928902c551b91071320fccf8) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', $va35841ac08e68f3d24cdb3414c411a1b);return self::parseTemplate($vd08226ef928902c551b91071320fccf8, array('parent_id' => $v73f10df5e289faaff50345b514062c0e) );}public function itemDelete($v7552cd149af7495ee7d8225974e50f80 = false) {if($v7552cd149af7495ee7d8225974e50f80 === false) {$v7552cd149af7495ee7d8225974e50f80 = getRequest('param0');}if($v7552cd149af7495ee7d8225974e50f80) {try {umiHierarchy::getInstance()->delElement($v7552cd149af7495ee7d8225974e50f80);}catch(Exception $ve1671797c52e15f763380b45e841ec32) {}}$vf397b9d300233925e757b1e59d70c46c = getRequest('redirect');if($vf397b9d300233925e757b1e59d70c46c != null) {$this->redirect($vf397b9d300233925e757b1e59d70c46c);}else {$v1a6e5b63f2eb2d252ebf9d40d7118b8d  = getServer('HTTP_REFERER');$this->redirect($v1a6e5b63f2eb2d252ebf9d40d7118b8d);}}public function editUserBlogs($v5ec92172c9f45d96f490290ccbaaf809 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {if($v5ec92172c9f45d96f490290ccbaaf809 === false) {$vbec49e4ebb1c7d10a8c350f010648fc7 = getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) $v5ec92172c9f45d96f490290ccbaaf809 = $vbec49e4ebb1c7d10a8c350f010648fc7;}$vb1444fb0c07653567ad325aa25d4e37a    = regedit::getInstance();$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "blog")->getId();$v2285c8dbaad09008016f9b367370fb67 = cmsController::getInstance()->getModule('users');if(intval($v5ec92172c9f45d96f490290ccbaaf809)>0 || $v5ec92172c9f45d96f490290ccbaaf809 == 'new') {$v738bc845fd0f74ce74c075ddca009cee = getRequest('blog');$v738bc845fd0f74ce74c075ddca009cee = $v738bc845fd0f74ce74c075ddca009cee[$v5ec92172c9f45d96f490290ccbaaf809];if($v738bc845fd0f74ce74c075ddca009cee && isset($v738bc845fd0f74ce74c075ddca009cee['title']) && strlen($v738bc845fd0f74ce74c075ddca009cee['title'])) {$vd5d3db1765287eef77d7927cc956f50a       = $v738bc845fd0f74ce74c075ddca009cee['title'];$v67daf92c833c41c95db874e18fcb2786 = isset($v738bc845fd0f74ce74c075ddca009cee['description']) ? $v738bc845fd0f74ce74c075ddca009cee['description'] : '';$v220bc1b7fbe323dcd9b9de209810b64e  = isset($v738bc845fd0f74ce74c075ddca009cee['friendlist'])  ? array_map('intval', $v738bc845fd0f74ce74c075ddca009cee['friendlist']) : array();if($v5ec92172c9f45d96f490290ccbaaf809 == 'new') {$vd6fe1d0be6347b8ef2427fa629c04485     = $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/blogs20/autocreate_path");$vbfa030fe63bacd523dd70a76cfaed98a = intval($vc20baa4161945565bd89bb659504b1a7->getIdByPath($vd6fe1d0be6347b8ef2427fa629c04485));$v5ec92172c9f45d96f490290ccbaaf809   = $vc20baa4161945565bd89bb659504b1a7->addElement($vbfa030fe63bacd523dd70a76cfaed98a, $v0715f6d9497f93911417c9c324265771, $vd5d3db1765287eef77d7927cc956f50a, $vd5d3db1765287eef77d7927cc956f50a);permissionsCollection::getInstance()->setDefaultPermissions($v5ec92172c9f45d96f490290ccbaaf809);$vee11cbb19052e40b07aac0ca060c23ee     = umiObjectsCollection::getInstance()->getObject( $v2285c8dbaad09008016f9b367370fb67->user_id );$v1471e4e05a4db95d353cc867fe317314   = $vee11cbb19052e40b07aac0ca060c23ee->getValue('groups');$va57e8cf45285cb352f43819c5125de20 = permissionsCollection::getInstance();foreach($v1471e4e05a4db95d353cc867fe317314 as $vb80bb7740288fda1f201890375a60c8f) {$va57e8cf45285cb352f43819c5125de20->setElementPermissions($vb80bb7740288fda1f201890375a60c8f, $v5ec92172c9f45d96f490290ccbaaf809, 1);}$va57e8cf45285cb352f43819c5125de20->setElementPermissions($v2285c8dbaad09008016f9b367370fb67->user_id, $v5ec92172c9f45d96f490290ccbaaf809, 2);}if($v4640d44b30f3273e05905771772fd9be = $vc20baa4161945565bd89bb659504b1a7->getElement($v5ec92172c9f45d96f490290ccbaaf809)) {$v4640d44b30f3273e05905771772fd9be->setIsActive();$v4640d44b30f3273e05905771772fd9be->setValue('title', $vd5d3db1765287eef77d7927cc956f50a);$v4640d44b30f3273e05905771772fd9be->setValue('description', $v67daf92c833c41c95db874e18fcb2786);$v4640d44b30f3273e05905771772fd9be->setValue('friendlist', $v220bc1b7fbe323dcd9b9de209810b64e);$v4640d44b30f3273e05905771772fd9be->commit();}$v59056bb4c6c9c887579a6d2e62954c2c = getRequest('redirect');if($v59056bb4c6c9c887579a6d2e62954c2c) $this->redirect($v59056bb4c6c9c887579a6d2e62954c2c);}else {}if($v5ec92172c9f45d96f490290ccbaaf809 != 'new') $result = array($v5ec92172c9f45d96f490290ccbaaf809);else                 $result = array();}else {$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$v8be74552df93e31bbdd6b36ed74bdb6a->setOrderByName(true);$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsLevel(2);$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);}list($v18d8c52f684306e4ff9724366854e88c, $v867bc014e617d40529613ca365475165, $vfc0a66956f790f0422313cb261ee9314) =    self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'blod_edit_block', 'blog_edit_line', 'blog_new_line');$vc56c4b05ed55494b480fe745c3c24542 = umiObjectsCollection::getInstance();$v71531c96af40bfbcff591223b978c34d  = umiObjectTypesCollection::getInstance()->getBaseType('users', 'user');$vea889e053e4f623040312d22f0361b2b    = $vc56c4b05ed55494b480fe745c3c24542->getGuidedItems($v71531c96af40bfbcff591223b978c34d);$v58adb00b289a0e0e1b51fa7e280b6bbc = array();$v5a096886f4b018d9c93608fb21983ee0 = 0;foreach($result as $v5ec92172c9f45d96f490290ccbaaf809) {$v4640d44b30f3273e05905771772fd9be    = $vc20baa4161945565bd89bb659504b1a7->getElement($v5ec92172c9f45d96f490290ccbaaf809);if(!$v4640d44b30f3273e05905771772fd9be) continue;$ve03aaad027a88fc6cd24c8cfdfd8db10 = array();$ve03aaad027a88fc6cd24c8cfdfd8db10['bid']       = $v5ec92172c9f45d96f490290ccbaaf809;$ve03aaad027a88fc6cd24c8cfdfd8db10['title']       = $v4640d44b30f3273e05905771772fd9be->getValue('title');$ve03aaad027a88fc6cd24c8cfdfd8db10['description'] = $v4640d44b30f3273e05905771772fd9be->getValue('description');$ve03aaad027a88fc6cd24c8cfdfd8db10['path']     = $vc20baa4161945565bd89bb659504b1a7->getPathById($v5ec92172c9f45d96f490290ccbaaf809);$vb2f4dfe176ecb8f5602e258e2df4d790 = $v4640d44b30f3273e05905771772fd9be->getValue('friendlist');$v40be9a1ee7b37ea0c5c5736e54034b6c    = '';foreach($vea889e053e4f623040312d22f0361b2b as $v8e44f0089b076e18a718eb9ca3d94674 => $v435e0648d634175c46bd40ac366545a8) {$v40be9a1ee7b37ea0c5c5736e54034b6c .= '<option value="'.$v8e44f0089b076e18a718eb9ca3d94674.'" '.( in_array($v8e44f0089b076e18a718eb9ca3d94674, $vb2f4dfe176ecb8f5602e258e2df4d790) ? 'selected' : '' ). '>' . $v435e0648d634175c46bd40ac366545a8 . '</option>';}$ve03aaad027a88fc6cd24c8cfdfd8db10['friends'] = $v40be9a1ee7b37ea0c5c5736e54034b6c;$ve03aaad027a88fc6cd24c8cfdfd8db10['current_page'] = getServer('REQUEST_URI');$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v867bc014e617d40529613ca365475165, $ve03aaad027a88fc6cd24c8cfdfd8db10);if($v4640d44b30f3273e05905771772fd9be->getObject()->getOwnerId() == $v2285c8dbaad09008016f9b367370fb67->user_id) $v5a096886f4b018d9c93608fb21983ee0++;}if($v5a096886f4b018d9c93608fb21983ee0 < $vb1444fb0c07653567ad325aa25d4e37a->getVal("//modules/blogs20/blogs_per_user")) {$ve03aaad027a88fc6cd24c8cfdfd8db10 = array('bid'=>'new', 'title'=>'', 'description'=>'');$v40be9a1ee7b37ea0c5c5736e54034b6c    = '';foreach($vea889e053e4f623040312d22f0361b2b as $v8e44f0089b076e18a718eb9ca3d94674 => $v435e0648d634175c46bd40ac366545a8) {$v40be9a1ee7b37ea0c5c5736e54034b6c .= '<option value="'.$v8e44f0089b076e18a718eb9ca3d94674.'">' . $v435e0648d634175c46bd40ac366545a8 . '</option>';}$ve03aaad027a88fc6cd24c8cfdfd8db10['friends'] = $v40be9a1ee7b37ea0c5c5736e54034b6c;$ve03aaad027a88fc6cd24c8cfdfd8db10['current_page'] = getServer('REQUEST_URI');$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($vfc0a66956f790f0422313cb261ee9314, $ve03aaad027a88fc6cd24c8cfdfd8db10);}$v5269d01add2bfaf4ed72b667089afc7a = array();$v5269d01add2bfaf4ed72b667089afc7a['subnodes:blogs'] = $v5269d01add2bfaf4ed72b667089afc7a['void:lines'] = $v58adb00b289a0e0e1b51fa7e280b6bbc;return self::parseTemplate($v18d8c52f684306e4ff9724366854e88c, $v5269d01add2bfaf4ed72b667089afc7a);}public function viewBlogAuthors($v5ec92172c9f45d96f490290ccbaaf809 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {static $v17fd2a26c32a68629bcd0509af59c959        = false;static $vfbd4fece8410679bc4d12bf890485244 = false;static $v60bea1419e0d2afc208fd869ba872e68  = false;static $vf24fb6e87a19d3a5d73c015a9ddfcfe9   = null;static $vfc5ecff8bf18f57d6c531d097242e888       = null;static $vea6fa4982fd7cb898b3a8c075cf7df1a    = 0;static $vf0d297ca31334071e14d481e6e589317 = 0;$v72122ce96bfec66e2396d2e25225d70a = 14;if(!$v17fd2a26c32a68629bcd0509af59c959) {list($vfbd4fece8410679bc4d12bf890485244, $v60bea1419e0d2afc208fd869ba872e68) =      self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'blog_author_list_block', 'blog_author_list_line');$vf24fb6e87a19d3a5d73c015a9ddfcfe9 = permissionsCollection::getInstance();$vfc5ecff8bf18f57d6c531d097242e888     = umiObjectsCollection::getInstance();$vea6fa4982fd7cb898b3a8c075cf7df1a  = umiObjectTypesCollection::getInstance()->getBaseType('users', 'user');$vd661cb477c1363d6e0467a5b80c5a5d1    = umiObjectTypesCollection::getInstance()->getType($vea6fa4982fd7cb898b3a8c075cf7df1a);$vf0d297ca31334071e14d481e6e589317 = $vd661cb477c1363d6e0467a5b80c5a5d1->getFieldId('groups');$v17fd2a26c32a68629bcd0509af59c959 = true;}$v242ce12d964f3c99336424f73158a1d4    = array();$v7942cba2a888a38186c16595b04ee77f = array();$vea889e053e4f623040312d22f0361b2b  = array();$ve0626222614bdee31951d84c64e5e9ff  = false;$v0680939f977ab86d0bed026d3f2ca1fc = $vf24fb6e87a19d3a5d73c015a9ddfcfe9->getUsersByElementPermissions($v5ec92172c9f45d96f490290ccbaaf809, 2);$v8be74552df93e31bbdd6b36ed74bdb6a     = new umiSelection();$v8be74552df93e31bbdd6b36ed74bdb6a->addObjectType($vea6fa4982fd7cb898b3a8c075cf7df1a);foreach($v0680939f977ab86d0bed026d3f2ca1fc as $v4908588c696a4fb243d21ae536fed837) {if($v4908588c696a4fb243d21ae536fed837 == 15) continue;$vb6f4a2ec6356bbd56d49f2096bf9d3d3 = $vfc5ecff8bf18f57d6c531d097242e888->getObject($v4908588c696a4fb243d21ae536fed837);if($vb6f4a2ec6356bbd56d49f2096bf9d3d3->getTypeId() == $vea6fa4982fd7cb898b3a8c075cf7df1a) {$vea889e053e4f623040312d22f0361b2b[] = $v4908588c696a4fb243d21ae536fed837;}else {$ve0626222614bdee31951d84c64e5e9ff = true;$v8be74552df93e31bbdd6b36ed74bdb6a->addPropertyFilterEqual($vf0d297ca31334071e14d481e6e589317, $v4908588c696a4fb243d21ae536fed837);}}if($ve0626222614bdee31951d84c64e5e9ff) {$v4b43b0aee35624cd95b910189b3dc231 = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vea889e053e4f623040312d22f0361b2b = array_merge($vea889e053e4f623040312d22f0361b2b, $v4b43b0aee35624cd95b910189b3dc231);}if(!$v126ac9f6149081eb0e97c2e939eaad52 = umiHierarchy::getInstance()->getElement($v5ec92172c9f45d96f490290ccbaaf809)) {throw new publicException(getLabel('error-page-does-not-exist', null, $v5ec92172c9f45d96f490290ccbaaf809));}$v72122ce96bfec66e2396d2e25225d70a    = $v126ac9f6149081eb0e97c2e939eaad52->getObject()->getOwnerId();$vea889e053e4f623040312d22f0361b2b[] = $v72122ce96bfec66e2396d2e25225d70a;if(empty($vea889e053e4f623040312d22f0361b2b)) return '';$vea889e053e4f623040312d22f0361b2b = array_unique($vea889e053e4f623040312d22f0361b2b);foreach($vea889e053e4f623040312d22f0361b2b as $v8e44f0089b076e18a718eb9ca3d94674) {$v9fe0bb93b257b012f0c9427fb1d48ffd   = $vfc5ecff8bf18f57d6c531d097242e888->getObject($v8e44f0089b076e18a718eb9ca3d94674);if(!$v9fe0bb93b257b012f0c9427fb1d48ffd) continue;$v9f603482a3512b98ada9fdb672e14501 = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue('groups');$ve1096cde0e7e98b154a5494ac0d1b1d0   = array();$ve1096cde0e7e98b154a5494ac0d1b1d0['attribute:user_id'] = $v8e44f0089b076e18a718eb9ca3d94674;$ve1096cde0e7e98b154a5494ac0d1b1d0['attribute:login'] = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue('login');$ve1096cde0e7e98b154a5494ac0d1b1d0['attribute:fname']   = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue('fname');$ve1096cde0e7e98b154a5494ac0d1b1d0['attribute:lname']   = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue('lname');$vb068931cc450442b63f5b3d276ea4297  = $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue('fname') . ' ' . $v9fe0bb93b257b012f0c9427fb1d48ffd->getValue('lname');$vd56b699830e77ba53855679cb1d252da = $v9fe0bb93b257b012f0c9427fb1d48ffd->getName();$ve1096cde0e7e98b154a5494ac0d1b1d0['attribute:name']    = strlen(trim($vb068931cc450442b63f5b3d276ea4297)) ? $vb068931cc450442b63f5b3d276ea4297 : $vd56b699830e77ba53855679cb1d252da;if($v8e44f0089b076e18a718eb9ca3d94674 == $v72122ce96bfec66e2396d2e25225d70a) {$ve1096cde0e7e98b154a5494ac0d1b1d0['attribute:is_owner'] = '1';}$v242ce12d964f3c99336424f73158a1d4[]    = self::parseTemplate($v60bea1419e0d2afc208fd869ba872e68, $ve1096cde0e7e98b154a5494ac0d1b1d0);$v7942cba2a888a38186c16595b04ee77f[] = $ve1096cde0e7e98b154a5494ac0d1b1d0;}if(empty($v242ce12d964f3c99336424f73158a1d4)) return '';$v980da98409d058c365664ff7ea33dd6b = (!empty($v242ce12d964f3c99336424f73158a1d4) && !is_array($v242ce12d964f3c99336424f73158a1d4[0])) ? implode(', ', $v242ce12d964f3c99336424f73158a1d4) : '';return self::parseTemplate($vfbd4fece8410679bc4d12bf890485244, array('void:lines' => $v980da98409d058c365664ff7ea33dd6b, 'subnodes:users' => $v7942cba2a888a38186c16595b04ee77f));}public function viewBlogFriends($v5ec92172c9f45d96f490290ccbaaf809, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {if($v5ec92172c9f45d96f490290ccbaaf809 === false) {$vbec49e4ebb1c7d10a8c350f010648fc7 = getRequest('param0');if($vbec49e4ebb1c7d10a8c350f010648fc7) $v5ec92172c9f45d96f490290ccbaaf809 = $vbec49e4ebb1c7d10a8c350f010648fc7;}if(!$v4cdc889a6fa8983cb13088748fdd5dd7 = cmsController::getInstance()->getModule("users")) {throw new publicException("Can't find users module");}$v4640d44b30f3273e05905771772fd9be = umiHierarchy::getInstance()->getElement($v5ec92172c9f45d96f490290ccbaaf809);if(!$v4640d44b30f3273e05905771772fd9be) {throw new publicException("Incorrect Blog ID");}$vbedd1b0ec0351878d7d0c781832a49e2 = $v4640d44b30f3273e05905771772fd9be->getValue('friendlist');$v242ce12d964f3c99336424f73158a1d4      = array();foreach($vbedd1b0ec0351878d7d0c781832a49e2 as $v8e44f0089b076e18a718eb9ca3d94674) {$v242ce12d964f3c99336424f73158a1d4[] = $v4cdc889a6fa8983cb13088748fdd5dd7->viewAuthor($v8e44f0089b076e18a718eb9ca3d94674, 'blogs20');}return implode(', ', $v242ce12d964f3c99336424f73158a1d4);}public function placeControls($v7552cd149af7495ee7d8225974e50f80, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {static $v17fd2a26c32a68629bcd0509af59c959 = false;static $v62e1ceeca00288d50023912c225e7c39, $ved81be89f96a2cece3a67dc44ab6bb65, $v71e96cc0dd21ae2b0889e8828c979720, $vdd502eb2aa42998e4cfe76afa830311a, $v245477c1e89f1107fa8f1a37edcff015, $v529836906749eb8f783ea79a92ed61a7;static $v8e44f0089b076e18a718eb9ca3d94674  = false;static $vc20baa4161945565bd89bb659504b1a7;static $v84582ccdffe07a1c9f8e895eb2152e53;static $vf9f25f29a169e373a2849ab7e43babeb;if(!$v17fd2a26c32a68629bcd0509af59c959) {list($v62e1ceeca00288d50023912c225e7c39, $ved81be89f96a2cece3a67dc44ab6bb65, $v71e96cc0dd21ae2b0889e8828c979720, $vdd502eb2aa42998e4cfe76afa830311a, $v245477c1e89f1107fa8f1a37edcff015, $v529836906749eb8f783ea79a92ed61a7) =       self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl',            'post_control_block', 'post_control_delete', 'post_control_edit',           'comment_control_block', 'comment_control_delete', 'comment_control_edit');$v8e44f0089b076e18a718eb9ca3d94674       = cmsController::getInstance()->getModule('users')->user_id;$vc20baa4161945565bd89bb659504b1a7   = umiHierarchy::getInstance();$v84582ccdffe07a1c9f8e895eb2152e53 = umiHierarchyTypesCollection::getInstance()->getTypeByName('blogs20', 'comment')->getId();$vf9f25f29a169e373a2849ab7e43babeb = umiHierarchyTypesCollection::getInstance()->getTypeByName('blogs20', 'post')->getId();$v17fd2a26c32a68629bcd0509af59c959      = true;}if($v8e44f0089b076e18a718eb9ca3d94674 === false) return;if(!$v266dfb6190a3ce57973bce176a01701e = $vc20baa4161945565bd89bb659504b1a7->getElement($v7552cd149af7495ee7d8225974e50f80, true)) return '';$v1cac9b8eba5f808398072b53f245f98f = $v266dfb6190a3ce57973bce176a01701e;while($v1cac9b8eba5f808398072b53f245f98f->getTypeId() == $v84582ccdffe07a1c9f8e895eb2152e53) $v1cac9b8eba5f808398072b53f245f98f = $vc20baa4161945565bd89bb659504b1a7->getElement($v1cac9b8eba5f808398072b53f245f98f->getRel(), true);if($v1cac9b8eba5f808398072b53f245f98f->getObject()->getOwnerId() != $v8e44f0089b076e18a718eb9ca3d94674) return;if($v266dfb6190a3ce57973bce176a01701e->getTypeId() == $v84582ccdffe07a1c9f8e895eb2152e53) {$v19bfcf27f16bc74262a4a4678e2e6a46  = $vdd502eb2aa42998e4cfe76afa830311a;$va4d17b5c24ba95b70d084f70af288aec = self::parseTemplate($v245477c1e89f1107fa8f1a37edcff015, array('attribute:link' => '/blogs20/itemDelete/'.$v7552cd149af7495ee7d8225974e50f80.'/'));$v2d7f42bfb8d4a759b07f4975c610da1d   = self::parseTemplate($v529836906749eb8f783ea79a92ed61a7,   array('attribute:link' => '/blogs20/commentEdit/'.$v7552cd149af7495ee7d8225974e50f80.'/'));}else if($v266dfb6190a3ce57973bce176a01701e->getTypeId() == $vf9f25f29a169e373a2849ab7e43babeb) {$v389f9ac6024bbda5ae2d8e4984ce0f22   = $vc20baa4161945565bd89bb659504b1a7->getPathById( $v1cac9b8eba5f808398072b53f245f98f->getRel() );$v19bfcf27f16bc74262a4a4678e2e6a46  = $v62e1ceeca00288d50023912c225e7c39;$va4d17b5c24ba95b70d084f70af288aec = self::parseTemplate($ved81be89f96a2cece3a67dc44ab6bb65, array('attribute:link' => '/blogs20/itemDelete/'.$v7552cd149af7495ee7d8225974e50f80.'/?redirect='.urlencode($v389f9ac6024bbda5ae2d8e4984ce0f22)));$v2d7f42bfb8d4a759b07f4975c610da1d   = self::parseTemplate($v71e96cc0dd21ae2b0889e8828c979720,   array('attribute:link' => '/blogs20/postEdit/'.$v7552cd149af7495ee7d8225974e50f80.'/'));}else {return '';}$v69ba0c89abba8a3e9cc0c5e32be0d35d = Array();$v69ba0c89abba8a3e9cc0c5e32be0d35d['edit'] = $v2d7f42bfb8d4a759b07f4975c610da1d;$v69ba0c89abba8a3e9cc0c5e32be0d35d['delete'] = $va4d17b5c24ba95b70d084f70af288aec;$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['controls'] = $v69ba0c89abba8a3e9cc0c5e32be0d35d;return self::parseTemplate($v19bfcf27f16bc74262a4a4678e2e6a46, $vfca1bff8ad8b3a8585abfb0ad523ba42);}public function checkAllowComments() {if (permissionsCollection::getInstance()->getUserId() == '2373') {return regedit::getInstance()->getVal('/modules/blogs20/allow_guest_comments');}else return 1;}private function prepareBlogSelect($v813f93484a336bb6584cd1e39d929538 = false, $vae254d63f2381cc183c11594873793e0 = false, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {if($v813f93484a336bb6584cd1e39d929538 && !$vae254d63f2381cc183c11594873793e0) return;static $v17fd2a26c32a68629bcd0509af59c959   = false;static $v986eab15ced2b8e3368ee0c3f92324be, $v635fca09dd69543b7a42735690f420a2;static $ve627ce31249efefa9f2a6e801b8ad6f3 = array();if(!$v17fd2a26c32a68629bcd0509af59c959) {list($v986eab15ced2b8e3368ee0c3f92324be, $v635fca09dd69543b7a42735690f420a2) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'blog_choose_block', 'blog_choose_line');$v8be74552df93e31bbdd6b36ed74bdb6a = new umiSelection;$v0715f6d9497f93911417c9c324265771 = umiHierarchyTypesCollection::getInstance()->getTypeByName("blogs20", "blog")->getId();$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v0715f6d9497f93911417c9c324265771);$v8be74552df93e31bbdd6b36ed74bdb6a->addPermissions();$v8be74552df93e31bbdd6b36ed74bdb6a->setPermissionsLevel(2);$result  = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vc20baa4161945565bd89bb659504b1a7 = umiHierarchy::getInstance();foreach($result as $v5ec92172c9f45d96f490290ccbaaf809) {$ve627ce31249efefa9f2a6e801b8ad6f3[$v5ec92172c9f45d96f490290ccbaaf809] = $vc20baa4161945565bd89bb659504b1a7->getElement($v5ec92172c9f45d96f490290ccbaaf809)->getValue('title');}$v17fd2a26c32a68629bcd0509af59c959 = true;}$v58adb00b289a0e0e1b51fa7e280b6bbc = array();foreach($ve627ce31249efefa9f2a6e801b8ad6f3 as $v5ec92172c9f45d96f490290ccbaaf809 => $v3ed478448ba882b88c446563d8f12dbd) {$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v635fca09dd69543b7a42735690f420a2, array('bid'   => $v5ec92172c9f45d96f490290ccbaaf809,               'title' => $v3ed478448ba882b88c446563d8f12dbd,               'selected' => ( $v5ec92172c9f45d96f490290ccbaaf809 == $v813f93484a336bb6584cd1e39d929538 ? 'selected' : '') ));}return self::parseTemplate($v986eab15ced2b8e3368ee0c3f92324be, array('subnodes:options'=>$v58adb00b289a0e0e1b51fa7e280b6bbc));}private function prepareCut($v9a0364b9e99bb480dd25e1f0284c8555, $v06294798928dc69413ef1257fc2ff0d4, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {static $v11fc3ed2ddeb4eb96cbd3a5ca1aa8213 = false;$vf4856dbd54980471549ceffcfccabdf3 = strpos($v9a0364b9e99bb480dd25e1f0284c8555, '[cut]');if($vf4856dbd54980471549ceffcfccabdf3 === false) {return $this->prepareContent($v9a0364b9e99bb480dd25e1f0284c8555);}if($v11fc3ed2ddeb4eb96cbd3a5ca1aa8213 === false) {list($v11fc3ed2ddeb4eb96cbd3a5ca1aa8213) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'post_cut_link');}$vc8e1166d6915408cae4e60563d1d0e35 = strpos($v9a0364b9e99bb480dd25e1f0284c8555, '[/cut]');if($vc8e1166d6915408cae4e60563d1d0e35 === false) {$vc8e1166d6915408cae4e60563d1d0e35 = $vf4856dbd54980471549ceffcfccabdf3;$vf4856dbd54980471549ceffcfccabdf3    = 0;}$v9a0364b9e99bb480dd25e1f0284c8555 = substr($v9a0364b9e99bb480dd25e1f0284c8555, $vf4856dbd54980471549ceffcfccabdf3, $vc8e1166d6915408cae4e60563d1d0e35-$vf4856dbd54980471549ceffcfccabdf3);$v9a0364b9e99bb480dd25e1f0284c8555 = $this->prepareContent($v9a0364b9e99bb480dd25e1f0284c8555);$v2a304a1348456ccd2234cd71a81bd338    = self::parseTemplate($v11fc3ed2ddeb4eb96cbd3a5ca1aa8213, array('link'=>$v06294798928dc69413ef1257fc2ff0d4));if(!is_array($v2a304a1348456ccd2234cd71a81bd338)) $v9a0364b9e99bb480dd25e1f0284c8555 .= $v2a304a1348456ccd2234cd71a81bd338;return $v9a0364b9e99bb480dd25e1f0284c8555;}private function prepareTags($v189f63f277cd73395561651753563065, $v66f6181bcb4cff4cd38fbc804a036db6 = 'default') {static $v39f17319be96f2b5889115ba057e5c2a = null;if($v39f17319be96f2b5889115ba057e5c2a == null) {list($v39f17319be96f2b5889115ba057e5c2a) = self::loadTemplates('tpls/blogs20/'.$v66f6181bcb4cff4cd38fbc804a036db6.'.tpl', 'tag_decoration');}$v8eea62084ca7e541d918e823422bd82e = array();foreach($v189f63f277cd73395561651753563065 as $ve4d23e841d8e8804190027bce3180fa5) {$v8eea62084ca7e541d918e823422bd82e[] = self::parseTemplate($v39f17319be96f2b5889115ba057e5c2a, array('link'=>'/blogs20/postsByTag/'.$ve4d23e841d8e8804190027bce3180fa5, 'tag'=>$ve4d23e841d8e8804190027bce3180fa5));}return (!empty($v8eea62084ca7e541d918e823422bd82e) && is_array($v8eea62084ca7e541d918e823422bd82e[0])) ? $v8eea62084ca7e541d918e823422bd82e : implode(', ', $v8eea62084ca7e541d918e823422bd82e);}private function prepareContent($v9a0364b9e99bb480dd25e1f0284c8555) {$vd98a07f84921b24ee30f86fd8cd85c3c = array('[b]', '[/b]', '[i]', '[/i]', '[s]', '[/s]', '[u]', '[/u]', '[quote]', '[/quote]', "\n", '[cut]', '[/cut]');$v01b6e20344b68835c5ed1ddedf20d531   = array('<b>', '</b>', '<i>', '</i>', '<span style="text-decoration:line-through;">', '</span>', '<span style="text-decoration:underline;">', '</span>', '<div class="quote">', '</div>', "<br />\n", '', '');$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace($vd98a07f84921b24ee30f86fd8cd85c3c, $v01b6e20344b68835c5ed1ddedf20d531, $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace("@\[img\](.+?)\[\/img\]@i", "<img src=\"$1\" alt=\"\" />", $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace("@\[url\](.+?)\[\/url\]@i", "<a href=\"$1\">[Link]</a>", $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace("@\[url=(.+?)\]((.|\n)+?)\[\/url\]@i", "<a href=\"$1\" target=\"_blank\">$2</a>", $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace("@\[code\]((.|\n)+?)\[\/code\]@i", "<tt>$1</tt>", $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace("@\[color=([A-Za-z0-9#]+?)\]((.|\n)+?)\[\/color\]@i", "<span style=\"color:$1;\">$2</span>", $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace("@\[smile:([0-9]+?)\]@i", "<img src=\"/images/forum/smiles/$1.gif\" alt=\"$1\">", $v9a0364b9e99bb480dd25e1f0284c8555);return $v9a0364b9e99bb480dd25e1f0284c8555;}private function placeComments($vbfa030fe63bacd523dd70a76cfaed98a, $v78325ef2910aaa327bba1fde7d68bbf9, umiHierarchy $vb81ca7c0ccaa77e7aa91936ab0070695, $v95d298e14fcec7c8568cfdf4be0c23c1, &$vfbb44b4487415b134bce9c790a27fe5e) {static $v268cb0796a546fbf56a4a5ded2c2035e = 0;if(!$v268cb0796a546fbf56a4a5ded2c2035e) {$v268cb0796a546fbf56a4a5ded2c2035e = umiHierarchyTypesCollection::getInstance()->getTypeByName('blogs20', 'post')->getId();}$vd0e45878043844ffc41aac437e86b602 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($vbfa030fe63bacd523dd70a76cfaed98a, true);if(!($vd0e45878043844ffc41aac437e86b602 instanceof umiHierarchyElement)) {throw new publicException("Unknown parent element for comments");}$vdd8917be3b944856b50ffd46654c8351 = ($vd0e45878043844ffc41aac437e86b602->getTypeId() == $v268cb0796a546fbf56a4a5ded2c2035e);$v8be74552df93e31bbdd6b36ed74bdb6a  = new umiSelection;$v8be74552df93e31bbdd6b36ed74bdb6a->addElementType($v95d298e14fcec7c8568cfdf4be0c23c1);$v8be74552df93e31bbdd6b36ed74bdb6a->addHierarchyFilter($vbfa030fe63bacd523dd70a76cfaed98a);if($vdd8917be3b944856b50ffd46654c8351) {$v71860c77c6745379b0d44304d66b6a13    = (int)getRequest('p');$v8be74552df93e31bbdd6b36ed74bdb6a->addLimit($this->comments_per_page, $v71860c77c6745379b0d44304d66b6a13);}$result = umiSelectionsParser::runSelection($v8be74552df93e31bbdd6b36ed74bdb6a);$vfbb44b4487415b134bce9c790a27fe5e  = umiSelectionsParser::runSelectionCounts($v8be74552df93e31bbdd6b36ed74bdb6a);$v58adb00b289a0e0e1b51fa7e280b6bbc = array();foreach($result as $ve2e1896b91c77e852e93acb763cdb1a7) {$v9894ce3abcd8c0c55d700cce56b565ca   = $vb81ca7c0ccaa77e7aa91936ab0070695->getElement($ve2e1896b91c77e852e93acb763cdb1a7, true);$v3d801aa532c1cec3ee82d87a99fdf63f       = 0;$v2c5801de7269e15cdadf545de70d5440    = $v9894ce3abcd8c0c55d700cce56b565ca->getValue('publish_time');$ve03aaad027a88fc6cd24c8cfdfd8db10 = array();$ve03aaad027a88fc6cd24c8cfdfd8db10['attribute:cid'] = $ve2e1896b91c77e852e93acb763cdb1a7;$ve03aaad027a88fc6cd24c8cfdfd8db10['name']    = $v9894ce3abcd8c0c55d700cce56b565ca->getName();$ve03aaad027a88fc6cd24c8cfdfd8db10['content']    = $this->prepareContent( $v9894ce3abcd8c0c55d700cce56b565ca->getValue('content') );$ve03aaad027a88fc6cd24c8cfdfd8db10['author_id']  = $v9894ce3abcd8c0c55d700cce56b565ca->getValue('author_id');$ve03aaad027a88fc6cd24c8cfdfd8db10['publish_time']  = ($v2c5801de7269e15cdadf545de70d5440 instanceof umiDate) ? $v2c5801de7269e15cdadf545de70d5440->getFormattedDate('U') : time() ;$ve03aaad027a88fc6cd24c8cfdfd8db10['subnodes:subcomments']  = $this->placeComments($ve2e1896b91c77e852e93acb763cdb1a7, $v78325ef2910aaa327bba1fde7d68bbf9, $vb81ca7c0ccaa77e7aa91936ab0070695, $v95d298e14fcec7c8568cfdf4be0c23c1, $v3d801aa532c1cec3ee82d87a99fdf63f);$v58adb00b289a0e0e1b51fa7e280b6bbc[] = self::parseTemplate($v78325ef2910aaa327bba1fde7d68bbf9, $ve03aaad027a88fc6cd24c8cfdfd8db10, $ve2e1896b91c77e852e93acb763cdb1a7);}return $v58adb00b289a0e0e1b51fa7e280b6bbc;}private static function applyTimeRange(umiSelection $vef5714e0519bfaa645cdff7d28843b70, umiObjectType $v599dcce2998a6b40b1e38e8c6006cb0a) {$v7fad969560e5766b7940d3703acb5223 = getRequest('from_date');$v200a296e04106eac8d4c73e875e62cb5   = getRequest('to_date');if(strlen($v7fad969560e5766b7940d3703acb5223) && strlen($v200a296e04106eac8d4c73e875e62cb5)) {$vf83c20bdf50274997123314d247a5dc9 = explode('-', $v7fad969560e5766b7940d3703acb5223);$v0d581fd432f2647b7eee022cbfa5959f   = explode('-', $v200a296e04106eac8d4c73e875e62cb5);$vfc0c08198f54555abea76305690792e4 = mktime(0, 0, 0,    $vf83c20bdf50274997123314d247a5dc9[1], $vf83c20bdf50274997123314d247a5dc9[2], $vf83c20bdf50274997123314d247a5dc9[0]);$vaf641ac0e29f8e06f78ee5580d00a7f1   = mktime(23, 59, 59, $v0d581fd432f2647b7eee022cbfa5959f[1],   $v0d581fd432f2647b7eee022cbfa5959f[2],   $v0d581fd432f2647b7eee022cbfa5959f[0]);$vef5714e0519bfaa645cdff7d28843b70->addPropertyFilterBetween( $v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId('publish_time'), $vfc0c08198f54555abea76305690792e4, $vaf641ac0e29f8e06f78ee5580d00a7f1 );}else if(strlen($v7fad969560e5766b7940d3703acb5223) && !strlen($v200a296e04106eac8d4c73e875e62cb5)) {$vf83c20bdf50274997123314d247a5dc9 = explode('-', $v7fad969560e5766b7940d3703acb5223);$vfc0c08198f54555abea76305690792e4 = mktime(0, 0, 0,    $vf83c20bdf50274997123314d247a5dc9[1], $vf83c20bdf50274997123314d247a5dc9[2], $vf83c20bdf50274997123314d247a5dc9[0]);$vef5714e0519bfaa645cdff7d28843b70->addPropertyFilterMore($v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId('publish_time'), $vfc0c08198f54555abea76305690792e4);}else if(strlen($v200a296e04106eac8d4c73e875e62cb5)) {$v0d581fd432f2647b7eee022cbfa5959f   = explode('-', $v200a296e04106eac8d4c73e875e62cb5);$vaf641ac0e29f8e06f78ee5580d00a7f1   = mktime(23, 59, 59, $v0d581fd432f2647b7eee022cbfa5959f[1],   $v0d581fd432f2647b7eee022cbfa5959f[2],   $v0d581fd432f2647b7eee022cbfa5959f[0]);$vef5714e0519bfaa645cdff7d28843b70->addPropertyFilterLess($v599dcce2998a6b40b1e38e8c6006cb0a->getFieldId('publish_time'), $vaf641ac0e29f8e06f78ee5580d00a7f1);}}public function onPostAdded(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {if($v4119639092e62c55ea8be348e4d9260d->getMode() == 'after') {$v73f10df5e289faaff50345b514062c0e = $v4119639092e62c55ea8be348e4d9260d->getParam('id');antiSpamHelper::checkForSpam($v73f10df5e289faaff50345b514062c0e);}}public function onCommentAdded(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {$ve2e1896b91c77e852e93acb763cdb1a7 = $v4119639092e62c55ea8be348e4d9260d->getParam('id');antiSpamHelper::checkForSpam($ve2e1896b91c77e852e93acb763cdb1a7);}};?>