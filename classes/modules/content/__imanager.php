<?php
 abstract class __imanager_content extends baseModuleAdmin {protected function makePanelImageThumbnail ($v78805a221a988e79ef3f42d7c5bfd418, $v80e1e5084bf4b06e52cbf5fe25d6bec0 = false) {$vdea05303f28526fb733ce0b5ab63f6ec = umiConversion::getInstance()->Any2UTF8($v78805a221a988e79ef3f42d7c5bfd418->getFilePath(true));$v61d7af558890184d5ed1e4367d7b4b68 = umiConversion::getInstance()->Any2UTF8($v78805a221a988e79ef3f42d7c5bfd418->getFileName());$v1bbcb648e0b1869444f3a2d344a5b3ac = pathinfo($vdea05303f28526fb733ce0b5ab63f6ec);$v71873b7730395a154aed48ab8f70e5ef = $v1bbcb648e0b1869444f3a2d344a5b3ac['dirname']."/".$v1bbcb648e0b1869444f3a2d344a5b3ac['filename'];$vb43c766cbc1365dca0ffcee38e46b613 = $v71873b7730395a154aed48ab8f70e5ef."_sl_90_60.".$v1bbcb648e0b1869444f3a2d344a5b3ac['extension'];$vf76c60d35b86d9fa09c1c6a438eda836 = "/autothumbs.php?img=" . $vb43c766cbc1365dca0ffcee38e46b613 . ($v80e1e5084bf4b06e52cbf5fe25d6bec0 ? "&rnd=".time() : "");$v71873b7730395a154aed48ab8f70e5ef = "/autothumbs.php?img=" . $v71873b7730395a154aed48ab8f70e5ef;$v260bee777bfc8df3da04ebda68dd6b76 = truncStr($v61d7af558890184d5ed1e4367d7b4b68, 16, ".." . substr($v71873b7730395a154aed48ab8f70e5ef, strlen($v71873b7730395a154aed48ab8f70e5ef) - 2) . "." . $v1bbcb648e0b1869444f3a2d344a5b3ac['extension']);return array ('src' => $vf76c60d35b86d9fa09c1c6a438eda836, 'path' => $v71873b7730395a154aed48ab8f70e5ef);}public function getDirectoryItems () {$v736007832d2167baaae763fd3a3f3cf1 = base64_decode(getRequest("dir"));$v21dd7626f3d92e2f229e3f06b0c057be = getRequest("type");if (!$v736007832d2167baaae763fd3a3f3cf1) {$v736007832d2167baaae763fd3a3f3cf1 = "images/";}if ($v21dd7626f3d92e2f229e3f06b0c057be == "img") {$v3308208c91a9e9a7814f0f32b0827b43 = umiImageFile::getSupportedImageTypes();$vbc0a47c192284883efc11fd2a23d4dcb = "^.+\.(";foreach ($v3308208c91a9e9a7814f0f32b0827b43 as $v3c6e0b8a9c15224a8228b9a98ca1531d=>$v708e08a820129855cbd4a2ac3c57585b) {if ($v3c6e0b8a9c15224a8228b9a98ca1531d != (count($v3308208c91a9e9a7814f0f32b0827b43) -1)) {$vbc0a47c192284883efc11fd2a23d4dcb.= $v708e08a820129855cbd4a2ac3c57585b."|";}else {$vbc0a47c192284883efc11fd2a23d4dcb.= $v708e08a820129855cbd4a2ac3c57585b;}}$vbc0a47c192284883efc11fd2a23d4dcb.= ")$";}elseif ($v21dd7626f3d92e2f229e3f06b0c057be == "dir") {$vbc0a47c192284883efc11fd2a23d4dcb = "^(?!\.).*";}if ($v736007832d2167baaae763fd3a3f3cf1!="images/") {preg_match("/(.+)\/.+/", $v736007832d2167baaae763fd3a3f3cf1, $vbf264b50962f0db5b691cdb2b0f909fb);$vcc16bbd4a0a01c2a3e7f0687a47e62b1 = $vbf264b50962f0db5b691cdb2b0f909fb[1];}else {$vcc16bbd4a0a01c2a3e7f0687a47e62b1 = "";}$v642d8cd2b183ce314393898962e7e7fa = Array ();$v5f8f22b8cdbaeee8cf857673a9b6ba20 = new umiDirectory($v736007832d2167baaae763fd3a3f3cf1);if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->getIsBroken()) {$v85428045bbea66f1cf5e28a3037463b0 = $v5f8f22b8cdbaeee8cf857673a9b6ba20->getFSObjects(0,$vbc0a47c192284883efc11fd2a23d4dcb);$v0b5c6f6b2cd02790bb607fda3cfcd669 = new umiDirectoryIterator($v85428045bbea66f1cf5e28a3037463b0);while ($v2268317dbea0e4df28bd78a892f265d4 = $v0b5c6f6b2cd02790bb607fda3cfcd669->current()) {$v8b234bc4d890dddc228a85c598a46e60 = Array ();if ($v2268317dbea0e4df28bd78a892f265d4 instanceof umiDirectory && $v21dd7626f3d92e2f229e3f06b0c057be == "dir") {$v8b234bc4d890dddc228a85c598a46e60['attribute:path'] = CURRENT_WORKING_DIR."/".$v2268317dbea0e4df28bd78a892f265d4->getPath();$v8b234bc4d890dddc228a85c598a46e60['attribute:type'] = "dir";$v8b234bc4d890dddc228a85c598a46e60['node:name'] = $v2268317dbea0e4df28bd78a892f265d4->getName();$v642d8cd2b183ce314393898962e7e7fa[] = $v8b234bc4d890dddc228a85c598a46e60;}elseif ($v2268317dbea0e4df28bd78a892f265d4 instanceof umiFile && $v21dd7626f3d92e2f229e3f06b0c057be == "img") {if ($v2268317dbea0e4df28bd78a892f265d4 instanceof umiImageFile) {$v750fab1750f911625f8eacfc80ac833f = self::makePanelImageThumbnail($v2268317dbea0e4df28bd78a892f265d4);$v8b234bc4d890dddc228a85c598a46e60['attribute:src'] = $v2268317dbea0e4df28bd78a892f265d4->getFilePath();$v8b234bc4d890dddc228a85c598a46e60['attribute:ext'] = $v2268317dbea0e4df28bd78a892f265d4->getExt();$v8b234bc4d890dddc228a85c598a46e60['attribute:name'] = $v2268317dbea0e4df28bd78a892f265d4->getFileName();$v8b234bc4d890dddc228a85c598a46e60['attribute:size'] = $v2268317dbea0e4df28bd78a892f265d4->getSize();$v8b234bc4d890dddc228a85c598a46e60['attribute:thumb_base'] = $v750fab1750f911625f8eacfc80ac833f['path'];$v8b234bc4d890dddc228a85c598a46e60['attribute:thumb'] = $v750fab1750f911625f8eacfc80ac833f['src'];$v126d75f63114ac938f9e95ce9e1102d3 = $v2268317dbea0e4df28bd78a892f265d4->getSize()/1024;$v126d75f63114ac938f9e95ce9e1102d3 = number_format($v126d75f63114ac938f9e95ce9e1102d3, 2);$vd5d3db1765287eef77d7927cc956f50a = $v2268317dbea0e4df28bd78a892f265d4->getFileName()." (";$v8b234bc4d890dddc228a85c598a46e60['attribute:type'] = "imgFile";$v8b234bc4d890dddc228a85c598a46e60['attribute:width'] = $v2268317dbea0e4df28bd78a892f265d4->getWidth();$v8b234bc4d890dddc228a85c598a46e60['attribute:height'] = $v2268317dbea0e4df28bd78a892f265d4->getHeight();$v951d4dff3c22e9fcc4a2707009f45ea8 = self::makePanelImageThumbnail($v2268317dbea0e4df28bd78a892f265d4);$vd5d3db1765287eef77d7927cc956f50a.= $v2268317dbea0e4df28bd78a892f265d4->getWidth()."x".$v2268317dbea0e4df28bd78a892f265d4->getHeight().", ";$vd5d3db1765287eef77d7927cc956f50a.= " $v126d75f63114ac938f9e95ce9e1102d3 Kb)";$v8b234bc4d890dddc228a85c598a46e60['node:name'] = $vd5d3db1765287eef77d7927cc956f50a;$v642d8cd2b183ce314393898962e7e7fa[] = $v8b234bc4d890dddc228a85c598a46e60;}}$v0b5c6f6b2cd02790bb607fda3cfcd669->next();}}$ve62e4d22f2d8630f6e44e2b7c3f70ddc = Array (     "Directory" => Array (     "attribute:name" => $v736007832d2167baaae763fd3a3f3cf1,     "nodes:item" => $v642d8cd2b183ce314393898962e7e7fa,     "attribute:parent" => $vcc16bbd4a0a01c2a3e7f0687a47e62b1     )    );$this->setDataType("list");$this->setActionType("view");$this->setData($ve62e4d22f2d8630f6e44e2b7c3f70ddc);return $this->doData();}public function removeImanagerObject () {$v78805a221a988e79ef3f42d7c5bfd418 = base64_decode(getRequest("obj_path"));$v599dcce2998a6b40b1e38e8c6006cb0a = getRequest("type");$v09ccebee89ba1513e068086becf87990 = ini_get("include_path");$v6051d4b53435ea115d3b87188884de6b = $v09ccebee89ba1513e068086becf87990."images";$v7241dc88824509155730a4842f61d0c1 = $v6051d4b53435ea115d3b87188884de6b.$v78805a221a988e79ef3f42d7c5bfd418;$result = "<?xml version=\"1.0\" encoding=\"utf-8\"?><result>";if ($v599dcce2998a6b40b1e38e8c6006cb0a == "img") {$result.= "<type>image</type>";if (file_exists($v7241dc88824509155730a4842f61d0c1)) {$ve7b3d145b35627763a15342a550fe402 = new umiFile($v7241dc88824509155730a4842f61d0c1);if ($vb31beddacdf47202dcd1aed50a4fc121 = $ve7b3d145b35627763a15342a550fe402->delete()) {$result.= "<item>".$vb31beddacdf47202dcd1aed50a4fc121."</item>";}}}elseif ($v599dcce2998a6b40b1e38e8c6006cb0a == "dir") {}$result.= "</result>";header ("Content-type: text/xml; charset=utf-8");$this->flush($result);}public function createImanagerDirectory () {$vf68d2c3658a26018e43729b214bc84c9 = getRequest('requestId');$vc0bf0ed8212ea4bc5c24d1d8a0eed789 = strtolower(getRequest("type"));$v2ce9f0ddf8a74a96b76f1da1214ca0ec = ini_get("include_path");$vd3e73e87c121191720aa03fc8a866ab4 = $v2ce9f0ddf8a74a96b76f1da1214ca0ec.'images';$vfc19ae0e7cb9076cc4077381bbe0b168 = getRequest('name');$vdf38ceb6517abb2f95107c2b39cfc047 = "";if (strlen(getRequest('dir'))) {$vdf38ceb6517abb2f95107c2b39cfc047 = base64_decode(getRequest('dir'));}$vdf38ceb6517abb2f95107c2b39cfc047 = str_replace("\\", "/", $vdf38ceb6517abb2f95107c2b39cfc047);$vdf38ceb6517abb2f95107c2b39cfc047 = str_replace("//", "/", $vdf38ceb6517abb2f95107c2b39cfc047);if(strpos($vdf38ceb6517abb2f95107c2b39cfc047, $vd3e73e87c121191720aa03fc8a866ab4) === false || strpos($vdf38ceb6517abb2f95107c2b39cfc047, "..") !== false || strpos($vdf38ceb6517abb2f95107c2b39cfc047, "./") !== false) {$vdf38ceb6517abb2f95107c2b39cfc047 = $vd3e73e87c121191720aa03fc8a866ab4;}while (substr($vdf38ceb6517abb2f95107c2b39cfc047, -1)=="/") $vdf38ceb6517abb2f95107c2b39cfc047=substr($vdf38ceb6517abb2f95107c2b39cfc047, 0, (strlen($vdf38ceb6517abb2f95107c2b39cfc047)-1));if ($vc0bf0ed8212ea4bc5c24d1d8a0eed789 === "img") {if (isset($_FILES['pics'])) {$va013a6af08beabf2bde3d2818a73c0eb = umiImageFile::upload("pics", "panel_item", $vdf38ceb6517abb2f95107c2b39cfc047);if ($va013a6af08beabf2bde3d2818a73c0eb instanceof umiImageFile) {if (umiImageFile::getIsImage($va013a6af08beabf2bde3d2818a73c0eb->getFilePath())) {header("Content-type: text/html; charset=utf-8");$v285fe165c97e9d97d252997fe63243dc = self::__renderPanelItem($va013a6af08beabf2bde3d2818a73c0eb, true);$vdccc8c8d061984a56d899361b4934477 = <<<END
								<html>
									<head>
										<script type="text/javascript">
											var responseArgs = new Array();

											{$v285fe165c97e9d97d252997fe63243dc}

										</script>
									</head>
									<body>Upload ok!</body>
								</html>
END;       echo $vdccc8c8d061984a56d899361b4934477;}else {header("Content-type: text/html; charset=utf-8");$vdccc8c8d061984a56d899361b4934477 = <<<END
							<html>
								<head>
									<script type="text/javascript">
										var error = 'uploadError';
									</script>
								</head>
								<body>Upload error!</body>
							</html>
END;       echo $vdccc8c8d061984a56d899361b4934477;}}else {$vdccc8c8d061984a56d899361b4934477 = <<<END
							<html>
								<head>
									<script type="text/javascript">
										var error = 'uploadError';
									</script>
								</head>
								<body>Upload error!</body>
							</html>
END;       echo $vdccc8c8d061984a56d899361b4934477;}}}elseif ($vc0bf0ed8212ea4bc5c24d1d8a0eed789 === "dir") {header("Content-type: text/javascript; charset=utf-8");$v9608e936812ff564801c97aebf07fd3c = $vdf38ceb6517abb2f95107c2b39cfc047 . "/" . translit::convert($vfc19ae0e7cb9076cc4077381bbe0b168);@mkdir($v9608e936812ff564801c97aebf07fd3c);@chmod($v9608e936812ff564801c97aebf07fd3c, 0777);$vdccc8c8d061984a56d899361b4934477 = <<<END
					var responseArgs = new Array();

					jsonRequestsController.getInstance().reportRequest({$vf68d2c3658a26018e43729b214bc84c9}, responseArgs);
END;     $this->flush($vdccc8c8d061984a56d899361b4934477);}exit();}};?>
