<?php
 abstract class __rss_import_news {public function rss_list() {$vb3827f7111095f5ba1a9f49988fe9382 = umiObjectTypesCollection::getInstance();$v69ae498121c2d8e63f20c7144a0246d7 = umiObjectsCollection::getInstance();$v94757cae63fd3e398c0811a976dd6bbe = 22;$result = $v69ae498121c2d8e63f20c7144a0246d7->getGuidedItems($v94757cae63fd3e398c0811a976dd6bbe);$v15d61712450a686a7f365adf4fef581f = (string) getRequest('param0');if($v15d61712450a686a7f365adf4fef581f == "do") {$v21ffce5b8a6cc8cc6a41448dd69623c9 = Array(     "type_id" => $v94757cae63fd3e398c0811a976dd6bbe    );$this->saveEditedList("objects", $v21ffce5b8a6cc8cc6a41448dd69623c9);try {$this->import_feeds();}catch(publicException $ve1671797c52e15f763380b45e841ec32) {}$this->chooseRedirect();}$result = array_keys($result);$vfbb44b4487415b134bce9c790a27fe5e = sizeof($result);$this->setDataType("list");$this->setActionType("modify");$this->setDataRange($vfbb44b4487415b134bce9c790a27fe5e, 0);$v8d777f385d3dfec8815d20f7496026dc = $this->prepareData($result, "objects");$this->setData($v8d777f385d3dfec8815d20f7496026dc, $vfbb44b4487415b134bce9c790a27fe5e);return $this->doData();}public function import_feeds() {$v94757cae63fd3e398c0811a976dd6bbe = 22;$result = umiObjectsCollection::getInstance()->getGuidedItems($v94757cae63fd3e398c0811a976dd6bbe);foreach($result as $vb80bb7740288fda1f201890375a60c8f => $vb068931cc450442b63f5b3d276ea4297) {$va8cfde6331bd59eb2ac96f8911c4b666 = umiObjectsCollection::getInstance()->getObject($vb80bb7740288fda1f201890375a60c8f);$v572d4e421e5e6b9bc11d815e8a027112 = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("url");$v599dcce2998a6b40b1e38e8c6006cb0a = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("rss_type");$v42aefbae01d2dfd981f7da7d823d689e = $va8cfde6331bd59eb2ac96f8911c4b666->getValue("news_rubric");$this->import_feed($v572d4e421e5e6b9bc11d815e8a027112, $v599dcce2998a6b40b1e38e8c6006cb0a, $v42aefbae01d2dfd981f7da7d823d689e, $vb068931cc450442b63f5b3d276ea4297);}}public function import_feed($v572d4e421e5e6b9bc11d815e8a027112, $v94757cae63fd3e398c0811a976dd6bbe, $v42aefbae01d2dfd981f7da7d823d689e, $v36cd38f49b9afa08222c0dc9ebfe35eb = false) {$vb53f1dfc1530c815c3c3915e7028570a = umiObjectsCollection::getInstance()->getObject($v94757cae63fd3e398c0811a976dd6bbe);$v84aa805a9d919179ab8f8b24376e2ed7 = $vb53f1dfc1530c815c3c3915e7028570a->getName();$v09353387931db36c8af0e1b3658ddffe = new RSSFeed($v572d4e421e5e6b9bc11d815e8a027112);$v09353387931db36c8af0e1b3658ddffe->loadContent();switch($v84aa805a9d919179ab8f8b24376e2ed7) {case "RSS": {$v09353387931db36c8af0e1b3658ddffe->loadRSS();break;}case "ATOM": {$v09353387931db36c8af0e1b3658ddffe->loadAtom();break;}default: {return false;}}$v06c5b10273a69992d8c6933e294909fa = umiImportRelations::getInstance();$v0afd9202ba86aa11ce63ad7007e7990b = $v06c5b10273a69992d8c6933e294909fa->getSourceId($v572d4e421e5e6b9bc11d815e8a027112);if($v0afd9202ba86aa11ce63ad7007e7990b === false) {$v0afd9202ba86aa11ce63ad7007e7990b = $v06c5b10273a69992d8c6933e294909fa->addNewSource($v572d4e421e5e6b9bc11d815e8a027112);}$vb946c44d711ade3b061653732977d043 = umiHierarchyTypesCollection::getInstance()->getTypeByName("news", "item");$v0715f6d9497f93911417c9c324265771 = $vb946c44d711ade3b061653732977d043->getId();$result = $v09353387931db36c8af0e1b3658ddffe->returnItems();foreach($result as $v447b7147e84be512208dcc0995d67ebc) {$v0ad4f20d1443d9529ab35534c1ba505b = $v447b7147e84be512208dcc0995d67ebc->getTitle();$v1a912b36b5425c1c26b1eb3229beeff9 = $v447b7147e84be512208dcc0995d67ebc->getUrl();if($v06c5b10273a69992d8c6933e294909fa->getNewIdRelation($v0afd9202ba86aa11ce63ad7007e7990b, $v1a912b36b5425c1c26b1eb3229beeff9)) {continue;}$v362b104f69b080e3d7e60b54bdb00e5c = $v447b7147e84be512208dcc0995d67ebc->getContent();$vcb25ec393cd9b985a8f9f4679afba999 = $v447b7147e84be512208dcc0995d67ebc->getDate();$vcb25ec393cd9b985a8f9f4679afba999 = strtotime($vcb25ec393cd9b985a8f9f4679afba999);if(!isset($v7057e8409c7c531a1a6e9ac3df4ed549) || $v7057e8409c7c531a1a6e9ac3df4ed549 === false) {if(!isset($v42aefbae01d2dfd981f7da7d823d689e[0])) {continue;}$vc68ad910ed49ac65f21f1bf2c5dbf912 = umiHierarchy::getInstance()->getObjectInstances($v42aefbae01d2dfd981f7da7d823d689e[0]);if(count($vc68ad910ed49ac65f21f1bf2c5dbf912)) {list($v6be379826b20cc58475f636e33f4606b) = $vc68ad910ed49ac65f21f1bf2c5dbf912;$v7057e8409c7c531a1a6e9ac3df4ed549 = umiHierarchy::getInstance()->addElement($v6be379826b20cc58475f636e33f4606b, $v0715f6d9497f93911417c9c324265771, $v0ad4f20d1443d9529ab35534c1ba505b, $v0ad4f20d1443d9529ab35534c1ba505b);$v06c5b10273a69992d8c6933e294909fa->setIdRelation($v0afd9202ba86aa11ce63ad7007e7990b, $v1a912b36b5425c1c26b1eb3229beeff9, $v7057e8409c7c531a1a6e9ac3df4ed549);permissionsCollection::getInstance()->setDefaultPermissions($v7057e8409c7c531a1a6e9ac3df4ed549);}else {return false;}}if ($v8e2dcfd7e7e24b1ca76c1193f645902b = umiHierarchy::getInstance()->getElement($v7057e8409c7c531a1a6e9ac3df4ed549, true)) {$v8e2dcfd7e7e24b1ca76c1193f645902b->getObject()->setName($v0ad4f20d1443d9529ab35534c1ba505b);$v8e2dcfd7e7e24b1ca76c1193f645902b->setAltName($v0ad4f20d1443d9529ab35534c1ba505b);$v8e2dcfd7e7e24b1ca76c1193f645902b->setIsActive(true);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("title", $v0ad4f20d1443d9529ab35534c1ba505b);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("h1", $v0ad4f20d1443d9529ab35534c1ba505b);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("publish_time", $vcb25ec393cd9b985a8f9f4679afba999);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("anons", $v362b104f69b080e3d7e60b54bdb00e5c);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("content", $v362b104f69b080e3d7e60b54bdb00e5c);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("source", $v36cd38f49b9afa08222c0dc9ebfe35eb);$v8e2dcfd7e7e24b1ca76c1193f645902b->setValue("source_url", $v1a912b36b5425c1c26b1eb3229beeff9);$v8e2dcfd7e7e24b1ca76c1193f645902b->commit();$v7057e8409c7c531a1a6e9ac3df4ed549 = false;}}return true;}public function feedsImportListener($v4119639092e62c55ea8be348e4d9260d) {$v886bb73b3156b0aa24aac99d2de0b238 = &$v4119639092e62c55ea8be348e4d9260d->getRef("counter");$v7f2db423a49b305459147332fb01cf87 = &$v4119639092e62c55ea8be348e4d9260d->getRef("buffer");$v886bb73b3156b0aa24aac99d2de0b238++;$v7f2db423a49b305459147332fb01cf87[ __METHOD__] = $this->import_feeds();}};?>
