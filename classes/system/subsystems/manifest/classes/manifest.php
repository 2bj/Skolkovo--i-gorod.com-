<?php
 class manifest implements iManifest {public $hibernationsCountLeft = -1;protected $config, $callback, $transactions = Array(), $completed_transactions = Array(),  $enviroment, $includedActions = Array(), $externalParams = Array();public function __construct(iBaseXmlConfig $v2245023265ae4cf87d02c8b6ba991139) {$this->config = $v2245023265ae4cf87d02c8b6ba991139;$this->readConfig();}public function setCallback(iManifestCallback $v924a8ceeac17f54d3be3f8cdf1c04eb2) {$this->callback = $v924a8ceeac17f54d3be3f8cdf1c04eb2;}public function execute() {if($this->callback instanceof iManifestCallback) {$this->callback->onBeforeExecute();}$v15acaacfda9ca01f7203cd9d816b3600 = &$this->completed_transactions;foreach($this->transactions as $vf4d5b76a2418eba4baeabc1ed9142b54) {$this->executeTransaction($vf4d5b76a2418eba4baeabc1ed9142b54);}if($this->callback instanceof iManifestCallback) {$this->callback->onAfterExecute();}$this->hibernationsCountLeft = -1;}public function rollback() {if($this->callback instanceof iManifestCallback) {$this->callback->onBeforeRollback();}$v15acaacfda9ca01f7203cd9d816b3600 = array_reverse($this->completed_transactions);foreach($v15acaacfda9ca01f7203cd9d816b3600 as $vf4d5b76a2418eba4baeabc1ed9142b54) {$vf4d5b76a2418eba4baeabc1ed9142b54->rollback();}if($this->callback instanceof iManifestCallback) {$this->callback->onAfterRollback();}}public function hibernate() {$vb068931cc450442b63f5b3d276ea4297 = $this->config->getName();$v8d777f385d3dfec8815d20f7496026dc = serialize($this);$_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest'] = $v8d777f385d3dfec8815d20f7496026dc;if(isset($_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest_content'])) {$v9a0364b9e99bb480dd25e1f0284c8555 = $_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest_content'];}else {$v9a0364b9e99bb480dd25e1f0284c8555 = "";}$vffe092d7553a9541c273f0a156744a92 = ob_get_contents();$vffe092d7553a9541c273f0a156744a92 = explode("\n", $vffe092d7553a9541c273f0a156744a92);foreach($vffe092d7553a9541c273f0a156744a92 as $v341be97d9aff90c9978347f66f945b77) {$v341be97d9aff90c9978347f66f945b77 = trim($v341be97d9aff90c9978347f66f945b77);if(!$v341be97d9aff90c9978347f66f945b77) continue;if(strstr($v9a0364b9e99bb480dd25e1f0284c8555, $v341be97d9aff90c9978347f66f945b77) === false) {$v9a0364b9e99bb480dd25e1f0284c8555 .= $v341be97d9aff90c9978347f66f945b77 . "\n";}}$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace("\n\n", "\n", $v9a0364b9e99bb480dd25e1f0284c8555);@ob_clean();$_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest_content'] = $v9a0364b9e99bb480dd25e1f0284c8555;return true;}public function getName() {return $this->config->getName();}public function result($v123402c04dcfb6625f688f771a5fc05d = false) {$vb068931cc450442b63f5b3d276ea4297 = $this->getName();if(isset($_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest_content'])) {$v9a0364b9e99bb480dd25e1f0284c8555 = $_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest_content'];unset($_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]);$v9a0364b9e99bb480dd25e1f0284c8555 .= ob_get_contents();@ob_clean();return $v9a0364b9e99bb480dd25e1f0284c8555;}}public function addParam($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {$this->externalParams[$vb068931cc450442b63f5b3d276ea4297] = $v2063c1608d6e0baf80249c42e2be5804;}public function getParams() {return $this->externalParams;}public static function unhibernate($vb068931cc450442b63f5b3d276ea4297) {if(isset($_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297])) {foreach($_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest_included_actions'] as $v6d3e0bf7690b1052b0454d863d76906e) {list($vb35f75a8f71e57273061dd1a7e1c2ae5, $vefe90a8e604a7c840e88d03a67f6b7d8) = $v6d3e0bf7690b1052b0454d863d76906e;include_once atomicAction::getSourceFilePath($vb35f75a8f71e57273061dd1a7e1c2ae5, $vefe90a8e604a7c840e88d03a67f6b7d8);}$v7f5cb74af5d7f4b82200738fdbdc5a45 = $_SESSION['manifests'][$vb068931cc450442b63f5b3d276ea4297]['manifest'];$v7f5cb74af5d7f4b82200738fdbdc5a45 = unserialize($v7f5cb74af5d7f4b82200738fdbdc5a45);$v7f5cb74af5d7f4b82200738fdbdc5a45->execute();return $v7f5cb74af5d7f4b82200738fdbdc5a45->result(true);}}protected function executeTransaction(iTransaction $vf4d5b76a2418eba4baeabc1ed9142b54) {try {if($this->callback instanceof iManifestCallback) {$this->callback->onBeforeTransactionExecute($vf4d5b76a2418eba4baeabc1ed9142b54);$vf4d5b76a2418eba4baeabc1ed9142b54->setCallback($this->callback);}$vf4d5b76a2418eba4baeabc1ed9142b54->execute();if($this->callback instanceof iManifestCallback) {$this->callback->onAfterTransactionExecute($vf4d5b76a2418eba4baeabc1ed9142b54);}}catch(Exception $ve1671797c52e15f763380b45e841ec32) {if($this->callback instanceof iManifestCallback) {$this->callback->onException($ve1671797c52e15f763380b45e841ec32);}throw $ve1671797c52e15f763380b45e841ec32;}}protected function readConfig() {$this->loadEnviromentSettings();$this->loadTransactions();}protected function loadEnviromentSettings() {$v2245023265ae4cf87d02c8b6ba991139 = $this->config;$v883eece4e845ab86a4c126ac3fc0fafc = CURRENT_WORKING_DIR . '/' . $v2245023265ae4cf87d02c8b6ba991139->getValue("/manifest/enviroment/temporary-directory/@path");$v0a513639e176c02bf2fb427b1c58c5b0 = CURRENT_WORKING_DIR . '/' . $v2245023265ae4cf87d02c8b6ba991139->getValue("/manifest/enviroment/backup-directory/@path");$vd639d6bc05bd34d6d1aab3f3b60a60a0 = CURRENT_WORKING_DIR . '/' . $v2245023265ae4cf87d02c8b6ba991139->getValue("/manifest/enviroment/logger-directory/@path");$this->enviroment = Array(    "temporary-directory-path" => $v883eece4e845ab86a4c126ac3fc0fafc,    "backup-directory-path" => $v0a513639e176c02bf2fb427b1c58c5b0,    "logger-directory-path" => $vd639d6bc05bd34d6d1aab3f3b60a60a0   );}protected function loadTransactions() {$v2245023265ae4cf87d02c8b6ba991139 = $this->config;$v240bf022e685b0ee30ad9fe9e1fb5d5b = Array('name' => '@name', 'title' => '/title');$vc15b977dd99332ca8623fbdfb86827e8 = $v2245023265ae4cf87d02c8b6ba991139->getList("//transaction", $v240bf022e685b0ee30ad9fe9e1fb5d5b);foreach($vc15b977dd99332ca8623fbdfb86827e8 as $vcaf9b6b99962bf5c2264824231d7a40c) {$vb068931cc450442b63f5b3d276ea4297 = $vcaf9b6b99962bf5c2264824231d7a40c['name'];$vd5d3db1765287eef77d7927cc956f50a = $vcaf9b6b99962bf5c2264824231d7a40c['title'];$vf4d5b76a2418eba4baeabc1ed9142b54 = new transaction($vb068931cc450442b63f5b3d276ea4297, $this);$vf4d5b76a2418eba4baeabc1ed9142b54->setTitle($vd5d3db1765287eef77d7927cc956f50a);$this->loadActions($vf4d5b76a2418eba4baeabc1ed9142b54);$this->transactions[] = $vf4d5b76a2418eba4baeabc1ed9142b54;}}protected function loadActions(iTransaction $vf4d5b76a2418eba4baeabc1ed9142b54) {$v2245023265ae4cf87d02c8b6ba991139 = $this->config;$vc995ed7d342223eb83a2f308c1937fb4 = $vf4d5b76a2418eba4baeabc1ed9142b54->getName();$v240bf022e685b0ee30ad9fe9e1fb5d5b = Array('name' => '@name', 'title' => '/title', 'params' => '+params', 'manifest' => '@manifest', 'package' => '@package');$vebb67a4271abe715344471b0f16321f6 = $v2245023265ae4cf87d02c8b6ba991139->getList("//transaction[@name = '{$vc995ed7d342223eb83a2f308c1937fb4}']/action", $v240bf022e685b0ee30ad9fe9e1fb5d5b);foreach($vebb67a4271abe715344471b0f16321f6 as $v418c5509e2171d55b0aee5c2ea4442b5) {$vb068931cc450442b63f5b3d276ea4297 = $v418c5509e2171d55b0aee5c2ea4442b5['name'];$vd5d3db1765287eef77d7927cc956f50a = $v418c5509e2171d55b0aee5c2ea4442b5['title'];$v21ffce5b8a6cc8cc6a41448dd69623c9 = $v418c5509e2171d55b0aee5c2ea4442b5['params'];$vefe90a8e604a7c840e88d03a67f6b7d8 = $v418c5509e2171d55b0aee5c2ea4442b5['package'];try {$v418c5509e2171d55b0aee5c2ea4442b5 = atomicAction::load($vb068931cc450442b63f5b3d276ea4297, $vf4d5b76a2418eba4baeabc1ed9142b54, $vefe90a8e604a7c840e88d03a67f6b7d8);$this->addIncludedAction($vb068931cc450442b63f5b3d276ea4297, $vefe90a8e604a7c840e88d03a67f6b7d8);if($v418c5509e2171d55b0aee5c2ea4442b5 instanceof iAtomicAction) {$v418c5509e2171d55b0aee5c2ea4442b5->setTitle($vd5d3db1765287eef77d7927cc956f50a);$v418c5509e2171d55b0aee5c2ea4442b5->setParams($v21ffce5b8a6cc8cc6a41448dd69623c9);$v418c5509e2171d55b0aee5c2ea4442b5->setEnviroment($this->enviroment);$vf4d5b76a2418eba4baeabc1ed9142b54->addAtomicAction($v418c5509e2171d55b0aee5c2ea4442b5);}}catch(Exception $ve1671797c52e15f763380b45e841ec32) {if($this->callback instanceof iManifestCallback) {$this->callback->onException($ve1671797c52e15f763380b45e841ec32);}throw $ve1671797c52e15f763380b45e841ec32;}}}protected function addIncludedAction($vb068931cc450442b63f5b3d276ea4297, $vefe90a8e604a7c840e88d03a67f6b7d8) {$this->includedActions[] = Array($vb068931cc450442b63f5b3d276ea4297, $vefe90a8e604a7c840e88d03a67f6b7d8);$_SESSION['manifests'][$this->getName()]['manifest_included_actions'] = $this->includedActions;}};?>