<?php
    class umiMail implements iUmiMail {private $template, $is_commited = false, $is_sended = false,  $subject = "", $from_email = "no_reply@no_reply.ru", $from_name = "No_address",  $recipients = Array(),  $files = Array(),  $priority,  $mess_body, $mail_charset, $content, $boundary, $sTxtBody, $arrHeaders = array(), $arrContentImages = array(),  $arrAttachmentsImages = array(), $arrAttachments = array();private static $arrImagesCache = array(), $arrAttachmentsCache = array();public function __construct($v66f6181bcb4cff4cd38fbc804a036db6 = "default") {$this->template = $v66f6181bcb4cff4cd38fbc804a036db6;$this->boundary= md5(uniqid("myboundary"));$this->charset="utf-8";$this->priority="normal";}public function addRecipient($v0c83f57c786a0b4a39efab23731c7ebc, $vb068931cc450442b63f5b3d276ea4297 = false) {if(self::checkEmail($v0c83f57c786a0b4a39efab23731c7ebc)) {$vcaf9b6b99962bf5c2264824231d7a40c = Array($v0c83f57c786a0b4a39efab23731c7ebc, $vb068931cc450442b63f5b3d276ea4297);if(in_array($vcaf9b6b99962bf5c2264824231d7a40c, $this->recipients) === false) {$this->recipients[] = $vcaf9b6b99962bf5c2264824231d7a40c;}return true;}else {return false;}}public function setFrom($v0c83f57c786a0b4a39efab23731c7ebc, $vb068931cc450442b63f5b3d276ea4297 = false) {if(self::checkEmail($v0c83f57c786a0b4a39efab23731c7ebc)) {$this->from_email = $v0c83f57c786a0b4a39efab23731c7ebc;$this->from_name = str_replace(Array("\"", "'"), Array("\\\"", "\\'"), $vb068931cc450442b63f5b3d276ea4297);return true;}else {return false;}}public function setSubject($vb5e3374e43f6544852f7751dfc529100) {$this->subject = (string) str_replace("\n", " ", str_replace("\r", "", $vb5e3374e43f6544852f7751dfc529100));}public function setContent($va5374bce6e736150046560d951958df7) {$this->content = (string) $va5374bce6e736150046560d951958df7;$this->content = str_replace("&#037;", "%", $this->content);$this->content = templater::getInstance()->parseInput($this->content);}public function setTxtContent($va9cdadb3209df7e7f81aa1f3b9aaf4f0) {$this->sTxtBody = (string) $va9cdadb3209df7e7f81aa1f3b9aaf4f0;}public function setPriorityLevel($vc9e9a848920877e76685b2e4e76de38d = "normal") {switch($vc9e9a848920877e76685b2e4e76de38d) {case "highest": $this->priority='1 (Highest)';break;case "hight":   $this->priority='2 (Hight)';break;case "normal":  $this->priority='3 (Normal)';break;case "low":     $this->priority='4 (Low)';break;case "lowest":  $this->priority='5 (Lowest)';break;default:        $this->priority='3 (Normal)';break;}}public function setImportanceLevel($vc9e9a848920877e76685b2e4e76de38d = "normal") {}public function commit() {$this->is_commited = true;}private function formAttachement() {}private function addHTMLImage($va83269b957a782de9de17b330b439574, $v1a58436e50c600514b0e0e25873e5c40 = "image/jpeg") {$v7c610e4d8f0bc3df13a676914dbc6224 = $va83269b957a782de9de17b330b439574;if (strtolower(substr($va83269b957a782de9de17b330b439574, 0, 7)) !== 'http://') {if (!file_exists($va83269b957a782de9de17b330b439574)) {$v7c610e4d8f0bc3df13a676914dbc6224 = 'http://' . $_SERVER['SERVER_NAME'] . "/" . ltrim($va83269b957a782de9de17b330b439574 , '/');}}if (isset(self::$arrImagesCache[$v7c610e4d8f0bc3df13a676914dbc6224])) {$this->arrAttachmentsImages[$v7c610e4d8f0bc3df13a676914dbc6224] = self::$arrImagesCache[$v7c610e4d8f0bc3df13a676914dbc6224];$this->arrContentImages[$va83269b957a782de9de17b330b439574] = $v7c610e4d8f0bc3df13a676914dbc6224;return true;}if (false !== ($v5d60b99373796eecf6015de3d66712f0 = @file_get_contents($v7c610e4d8f0bc3df13a676914dbc6224))) {$v33d1ae3aef5ddc2f5717e8f4856a5797 = basename($v7c610e4d8f0bc3df13a676914dbc6224);$this->arrAttachmentsImages[$v7c610e4d8f0bc3df13a676914dbc6224] = array(      'name' => $v33d1ae3aef5ddc2f5717e8f4856a5797,      'path' => $va83269b957a782de9de17b330b439574,      'data' => $v5d60b99373796eecf6015de3d66712f0,      'content-type' => $v1a58436e50c600514b0e0e25873e5c40,      'sizes' => @getimagesize($va83269b957a782de9de17b330b439574),      'cid' => md5(uniqid(rand(), true))      );self::$arrImagesCache[$v7c610e4d8f0bc3df13a676914dbc6224] = $this->arrAttachmentsImages[$v7c610e4d8f0bc3df13a676914dbc6224];$this->arrContentImages[$va83269b957a782de9de17b330b439574] = $v7c610e4d8f0bc3df13a676914dbc6224;return true;}else {return false;}}private function addAttachment($vabdc6fca39c945587efec7f17113d48a, $v1a58436e50c600514b0e0e25873e5c40="application/octet-stream") {if (isset(self::$arrAttachmentsCache[$vabdc6fca39c945587efec7f17113d48a])) {$this->arrAttachments[$vabdc6fca39c945587efec7f17113d48a] = self::$arrAttachmentsCache[$vabdc6fca39c945587efec7f17113d48a];return true;}$v33d1ae3aef5ddc2f5717e8f4856a5797 = basename($vabdc6fca39c945587efec7f17113d48a);if (false !== ($v30131c31f301d25a705810f37232ef77 = @file_get_contents($vabdc6fca39c945587efec7f17113d48a))) {$this->arrAttachments[$vabdc6fca39c945587efec7f17113d48a] = array(      'name' => $v33d1ae3aef5ddc2f5717e8f4856a5797,      'path' => $vabdc6fca39c945587efec7f17113d48a,      'data' => $v30131c31f301d25a705810f37232ef77,      'content-type' => $v1a58436e50c600514b0e0e25873e5c40,      'disposition' => 'attachment',      'cid' => md5(uniqid(rand(), true))      );self::$arrAttachmentsCache[$vabdc6fca39c945587efec7f17113d48a] = $this->arrAttachments[$vabdc6fca39c945587efec7f17113d48a];return true;}else {return false;}}public static function clearFilesCache() {self::$arrAttachmentsCache = array();self::$arrImagesCache = array();}public function getHeaders($vf28cf985778b731802febf0cd05df0c2 = array(), $v57c13771c665e3e754d45cf1f203bdae = false) {$v99b7ac2b500826e1b6e5496c094befbe =  array();$v99b7ac2b500826e1b6e5496c094befbe['MIME-Version'] = '1.0';$v99b7ac2b500826e1b6e5496c094befbe = array_merge($v99b7ac2b500826e1b6e5496c094befbe, $vf28cf985778b731802febf0cd05df0c2);$this->arrHeaders = $v57c13771c665e3e754d45cf1f203bdae? array_merge($this->arrHeaders, $v99b7ac2b500826e1b6e5496c094befbe): array_merge($v99b7ac2b500826e1b6e5496c094befbe, $this->arrHeaders);return $this->encodeHeaders($this->arrHeaders);}private function encodeHeaders($v99b7ac2b500826e1b6e5496c094befbe) {$v76e5bebbd31002d9f9bdc30cf3f9e80e = array();foreach ($v99b7ac2b500826e1b6e5496c094befbe as $vcba6edd8118e56459daee1a4a52365e1 => $v2c0f0eef009b52594d1845816b697bed) {$v6cddaf13bfc401291a3950ae3689a443 = preg_split("/(\s)/", $v2c0f0eef009b52594d1845816b697bed, -1, PREG_SPLIT_DELIM_CAPTURE);$va6996137ab5b77c55984187e30bc413f = "";$v0726147c36ed3459eb2dc69141d33b3f = "";foreach ($v6cddaf13bfc401291a3950ae3689a443 as $v2c0f0eef009b52594d1845816b697bed) {if (!trim($v2c0f0eef009b52594d1845816b697bed)) {$va6996137ab5b77c55984187e30bc413f .= $v2c0f0eef009b52594d1845816b697bed;continue;}else {$v2c0f0eef009b52594d1845816b697bed = $va6996137ab5b77c55984187e30bc413f . $v2c0f0eef009b52594d1845816b697bed;$va6996137ab5b77c55984187e30bc413f = "";}$v1c0d2979616c420cd68d69d39ee78673 = $v0134137bbc984a9b06209bcff860206f = '';if ($v2c0f0eef009b52594d1845816b697bed{0}== "\"") {$v2c0f0eef009b52594d1845816b697bed = substr($v2c0f0eef009b52594d1845816b697bed, 1);$v1c0d2979616c420cd68d69d39ee78673 = "\"";}if ($v2c0f0eef009b52594d1845816b697bed{strlen($v2c0f0eef009b52594d1845816b697bed)-1}== "\"") {$v2c0f0eef009b52594d1845816b697bed = substr($v2c0f0eef009b52594d1845816b697bed, 0, -1);$v0134137bbc984a9b06209bcff860206f = "\"";}if (preg_match('/[\x80-\xFF]{1}/', $v2c0f0eef009b52594d1845816b697bed)) {$v2c0f0eef009b52594d1845816b697bed = iconv_mime_encode($vcba6edd8118e56459daee1a4a52365e1, $v2c0f0eef009b52594d1845816b697bed, array('input-charset' => 'UTF-8', 'output-charset' => 'UTF-8', 'line-break-chars'=> umiMimePart::UMI_MIMEPART_CRLF));$v2c0f0eef009b52594d1845816b697bed = preg_replace("/^{$vcba6edd8118e56459daee1a4a52365e1}\:\ /", "", $v2c0f0eef009b52594d1845816b697bed);}$v0726147c36ed3459eb2dc69141d33b3f .= $v1c0d2979616c420cd68d69d39ee78673 . $v2c0f0eef009b52594d1845816b697bed . $v0134137bbc984a9b06209bcff860206f;}$v76e5bebbd31002d9f9bdc30cf3f9e80e[$vcba6edd8118e56459daee1a4a52365e1] = $v0726147c36ed3459eb2dc69141d33b3f;}return $v76e5bebbd31002d9f9bdc30cf3f9e80e;}private function parseContent() {$v5829f3773b9c8e66e039b5d1a5d94418 = xslTemplater::getInstance()->setIsInited(false);$v9a0364b9e99bb480dd25e1f0284c8555 = $this->content;try {list($vb6b2481e9a1cb5fbe264662343183d95) = def_module::loadTemplates("tpls/mail/" . $this->template . ".tpl", "body");}catch(publicException $ve1671797c52e15f763380b45e841ec32) {$vb6b2481e9a1cb5fbe264662343183d95 = "%header%\n%content%";}$vfca1bff8ad8b3a8585abfb0ad523ba42 = Array();$vfca1bff8ad8b3a8585abfb0ad523ba42['header'] = $this->subject;$vfca1bff8ad8b3a8585abfb0ad523ba42['content'] = $this->content;$vb01a74494194b212fcf94b6a6364e046 = def_module::parseTemplate($vb6b2481e9a1cb5fbe264662343183d95, $vfca1bff8ad8b3a8585abfb0ad523ba42);$v52d3a7c11fa6e88478f6437456cc19af = array();$vb391d9fc0580b82c8487c853e5415c19 = array();if (preg_match_all('#<\w+[^>]+\s((?i)src|background|href(?-i))\s*=\s*(["\']?)?([\w\?=\.\-_:\/]+.(jpeg|jpg|gif|png|bmp))\2#i', $vb01a74494194b212fcf94b6a6364e046, $v020aae5ccf424487d5c7cecc391f9521)) {$v52d3a7c11fa6e88478f6437456cc19af = isset($v020aae5ccf424487d5c7cecc391f9521[3])? $v020aae5ccf424487d5c7cecc391f9521[3]: array();}if (preg_match_all('#(?i)url(?-i)\(\s*(["\']?)([\w\.\-_:\/]+.(jpeg|jpg|gif|png|bmp))\1\s*\)#', $vb01a74494194b212fcf94b6a6364e046, $v020aae5ccf424487d5c7cecc391f9521)) {$vb391d9fc0580b82c8487c853e5415c19 = isset($v020aae5ccf424487d5c7cecc391f9521[2])? $v020aae5ccf424487d5c7cecc391f9521[2]: array();}$v34c033f0f84cdc7d18f8302893c97eeb = array_unique(array_merge($v52d3a7c11fa6e88478f6437456cc19af,$vb391d9fc0580b82c8487c853e5415c19));foreach ($v34c033f0f84cdc7d18f8302893c97eeb as $v28b569d3f9a3e63f94ca6fad969475f9) {$this->addHTMLImage($v28b569d3f9a3e63f94ca6fad969475f9);}$v61adcb2cd3bec191f3057b6c9bef9158 = cmsController::getInstance()->getCurrentDomain()->getHost();$vb01a74494194b212fcf94b6a6364e046 = preg_replace('#(href)\s*=\s*(["\']?)?(/([^\s"\']+))#i', '$1=$2http://'.$v61adcb2cd3bec191f3057b6c9bef9158.'$3', $vb01a74494194b212fcf94b6a6364e046);xslTemplater::getInstance()->setIsInited($v5829f3773b9c8e66e039b5d1a5d94418);return $vb01a74494194b212fcf94b6a6364e046;}public function send() {if($this->is_sended) return true;if($this->content!="") {$this->arrHeaders["From"] = ($this->from_name?"\"".$this->from_name."\" ":"")."<".$this->from_email.">";$this->arrHeaders["X-Mailer"] = "UMI.CMS";$this->arrHeaders["Reply-To"] = ($this->from_name?"\"".$this->from_name."\" ":"")."<".$this->from_email.">\n";$this->arrHeaders["X-Priority"] = $this->priority."\n";$v9a0364b9e99bb480dd25e1f0284c8555 = $this->parseContent();foreach ($this->arrContentImages as $va83269b957a782de9de17b330b439574 => $v7c610e4d8f0bc3df13a676914dbc6224) {if (!isset($this->arrAttachmentsImages[$v7c610e4d8f0bc3df13a676914dbc6224])) continue;$v8b9f60798e84fcd02a6f16731fad0d75 = $this->arrAttachmentsImages[$v7c610e4d8f0bc3df13a676914dbc6224];$vaa5bb0b328edf04bdeade3062181e7ae = array(         '/(\s)((?i)src|background|href(?-i))\s*=\s*(["\']?)' . preg_quote($va83269b957a782de9de17b330b439574, '/') . '\3/',         '/(?i)url(?-i)\(\s*(["\']?)' . preg_quote($va83269b957a782de9de17b330b439574, '/') . '\1\s*\)/'         );$v765a7aaaad7c01a34106aa80b74e28b7 = array(         '\1\2=\3cid:' . $v8b9f60798e84fcd02a6f16731fad0d75['cid'] .'\3',         'url(\1cid:' . $v8b9f60798e84fcd02a6f16731fad0d75['cid'] . '\2)'         );$v9a0364b9e99bb480dd25e1f0284c8555 = preg_replace($vaa5bb0b328edf04bdeade3062181e7ae, $v765a7aaaad7c01a34106aa80b74e28b7, $v9a0364b9e99bb480dd25e1f0284c8555);}foreach ($this->files as $v3b569bcd1bf089908a7a85ead9f9ab9a) {$this->addAttachment($v3b569bcd1bf089908a7a85ead9f9ab9a->getFilePath());}$v46f2f0d388f714c268d510d3ddbdfe88 = (bool) count($this->arrAttachments);$va491666beca97718aeb4d201ac898bb5 = (bool) count($this->arrAttachmentsImages);$vcae3e24516df3c71ced3f01fc0ee6c65 = (bool) strlen($v9a0364b9e99bb480dd25e1f0284c8555);$vdb9129f4c75531384e13d0a0d7dae6e9 = (bool) strlen($this->sTxtBody);$v69476a86c388a5b8e4e18eeaea2ae2ba = !$vcae3e24516df3c71ced3f01fc0ee6c65 && (bool) strlen($v9a0364b9e99bb480dd25e1f0284c8555);$vd6d25fae8ec76ccadc5deee4ee0c4896 =  new umiMimePart('', array());switch (true) {case $v69476a86c388a5b8e4e18eeaea2ae2ba && !$v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addTextPart($this->sTxtBody);break;case !$vcae3e24516df3c71ced3f01fc0ee6c65 && !$vdb9129f4c75531384e13d0a0d7dae6e9 && $v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addMixedPart();foreach ($this->arrAttachments as $v5d659066115284c2f4023431d517fe38) {$vd6d25fae8ec76ccadc5deee4ee0c4896->addAttachmentPart($v5d659066115284c2f4023431d517fe38);}break;case $v69476a86c388a5b8e4e18eeaea2ae2ba && $v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addMixedPart();$vd6d25fae8ec76ccadc5deee4ee0c4896->addTextPart($this->sTxtBody);foreach ($this->arrAttachments as $v5d659066115284c2f4023431d517fe38) {$vd6d25fae8ec76ccadc5deee4ee0c4896->addAttachmentPart($v5d659066115284c2f4023431d517fe38);}break;case $vcae3e24516df3c71ced3f01fc0ee6c65 && !$va491666beca97718aeb4d201ac898bb5 && !$v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addMixedPart();if ($vdb9129f4c75531384e13d0a0d7dae6e9) {$vb09cfd144243e0299ce0a896ca163843 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addAlternativePart();$vb09cfd144243e0299ce0a896ca163843->addTextPart($this->sTxtBody);$vb09cfd144243e0299ce0a896ca163843->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);}else {$vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);}break;case $vcae3e24516df3c71ced3f01fc0ee6c65 && $va491666beca97718aeb4d201ac898bb5 && !$v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addRelatedPart();if ($vdb9129f4c75531384e13d0a0d7dae6e9) {$vb09cfd144243e0299ce0a896ca163843 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addAlternativePart();$vb09cfd144243e0299ce0a896ca163843->addTextPart($this->sTxtBody);$vb09cfd144243e0299ce0a896ca163843->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);}else {$vd6d25fae8ec76ccadc5deee4ee0c4896->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);}foreach ($this->arrAttachmentsImages as $v8b9f60798e84fcd02a6f16731fad0d75) {$vd6d25fae8ec76ccadc5deee4ee0c4896->addHtmlImagePart($v8b9f60798e84fcd02a6f16731fad0d75);}break;case $vcae3e24516df3c71ced3f01fc0ee6c65 && !$va491666beca97718aeb4d201ac898bb5 && $v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addMixedPart();if ($vdb9129f4c75531384e13d0a0d7dae6e9) {$vb09cfd144243e0299ce0a896ca163843 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addAlternativePart();$vb09cfd144243e0299ce0a896ca163843->addTextPart($this->sTxtBody);$vb09cfd144243e0299ce0a896ca163843->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);}else {$vd6d25fae8ec76ccadc5deee4ee0c4896->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);}foreach ($this->arrAttachments as $v5d659066115284c2f4023431d517fe38) {$vd6d25fae8ec76ccadc5deee4ee0c4896->addAttachmentPart($v5d659066115284c2f4023431d517fe38);}break;case $vcae3e24516df3c71ced3f01fc0ee6c65 && $va491666beca97718aeb4d201ac898bb5 && $v46f2f0d388f714c268d510d3ddbdfe88:      $vd6d25fae8ec76ccadc5deee4ee0c4896 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addMixedPart();if ($vdb9129f4c75531384e13d0a0d7dae6e9) {$vb09cfd144243e0299ce0a896ca163843 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addAlternativePart();$vb09cfd144243e0299ce0a896ca163843->addTextPart($this->sTxtBody);$v692f1e5fb84fbda80e99a0ce848bc2b1 = $vb09cfd144243e0299ce0a896ca163843->addRelatedPart();}else {$v692f1e5fb84fbda80e99a0ce848bc2b1 = $vd6d25fae8ec76ccadc5deee4ee0c4896->addRelatedPart();}$v692f1e5fb84fbda80e99a0ce848bc2b1->addHtmlPart($v9a0364b9e99bb480dd25e1f0284c8555);foreach ($this->arrAttachmentsImages as $v8b9f60798e84fcd02a6f16731fad0d75) {$v692f1e5fb84fbda80e99a0ce848bc2b1->addHtmlImagePart($v8b9f60798e84fcd02a6f16731fad0d75);}foreach ($this->arrAttachments as $v5d659066115284c2f4023431d517fe38) {$vd6d25fae8ec76ccadc5deee4ee0c4896->addAttachmentPart($v5d659066115284c2f4023431d517fe38);}break;}$v766454ac4fb7a41c6ebf95bfb8130318 = $vd6d25fae8ec76ccadc5deee4ee0c4896->encodePart();$this->mess_body = $v766454ac4fb7a41c6ebf95bfb8130318['body'];$v99b7ac2b500826e1b6e5496c094befbe = $this->getHeaders($v766454ac4fb7a41c6ebf95bfb8130318['headers'], true);$v5c27dddc7f7c23c046aa4f514147f839 = "";foreach ($v99b7ac2b500826e1b6e5496c094befbe as $vcba6edd8118e56459daee1a4a52365e1 => $v2c0f0eef009b52594d1845816b697bed) {$v5c27dddc7f7c23c046aa4f514147f839 .= $vcba6edd8118e56459daee1a4a52365e1.": ".$v2c0f0eef009b52594d1845816b697bed . umiMimePart::UMI_MIMEPART_CRLF;}foreach($this->recipients as $ve6a967f2c984f079715d7daa3f9b5f90) {$v4b5789f850e658bcfb56173ae0a5b7ca = trim(str_replace("\n", " ", $ve6a967f2c984f079715d7daa3f9b5f90[1]));$v0a1cb7958085865f48edbe2a30158589 = trim($ve6a967f2c984f079715d7daa3f9b5f90[0]);if (!strlen($v0a1cb7958085865f48edbe2a30158589)) continue;$v22c7ae03c1d7ec9ffafe48c116510eed = $v0a1cb7958085865f48edbe2a30158589;if (strlen($v4b5789f850e658bcfb56173ae0a5b7ca)) {$v22c7ae03c1d7ec9ffafe48c116510eed = iconv_mime_encode("", $ve6a967f2c984f079715d7daa3f9b5f90[1], array('input-charset' => 'UTF-8', 'output-charset' => 'UTF-8', 'line-break-chars'=> ''));$v22c7ae03c1d7ec9ffafe48c116510eed = ltrim($v22c7ae03c1d7ec9ffafe48c116510eed, " :");$v22c7ae03c1d7ec9ffafe48c116510eed .= " <".$v0a1cb7958085865f48edbe2a30158589.">";}$v18510ea4e30a52ff7b53e7b5e2691d83 = "";if (strlen($this->subject)) {$v18510ea4e30a52ff7b53e7b5e2691d83 = iconv_mime_encode("", $this->subject, array('input-charset' => 'UTF-8', 'output-charset' => 'UTF-8', 'line-break-chars'=> ''));$v18510ea4e30a52ff7b53e7b5e2691d83 = ltrim($v18510ea4e30a52ff7b53e7b5e2691d83, " :");}$v6da648158add0c53655351ff6ac29a12 = mail($v22c7ae03c1d7ec9ffafe48c116510eed, $v18510ea4e30a52ff7b53e7b5e2691d83, $this->mess_body, $v5c27dddc7f7c23c046aa4f514147f839);$v161c9aaa4fe035e7b2f465bc59f3ab45 = new umiEventPoint("core_sendmail");$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("to", $v22c7ae03c1d7ec9ffafe48c116510eed);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("subject", $v18510ea4e30a52ff7b53e7b5e2691d83);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("body", $this->mess_body);$v161c9aaa4fe035e7b2f465bc59f3ab45->setParam("headers", $v5c27dddc7f7c23c046aa4f514147f839);$v161c9aaa4fe035e7b2f465bc59f3ab45->setMode("after");$v161c9aaa4fe035e7b2f465bc59f3ab45->call();}$this->is_sended = true;}else return false;}public function attachFile(umiFile $v8c7dd922ad47494fc02c388e12c00eac) {if(in_array($v8c7dd922ad47494fc02c388e12c00eac, $this->files) === false) {$this->files[] = $v8c7dd922ad47494fc02c388e12c00eac;return true;}}public function __destruct() {if($this->is_commited && !$this->is_sended) {$this->send();}}public static function checkEmail($v0c83f57c786a0b4a39efab23731c7ebc) {return (bool) eregi("^[a-z0-9\._-]+@[a-z0-9\._-]+\.[a-z]{2,4}\$", $v0c83f57c786a0b4a39efab23731c7ebc);}protected function quoted_printable_encode($v1cb251ec0d568de6a929b520c4aed8d1, $v1f2ee5a302d4ab6b539e6339acd0eda0 = 'utf-8') {$v2fa47f7c65fec19cc163b195725e3844 = strlen($v1cb251ec0d568de6a929b520c4aed8d1);for($v67b8601a11e47a9ee3bf08ddfd0b79ba = "", $v6438c669e0d0de98e6929c2cc0fac474 = 0, $v97a57645a3f0e1518f8c9f4d340d4c4f = "", $v6a992d5529f459a44fee58c733255e86 = 0;$v6a992d5529f459a44fee58c733255e86 < $v2fa47f7c65fec19cc163b195725e3844;$v6a992d5529f459a44fee58c733255e86++) {$va956161a69928cd130a889b88082fb6e=substr($v1cb251ec0d568de6a929b520c4aed8d1,$v6a992d5529f459a44fee58c733255e86,1);$v70a17ffa722a3985b86d30b034ad06d7=Ord($va956161a69928cd130a889b88082fb6e);$v97a57645a3f0e1518f8c9f4d340d4c4f=0;switch($v70a17ffa722a3985b86d30b034ad06d7) {case 9:     case 32:      if($v1f2ee5a302d4ab6b539e6339acd0eda0 == "") {$v3d96da8d7724c7fa903db7a4864707af=$v67b8601a11e47a9ee3bf08ddfd0b79ba;$v67b8601a11e47a9ee3bf08ddfd0b79ba=$va956161a69928cd130a889b88082fb6e;$va956161a69928cd130a889b88082fb6e= "";}else {if($v70a17ffa722a3985b86d30b034ad06d7==32) {$va956161a69928cd130a889b88082fb6e= "_";}else {$v97a57645a3f0e1518f8c9f4d340d4c4f=1;}}break;case 10:     case 13:      if($v67b8601a11e47a9ee3bf08ddfd0b79ba!= "") {if($v1f2ee5a302d4ab6b539e6339acd0eda0 == "" && ($v6438c669e0d0de98e6929c2cc0fac474+3) > 75) {$v4b719acee4a1d5e30577f59e80d06205.= "=\n";$v6438c669e0d0de98e6929c2cc0fac474=0;}$v4b719acee4a1d5e30577f59e80d06205 .= sprintf("=%02X", ord($v67b8601a11e47a9ee3bf08ddfd0b79ba));$v6438c669e0d0de98e6929c2cc0fac474 += 3;$v67b8601a11e47a9ee3bf08ddfd0b79ba = "";}$v4b719acee4a1d5e30577f59e80d06205 .= $va956161a69928cd130a889b88082fb6e;$v6438c669e0d0de98e6929c2cc0fac474 = 0;continue 2;default:      if($v70a17ffa722a3985b86d30b034ad06d7 > 127 || $v70a17ffa722a3985b86d30b034ad06d7 < 32 || $va956161a69928cd130a889b88082fb6e == "=" || ($v1f2ee5a302d4ab6b539e6339acd0eda0 != "" && ($va956161a69928cd130a889b88082fb6e == "?" || $va956161a69928cd130a889b88082fb6e == "_" || $va956161a69928cd130a889b88082fb6e == "(" || $va956161a69928cd130a889b88082fb6e == ")"))) {$v97a57645a3f0e1518f8c9f4d340d4c4f=1;}break;}if($v67b8601a11e47a9ee3bf08ddfd0b79ba != "") {if($v1f2ee5a302d4ab6b539e6339acd0eda0 == "" && ($v6438c669e0d0de98e6929c2cc0fac474+1) > 75) {$v4b719acee4a1d5e30577f59e80d06205 .= "=\n";$v6438c669e0d0de98e6929c2cc0fac474 = 0;}$v4b719acee4a1d5e30577f59e80d06205 .= $v67b8601a11e47a9ee3bf08ddfd0b79ba;$v6438c669e0d0de98e6929c2cc0fac474++;$v67b8601a11e47a9ee3bf08ddfd0b79ba = "";}if($va956161a69928cd130a889b88082fb6e != "") {if($v97a57645a3f0e1518f8c9f4d340d4c4f) {$va956161a69928cd130a889b88082fb6e = sprintf("=%02X", $v70a17ffa722a3985b86d30b034ad06d7);$v7e3405b5532d0adb7c0cc2271b810ca5 = 3;}else {$v7e3405b5532d0adb7c0cc2271b810ca5 = 1;}if($v1f2ee5a302d4ab6b539e6339acd0eda0 == "" && ($v6438c669e0d0de98e6929c2cc0fac474 + $v7e3405b5532d0adb7c0cc2271b810ca5) > 75) {$v4b719acee4a1d5e30577f59e80d06205 .= "=\n";$v6438c669e0d0de98e6929c2cc0fac474 = 0;}$v4b719acee4a1d5e30577f59e80d06205 .= $va956161a69928cd130a889b88082fb6e;$v6438c669e0d0de98e6929c2cc0fac474 += $v7e3405b5532d0adb7c0cc2271b810ca5;}}if($v67b8601a11e47a9ee3bf08ddfd0b79ba != "") {if($v1f2ee5a302d4ab6b539e6339acd0eda0 == "" && ($v6438c669e0d0de98e6929c2cc0fac474+3) > 75) {$v4b719acee4a1d5e30577f59e80d06205 .= "=\n";$v4b719acee4a1d5e30577f59e80d06205 .= sprintf("=%02X", ord($v67b8601a11e47a9ee3bf08ddfd0b79ba));}if($v1f2ee5a302d4ab6b539e6339acd0eda0 != "" && $v1cb251ec0d568de6a929b520c4aed8d1 != $v4b719acee4a1d5e30577f59e80d06205) {return( "=?$v1f2ee5a302d4ab6b539e6339acd0eda0?q?$v4b719acee4a1d5e30577f59e80d06205?=");}else {return($v4b719acee4a1d5e30577f59e80d06205);}}}};?>