<?php
 class umiEventsController implements iUmiEventsController {protected static $eventListeners = Array();private   static $oInstance  = null;protected function __construct() {$this->loadEventListeners();}public static function getInstance() {if(self::$oInstance == null) {self::$oInstance = new umiEventsController();}return self::$oInstance;}protected function loadEventListeners() {$v6c63406410aa57b3c97b88d3feb09990 = regedit::getInstance()->getList("//modules");foreach($v6c63406410aa57b3c97b88d3feb09990 as $v47c80780ab608cc046f2a6e6f071feb6) {$v22884db148f0ffb0d830ba431102b0b5 = $v47c80780ab608cc046f2a6e6f071feb6[0];$this->loadModuleEventListeners($v22884db148f0ffb0d830ba431102b0b5);}}protected function loadModuleEventListeners($v22884db148f0ffb0d830ba431102b0b5) {$vd6fe1d0be6347b8ef2427fa629c04485 = "./classes/modules/{$v22884db148f0ffb0d830ba431102b0b5}/events.php";$v8c889aaa2bdffb33c678609ca3bddac8 = "./classes/modules/{$v22884db148f0ffb0d830ba431102b0b5}/custom_events.php";$this->tryLoadEvents($v8c889aaa2bdffb33c678609ca3bddac8);$this->tryLoadEvents($vd6fe1d0be6347b8ef2427fa629c04485);}protected function tryLoadEvents($vd6fe1d0be6347b8ef2427fa629c04485) {if(file_exists($vd6fe1d0be6347b8ef2427fa629c04485)) {require $vd6fe1d0be6347b8ef2427fa629c04485;return true;}else {return false;}}protected function searchEventListeners($v53cc4db543d7a569e51c1d76ac6f278e) {$result = array();foreach(self::$eventListeners as $v09d7ec30552b0eded7e4bfad71fac83d) {if($v09d7ec30552b0eded7e4bfad71fac83d->getEventId() == $v53cc4db543d7a569e51c1d76ac6f278e) {$result[] = $v09d7ec30552b0eded7e4bfad71fac83d;}}return $result;}protected function executeCallback($v924a8ceeac17f54d3be3f8cdf1c04eb2, $v70e8822b2e035fa3777d666207aeafa8) {$v22884db148f0ffb0d830ba431102b0b5 = $v924a8ceeac17f54d3be3f8cdf1c04eb2->getCallbackModule();$vea9f6aca279138c58f705c8d4cb4b8ce = $v924a8ceeac17f54d3be3f8cdf1c04eb2->getCallbackMethod();if($v47a12618c9a47b69a3050e6b9313a351 = cmsController::getInstance()->getModule($v22884db148f0ffb0d830ba431102b0b5)) {$v47a12618c9a47b69a3050e6b9313a351->$vea9f6aca279138c58f705c8d4cb4b8ce($v70e8822b2e035fa3777d666207aeafa8);}else {throw new coreException("Cannot find module \"{$v22884db148f0ffb0d830ba431102b0b5}\"");}}public function callEvent(iUmiEventPoint $v70e8822b2e035fa3777d666207aeafa8) {$v53cc4db543d7a569e51c1d76ac6f278e = $v70e8822b2e035fa3777d666207aeafa8->getEventId();$v89885eff552e13893a0dade8efb1b731 = $this->searchEventListeners($v53cc4db543d7a569e51c1d76ac6f278e);$v89885eff552e13893a0dade8efb1b731 = $this->sortCallbacksByPriority($v89885eff552e13893a0dade8efb1b731);$v2165e4fa5bddb65a31f6a0c495c2fa37 = array('executed' => array(), 'failed' => array(), 'breaked' => array());foreach($v89885eff552e13893a0dade8efb1b731 as $v924a8ceeac17f54d3be3f8cdf1c04eb2) {try {$this->executeCallback($v924a8ceeac17f54d3be3f8cdf1c04eb2, $v70e8822b2e035fa3777d666207aeafa8);$v2165e4fa5bddb65a31f6a0c495c2fa37['executed'][] = $v924a8ceeac17f54d3be3f8cdf1c04eb2;}catch (baseException $ve1671797c52e15f763380b45e841ec32) {$v2165e4fa5bddb65a31f6a0c495c2fa37['failed'][] = $v924a8ceeac17f54d3be3f8cdf1c04eb2;if($v924a8ceeac17f54d3be3f8cdf1c04eb2->getIsCritical()) {throw $ve1671797c52e15f763380b45e841ec32;}else {continue;}}catch (breakException $ve1671797c52e15f763380b45e841ec32) {$v2165e4fa5bddb65a31f6a0c495c2fa37['breaked'][] = $v924a8ceeac17f54d3be3f8cdf1c04eb2;break;}}return $v2165e4fa5bddb65a31f6a0c495c2fa37;}protected function sortCallbacksByPriority($v89885eff552e13893a0dade8efb1b731) {$result = Array();$v3d801aa532c1cec3ee82d87a99fdf63f = Array();foreach($v89885eff552e13893a0dade8efb1b731 as $v924a8ceeac17f54d3be3f8cdf1c04eb2) {$v3d801aa532c1cec3ee82d87a99fdf63f[$v924a8ceeac17f54d3be3f8cdf1c04eb2->getPriority()][] = $v924a8ceeac17f54d3be3f8cdf1c04eb2;}ksort($v3d801aa532c1cec3ee82d87a99fdf63f);foreach($v3d801aa532c1cec3ee82d87a99fdf63f as $v6a3d252c501d3bde07ddc1f57a683937) {foreach($v6a3d252c501d3bde07ddc1f57a683937 as $v924a8ceeac17f54d3be3f8cdf1c04eb2) {$result[] = $v924a8ceeac17f54d3be3f8cdf1c04eb2;}}return $result;}static public function registerEventListener(iUmiEventListener $v09d7ec30552b0eded7e4bfad71fac83d) {self::$eventListeners[] = $v09d7ec30552b0eded7e4bfad71fac83d;}};?>