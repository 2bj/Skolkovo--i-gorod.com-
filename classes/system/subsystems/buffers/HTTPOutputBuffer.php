<?php
 class HTTPOutputBuffer extends outputBuffer {protected   $charset  = 'utf-8',   $contentType = 'text/html',   $headers  = array(),   $headersSended = false,   $status   = '200 Ok',   $options  = array(    'compression' => true,    'quick-edit' => true,    'generation-time' => true,    'send-stat-id' => true   );public function __construct() {parent::__construct();session_start();$this->checkHTTPAuth();}public function send() {$this->sendHeaders();echo $this->buffer;$this->clear();}public function status($v9acb44549b41563697bb490144ec6258 = false) {if($v9acb44549b41563697bb490144ec6258) $this->status = $v9acb44549b41563697bb490144ec6258;return $this->status;}public function charset($vdbd153490a1c3720a970a611afc4371c = false) {if($vdbd153490a1c3720a970a611afc4371c) $this->charset = $vdbd153490a1c3720a970a611afc4371c;return $this->charset;}public function contentType($vdf5feafab86601ea0e1e6fe6e20df6c5 = false) {if($vdf5feafab86601ea0e1e6fe6e20df6c5) $this->contentType = $vdf5feafab86601ea0e1e6fe6e20df6c5;return $this->contentType;}public function getHTTPRequestBody() {$v7397e0741c9ce2781444c8afea22005c = fopen("php://input", "r");$v8d777f385d3dfec8815d20f7496026dc = "";while (!feof($v7397e0741c9ce2781444c8afea22005c)) {$v8d777f385d3dfec8815d20f7496026dc .= fread($v7397e0741c9ce2781444c8afea22005c, 1024);}fclose($v7397e0741c9ce2781444c8afea22005c);return $v8d777f385d3dfec8815d20f7496026dc;}public function sendHeaders() {if($this->headersSended) {return true;}else if (headers_sent()) {return false;}if(CALC_LAST_MODIFIED) $this->sendLastModified();$this->sendStatusHeader();$this->sendDefaultHeaders();foreach($this->headers as $v099fb995346f31c749f6e40db0f395e3 => $v2063c1608d6e0baf80249c42e2be5804) {$this->sendHeader($v099fb995346f31c749f6e40db0f395e3, $v2063c1608d6e0baf80249c42e2be5804);}$this->headersSended = true;}public function end() {if(getArrayKey($this->options, 'quick-edit')) {templater::prepareQuickEdit();}if(CALC_E_TAG) $this->sendETag();$this->push($this->getCallTime());$this->send();exit;}public function option($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804 = null) {if(is_null($v2063c1608d6e0baf80249c42e2be5804)) {return isset($this->options[$v3c6e0b8a9c15224a8228b9a98ca1531d]) ? $this->options[$v3c6e0b8a9c15224a8228b9a98ca1531d] : null;}else $this->options[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $v2063c1608d6e0baf80249c42e2be5804;}public function redirect($v572d4e421e5e6b9bc11d815e8a027112, $v9acb44549b41563697bb490144ec6258 = '301 Moved Permanently') {$this->status($v9acb44549b41563697bb490144ec6258);$this->header('Location', $v572d4e421e5e6b9bc11d815e8a027112);$this->end();}public function header($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804 = false) {if($v2063c1608d6e0baf80249c42e2be5804 === false) {unset($this->headers[$vb068931cc450442b63f5b3d276ea4297]);return NULL;}else {return $this->headers[$vb068931cc450442b63f5b3d276ea4297] = $v2063c1608d6e0baf80249c42e2be5804;}}protected function checkHTTPAuth() {$vd56b699830e77ba53855679cb1d252da = getServer('PHP_AUTH_USER');$v5f4dcc3b5aa765d61d8327deb882cf99 = getServer('PHP_AUTH_PW');if($vd56b699830e77ba53855679cb1d252da && $v5f4dcc3b5aa765d61d8327deb882cf99) {$permissions = permissionsCollection::getInstance();if($permissions->isAuth() == false) {if($vee11cbb19052e40b07aac0ca060c23ee = $permissions->checkLogin($vd56b699830e77ba53855679cb1d252da, $v5f4dcc3b5aa765d61d8327deb882cf99)) {$permissions->loginAsUser($vee11cbb19052e40b07aac0ca060c23ee->id);}else {$this->clear();$this->status('401 Unauthorized');$this->header('WWW-Authenticate: Basic realm="UMI.CMS"');$this->push('HTTP Authenticate failed');$this->end();}}}}protected function sendStatusHeader() {header("HTTP/1.1 " . $this->status);header("Status: " . $this->status);}protected function sendDefaultHeaders() {$this->sendHeader('Content-type', $this->contentType . '; charset=' . $this->charset);$this->sendHeader('Content-length', $this->length());$this->sendHeader('Date', (gmdate("D, d M Y H:i:s") . " GMT"));if(stristr(getServer('HTTP_USER_AGENT'), 'msie')) {$this->sendHeader('Cache-Control', 'no-store, no-cache, must-revalidate');$this->sendHeader('Pragma', 'no-cache');$this->sendHeader('Expires', gmdate('D, d M Y H:i:s') . ' GMT');$this->sendHeader('X-XSS-Protection', '0');}else {$this->sendHeader('Cache-Control', 'max-age=3600, private, must-revalidate');}if($this->option('send-stat-id')) {if (!getCookie('stat_id')) {setcookie('stat_id', session_id(), strtotime('+10 years'), "/");}}}protected function sendHeader($v099fb995346f31c749f6e40db0f395e3, $v2063c1608d6e0baf80249c42e2be5804) {header("{$v099fb995346f31c749f6e40db0f395e3}: {$v2063c1608d6e0baf80249c42e2be5804}");}protected function sendETag() {$this->sendHeader('E-tag', sha1($this->content()));}protected function sendLastModified() {$vb81ca7c0ccaa77e7aa91936ab0070695 = umiHierarchy::getInstance();$v5fa40b2485d1096a170d2d7ecd0f7030 = $vb81ca7c0ccaa77e7aa91936ab0070695->getElementsLastUpdateTime();if($v5fa40b2485d1096a170d2d7ecd0f7030) {$this->sendHeader('Last-Modified', (gmdate('D, d M Y H:i:s', $v5fa40b2485d1096a170d2d7ecd0f7030) . ' GMT'));$this->sendHeader('Expires', (gmdate('D, d M Y H:i:s', time() + 24 * 3600) . ' GMT'));if(function_exists("apache_request_headers")) {$v10573b873d2fa5a365d558a45e328e47 = apache_request_headers();if(isset($v10573b873d2fa5a365d558a45e328e47['If-Modified-Since']) && (strtotime($v10573b873d2fa5a365d558a45e328e47['If-Modified-Since']) >= $v5fa40b2485d1096a170d2d7ecd0f7030)) {$this->status('304 Not Modified');$this->sendHeader('Connection',  'close');}}}}protected function getCallTime() {$v6b65583eced7f2bc21d80ba0fc82066a = round(microtime(true) - $this->invokeTime, 6);if(!$this->option('generation-time')) {return;}switch($this->contentType) {case 'text/html':    case 'text/xml':     return "<!-- This page generated in {$v6b65583eced7f2bc21d80ba0fc82066a} secs -->";case 'application/javascript':    case 'text/javascript':     return "/* This page generated in {$v6b65583eced7f2bc21d80ba0fc82066a} secs */";default: "";}}};?>